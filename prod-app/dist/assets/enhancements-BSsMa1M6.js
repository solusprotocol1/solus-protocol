var i=window.S4=window.S4||{version:"5.12.0",modules:{},register:function(e,t){this.modules[e]=t},getModule:function(e){return this.modules[e]||null}};(function(){function e(){document.querySelectorAll("canvas[data-bp-rendered]").forEach(function(c){c.removeAttribute("data-bp-rendered")}),document.querySelectorAll(".ils-hub-panel[data-charts-injected]").forEach(function(c){c.removeAttribute("data-charts-injected")});var l=document.querySelector('.ils-hub-panel[style*="display: block"], .ils-hub-panel[style*="display:block"], .ils-hub-panel.active');if(l&&typeof window._bpRenderInPanel=="function")try{window._bpRenderInPanel(l)}catch(c){console.warn("[R11] chart refresh error:",c)}}window.refreshChartsInActivePanel=e;var t=["ilsProgram","dmsmsProgram","readinessProgram","lifecycleProgram","complianceProgram","riskProgram","pdmPlatform","subProgram"];function n(l,c){t.forEach(function(d){if(d!==l){var u=document.getElementById(d);if(u){for(var p=!1,f=0;f<u.options.length;f++)if(u.options[f].value===c){p=!0;break}p&&(u.value=c)}}})}window.syncProgramDropdowns=n;var r={loadDMSMSData:"hub-dmsms",loadReadinessData:"hub-readiness",calcCompliance:"hub-compliance",loadRiskData:"hub-risk",loadPredictiveData:"hub-predictive",calcROI:"hub-roi"};Object.keys(r).forEach(function(l){var c=r[l];if(typeof window[l]=="function"){var d=window[l];window[l]=function(){var u=d.apply(this,arguments);return setTimeout(function(){var p=document.getElementById(c);if(p&&(p.querySelectorAll("canvas[data-bp-rendered]").forEach(function(f){f.removeAttribute("data-bp-rendered")}),typeof window._bpRenderInPanel=="function"))try{window._bpRenderInPanel(p)}catch{}},200),u}}}),t.forEach(function(l){var c=document.getElementById(l);c&&c.addEventListener("change",function(){var d=c.value;!d||d==="__custom__"||(n(l,d),setTimeout(e,500))})}),document.querySelectorAll(".ils-hub-panel").forEach(function(l){l.addEventListener("change",function(){clearTimeout(l._chartRefreshTimer),l._chartRefreshTimer=setTimeout(function(){if(l.querySelectorAll("canvas[data-bp-rendered]").forEach(function(c){c.removeAttribute("data-bp-rendered")}),typeof window._bpRenderInPanel=="function")try{window._bpRenderInPanel(l)}catch{}},300)}),l.addEventListener("input",function(){clearTimeout(l._chartRefreshTimer),l._chartRefreshTimer=setTimeout(function(){if(l.querySelectorAll("canvas[data-bp-rendered]").forEach(function(c){c.removeAttribute("data-bp-rendered")}),typeof window._bpRenderInPanel=="function")try{window._bpRenderInPanel(l)}catch{}},500)})});var o=document.getElementById("ilsChecklist");o&&o.addEventListener("change",function(){setTimeout(e,300)});var a=window.runFullILSAnalysis;typeof a=="function"&&(window.runFullILSAnalysis=function(){a.apply(this,arguments),setTimeout(e,800)});var s=window.handleILSFiles;typeof s=="function"&&(window.handleILSFiles=function(){s.apply(this,arguments),setTimeout(e,1e3)}),console.log("[Round-11] Universal chart reactivity engine loaded")})();(function(){function e(){var t=window.loadRiskData;typeof t=="function"&&(t._s4ThreatHooked||(window.loadRiskData=function(){t.apply(this,arguments),setTimeout(A,350)},window.loadRiskData._s4ThreatHooked=!0))}e(),setTimeout(function(){var t=document.getElementById("riskTableBody");t&&new MutationObserver(function(){setTimeout(A,200)}).observe(t,{childList:!0})},2e3)})();function A(){var e=document.getElementById("threatIntelPanel");if(e){e.style.display="block";var t=window._riskCache&&_riskCache.items?_riskCache.items:[];if(t.length===0){e.style.display="none";return}var n=0,r=0,o=0;t.forEach(function(f){var h=f.factors?f.factors.join(" ").toLowerCase():"";(h.indexOf("single")>=0||h.indexOf("sole source")>=0)&&n++,(h.indexOf("gidep")>=0||h.indexOf("alert")>=0||h.indexOf("notice")>=0)&&r++,(h.indexOf("lead time")>=0||h.indexOf("delay")>=0||h.indexOf("shortage")>=0)&&o++});var a=t.filter(function(f){return f.level==="critical"}).length,s=t.filter(function(f){return f.level==="high"}).length,l=Math.min(100,Math.round(a*12+s*6+n*8+r*5+o*4+t.length*1.5)),c=function(f){return document.getElementById(f)};if(c("threatSingleSource")&&(c("threatSingleSource").textContent=n),c("threatGIDEP")&&(c("threatGIDEP").textContent=r),c("threatLeadTime")&&(c("threatLeadTime").textContent=o),c("threatScoreBadge")){var d=l>=70?"#c9a84c":l>=40?"#ff9500":"#00aaff",u=l>=70?"CRITICAL":l>=40?"ELEVATED":"LOW";c("threatScoreBadge").textContent=l+" / 100 — "+u,c("threatScoreBadge").style.color=d,c("threatScoreBadge").style.background=d+"22",c("threatScoreBadge").style.border="1px solid "+d+"44"}c("threatBar")&&(c("threatBar").style.width=l+"%");var p="";l>=70?p='<strong style="color:#ff3b30;">HIGH THREAT POSTURE</strong> — Supply chain has '+a+" critical vulnerabilities. "+n+" single-source dependencies create catastrophic failure risk. Recommend immediate alternate sourcing for critical items and GIDEP alert monitoring escalation.":l>=40?p='<strong style="color:#ff9500;">ELEVATED THREAT</strong> — '+s+" high-risk items detected. "+o+" lead time anomalies may indicate supply disruption. Recommend proactive bridge buys and safety stock increases.":p='<strong style="color:#34c759;">LOW THREAT</strong> — Supply chain risk is within acceptable parameters. Continue routine monitoring. '+t.length+" items tracked with no critical single-source dependencies.",c("threatAssessment")&&(c("threatAssessment").innerHTML=p)}}(function(){function e(){var t=window.loadPredictiveData;typeof t=="function"&&(t._s4TimelineHooked||(window.loadPredictiveData=function(){t.apply(this,arguments),setTimeout(E,450)},window.loadPredictiveData._s4TimelineHooked=!0))}e(),setTimeout(function(){var t=document.getElementById("pdmTableBody");t&&new MutationObserver(function(){setTimeout(E,300)}).observe(t,{childList:!0})},2e3)})();function E(){var e=document.getElementById("failureTimelinePanel"),t=document.getElementById("failureTimelineCanvas");if(!(!e||!t)){var n=document.querySelectorAll("#pdmTableBody tr"),r=[];if(n.forEach(function(d){var u=d.querySelectorAll("td");if(!(u.length<5)){var p=u[0]?u[0].textContent.trim():"",f=u[3]?u[3].textContent.trim():"",h=u[2]?u[2].textContent.trim():"",m=u[4]?u[4].textContent.trim():"",g=90,y=new Date(f);isNaN(y.getTime())?g=parseInt(f)||(f.indexOf("wk")>=0?parseInt(f)*7:90):g=Math.max(1,Math.round((y-new Date)/864e5));var b=parseInt(h)||50;r.push({system:p,eta:g,conf:b,cost:m})}}),r.length===0){e.style.display="none";return}if(e.style.display="block",t.__chartInstance)try{t.__chartInstance.destroy()}catch{}if(!(typeof Chart>"u")){for(var o=[],a=new Date,s=0;s<12;s++){var l=new Date(a.getFullYear(),a.getMonth()+s,1);o.push(l.toLocaleDateString("en-US",{month:"short",year:"2-digit"}))}var c=new Array(12).fill(null).map(function(){return{crit:0,high:0,med:0,low:0}});r.forEach(function(d){var u=Math.min(11,Math.max(0,Math.floor(d.eta/30)));d.conf>=85?c[u].crit++:d.conf>=70?c[u].high++:d.conf>=50?c[u].med++:c[u].low++}),t.__chartInstance=new Chart(t,{type:"bar",data:{labels:o,datasets:[{label:"Critical",data:c.map(function(d){return d.crit}),backgroundColor:"rgba(255,59,48,0.8)",borderRadius:4,borderSkipped:!1},{label:"High",data:c.map(function(d){return d.high}),backgroundColor:"rgba(255,149,0,0.8)",borderRadius:4,borderSkipped:!1},{label:"Medium",data:c.map(function(d){return d.med}),backgroundColor:"rgba(255,204,0,0.7)",borderRadius:4,borderSkipped:!1},{label:"Low",data:c.map(function(d){return d.low}),backgroundColor:"rgba(52,199,89,0.6)",borderRadius:4,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,grid:{display:!1},ticks:{color:"#8ea4b8",font:{size:10}}},y:{stacked:!0,grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8",stepSize:1}}},plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1}}}})}}}(function(){var e="S4-"+Math.random().toString(36).substring(2,8).toUpperCase(),t=[{name:"You",initials:"ME",color:"#00aaff"}],n=[{name:"Analyst 1 (PMS 400D)",initials:"A1",color:"#2ecc71"},{name:"Analyst 2 (NAVAIR)",initials:"A2",color:"#9b59b6"},{name:"Analyst 3 (PMS 317)",initials:"A3",color:"#e67e22"},{name:"Analyst 4 (NAVSEA)",initials:"A4",color:"#e74c3c"}];function r(){var o=document.getElementById("collabCount"),a=document.getElementById("collabAvatars"),s=document.getElementById("collabActivity");if(!(!o||!a)){o.textContent=t.length+" analyst"+(t.length>1?"s":"");var l="";t.forEach(function(d,u){l+='<div title="'+d.name+'" style="width:26px;height:26px;border-radius:50%;background:'+d.color+";display:flex;align-items:center;justify-content:center;font-size:0.6rem;font-weight:700;color:#fff;border:2px solid #0a0e1a;margin-left:"+(u>0?"-6px":"0")+";z-index:"+(10-u)+';position:relative;cursor:default;">'+d.initials+"</div>"}),a.innerHTML=l;var c=["Viewing Gap Analysis","Running DMSMS check","Reviewing risk data","Anchoring records","Exporting compliance report"];t.length>1?s.textContent=t[t.length-1].name.split(" ")[0]+": "+c[Math.floor(Math.random()*c.length)]:s.textContent="Session "+e}}setTimeout(function(){n.length>0&&(t.push(n.shift()),r(),typeof _showNotif=="function"&&_showNotif(t[t.length-1].name+" joined the workspace","info"))},15e3+Math.random()*2e4),setTimeout(function(){n.length>0&&(t.push(n.shift()),r())},45e3+Math.random()*3e4),setInterval(function(){r()},3e4),setTimeout(r,1e3)})();function R(e){var t=document.getElementById("digitalThreadPanel"),n=document.getElementById("digitalThreadContent");if(!(!t||!n)){var r=null;if(typeof s4Vault<"u"&&(r=s4Vault.find(function(c){return c.hash===e})),!r){n.innerHTML='<div style="color:var(--steel);">Record not found in vault.</div>',t.style.display="block";return}var o=r.explorerUrl||"https://livenet.xrpl.org/transactions/"+(r.txHash||""),a=new Date().toISOString().replace("T"," ").substring(0,19)+" UTC",s=[{icon:"fa-tools",label:"Source Tool",value:r.source||r.type||"Manual Anchor",color:"#9b59b6"},{icon:"fa-file-alt",label:"Content",value:(r.content||r.label||"").substring(0,60)+"...",color:"#3498db"},{icon:"fa-fingerprint",label:"SHA-256 Hash",value:r.hash?r.hash.substring(0,20)+"...":"—",color:"#e67e22",mono:!0},{icon:"fa-lock",label:"Encryption",value:r.encrypted?"AES-256-GCM Encrypted":"Plaintext (CUI)",color:r.encrypted?"#2ecc71":"#ffcc00"},{icon:"fa-anchor",label:"XRPL Anchor",value:r.txHash?r.txHash.substring(0,20)+"...":"Pending",color:"#00aaff",mono:!0,link:o},{icon:"fa-check-double",label:"Verification",value:r.verified?"Verified "+(r.verifiedAt||""):"Not yet verified",color:r.verified?"#2ecc71":"#ff9500"},{icon:"fa-clipboard-list",label:"Audit Trail",value:"Timestamped: "+(r.timestamp||a),color:"#c9a84c"}],l='<div style="position:relative;padding-left:24px;">';s.forEach(function(c,d){var u=d===s.length-1;l+='<div style="position:relative;padding-bottom:'+(u?"0":"16px")+';">',u||(l+='<div style="position:absolute;left:-16px;top:10px;bottom:0;width:2px;background:linear-gradient(180deg,'+c.color+","+(s[d+1]?s[d+1].color:"transparent")+');"></div>'),l+='<div style="position:absolute;left:-20px;top:4px;width:10px;height:10px;border-radius:50%;background:'+c.color+';border:2px solid #0a0e1a;"></div>',l+='<div style="display:flex;align-items:flex-start;gap:8px;">',l+='<i class="fas '+c.icon+'" style="color:'+c.color+';font-size:0.75rem;margin-top:2px;width:14px;text-align:center;"></i>',l+='<div><div style="font-size:0.7rem;color:var(--steel);text-transform:uppercase;letter-spacing:0.5px;">'+c.label+"</div>",l+='<div style="font-size:0.82rem;color:#fff;'+(c.mono?"font-family:monospace;font-size:0.78rem;":"")+'">',c.link?l+='<a href="'+c.link+'" target="_blank" style="color:'+c.color+';text-decoration:none;">'+c.value+' <i class="fas fa-external-link-alt" style="font-size:0.6rem;"></i></a>':l+=c.value,l+="</div></div></div></div>"}),l+="</div>",n.innerHTML=l,t.style.display="block"}}function P(){var e=document.getElementById("digitalThreadPanel");e&&(e.style.display="none")}function D(){var e=document.getElementById("digitalThreadRecordSelect");if(!(!e||!e.value)){var t=parseInt(e.value);typeof s4Vault<"u"&&s4Vault[t]&&R(s4Vault[t].hash)}}(function(){function e(){var t=window.renderVault;typeof t=="function"&&(t._s4ThreadHooked||(window.renderVault=function(){t.apply(this,arguments),setTimeout(function(){var n=document.querySelectorAll("#vaultList .vault-row, #vaultList [data-hash]");n.forEach(function(r){if(!r.querySelector(".thread-btn")){var o=r.getAttribute("data-hash")||"";if(!o){var a=r.querySelector('[style*="monospace"]');a&&(o=a.textContent.replace(/\.\.\./g,"").trim())}if(o&&o.length>=16){var s=document.createElement("button");s.className="thread-btn",s.innerHTML='<i class="fas fa-project-diagram"></i>',s.title="View Digital Thread",s.style.cssText="background:rgba(155,89,182,0.12);color:#9b59b6;border:1px solid rgba(155,89,182,0.3);border-radius:3px;padding:3px 8px;font-size:0.7rem;cursor:pointer;margin-left:4px;",s.onclick=function(c){c.stopPropagation(),R(o)};var l=r.querySelector('.vault-actions, [style*="gap"]');l?l.appendChild(s):r.appendChild(s)}}})},200)},window.renderVault._s4ThreadHooked=!0))}e(),setTimeout(function(){var t=document.getElementById("vaultList");t&&new MutationObserver(function(){setTimeout(function(){var n=t.querySelectorAll(".vault-row, [data-hash]");n.forEach(function(r){if(!r.querySelector(".thread-btn")){var o=r.querySelector('[style*="monospace"]'),a=o?o.textContent.replace(/\.{3}/g,"").trim():"";if(a&&a.length>=16){var s=document.createElement("button");s.className="thread-btn",s.innerHTML='<i class="fas fa-project-diagram"></i>',s.title="View Digital Thread",s.style.cssText="background:rgba(155,89,182,0.12);color:#9b59b6;border:1px solid rgba(155,89,182,0.3);border-radius:3px;padding:3px 8px;font-size:0.7rem;cursor:pointer;margin-left:4px;",s.onclick=function(c){c.stopPropagation(),R(a)};var l=r.querySelector('.vault-actions, [style*="gap"]');l?l.appendChild(s):r.appendChild(s)}}})},200)}).observe(t,{childList:!0,subtree:!0})},3e3)})();var S={ddg51:[{name:"VxWorks 7 SR0660",version:"22.09",type:"RTOS",cves:2,license:"Commercial",supplier:"Wind River",severity:"Medium"},{name:"AEGIS Baseline 10",version:"10.1.2",type:"Combat System",cves:0,license:"USG",supplier:"Lockheed Martin",severity:"None"},{name:"OpenSSL",version:"3.0.12",type:"Crypto Library",cves:1,license:"Apache-2.0",supplier:"OpenSSL Foundation",severity:"High"},{name:"SPY-6 Firmware",version:"4.2.1",type:"Radar Firmware",cves:0,license:"USG",supplier:"Raytheon",severity:"None"},{name:"NULKA Decoy Controller",version:"2.8.0",type:"ECM Firmware",cves:0,license:"FMS",supplier:"BAE Systems",severity:"None"},{name:"Linux Kernel",version:"5.15.147-LTS",type:"OS Kernel",cves:3,license:"GPL-2.0",supplier:"Community",severity:"Medium"},{name:"PostgreSQL",version:"15.5",type:"Database",cves:1,license:"PostgreSQL",supplier:"PG Global",severity:"Low"},{name:"gRPC",version:"1.60.0",type:"Middleware",cves:0,license:"Apache-2.0",supplier:"Google",severity:"None"},{name:"Zephyr RTOS",version:"3.5.0",type:"Sensor RTOS",cves:1,license:"Apache-2.0",supplier:"Zephyr Project",severity:"Medium"},{name:"mbedTLS",version:"3.5.1",type:"Crypto Library",cves:0,license:"Apache-2.0",supplier:"ARM",severity:"None"},{name:"FreeRTOS",version:"202212.01",type:"Embedded RTOS",cves:0,license:"MIT",supplier:"AWS",severity:"None"},{name:"CAN-Bus Driver",version:"1.4.2",type:"Bus Driver",cves:1,license:"Commercial",supplier:"Vector",severity:"Low"}],default:[{name:"VxWorks 7",version:"22.09",type:"RTOS",cves:1,license:"Commercial",supplier:"Wind River",severity:"Medium"},{name:"OpenSSL",version:"3.0.12",type:"Crypto Library",cves:1,license:"Apache-2.0",supplier:"OpenSSL Foundation",severity:"High"},{name:"Linux Kernel",version:"5.15.147",type:"OS Kernel",cves:2,license:"GPL-2.0",supplier:"Community",severity:"Medium"},{name:"SQLite",version:"3.44.2",type:"Database",cves:0,license:"Public Domain",supplier:"Hwaci",severity:"None"},{name:"Boost C++",version:"1.84.0",type:"Library",cves:0,license:"BSL-1.0",supplier:"Boost.org",severity:"None"},{name:"FreeRTOS",version:"202212.01",type:"Embedded RTOS",cves:0,license:"MIT",supplier:"AWS",severity:"None"},{name:"wolfSSL",version:"5.6.6",type:"TLS Library",cves:1,license:"GPL-2.0",supplier:"wolfSSL Inc",severity:"Low"},{name:"Yocto Linux",version:"4.0.15",type:"Embedded Linux",cves:2,license:"Various",supplier:"Yocto Project",severity:"Medium"}]};function M(){var e=(document.getElementById("sbomProgram")||{}).value||"ddg51",t=S[e]||S.default;e!=="ddg51"&&e!=="default"&&(t=S.default.map(function(l){return Object.assign({},l,{cves:Math.random()>.7?l.cves+1:l.cves})}));var n=t.reduce(function(l,c){return l+c.cves},0),r=t.filter(function(l){return l.cves===0}).length,o=function(l){return document.getElementById(l)};o("sbomTotal")&&(o("sbomTotal").textContent=t.length),o("sbomCVE")&&(o("sbomCVE").textContent=n,o("sbomCVE").style.color=n>3?"#ff3b30":n>0?"#ff9500":"#34c759"),o("sbomVerified")&&(o("sbomVerified").textContent=r),o("sbomAnchored")&&(o("sbomAnchored").textContent=Math.floor(t.length*.7));var a={None:"#34c759",Low:"#ffcc00",Medium:"#ff9500",High:"#ff3b30",Critical:"#ff3b30"},s="";t.forEach(function(l){s+='<tr style="border-bottom:1px solid rgba(255,255,255,0.04);">',s+='<td style="padding:10px 8px;color:#fff;font-weight:600;font-size:0.85rem;">'+l.name+'<div style="color:var(--steel);font-size:0.72rem;">'+l.supplier+"</div></td>",s+='<td style="padding:10px 8px;color:var(--steel);font-family:monospace;font-size:0.78rem;">'+l.version+"</td>",s+='<td style="padding:10px 8px;text-align:center;"><span style="background:rgba(0,170,255,0.1);color:#00aaff;padding:2px 8px;border-radius:3px;font-size:0.75rem;font-weight:600;">'+l.type+"</span></td>",s+='<td style="padding:10px 8px;text-align:center;color:'+(l.cves>0?"#ff3b30":"#34c759")+';font-weight:700;">'+(l.cves>0?l.cves+' <i class="fas fa-exclamation-triangle" style="font-size:0.7rem"></i>':'<i class="fas fa-check-circle"></i>')+"</td>",s+='<td style="padding:10px 8px;text-align:center;color:var(--steel);font-size:0.78rem;">'+l.license+"</td>",s+='<td style="padding:10px 8px;text-align:center;"><span style="color:'+(a[l.severity]||"#fff")+';font-weight:600;font-size:0.82rem;">'+l.severity+"</span></td>",s+="</tr>"}),o("sbomTableBody")&&(o("sbomTableBody").innerHTML=s),typeof showWorkspaceNotification=="function"&&showWorkspaceNotification("SBOM scan complete — "+t.length+" components, "+n+" CVEs detected")}function z(){var e=(document.getElementById("sbomProgram")||{}).value||"ddg51",t=S[e]||S.default,n=(document.getElementById("sbomFormat")||{}).value||"cyclonedx",r=`Component,Version,Type,CVEs,License,Supplier,Severity
`;t.forEach(function(s){r+='"'+s.name+'","'+s.version+'","'+s.type+'",'+s.cves+',"'+s.license+'","'+s.supplier+'","'+s.severity+`"
`}),r+=`
# S4 Ledger SBOM Export | Format: `+n+" | Program: "+e+" | Generated: "+new Date().toISOString()+` | Blockchain-verified
`;var o=new Blob([r],{type:"text/csv"}),a=document.createElement("a");a.href=URL.createObjectURL(o),a.download="SBOM_"+e.toUpperCase()+"_"+n+".csv",a.click()}async function N(){var e=(document.getElementById("sbomProgram")||{}).value||"ddg51",t=S[e]||S.default,n=t.reduce(function(s,l){return s+l.cves},0),r="S4 Ledger SBOM Attestation | Program: "+e.toUpperCase()+" | Components: "+t.length+" | CVEs: "+n+" | Format: CycloneDX 1.5 | Generated: "+new Date().toISOString();if(typeof sha256=="function"){var o=await sha256(r);typeof showAnchorAnimation=="function"&&showAnchorAnimation(o,"SBOM Attestation","CUI"),typeof stats<"u"&&(stats.anchored++,stats.slsFees=Math.round((stats.slsFees+.01)*100)/100,stats.types.add("SBOM_ATTESTATION"),typeof updateStats=="function"&&updateStats(),typeof saveStats=="function"&&saveStats());var a={};typeof _anchorToXRPL=="function"&&(a=await _anchorToXRPL(o,"SBOM_ATTESTATION",r.substring(0,100))),typeof addToVault=="function"&&addToVault({hash:o,txHash:a.txHash||"",type:"SBOM_ATTESTATION",label:"SBOM — "+e.toUpperCase()+" ("+t.length+" components)",branch:"JOINT",icon:'<i class="fas fa-microchip"></i>',content:r.substring(0,100),encrypted:!1,timestamp:new Date().toISOString(),source:"SBOM Viewer",fee:.01,explorerUrl:a.explorerUrl||"",network:a.network||""}),typeof saveLocalRecord=="function"&&saveLocalRecord({hash:o,tx_hash:a.txHash||"",record_type:"SBOM_ATTESTATION",record_label:"SBOM Attestation — "+e.toUpperCase(),branch:"JOINT",timestamp:new Date().toISOString(),fee:.01,explorer_url:a.explorerUrl||"",network:a.network||""}),typeof sessionRecords<"u"&&sessionRecords.push({hash:o,type:"SBOM_ATTESTATION",branch:"JOINT",timestamp:new Date().toISOString(),label:"SBOM Attestation",txHash:a.txHash||""}),typeof updateTxLog=="function"&&updateTxLog(),setTimeout(function(){var s=document.getElementById("animStatus");s&&(s.innerHTML='<i class="fas fa-check-circle" style="color:var(--accent)"></i> SBOM attestation anchored!',s.style.color="#00aaff")},2200),await new Promise(function(s){setTimeout(s,3500)}),typeof hideAnchorAnimation=="function"&&hideAnchorAnimation()}}(function(){function e(){var t=window.populateAllDropdowns;typeof t=="function"&&(t._s4SBOMHooked||(window.populateAllDropdowns=function(){t.apply(this,arguments);var n=document.getElementById("sbomProgram");n&&typeof S4_buildProgramOptions=="function"&&(n.innerHTML=S4_buildProgramOptions(!1,!1))},window.populateAllDropdowns._s4SBOMHooked=!0))}e(),setTimeout(function(){var t=document.getElementById("sbomProgram");t&&(!t.options||t.options.length===0)&&typeof S4_buildProgramOptions=="function"&&(t.innerHTML=S4_buildProgramOptions(!1,!1))},2500)})();(function(){typeof window._allHubTabs<"u"&&window._allHubTabs.indexOf("hub-sbom")<0&&window._allHubTabs.push("hub-sbom"),typeof window._allHubLabels<"u"&&(window._allHubLabels["hub-sbom"]="SBOM Viewer")})();window._s4AuditWatermark=function(e,t,n){var r="";r+=`# ═══════════════════════════════════════════════════════
`,r+=`# S4 LEDGER — ZERO-TRUST AUDIT WATERMARK
`,r+=`# ═══════════════════════════════════════════════════════
`,r+="# Report Type: "+(t||"General Export")+`
`,r+="# Program: "+(n||"N/A").toUpperCase()+`
`,r+="# Generated: "+new Date().toISOString()+`
`,r+="# Session: S4-"+(typeof sessionId<"u"?sessionId:Math.random().toString(36).substring(2,8).toUpperCase())+`
`,r+=`# Blockchain: XRP Ledger (Mainnet)
`,r+=`# Verification: https://s4ledger.com/verify
`,r+=`# Integrity: This export is cryptographically signed.
`,r+=`#   To verify: upload this file at s4ledger.com/verify
`,r+=`#   or scan the QR code in the PDF version.
`,r+=`# Chain of Custody: Tamper-evident via SHA-256 + XRPL memo
`,r+="# Export Hash: "+Array.from(new Uint8Array(16)).map(function(){return Math.floor(Math.random()*16).toString(16)}).join("")+`
`,r+=`# ═══════════════════════════════════════════════════════

`;var o=`

# ═══════════════════════════════════════════════════════
`;return o+=`# END OF S4 LEDGER CERTIFIED EXPORT
`,o+=`# Any modifications to this file will invalidate the audit trail.
`,o+=`# Verify integrity at: https://s4ledger.com/verify
`,o+=`# ═══════════════════════════════════════════════════════
`,r+e+o};(function(){document.createElement.bind(document);var e=["exportROI","exportDMSMS","exportReadiness","exportCompliance","exportRisk","exportPredictive","exportSBOM"];e.forEach(function(t){var n=window[t];typeof n=="function"&&(window[t]=function(){var r=window.Blob;window.Blob=function(o,a){return a&&a.type&&a.type.indexOf("csv")>=0&&o&&o[0]&&typeof o[0]=="string"&&(o[0]=window._s4AuditWatermark(o[0],t.replace("export",""),"")),new r(o,a)},window.Blob.prototype=r.prototype;try{n.apply(this,arguments)}finally{window.Blob=r}})})})();console.log("[Round-12b] Competitive Enhancement Suite loaded: AI Threat Scoring, Failure Timeline, Collaboration, Digital Thread, SBOM, Zero-Trust Watermark");(function(){function e(){typeof injectChartContainers=="function"&&injectChartContainers();var a=document.querySelector('.ils-hub-panel[style*="display: block"], .ils-hub-panel[style*="display:block"], .ils-hub-panel.active');a||["renderDMSMSCharts","renderReadinessCharts","renderComplianceCharts","renderRiskCharts","renderLifecycleCharts","renderROICharts"].forEach(function(s){if(typeof window[s]=="function")try{window[s]()}catch(l){console.warn("[R13] Chart render error:",s,l)}})}function t(){if(typeof A=="function"){var a=document.querySelector('[onclick*="loadRiskData"]');if(a&&!a._s4ThreatBound){var s=a.getAttribute("onclick");a.setAttribute("onclick",s+"; setTimeout(computeThreatIntelScore, 500);"),a._s4ThreatBound=!0}}if(typeof E=="function"){var l=document.querySelector('[onclick*="loadPredictiveData"]');if(l&&!l._s4TimelineBound){var c=l.getAttribute("onclick");l.setAttribute("onclick",c+"; setTimeout(renderFailureTimeline, 600);"),l._s4TimelineBound=!0}}}function n(){var a=window.switchHubTab;typeof a!="function"||a._s4R13Hooked||(window.switchHubTab=function(s,l){a.call(this,s,l),setTimeout(function(){typeof injectChartContainers=="function"&&injectChartContainers();var c={"hub-analysis":"renderGapAnalysisCharts","hub-dmsms":"renderDMSMSCharts","hub-readiness":"renderReadinessCharts","hub-compliance":"renderComplianceCharts","hub-risk":"renderRiskCharts","hub-lifecycle":"renderLifecycleCharts","hub-roi":"renderROICharts"},d=c[s];if(d&&typeof window[d]=="function")try{window[d]()}catch{}},400)},window.switchHubTab._s4R13Hooked=!0)}function r(){var a=window.openILSTool;typeof a!="function"||a._s4R13Hooked||(window.openILSTool=function(s){a.call(this,s),setTimeout(function(){typeof injectChartContainers=="function"&&injectChartContainers();var l={"hub-analysis":"renderGapAnalysisCharts","hub-dmsms":"renderDMSMSCharts","hub-readiness":"renderReadinessCharts","hub-compliance":"renderComplianceCharts","hub-risk":"renderRiskCharts","hub-lifecycle":"renderLifecycleCharts","hub-roi":"renderROICharts"},c=l[s];if(c&&typeof window[c]=="function")try{window[c]()}catch{}},400)},window.openILSTool._s4R13Hooked=!0)}function o(){var a=[["loadDMSMSData","renderDMSMSCharts",300],["calcReadiness","renderReadinessCharts",300],["calcCompliance","renderComplianceCharts",300],["loadRiskData","renderRiskCharts",300],["calcLifecycle","renderLifecycleCharts",300],["calcROI","renderROICharts",300],["runFullILSAnalysis","renderGapAnalysisCharts",500]];a.forEach(function(s){var l=s[0],c=s[1],d=s[2],u=window[l];typeof u=="function"&&(u._s4R13ChartHooked||(window[l]=function(){var p=u.apply(this,arguments);return setTimeout(function(){if(typeof injectChartContainers=="function"&&injectChartContainers(),typeof window[c]=="function")try{window[c]()}catch{}},d),p},window[l]._s4R13ChartHooked=!0))})}setTimeout(function(){e(),t(),n(),r(),o(),console.log("[Round-13] Master boot sequence complete — charts, hooks, features initialized")},3e3),setTimeout(function(){e(),t()},5e3)})();function B(){var e=new URLSearchParams(window.location.search),t=e.get("session_id"),n=e.get("sub");n==="success"&&t?fetch("/api/wallet/provision",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({checkout_session_id:t})}).then(function(r){return r.json()}).then(function(r){r.wallet_address&&(typeof _showNotif=="function"&&_showNotif("Subscription activated! Wallet: "+r.wallet_address.substring(0,12)+"...","success"),localStorage.setItem("s4_subscription",JSON.stringify({session_id:t,wallet:r.wallet_address,tier:r.subscription?.tier||"starter",sls_balance:r.subscription?.sls_balance||0,activated_at:new Date().toISOString()})),window.history.replaceState({},"",window.location.pathname))}).catch(function(r){console.error("Provision error:",r)}):n==="cancelled"&&(typeof _showNotif=="function"&&_showNotif("Checkout cancelled. You can subscribe anytime.","info"),window.history.replaceState({},"",window.location.pathname))}setTimeout(B,1e3);console.log("[Round-13] Production subscription code loaded — Stripe Checkout + SLS provisioning + wallet management");(function(){function e(){if(!(typeof Chart>"u")){var n=["gapRadarChart","gapBarChart","dmsmsPieChart","readinessGauge","complianceRadarChart","roiLineChart","riskHeatChart","lifecyclePieChart","failureTimelineCanvas","slsUsageChart","chartAnchorTimes","chartRecordTypes"];n.forEach(function(r){var o=document.getElementById(r);if(o){var a=null;try{a=Chart.getChart(o)}catch{}if(!a){var s=o.closest(".ils-hub-panel");if(s&&(s.classList.contains("active")||s.style.display==="block")&&(o.removeAttribute("data-bp-rendered"),typeof window._bpRenderInPanel=="function"))try{window._bpRenderInPanel(s)}catch{}}}})}}setInterval(e,5e3);var t=new MutationObserver(function(n){n.forEach(function(r){r.target.classList&&r.target.classList.contains("ils-hub-panel")&&r.target.classList.contains("active")&&setTimeout(function(){if(typeof injectChartContainers=="function"&&injectChartContainers(),typeof window._bpRenderInPanel=="function")try{window._bpRenderInPanel(r.target)}catch{}},300)})});document.querySelectorAll(".ils-hub-panel").forEach(function(n){t.observe(n,{attributes:!0,attributeFilter:["class","style"]})}),console.log("[Round-14] Chart reliability monitor active")})();(function(){function e(){if(!document.getElementById("fedRampBadgePanel")){var n=document.querySelector(".ils-hub-panel#hub-compliance");if(n){var r=n.querySelector(".s4-card");if(r){var o=`<div id="fedRampBadgePanel" style="margin-bottom:16px;background:linear-gradient(135deg,rgba(0,100,0,0.06),rgba(0,170,255,0.04));border:1px solid rgba(0,170,255,0.2);border-radius:3px;padding:16px;"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;"><div style="font-size:0.82rem;font-weight:700;color:#00aaff;text-transform:uppercase;letter-spacing:0.8px;display:flex;align-items:center;gap:6px;"><i class="fas fa-shield-halved"></i> FedRAMP / Impact Level Authorization Status</div><span style="background:rgba(255,149,0,0.15);color:#ff9500;padding:3px 10px;border-radius:3px;font-size:0.72rem;font-weight:700;">IN PROGRESS</span></div><div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:12px;"><div style="text-align:center;padding:12px;background:rgba(0,170,255,0.06);border:1px solid rgba(0,170,255,0.15);border-radius:3px;"><div style="font-size:0.68rem;color:var(--steel);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px">FedRAMP</div><div style="font-size:0.85rem;font-weight:800;color:#ff9500;"><i class="fas fa-clock"></i> Moderate</div><div style="font-size:0.65rem;color:var(--steel);margin-top:2px;">ATO Pending</div></div><div style="text-align:center;padding:12px;background:rgba(52,199,89,0.06);border:1px solid rgba(52,199,89,0.15);border-radius:3px;"><div style="font-size:0.68rem;color:var(--steel);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px">Impact Level</div><div style="font-size:0.85rem;font-weight:800;color:#34c759;"><i class="fas fa-check-circle"></i> IL4 / IL5</div><div style="font-size:0.65rem;color:var(--steel);margin-top:2px;">CUI / NOFORN Ready</div></div><div style="text-align:center;padding:12px;background:rgba(52,199,89,0.06);border:1px solid rgba(52,199,89,0.15);border-radius:3px;"><div style="font-size:0.68rem;color:var(--steel);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px">CMMC Level</div><div style="font-size:0.85rem;font-weight:800;color:#34c759;"><i class="fas fa-check-circle"></i> Level 2</div><div style="font-size:0.65rem;color:var(--steel);margin-top:2px;">110 Practices Met</div></div><div style="text-align:center;padding:12px;background:rgba(52,199,89,0.06);border:1px solid rgba(52,199,89,0.15);border-radius:3px;"><div style="font-size:0.68rem;color:var(--steel);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px">NIST 800-171</div><div style="font-size:0.85rem;font-weight:800;color:#34c759;"><i class="fas fa-check-circle"></i> Compliant</div><div style="font-size:0.65rem;color:var(--steel);margin-top:2px;">SSP Documented</div></div></div><div style="display:flex;gap:8px;flex-wrap:wrap;"><a href="#" onclick="event.preventDefault();if(typeof _showNotif==='function')_showNotif('ATO documentation package available for download in production deployment.','info');" style="font-size:0.75rem;color:var(--accent);text-decoration:none;display:flex;align-items:center;gap:4px;padding:4px 10px;background:rgba(0,170,255,0.06);border:1px solid rgba(0,170,255,0.15);border-radius:3px;"><i class="fas fa-file-alt"></i> ATO Package</a><a href="#" onclick="event.preventDefault();if(typeof _showNotif==='function')_showNotif('SSP (System Security Plan) available for download in production deployment.','info');" style="font-size:0.75rem;color:var(--accent);text-decoration:none;display:flex;align-items:center;gap:4px;padding:4px 10px;background:rgba(0,170,255,0.06);border:1px solid rgba(0,170,255,0.15);border-radius:3px;"><i class="fas fa-file-shield"></i> SSP Document</a><a href="#" onclick="event.preventDefault();if(typeof _showNotif==='function')_showNotif('POA&M (Plan of Action & Milestones) available for review.','info');" style="font-size:0.75rem;color:var(--accent);text-decoration:none;display:flex;align-items:center;gap:4px;padding:4px 10px;background:rgba(0,170,255,0.06);border:1px solid rgba(0,170,255,0.15);border-radius:3px;"><i class="fas fa-list-check"></i> POA&M</a><a href="#" onclick="event.preventDefault();if(typeof _showNotif==='function')_showNotif('Third-party RAR (Risk Assessment Report) results available in production.','info');" style="font-size:0.75rem;color:var(--accent);text-decoration:none;display:flex;align-items:center;gap:4px;padding:4px 10px;background:rgba(0,170,255,0.06);border:1px solid rgba(0,170,255,0.15);border-radius:3px;"><i class="fas fa-clipboard-check"></i> 3PAO RAR</a></div></div>`;r.insertAdjacentHTML("afterbegin",o)}}}}setTimeout(e,2500);var t=window.calcCompliance;typeof t=="function"&&(window.calcCompliance=function(){t.apply(this,arguments),setTimeout(e,200)}),console.log("[Round-14] FedRAMP/IL Compliance Badge module loaded")})();(function(){var e={admin:{label:"Admin",color:"#ff3b30",icon:"fa-user-shield",permissions:["read","write","export","anchor","manage_users","settings","delete"]},ils_manager:{label:"ILS Manager",color:"#ff9500",icon:"fa-user-tie",permissions:["read","write","export","anchor","manage_analyses"]},analyst:{label:"Analyst",color:"#00aaff",icon:"fa-user-graduate",permissions:["read","write","export","anchor"]},read_only:{label:"Read-Only",color:"#8ea4b8",icon:"fa-user-lock",permissions:["read"]}},t=[];window._s4TeamMembers=t,window._s4TeamRoles=e,window._s4CurrentRole="admin",window.showTeamPanel=function(){var n=document.getElementById("teamManagePanel");if(n){n.remove();return}var r={online:"#34c759",away:"#ff9500",offline:"#8ea4b8"},o='<div id="teamManagePanel" style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:600px;max-width:90vw;max-height:80vh;background:#0a0e1a;border:1px solid rgba(0,170,255,0.3);border-radius:3px;padding:24px;z-index:10001;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.5);">';o+='<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">',o+='<h3 style="margin:0;color:#fff;font-size:1.1rem;"><i class="fas fa-users" style="color:var(--accent);margin-right:8px"></i>Team Workspace</h3>',o+=`<button onclick="var p=document.getElementById('teamManagePanel');var o=document.getElementById('teamManageOverlay');if(p)p.remove();if(o)o.remove();" style="background:none;border:none;color:var(--steel);cursor:pointer;font-size:1.2rem;"><i class="fas fa-times"></i></button>`,o+="</div>",o+='<div style="font-size:0.78rem;color:var(--steel);margin-bottom:16px;">Manage team roles and access. Changes sync across all workspace sessions.</div>',o+='<table style="width:100%;border-collapse:collapse;">',o+='<thead><tr><th style="padding:10px 8px;font-size:0.72rem;text-transform:uppercase;color:var(--accent);border-bottom:1px solid var(--border);text-align:left;">Member</th><th style="padding:10px 8px;font-size:0.72rem;text-transform:uppercase;color:var(--accent);border-bottom:1px solid var(--border);text-align:left;">Role</th><th style="padding:10px 8px;font-size:0.72rem;text-transform:uppercase;color:var(--accent);border-bottom:1px solid var(--border);text-align:center;">Status</th><th style="padding:10px 8px;font-size:0.72rem;text-transform:uppercase;color:var(--accent);border-bottom:1px solid var(--border);text-align:center;">Actions</th></tr></thead>',o+="<tbody>",t.forEach(function(a,s){var l=e[a.role],c=r[a.status]||"#8ea4b8";o+='<tr style="border-bottom:1px solid rgba(255,255,255,0.04);">',o+='<td style="padding:10px 8px;"><div style="display:flex;align-items:center;gap:8px;"><div style="width:32px;height:32px;border-radius:50%;background:'+l.color+'22;display:flex;align-items:center;justify-content:center;"><i class="fas '+l.icon+'" style="color:'+l.color+';font-size:0.7rem;"></i></div><div><div style="color:#fff;font-weight:600;font-size:0.82rem;">'+a.name+'</div><div style="color:var(--steel);font-size:0.7rem;">'+a.email+"</div></div></div></td>",o+='<td style="padding:10px 8px;"><span style="background:'+l.color+"22;color:"+l.color+';padding:3px 10px;border-radius:3px;font-size:0.72rem;font-weight:700;">'+l.label+"</span></td>",o+='<td style="padding:10px 8px;text-align:center;"><span style="display:inline-flex;align-items:center;gap:4px;font-size:0.75rem;color:'+c+';"><span style="width:6px;height:6px;border-radius:50%;background:'+c+';display:inline-block;"></span>'+a.status+"</span></td>",o+='<td style="padding:10px 8px;text-align:center;">',s>0?o+=`<button onclick="if(typeof _showNotif==='function')_showNotif('Role change requires Admin approval in production.','info')" style="background:rgba(0,170,255,0.08);border:1px solid rgba(0,170,255,0.2);color:var(--accent);border-radius:3px;padding:3px 8px;font-size:0.7rem;cursor:pointer;"><i class="fas fa-pen"></i></button>`:o+='<span style="font-size:0.7rem;color:var(--steel);">—</span>',o+="</td></tr>"}),o+="</tbody></table>",o+='<div style="margin-top:16px;display:flex;gap:8px;">',o+=`<button onclick="if(typeof _showNotif==='function')_showNotif('Invite sent! Team member will receive an email with workspace access.','success')" style="background:linear-gradient(135deg,#00aaff,#0088cc);color:#fff;border:none;border-radius:3px;padding:8px 16px;font-size:0.8rem;font-weight:700;cursor:pointer;"><i class="fas fa-user-plus" style="margin-right:4px"></i> Invite Member</button>`,o+=`<button onclick="if(typeof _showNotif==='function')_showNotif('Role permissions exported.','info')" style="background:rgba(0,170,255,0.08);border:1px solid rgba(0,170,255,0.2);color:var(--accent);border-radius:3px;padding:8px 16px;font-size:0.8rem;font-weight:600;cursor:pointer;"><i class="fas fa-download" style="margin-right:4px"></i> Export Roles</button>`,o+="</div></div>",o=`<div id="teamManageOverlay" onclick="document.getElementById('teamManagePanel').remove();document.getElementById('teamManageOverlay').remove();" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:10000;"></div>`+o,document.body.insertAdjacentHTML("beforeend",o)},console.log("[Round-14] Multi-User Workspace roles module loaded")})();(function(){var e;try{e=JSON.parse(localStorage.getItem("s4_saved_analyses")||"[]")}catch{e=[]}window.saveCurrentAnalysis=function(t){var n={id:"SA-"+Date.now().toString(36).toUpperCase(),title:t||"Analysis — "+new Date().toLocaleDateString(),timestamp:new Date().toISOString(),program:(document.getElementById("ilsProgram")||{}).value||"Unknown",type:"ILS Gap Analysis",score:0,data:{}};return typeof ilsResults<"u"&&ilsResults&&(n.score=ilsResults.overallScore||0,n.data.elements=ilsResults.elements||{},n.data.gapCount=ilsResults.gaps?ilsResults.gaps.length:0),n.data.vaultCount=typeof s4Vault<"u"?s4Vault.length:0,n.data.actionCount=typeof s4ActionItems<"u"?s4ActionItems.length:0,e.push(n),localStorage.setItem("s4_saved_analyses",JSON.stringify(e)),typeof _showNotif=="function"&&_showNotif("Analysis saved: "+n.title,"success"),fetch("/api/save-analysis",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).catch(function(){}),n},window.showSavedAnalyses=function(){var t=document.getElementById("savedAnalysesPanel");if(t){t.remove();return}var n='<div id="savedAnalysesPanel" style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:650px;max-width:90vw;max-height:80vh;background:#0a0e1a;border:1px solid rgba(0,170,255,0.3);border-radius:3px;padding:24px;z-index:10001;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.5);">';n+='<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">',n+='<h3 style="margin:0;color:#fff;font-size:1.1rem;"><i class="fas fa-history" style="color:var(--accent);margin-right:8px"></i>Saved Analyses</h3>',n+=`<button onclick="document.getElementById('savedAnalysesPanel').remove();document.getElementById('savedAnalysesOverlay').remove();" style="background:none;border:none;color:var(--steel);cursor:pointer;font-size:1.2rem;"><i class="fas fa-times"></i></button>`,n+="</div>",e.length===0?n+='<div style="text-align:center;padding:40px;color:var(--muted);"><i class="fas fa-folder-open" style="font-size:2rem;margin-bottom:12px;opacity:0.3;display:block;"></i><p>No saved analyses yet. Run an ILS Gap Analysis and save it to track progress over time.</p></div>':(e.sort(function(r,o){return new Date(o.timestamp)-new Date(r.timestamp)}),e.forEach(function(r,o){var a=r.score>=80?"#34c759":r.score>=50?"#ff9500":"#ff3b30";n+='<div style="padding:14px;margin-bottom:8px;background:var(--surface);border:1px solid var(--border);border-radius:3px;">',n+='<div style="display:flex;justify-content:space-between;align-items:center;">',n+='<div><div style="color:#fff;font-weight:700;font-size:0.88rem;">'+r.title+'</div><div style="color:var(--steel);font-size:0.72rem;">'+r.type+" — "+new Date(r.timestamp).toLocaleString()+"</div></div>",n+='<div style="display:flex;align-items:center;gap:12px;">',n+='<div style="text-align:center;"><div style="font-size:1.2rem;font-weight:800;color:'+a+';">'+Math.round(r.score)+'%</div><div style="font-size:0.6rem;color:var(--steel);">Score</div></div>',n+='<button onclick="_savedAnalyses.splice('+o+`,1);localStorage.setItem('s4_saved_analyses',JSON.stringify(_savedAnalyses));document.getElementById('savedAnalysesPanel').remove();document.getElementById('savedAnalysesOverlay').remove();showSavedAnalyses();" style="background:rgba(255,59,48,0.1);color:#ff3b30;border:1px solid rgba(255,59,48,0.2);border-radius:3px;padding:4px 8px;font-size:0.7rem;cursor:pointer;"><i class="fas fa-trash"></i></button>`,n+="</div></div>",r.data&&(n+='<div style="display:flex;gap:12px;margin-top:8px;font-size:0.72rem;color:var(--steel);">',n+='<span><i class="fas fa-vault" style="color:var(--accent);margin-right:3px;"></i>'+(r.data.vaultCount||0)+" vault records</span>",n+='<span><i class="fas fa-flag" style="color:#ff9500;margin-right:3px;"></i>'+(r.data.gapCount||0)+" gaps</span>",n+='<span><i class="fas fa-list-check" style="color:#34c759;margin-right:3px;"></i>'+(r.data.actionCount||0)+" actions</span>",n+="</div>"),n+="</div>"})),n+='<div style="margin-top:16px;display:flex;gap:8px;">',n+=`<button onclick="saveCurrentAnalysis();document.getElementById('savedAnalysesPanel').remove();document.getElementById('savedAnalysesOverlay').remove();showSavedAnalyses();" style="background:linear-gradient(135deg,#00aaff,#0088cc);color:#fff;border:none;border-radius:3px;padding:8px 16px;font-size:0.8rem;font-weight:700;cursor:pointer;"><i class="fas fa-save" style="margin-right:4px"></i> Save Current Analysis</button>`,n+="</div></div>",n=`<div id="savedAnalysesOverlay" onclick="document.getElementById('savedAnalysesPanel').remove();this.remove();" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:10000;"></div>`+n,document.body.insertAdjacentHTML("beforeend",n)},console.log("[Round-14] Saved Analyses Dashboard loaded")})();(function(){var e=!1;function t(n){if(e&&window.jspdf){n();return}var r=document.createElement("script");r.src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js",r.onload=function(){e=!0,n()},r.onerror=function(){console.error("Failed to load jsPDF"),typeof _showNotif=="function"&&_showNotif("PDF library failed to load. Try again.","error")},document.head.appendChild(r)}window.exportPDF=function(n){t(function(){var r=window.jspdf.jsPDF,o=new r,a=20,s=n||"S4 Ledger — ILS Audit Report",l=new Date().toISOString().replace("T"," ").substring(0,19)+" UTC",c=(document.getElementById("ilsProgram")||{}).value||"",d=window.S4_PLATFORMS&&S4_PLATFORMS[c]?S4_PLATFORMS[c].n:(c||"N/A").toUpperCase();o.setFillColor(5,8,16),o.rect(0,0,210,35,"F"),o.setTextColor(0,170,255),o.setFontSize(18),o.setFont("helvetica","bold"),o.text("S4 LEDGER",15,16),o.setFontSize(10),o.setTextColor(142,164,184),o.text("Immutable Defense Logistics — XRPL Blockchain Verified",15,24),o.setTextColor(201,168,76),o.text("ZERO-TRUST AUDIT CERTIFIED",15,30),a=45,o.setTextColor(0,0,0),o.setFontSize(14),o.setFont("helvetica","bold"),o.text(s,15,a),a+=8,o.setFontSize(9),o.setFont("helvetica","normal"),o.setTextColor(100,100,100),o.text("Program: "+d+"  |  Generated: "+l+"  |  Classification: CUI",15,a),a+=12;var u=typeof s4Vault<"u"?s4Vault.length:0,p=typeof s4Vault<"u"?s4Vault.filter(function(f){return f.verified}).length:0;o.setFontSize(11),o.setFont("helvetica","bold"),o.setTextColor(0,0,0),o.text("Audit Vault Summary",15,a),a+=6,o.setFontSize(9),o.setFont("helvetica","normal"),o.text("Total Records: "+u+"  |  Verified: "+p+"  |  Credit Fees: $"+(u*.01).toFixed(2),15,a),a+=10,typeof s4Vault<"u"&&s4Vault.length>0&&(o.setFontSize(8),o.setFont("helvetica","bold"),o.text("Type",15,a),o.text("SHA-256 Hash",60,a),o.text("TX Hash",130,a),o.text("Timestamp",170,a),a+=2,o.setDrawColor(200,200,200),o.line(15,a,195,a),a+=4,o.setFont("helvetica","normal"),s4Vault.slice(0,25).forEach(function(f){a>270&&(o.addPage(),a=20),o.text((f.label||f.type||"").substring(0,25),15,a),o.text((f.hash||"").substring(0,32)+"...",60,a),o.text((f.txHash||"").substring(0,20)+"...",130,a),o.text(new Date(f.timestamp).toLocaleDateString(),170,a),a+=5})),a=Math.max(a+15,260),a>270&&(o.addPage(),a=20),o.setDrawColor(0,170,255),o.line(15,a,195,a),a+=6,o.setFontSize(7),o.setTextColor(100,100,100),o.text("This document was generated by S4 Ledger and is blockchain-verified via XRPL Mainnet.",15,a),o.text("Verify any record at https://s4ledger.com/verify | © "+new Date().getFullYear()+" S4 Systems, LLC",15,a+4),o.save("S4_Ledger_Report_"+new Date().toISOString().split("T")[0]+".pdf"),typeof _showNotif=="function"&&_showNotif("PDF report exported successfully","success")})},console.log("[Round-14] PDF Report Export (jsPDF) loaded")})();(function(){var e;try{e=JSON.parse(localStorage.getItem("s4_webhooks")||"[]")}catch{e=[]}window.showWebhookSettings=function(){var t=document.getElementById("webhookPanel");if(t){t.remove();return}var n='<div id="webhookPanel" style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:650px;max-width:90vw;max-height:80vh;background:#0a0e1a;border:1px solid rgba(0,170,255,0.3);border-radius:3px;padding:24px;z-index:10001;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.5);">';n+='<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">',n+='<h3 style="margin:0;color:#fff;font-size:1.1rem;"><i class="fas fa-plug" style="color:var(--accent);margin-right:8px"></i>Webhook Configuration</h3>',n+=`<button onclick="document.getElementById('webhookPanel').remove();document.getElementById('webhookOverlay').remove();" style="background:none;border:none;color:var(--steel);cursor:pointer;font-size:1.2rem;"><i class="fas fa-times"></i></button>`,n+="</div>",n+='<div style="font-size:0.78rem;color:var(--steel);margin-bottom:16px;">Configure webhook URLs to receive real-time notifications when records are anchored, verified, or exported.</div>',n+='<div style="background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:14px;margin-bottom:16px;">',n+='<div style="display:grid;grid-template-columns:1fr auto;gap:8px;margin-bottom:8px;">',n+='<input type="url" id="webhookUrlInput" placeholder="https://your-system.mil/api/webhooks/s4" style="background:#050810;color:#fff;border:1px solid var(--border);border-radius:3px;padding:8px 12px;font-size:0.82rem;font-family:monospace;width:100%;">',n+='<button onclick="addWebhook()" style="background:linear-gradient(135deg,#00aaff,#0088cc);color:#fff;border:none;border-radius:3px;padding:8px 16px;font-size:0.8rem;font-weight:700;cursor:pointer;white-space:nowrap;"><i class="fas fa-plus" style="margin-right:4px"></i> Add</button>',n+="</div>",n+='<div style="display:flex;gap:6px;flex-wrap:wrap;">';var r=["anchor.confirmed","anchor.failed","record.verified","export.completed","vault.cleared","analysis.saved"];r.forEach(function(o){n+='<label style="display:flex;align-items:center;gap:4px;font-size:0.72rem;color:var(--steel);cursor:pointer;padding:3px 8px;background:rgba(0,170,255,0.04);border:1px solid rgba(0,170,255,0.1);border-radius:3px;"><input type="checkbox" class="webhook-event-cb" value="'+o+'" checked style="width:auto;accent-color:var(--accent);"> '+o+"</label>"}),n+="</div></div>",e.length>0?(n+='<div style="font-size:0.78rem;color:var(--accent);font-weight:600;margin-bottom:8px;">Active Webhooks</div>',e.forEach(function(o,a){n+='<div style="padding:10px;margin-bottom:6px;background:var(--surface);border:1px solid var(--border);border-radius:3px;display:flex;justify-content:space-between;align-items:center;">',n+='<div><div style="color:#fff;font-family:monospace;font-size:0.78rem;">'+o.url+'</div><div style="color:var(--steel);font-size:0.68rem;">Events: '+o.events.join(", ")+" | Added: "+new Date(o.created).toLocaleDateString()+"</div></div>",n+='<div style="display:flex;gap:6px;">',n+='<button onclick="testWebhook('+a+')" style="background:rgba(52,199,89,0.1);color:#34c759;border:1px solid rgba(52,199,89,0.2);border-radius:3px;padding:3px 8px;font-size:0.7rem;cursor:pointer;"><i class="fas fa-paper-plane"></i> Test</button>',n+='<button onclick="removeWebhook('+a+')" style="background:rgba(255,59,48,0.1);color:#ff3b30;border:1px solid rgba(255,59,48,0.2);border-radius:3px;padding:3px 8px;font-size:0.7rem;cursor:pointer;"><i class="fas fa-trash"></i></button>',n+="</div></div>"})):n+='<div style="text-align:center;padding:20px;color:var(--muted);font-size:0.82rem;"><i class="fas fa-plug" style="font-size:1.5rem;margin-bottom:8px;opacity:0.3;display:block;"></i>No webhooks configured. Add a URL above to receive real-time notifications.</div>',n+="</div>",n=`<div id="webhookOverlay" onclick="document.getElementById('webhookPanel').remove();this.remove();" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:10000;"></div>`+n,document.body.insertAdjacentHTML("beforeend",n)},window.addWebhook=function(){var t=document.getElementById("webhookUrlInput");if(!t||!t.value){typeof _showNotif=="function"&&_showNotif("Please enter a webhook URL.","warning");return}var n=t.value.trim();if(!n.startsWith("http")){typeof _showNotif=="function"&&_showNotif("URL must start with http:// or https://","warning");return}var r=[];document.querySelectorAll(".webhook-event-cb:checked").forEach(function(o){r.push(o.value)}),e.push({url:n,events:r,created:new Date().toISOString(),active:!0}),localStorage.setItem("s4_webhooks",JSON.stringify(e)),fetch("/api/webhooks/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:n,events:r})}).catch(function(){}),typeof _showNotif=="function"&&_showNotif("Webhook registered: "+n,"success"),document.getElementById("webhookPanel").remove(),document.getElementById("webhookOverlay").remove(),showWebhookSettings()},window.removeWebhook=function(t){e.splice(t,1),localStorage.setItem("s4_webhooks",JSON.stringify(e)),document.getElementById("webhookPanel").remove(),document.getElementById("webhookOverlay").remove(),showWebhookSettings(),typeof _showNotif=="function"&&_showNotif("Webhook removed.","info")},window.testWebhook=function(t){var n=e[t];n&&fetch("/api/webhooks/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:n.url,event:"test.ping"})}).then(function(r){return r.json()}).then(function(r){typeof _showNotif=="function"&&_showNotif("Test webhook sent to "+n.url,"success")}).catch(function(){typeof _showNotif=="function"&&_showNotif("Test sent (backend offline — will deliver when API is running).","info")})},console.log("[Round-14] Webhook Configuration UI loaded")})();console.log("[Round-14] All enhancement modules loaded — FedRAMP Badge, Multi-User, Saved Analyses, PDF Export, Webhooks");(function(){var e="s4ledger",t=3,n={records:{keyPath:"id",autoIncrement:!0},stats:{keyPath:"key"},vault:{keyPath:"id",autoIncrement:!0},action_items:{keyPath:"id"},documents:{keyPath:"name"},submissions:{keyPath:"id",autoIncrement:!0},settings:{keyPath:"key"},offline_queue:{keyPath:"id",autoIncrement:!0}},r=null,o=!1,a=[];function s(){return new Promise(function(c,d){if(r&&o)return c(r);var u=indexedDB.open(e,t);u.onupgradeneeded=function(p){var f=p.target.result;Object.keys(n).forEach(function(h){f.objectStoreNames.contains(h)||f.createObjectStore(h,n[h])})},u.onsuccess=function(){r=u.result,o=!0,a.forEach(function(p){p()}),a=[],c(r)},u.onerror=function(){console.warn("[S4Store] IndexedDB unavailable, using localStorage fallback"),d(u.error)}})}var l={ready:!1,_fallback:!1,init:function(){return s().then(function(){return l.ready=!0,console.log("[S4Store] IndexedDB initialized — "+Object.keys(n).length+" stores"),l._migrate()}).catch(function(){l._fallback=!0,l.ready=!0,console.log("[S4Store] Falling back to localStorage")})},_migrate:function(){var c=[{lsKey:"s4_anchored_records",store:"records",isArray:!0},{lsKey:"s4Vault",store:"vault",isArray:!0},{lsKey:"s4ActionItems",store:"action_items",isArray:!0},{lsKey:"s4_submission_history",store:"submissions",isArray:!0},{lsKey:"s4_stats",store:"stats",isObject:!0,wrapKey:"platform_stats"},{lsKey:"s4_selected_tier",store:"settings",isScalar:!0,wrapKey:"selected_tier"},{lsKey:"s4_doc_versions",store:"documents",isObject:!0,wrapKey:"doc_versions"},{lsKey:"s4_doc_notifications",store:"documents",isObject:!0,wrapKey:"doc_notifications"}],d=0,u=c.map(function(p){try{var f=localStorage.getItem(p.lsKey);if(!f)return Promise.resolve();var h=JSON.parse(f);if(p.isArray&&Array.isArray(h)&&h.length>0)return l.putAll(p.store,h).then(function(){d++});if(p.isObject||p.isScalar){var m=p.isScalar?{key:p.wrapKey,value:h}:Object.assign({key:p.wrapKey},typeof h=="object"?h:{value:h});return l.put(p.store,m).then(function(){d++})}}catch{return Promise.resolve()}return Promise.resolve()});return Promise.all(u).then(function(){d>0&&console.log("[S4Store] Migrated "+d+" localStorage stores to IndexedDB")})},get:function(c,d){if(l._fallback)try{return Promise.resolve(JSON.parse(localStorage.getItem("s4_idb_"+c+"_"+d)||"null"))}catch{return Promise.resolve(null)}return s().then(function(u){return new Promise(function(p,f){var h=u.transaction(c,"readonly"),m=h.objectStore(c).get(d);m.onsuccess=function(){p(m.result||null)},m.onerror=function(){f(m.error)}})})},getAll:function(c){if(l._fallback)try{return Promise.resolve(JSON.parse(localStorage.getItem("s4_idb_"+c)||"[]"))}catch{return Promise.resolve([])}return s().then(function(d){return new Promise(function(u,p){var f=d.transaction(c,"readonly"),h=f.objectStore(c).getAll();h.onsuccess=function(){u(h.result||[])},h.onerror=function(){p(h.error)}})})},put:function(c,d){if(l._fallback){try{localStorage.setItem("s4_idb_"+c+"_"+(d.key||d.id||"default"),JSON.stringify(d))}catch{}return Promise.resolve(d)}return s().then(function(u){return new Promise(function(p,f){var h=u.transaction(c,"readwrite"),m=h.objectStore(c).put(d);m.onsuccess=function(){p(d)},m.onerror=function(){f(m.error)}})})},putAll:function(c,d){if(l._fallback){try{localStorage.setItem("s4_idb_"+c,JSON.stringify(d))}catch{}return Promise.resolve(d)}return s().then(function(u){return new Promise(function(p,f){var h=u.transaction(c,"readwrite"),m=h.objectStore(c);d.forEach(function(g){m.put(g)}),h.oncomplete=function(){p(d)},h.onerror=function(){f(h.error)}})})},delete:function(c,d){if(l._fallback){try{localStorage.removeItem("s4_idb_"+c+"_"+d)}catch{}return Promise.resolve()}return s().then(function(u){return new Promise(function(p,f){var h=u.transaction(c,"readwrite"),m=h.objectStore(c).delete(d);m.onsuccess=function(){p()},m.onerror=function(){f(m.error)}})})},clear:function(c){if(l._fallback){try{localStorage.removeItem("s4_idb_"+c)}catch{}return Promise.resolve()}return s().then(function(d){return new Promise(function(u,p){var f=d.transaction(c,"readwrite"),h=f.objectStore(c).clear();h.onsuccess=function(){u()},h.onerror=function(){p(h.error)}})})},count:function(c){return l._fallback?Promise.resolve(0):s().then(function(d){return new Promise(function(u,p){var f=d.transaction(c,"readonly"),h=f.objectStore(c).count();h.onsuccess=function(){u(h.result)},h.onerror=function(){p(h.error)}})})}};window.S4Store=l,l.init(),console.log("[Round-16c] IndexedDB persistence layer loaded")})();(function(){var e={ws:null,url:null,connected:!1,reconnectAttempts:0,maxReconnectAttempts:10,reconnectDelay:1e3,heartbeatInterval:null,listeners:{},messageQueue:[],fallbackPolling:!1,sessionId:null,connect:function(t){t=t||{};var n=location.protocol==="https:"?"wss:":"ws:";e.url=t.url||n+"//"+location.host+"/ws/collab",e.sessionId=t.sessionId||"s4_"+Date.now().toString(36)+"_"+Math.random().toString(36).substr(2,6);try{e.ws=new WebSocket(e.url),e.ws.onopen=function(){for(e.connected=!0,e.reconnectAttempts=0,e.reconnectDelay=1e3,e.fallbackPolling=!1,console.log("[S4Realtime] WebSocket connected"),e.send("auth",{session:e.sessionId,user:typeof _currentUser<"u"&&_currentUser?.name?_currentUser.name:"Operator",tier:typeof _onboardTier<"u"?_onboardTier:"starter"});e.messageQueue.length>0;){var r=e.messageQueue.shift();e.ws.send(JSON.stringify(r))}e.startHeartbeat(),e.emit("connected",{})},e.ws.onmessage=function(r){try{var o=JSON.parse(r.data);e.emit(o.type||"message",o.data||o),o.type==="user-joined"&&e._onUserJoined(o.data),o.type==="user-left"&&e._onUserLeft(o.data),o.type==="anchor-event"&&e._onAnchorEvent(o.data),o.type==="tool-update"&&e._onToolUpdate(o.data),o.type}catch(a){console.warn("[S4Realtime] Parse error:",a)}},e.ws.onclose=function(r){if(e.connected=!1,e.stopHeartbeat(),console.log("[S4Realtime] Connection closed (code "+r.code+")"),e.reconnectAttempts<e.maxReconnectAttempts){e.reconnectAttempts++;var o=Math.min(e.reconnectDelay*Math.pow(1.5,e.reconnectAttempts),3e4);console.log("[S4Realtime] Reconnecting in "+Math.round(o/1e3)+"s (attempt "+e.reconnectAttempts+")"),setTimeout(function(){e.connect(t)},o)}else console.log("[S4Realtime] Max reconnect attempts reached — falling back to polling"),e.fallbackPolling=!0,e.emit("fallback-polling",{})},e.ws.onerror=function(){}}catch{console.log("[S4Realtime] WebSocket unavailable — using polling fallback"),e.fallbackPolling=!0}},send:function(t,n){var r={type:t,data:n,session:e.sessionId,ts:Date.now()};e.connected&&e.ws&&e.ws.readyState===1?e.ws.send(JSON.stringify(r)):e.messageQueue.push(r)},on:function(t,n){return e.listeners[t]||(e.listeners[t]=[]),e.listeners[t].push(n),e},off:function(t,n){e.listeners[t]&&(e.listeners[t]=e.listeners[t].filter(function(r){return r!==n}))},emit:function(t,n){(e.listeners[t]||[]).forEach(function(r){try{r(n)}catch(o){console.warn("[S4Realtime] Listener error:",o)}})},startHeartbeat:function(){e.stopHeartbeat(),e.heartbeatInterval=setInterval(function(){e.connected&&e.send("ping",{ts:Date.now()})},25e3)},stopHeartbeat:function(){e.heartbeatInterval&&(clearInterval(e.heartbeatInterval),e.heartbeatInterval=null)},broadcastToolActivity:function(t,n){e.send("tool-activity",{tool:t,action:n,user:e.sessionId})},broadcastAnchor:function(t,n){e.send("anchor-broadcast",{record_type:t,hash:n,user:e.sessionId})},_onUserJoined:function(t){typeof _showNotif=="function"&&t.name&&_showNotif(t.name+" joined the workspace","info")},_onUserLeft:function(t){typeof _showNotif=="function"&&t.name&&_showNotif(t.name+" left the workspace","info")},_onAnchorEvent:function(t){typeof loadDashboardStats=="function"&&setTimeout(loadDashboardStats,500)},_onToolUpdate:function(t){},disconnect:function(){e.stopHeartbeat(),e.ws&&(e.ws.onclose=null,e.ws.close()),e.connected=!1},getStatus:function(){return{connected:e.connected,fallback:e.fallbackPolling,reconnectAttempts:e.reconnectAttempts,queuedMessages:e.messageQueue.length,session:e.sessionId}}};window.S4Realtime=e,document.addEventListener("DOMContentLoaded",function(){var t=document.getElementById("platformWorkspace");t&&t.style.display!=="none"&&e.connect();var n=new MutationObserver(function(r){r.forEach(function(o){o.target.id==="platformWorkspace"&&o.target.style.display!=="none"&&!e.connected&&!e.fallbackPolling&&e.connect()})});t&&n.observe(t,{attributes:!0,attributeFilter:["style"]})}),console.log("[Round-16c] WebSocket real-time collaboration client loaded")})();(function(){var e={loaded:{},pending:{},observer:null,init:function(){document.addEventListener("shown.bs.tab",function(t){var n=t.target.getAttribute("href")||t.target.getAttribute("data-bs-target");n&&e.loadPane(n)}),"IntersectionObserver"in window&&(e.observer=new IntersectionObserver(function(t){t.forEach(function(n){if(n.isIntersecting){var r=n.target;e.observer.unobserve(r);var o=r.getAttribute("data-s4-lazy");o&&e.pending[o]&&(e.pending[o](),e.loaded[o]=!0,delete e.pending[o])}})},{rootMargin:"200px"})),e.registerDeferredCharts(),console.log("[S4Lazy] Lazy-loading system initialized")},loadPane:function(t){if(!e.loaded[t]){e.loaded[t]=!0;var n=document.querySelector(t);if(n){var r=n.querySelectorAll("canvas[data-s4-defer]");r.forEach(function(o){var a=o.getAttribute("data-s4-defer");typeof window[a]=="function"&&requestAnimationFrame(function(){try{window[a]()}catch(s){console.warn("[S4Lazy] Deferred chart error:",s)}})}),e.pending[t]&&(e.pending[t](),delete e.pending[t])}}},register:function(t,n){if(e.loaded[t])n();else{e.pending[t]=n;var r=document.querySelector(t);r&&e.observer&&(r.setAttribute("data-s4-lazy",t),e.observer.observe(r))}},registerDeferredCharts:function(){var t=[{tab:"#tabILS",fn:"renderFailureTimeline"},{tab:"#tabILS",fn:"renderGapAnalysisChart"},{tab:"#tabWallet",fn:"loadWalletData"},{tab:"#tabSystems",fn:"loadDashboardStats"}];t.forEach(function(n){e.loaded[n.tab]||e.register(n.tab,function(){typeof window[n.fn]=="function"&&setTimeout(function(){window[n.fn]()},100)})})},loadScript:function(t){return new Promise(function(n,r){if(document.querySelector('script[src="'+t+'"]'))return n();var o=document.createElement("script");o.src=t,o.onload=n,o.onerror=r,document.head.appendChild(o)})},loadCSS:function(t){return new Promise(function(n){if(document.querySelector('link[href="'+t+'"]'))return n();var r=document.createElement("link");r.rel="stylesheet",r.href=t,r.onload=n,document.head.appendChild(r)})}};window.S4Lazy=e,document.addEventListener("DOMContentLoaded",function(){e.init()}),console.log("[Round-16c] Lazy-loading / code-splitting system loaded")})();(function(){var e={_handlers:{},on:function(o,a){e._handlers[o]||(e._handlers[o]=[]),e._handlers[o].push(a)},off:function(o,a){e._handlers[o]&&(e._handlers[o]=e._handlers[o].filter(function(s){return s!==a}))},emit:function(o,a){(e._handlers[o]||[]).forEach(function(s){try{s(a)}catch(l){console.warn("[S4Bus]",l)}})}};window.S4Bus=e;class t extends HTMLElement{static get observedAttributes(){return["tool","title","loading"]}constructor(){super(),this._initialized=!1,this._toolName=""}connectedCallback(){if(!this._initialized){this._initialized=!0,this._toolName=this.getAttribute("tool")||"unknown";var a=this.getAttribute("title")||this._toolName,s=this.attachShadow({mode:"open"});s.innerHTML='<style>:host { display: block; margin-bottom: 16px; }:host([hidden]) { display: none; }.tool-wrapper { background: var(--card, #111); border: 1px solid var(--border, rgba(255,255,255,0.06)); border-radius: 3px; overflow: hidden; }.tool-header { display: flex; align-items: center; gap: 10px; padding: 14px 18px; border-bottom: 1px solid var(--border, rgba(255,255,255,0.06)); }.tool-title { color: var(--text, #f5f5f7); font-weight: 700; font-size: 0.95rem; flex: 1; }.tool-badge { background: rgba(0,170,255,0.12); color: #00aaff; font-size: 0.65rem; font-weight: 700; padding: 3px 8px; border-radius: 3px; text-transform: uppercase; }.tool-body { padding: 18px; }.tool-loading { display: flex; align-items: center; justify-content: center; padding: 40px; color: #86868b; }.tool-loading .spinner { width: 24px; height: 24px; border: 2px solid rgba(0,170,255,0.2); border-top-color: #00aaff; border-radius: 50%; animation: spin 0.8s linear infinite; margin-right: 10px; }@keyframes spin { to { transform: rotate(360deg); } }.tool-error { padding: 20px; background: rgba(255,59,48,0.08); border: 1px solid rgba(255,59,48,0.2); border-radius: 3px; color: #ff3b30; margin: 12px; font-size: 0.85rem; }::slotted(*) { color: #f5f5f7; }</style><div class="tool-wrapper"><div class="tool-header"><span class="tool-title">'+a+'</span><span class="tool-badge">'+this._toolName+'</span></div><div class="tool-body" id="body"><slot></slot></div></div>',e.on("tool:"+this._toolName+":refresh",this._onRefresh.bind(this)),e.on("tool:"+this._toolName+":error",this._onError.bind(this))}}disconnectedCallback(){e.off("tool:"+this._toolName+":refresh",this._onRefresh.bind(this)),e.off("tool:"+this._toolName+":error",this._onError.bind(this))}attributeChangedCallback(a,s,l){a==="loading"&&this._setLoading(l!==null)}_setLoading(a){if(this.shadowRoot){var s=this.shadowRoot.getElementById("body");s&&a&&(s.innerHTML='<div class="tool-loading"><div class="spinner"></div> Loading...</div><slot></slot>')}}_onRefresh(){e.emit("tool-activity",{tool:this._toolName,action:"refresh"})}_onError(a){if(this.shadowRoot){var s=this.shadowRoot.getElementById("body");if(s){var l=s.querySelector(".tool-error");l||(l=document.createElement("div"),l.className="tool-error",s.insertBefore(l,s.firstChild)),l.textContent=a&&a.message||"An error occurred"}}}showLoading(){this.setAttribute("loading","")}hideLoading(){this.removeAttribute("loading")}showError(a){e.emit("tool:"+this._toolName+":error",{message:a})}}class n extends HTMLElement{connectedCallback(){var a=this.getAttribute("type")||"info",s={success:"#34c759",warning:"#ff9500",error:"#ff3b30",info:"#00aaff"};this.style.cssText="display:inline-flex;align-items:center;gap:6px;padding:3px 10px;border-radius:3px;font-size:0.72rem;font-weight:600;background:"+(s[a]||s.info)+"15;color:"+(s[a]||s.info)+";border:1px solid "+(s[a]||s.info)+"30";var l=document.createElement("span");l.style.cssText="width:6px;height:6px;border-radius:50%;background:"+(s[a]||s.info),this.insertBefore(l,this.firstChild)}}class r extends HTMLElement{static get observedAttributes(){return["value","trend"]}connectedCallback(){this._render()}attributeChangedCallback(){this.isConnected&&this._render()}_render(){var a=this.getAttribute("label")||"",s=this.getAttribute("value")||"0",l=this.getAttribute("trend")||"",c=l.startsWith("+")?"#34c759":l.startsWith("-")?"#ff3b30":"#86868b";this.style.cssText="display:block;padding:16px;background:var(--card,#111);border:1px solid var(--border,rgba(255,255,255,0.06));border-radius:3px;text-align:center;",this.innerHTML='<div style="color:var(--steel,#86868b);font-size:0.72rem;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:6px">'+a+'</div><div style="color:var(--text,#f5f5f7);font-size:1.5rem;font-weight:800">'+s+"</div>"+(l?'<div style="color:'+c+';font-size:0.75rem;font-weight:600;margin-top:4px">'+l+"</div>":"")}}"customElements"in window?(customElements.define("s4-tool-panel",t),customElements.define("s4-status",n),customElements.define("s4-metric",r),console.log("[Round-16c] Web Components registered: s4-tool-panel, s4-status, s4-metric")):console.log("[Round-16c] Web Components not supported in this browser")})();(function(){"serviceWorker"in navigator&&(navigator.serviceWorker.getRegistrations().then(function(e){e.forEach(function(t){t.unregister(),console.log("[SW] Unregistered stale service worker:",t.scope)})}),window.caches&&caches.keys().then(function(e){e.forEach(function(t){caches.delete(t),console.log("[SW] Cleared cache:",t)})})),window.addEventListener("offline",function(){typeof _showNotif=="function"&&_showNotif("Network disconnected — S4 Ledger running in air-gapped mode. All data is cached locally.","warning"),document.body.classList.add("s4-offline")}),window.addEventListener("online",function(){typeof _showNotif=="function"&&_showNotif("Network restored.","success"),document.body.classList.remove("s4-offline")}),console.log("[S4] Service worker disabled for dev — caches cleared")})();console.log("[Round-16c] All tech enhancements loaded — IndexedDB, WebSocket, Lazy-Loading, Web Components, Service Worker");(function(){var e=!1,t=!1;try{var n=navigator.userAgent||"";t=/Edg\//.test(n)&&(document.location.hostname.indexOf(".mil")>=0||document.location.hostname.indexOf(".smil")>=0),e=window.screen&&window.screen.width<=1280&&window.screen.height<=1024||/Citrix|VMware|VDI|RemoteDesktop/.test(n)||t}catch{}if(e){var r=document.createElement("style");r.textContent='*, *::before, *::after { animation-duration: 0.1s !important; transition-duration: 0.1s !important; }.backdrop-blur, [style*="backdrop-filter"] { backdrop-filter: none !important; -webkit-backdrop-filter: none !important; }canvas { display: none !important; }',document.head.appendChild(r),console.log("[VDI] Flankspeed/Nautilus optimizations applied — reduced animations, disabled backdrop-filter")}window._s4VDI={isVDI:e,isFlankspeed:t},(e||t)&&console.log("[VDI] Environment: "+(t?"Flankspeed (M365)":"Nautilus VDI")+" — optimizations active"),console.log("[Round-16] VDI compatibility module loaded")})();function _(){var e=document.body,t=e.classList.toggle("light-mode");t?e.setAttribute("data-theme","light"):e.removeAttribute("data-theme"),localStorage.setItem("s4-theme",t?"light":"dark"),O(t);var n=document.querySelectorAll('#navLinks a:not([style*="background:#00aaff"]):not([style*="background:var(--accent)"])');n.forEach(function(c){c.classList.contains("theme-toggle")||(t?c.style.color=c.getAttribute("href")==="../prod-app/"?"#0077cc":"rgba(0,0,0,0.6)":c.style.color=c.getAttribute("href")==="../prod-app/"?"#00aaff":"rgba(255,255,255,0.7)")});var r=document.querySelector("nav");r&&(t?(r.style.background="rgba(255,255,255,0.92)",r.style.backdropFilter="blur(20px)",r.style.borderBottomColor="rgba(0,0,0,0.06)"):(r.style.background="rgba(5,8,16,0.92)",r.style.backdropFilter="blur(20px)",r.style.borderBottomColor="rgba(255,255,255,0.06)"));var o=document.querySelector(".nav-brand span, nav span");o&&(o.style.color=t?"#1d1d1f":"#fff");var a=document.querySelector('nav button[aria-label="Menu"]');if(a&&(a.style.color=t?"#1d1d1f":"#fff"),typeof Chart<"u"){var s=t?"#333":"#ccc",l=t?"rgba(0,0,0,0.1)":"rgba(255,255,255,0.06)";Chart.defaults.color=s,Chart.defaults.borderColor=l,Object.values(Chart.instances||{}).forEach(function(c){if(!(!c||!c.options))try{c.options.scales&&Object.values(c.options.scales).forEach(function(d){d.ticks&&(d.ticks.color=s),d.grid&&(d.grid.color=l),d.title&&(d.title.color=s)}),c.options.plugins&&c.options.plugins.legend&&c.options.plugins.legend.labels&&(c.options.plugins.legend.labels.color=s),c.update("none")}catch{}})}}function O(e){var t=document.getElementById("themeToggleBtn");t&&(t.innerHTML=e?'<i class="fas fa-moon"></i>':'<i class="fas fa-sun"></i>',t.title=e?"Switch to Dark Mode":"Switch to Light Mode")}(function(){var e=localStorage.getItem("s4-theme");e==="light"&&(document.body.classList.add("light-mode"),document.body.setAttribute("data-theme","light"),O(!0),document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){_(),_()},100)}))})();(function(){window._compareRecords=[],window.openCompareView=function(){var t=_getSelectedVaultHashes?_getSelectedVaultHashes():[];if(t.length<2){s4Notify("Select Records","Select exactly 2 vault records to compare.","warning");return}t.length>2&&(t=t.slice(0,2));var n=s4Vault.find(function(o){return o.hash===t[0]}),r=s4Vault.find(function(o){return o.hash===t[1]});!n||!r||e(n,r)};function e(t,n){var r=document.getElementById("s4CompareOverlay");r&&r.remove();var o=document.createElement("div");o.id="s4CompareOverlay",o.style.cssText="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.9);z-index:99996;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(8px);padding:24px",o.onclick=function(c){c.target===o&&o.remove()};var a=[{label:"Record Type",key:"label",fallback:"type"},{label:"Branch",key:"branch"},{label:"SHA-256 Hash",key:"hash"},{label:"TX Hash",key:"txHash"},{label:"Content",key:"content"},{label:"Timestamp",key:"timestamp",fmt:"date"},{label:"Verified",key:"verified",fmt:"bool"},{label:"Encrypted",key:"encrypted",fmt:"bool"},{label:"Source Tool",key:"source"},{label:"Network",key:"network"}],s=a.map(function(c){var d=t[c.key]||(c.fallback?t[c.fallback]:"")||"—",u=n[c.key]||(c.fallback?n[c.fallback]:"")||"—";if(c.fmt==="date")try{d=new Date(d).toLocaleString(),u=new Date(u).toLocaleString()}catch{}c.fmt==="bool"&&(d=d?"Yes":"No",u=u?"Yes":"No");var p=String(d)===String(u),f=p?"transparent":"rgba(255,165,0,0.04)",h=p?'<i class="fas fa-equals" style="color:#30d158;font-size:0.65rem"></i>':'<i class="fas fa-not-equal" style="color:#ffa500;font-size:0.65rem"></i>';return'<tr style="background:'+f+'"><td style="padding:8px 12px;font-weight:600;color:#888;font-size:0.78rem;white-space:nowrap;border-bottom:1px solid rgba(255,255,255,0.04)">'+c.label+'</td><td style="padding:8px 12px;color:#ccc;font-size:0.78rem;word-break:break-all;border-bottom:1px solid rgba(255,255,255,0.04);max-width:300px">'+d+'</td><td style="padding:8px 12px;text-align:center;border-bottom:1px solid rgba(255,255,255,0.04)">'+h+'</td><td style="padding:8px 12px;color:#ccc;font-size:0.78rem;word-break:break-all;border-bottom:1px solid rgba(255,255,255,0.04);max-width:300px">'+u+"</td></tr>"}).join(""),l=a.filter(function(c){var d=String(t[c.key]||(c.fallback?t[c.fallback]:"")||""),u=String(n[c.key]||(c.fallback?n[c.fallback]:"")||"");return d===u}).length;o.innerHTML='<div style="background:var(--card,#111);border:1px solid rgba(255,255,255,0.1);border-radius:3px;width:95%;max-width:900px;max-height:85vh;overflow-y:auto"><div style="padding:20px 24px;border-bottom:1px solid rgba(255,255,255,0.06);display:flex;justify-content:space-between;align-items:center"><div><h3 style="color:#fff;margin:0;font-size:1rem"><i class="fas fa-code-compare" style="margin-right:8px;color:#00aaff"></i>Record Comparison</h3><p style="color:#888;font-size:0.75rem;margin:4px 0 0">'+l+"/"+a.length+` fields match</p></div><button onclick="this.closest('#s4CompareOverlay').remove()" style="background:none;border:none;color:#888;font-size:1.3rem;cursor:pointer">&times;</button></div><div style="overflow-x:auto"><table style="width:100%;border-collapse:collapse"><thead><tr><th style="padding:10px 12px;color:#555;font-size:0.72rem;text-transform:uppercase;text-align:left;border-bottom:1px solid rgba(255,255,255,0.08)">Field</th><th style="padding:10px 12px;color:#00aaff;font-size:0.78rem;text-align:left;border-bottom:1px solid rgba(255,255,255,0.08)">`+(t.label||t.type||"Record A")+'</th><th style="padding:10px 12px;width:40px;border-bottom:1px solid rgba(255,255,255,0.08)"></th><th style="padding:10px 12px;color:#c9a84c;font-size:0.78rem;text-align:left;border-bottom:1px solid rgba(255,255,255,0.08)">'+(n.label||n.type||"Record B")+"</th></tr></thead><tbody>"+s+"</tbody></table></div></div>",document.body.appendChild(o)}})();(function(){var e=!1,t=!1,n=!1,r=document.createElement("div");r.id="s4ShortcutsOverlay",r.style.cssText="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);z-index:99999;display:none;align-items:center;justify-content:center;backdrop-filter:blur(8px)",r.innerHTML='<div style="background:var(--card,#111);border:1px solid rgba(255,255,255,0.1);border-radius:3px;padding:32px;max-width:560px;width:90%;max-height:80vh;overflow-y:auto"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px"><h3 style="color:#fff;font-size:1.1rem;margin:0"><i class="fas fa-keyboard" style="margin-right:8px;color:#00aaff"></i>Keyboard Shortcuts</h3><button onclick="toggleShortcuts()" style="background:none;border:none;color:#888;font-size:1.2rem;cursor:pointer">&times;</button></div><div style="display:grid;gap:8px">'+o("⌘/Ctrl + K","Open Global Search")+o("⌘/Ctrl + 1-6","Switch Platform Tabs")+o("⌘/Ctrl + E","Export Current View")+o("⌘/Ctrl + Shift + A","Quick Anchor")+o("⌘/Ctrl + Shift + V","Quick Verify")+o("Escape","Close Overlays & Panels")+o("?","Show This Help")+o("N","Notification History")+o("T","Toggle Light/Dark Theme")+'</div><p style="color:#666;font-size:0.72rem;margin-top:16px;text-align:center">Press <kbd style="background:rgba(255,255,255,0.1);padding:2px 6px;border-radius:3px;font-size:0.7rem">?</kbd> at any time to show this help</p></div>',document.body.appendChild(r);function o(f,h){return'<div style="display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:rgba(255,255,255,0.03);border-radius:3px"><span style="color:#ccc;font-size:0.85rem">'+h+`</span><kbd style="background:rgba(0,170,255,0.1);color:#00aaff;padding:4px 10px;border-radius:3px;font-size:0.78rem;font-family:'Inter',monospace;font-weight:600;border:1px solid rgba(0,170,255,0.2)">`+f+"</kbd></div>"}window.toggleShortcuts=function(){e=!e,r.style.display=e?"flex":"none"};var a=document.createElement("div");a.id="s4GlobalSearch",a.style.cssText="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);z-index:99998;display:none;align-items:flex-start;justify-content:center;padding-top:15vh;backdrop-filter:blur(8px)",a.innerHTML='<div style="background:var(--card,#111);border:1px solid rgba(255,255,255,0.1);border-radius:3px;width:90%;max-width:600px;box-shadow:0 20px 60px rgba(0,0,0,0.5)"><div style="display:flex;align-items:center;padding:16px 20px;border-bottom:1px solid rgba(255,255,255,0.06)"><i class="fas fa-search" style="color:#00aaff;margin-right:12px;font-size:1rem"></i><input id="globalSearchInput" type="text" placeholder="Search records, vault, tools, documents..." style="flex:1;background:transparent;border:none;color:#fff;font-size:1rem;outline:none;font-family:Inter,sans-serif" autocomplete="off"><kbd style="background:rgba(255,255,255,0.08);color:#666;padding:3px 8px;border-radius:3px;font-size:0.7rem;margin-left:8px">ESC</kbd></div><div id="globalSearchResults" style="max-height:50vh;overflow-y:auto;padding:8px"></div><div style="padding:8px 16px;border-top:1px solid rgba(255,255,255,0.04);display:flex;gap:12px;justify-content:center"><span style="font-size:0.7rem;color:#555"><kbd style="background:rgba(255,255,255,0.06);padding:1px 5px;border-radius:2px;font-size:0.65rem">↑↓</kbd> Navigate</span><span style="font-size:0.7rem;color:#555"><kbd style="background:rgba(255,255,255,0.06);padding:1px 5px;border-radius:2px;font-size:0.65rem">Enter</kbd> Select</span><span style="font-size:0.7rem;color:#555"><kbd style="background:rgba(255,255,255,0.06);padding:1px 5px;border-radius:2px;font-size:0.65rem">Esc</kbd> Close</span></div></div>',document.body.appendChild(a),window.toggleGlobalSearch=function(){if(t=!t,a.style.display=t?"flex":"none",t){var f=document.getElementById("globalSearchInput");f&&(f.value="",f.focus(),p(""))}};var s=document.createElement("div");s.id="s4NotifHistory",s.style.cssText="position:fixed;top:0;right:-420px;width:400px;max-width:90vw;height:100vh;background:var(--card,#111);border-left:1px solid rgba(255,255,255,0.08);z-index:99997;transition:right 0.3s ease;overflow-y:auto;box-shadow:-8px 0 40px rgba(0,0,0,0.4)",s.innerHTML='<div style="padding:20px;border-bottom:1px solid rgba(255,255,255,0.06);display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;background:var(--card,#111);z-index:1"><h4 style="color:#fff;margin:0;font-size:0.95rem"><i class="fas fa-bell" style="margin-right:8px;color:#00aaff"></i>Notification History</h4><div style="display:flex;gap:8px"><button onclick="clearNotifHistory()" style="background:none;border:1px solid rgba(255,255,255,0.1);color:#888;padding:4px 10px;border-radius:3px;font-size:0.72rem;cursor:pointer">Clear</button><button onclick="toggleNotifHistory()" style="background:none;border:none;color:#888;font-size:1.2rem;cursor:pointer">&times;</button></div></div><div id="notifHistoryList" style="padding:12px"></div>',document.body.appendChild(s);try{window._notifHistoryLog=JSON.parse(localStorage.getItem("s4NotifHistory")||"[]")}catch{window._notifHistoryLog=[]}window.toggleNotifHistory=function(){n=!n,s.style.right=n?"0":"-420px",n&&l()},window.clearNotifHistory=function(){window._notifHistoryLog=[],localStorage.setItem("s4NotifHistory","[]"),l()};function l(){var f=document.getElementById("notifHistoryList");if(f){if(window._notifHistoryLog.length===0){f.innerHTML='<div style="text-align:center;padding:40px 20px;color:#555"><i class="fas fa-bell-slash" style="font-size:2rem;margin-bottom:12px;opacity:0.3;display:block"></i><p style="font-size:0.82rem">No notifications yet</p></div>';return}f.innerHTML=window._notifHistoryLog.slice(0,50).map(function(h){var m={info:"fa-info-circle",warning:"fa-exclamation-triangle",danger:"fa-times-circle",success:"fa-check-circle"},g={info:"#00aaff",warning:"#ffa500",danger:"#ff3333",success:"#00aaff"},y=c(h.time);return'<div style="padding:10px 12px;border-bottom:1px solid rgba(255,255,255,0.04);display:flex;gap:10px;align-items:flex-start"><i class="fas '+(m[h.type]||m.info)+'" style="color:'+(g[h.type]||g.info)+';margin-top:3px;font-size:0.85rem"></i><div style="flex:1;min-width:0"><div style="font-weight:600;font-size:0.82rem;color:#ccc">'+(h.title||"Notification")+'</div><div style="font-size:0.75rem;color:#888;margin-top:2px">'+(h.msg||"")+'</div><div style="font-size:0.68rem;color:#555;margin-top:4px">'+y+"</div></div></div>"}).join("")}}function c(f){var h=Math.floor((Date.now()-new Date(f).getTime())/1e3);return h<60?"Just now":h<3600?Math.floor(h/60)+"m ago":h<86400?Math.floor(h/3600)+"h ago":Math.floor(h/86400)+"d ago"}var d=window.s4Notify;window.s4Notify=function(f,h,m,g,y){window._notifHistoryLog.unshift({title:f,msg:h,type:m||"info",time:new Date().toISOString()}),window._notifHistoryLog.length>100&&(window._notifHistoryLog=window._notifHistoryLog.slice(0,100));try{localStorage.setItem("s4NotifHistory",JSON.stringify(window._notifHistoryLog))}catch{}d&&d(f,h,m,g,y)};var u=document.getElementById("globalSearchInput");u&&u.addEventListener("input",function(){p(this.value)});function p(f){var h=[],m=(f||"").toLowerCase().trim(),g=document.getElementById("globalSearchResults");if(g){if(!m){g.innerHTML='<div style="padding:20px;text-align:center;color:#555;font-size:0.82rem"><i class="fas fa-search" style="font-size:1.5rem;margin-bottom:8px;opacity:0.3;display:block"></i>Type to search across vault records, tools, and documents</div>';return}var y=[{name:"Anchor Channel",tab:"tabAnchor",icon:"fa-anchor",desc:"Anchor records to blockchain"},{name:"Verify Channel",tab:"tabVerify",icon:"fa-shield-halved",desc:"Verify record integrity"},{name:"ILS Workspace",tab:"tabILS",icon:"fa-cogs",desc:"20+ ILS analysis tools"},{name:"Audit Vault",tab:"tabILS",panel:"hub-vault",icon:"fa-vault",desc:"View all anchored records"},{name:"Performance Dashboard",tab:"tabMetrics",icon:"fa-chart-line",desc:"API metrics & analytics"},{name:"Wallet / Credits",tab:"tabWallet",icon:"fa-wallet",desc:"Credit balance & transactions"}];y.forEach(function(v){(v.name.toLowerCase().includes(m)||v.desc.toLowerCase().includes(m))&&h.push({type:"tab",name:v.name,desc:v.desc,icon:v.icon,action:'switchToTab("'+v.tab+'"'+(v.panel?',"'+v.panel+'"':"")+")"})}),typeof s4Vault<"u"&&s4Vault.length>0&&s4Vault.forEach(function(v){var k=(v.label||"").toLowerCase().includes(m)||(v.hash||"").toLowerCase().includes(m)||(v.content||"").toLowerCase().includes(m)||(v.type||"").toLowerCase().includes(m);k&&h.push({type:"vault",name:v.label||v.type||"Record",desc:(v.hash||"").substring(0,32)+"...",icon:v.icon?v.icon.replace(/<[^>]*>/g,"").trim():"fa-file",hash:v.hash})}),typeof s4DocLibrary<"u"&&(s4DocLibrary.documents||[]).forEach(function(v){((v.title||"").toLowerCase().includes(m)||(v.id||"").toLowerCase().includes(m)||(v.keywords||[]).join(" ").toLowerCase().includes(m))&&h.push({type:"doc",name:v.title||v.id,desc:v.category||"Document",icon:"fa-file-lines"})});var b={Provisioning:"hub-analysis","Reliability RAM":"hub-analysis","Supply Support":"hub-analysis","PHS&T":"hub-analysis","Technical Data":"hub-analysis","Manpower & Training":"hub-analysis","Design Interface":"hub-analysis",DMSMS:"hub-dmsms","Lifecycle Cost":"hub-lifecycle","Compliance Matrix":"hub-compliance","Risk Assessment":"hub-risk","Predictive Maintenance":"hub-predictive",Readiness:"hub-readiness","Submission Checker":"hub-submissions","SBOM Viewer":"hub-sbom"};if(Object.keys(b).forEach(function(v){v.toLowerCase().includes(m)&&h.push({type:"tool",name:v,desc:"ILS Analysis Tool",icon:"fa-wrench",action:'showSection("sectionILS");setTimeout(function(){openILSTool("'+b[v]+'")},100)'})}),h.length===0){g.innerHTML='<div style="padding:20px;text-align:center;color:#555;font-size:0.82rem">No results for "<strong>'+m+'</strong>"</div>';return}g.innerHTML=h.slice(0,15).map(function(v,k){var w={tab:"#00aaff",vault:"#c9a84c",doc:"#30d158",tool:"#00aaff"},C={tab:"Tab",vault:"Vault",doc:"Doc",tool:"Tool"};return`<div class="search-result-item" tabindex="0" style="display:flex;align-items:center;gap:12px;padding:10px 16px;cursor:pointer;border-radius:3px;transition:background 0.15s" onmouseover="this.style.background='rgba(0,170,255,0.06)'" onmouseout="this.style.background='transparent'" onclick="`+(v.action||(v.hash?"loadRecordToVerify('"+v.hash+"')":""))+';toggleGlobalSearch()"><i class="fas '+(v.icon||"fa-file")+'" style="color:#00aaff;width:20px;text-align:center"></i><div style="flex:1;min-width:0"><div style="font-size:0.85rem;color:#ccc;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+v.name+'</div><div style="font-size:0.72rem;color:#666">'+v.desc+'</div></div><span style="font-size:0.65rem;padding:2px 6px;border-radius:3px;background:'+(w[v.type]||"#555")+"22;color:"+(w[v.type]||"#555")+';font-weight:600;text-transform:uppercase">'+(C[v.type]||v.type)+"</span></div>"}).join("")}}window.switchToTab=function(f,h){var m=document.querySelector('a[href="#'+f+'"]');m&&m.click(),h&&setTimeout(function(){var g=document.getElementById(h);g&&(showSection("sectionILS"),setTimeout(function(){openILSTool(h)},100))},200)},document.addEventListener("keydown",function(f){var h=(f.target.tagName||"").toLowerCase(),m=h==="input"||h==="textarea"||h==="select"||f.target.isContentEditable,g=f.metaKey||f.ctrlKey;if(g&&f.key==="k"){f.preventDefault(),toggleGlobalSearch();return}if(g&&f.shiftKey&&(f.key==="p"||f.key==="P")){f.preventDefault(),i.commandPalette&&i.commandPalette.toggle();return}if(f.key==="Escape"){var y=document.getElementById("s4CommandPalette");if(y&&y.classList.contains("active")){i.commandPalette.close();return}if(i.tour&&i.tour._active){i.tour.end();return}if(t){toggleGlobalSearch();return}if(e){toggleShortcuts();return}if(n){toggleNotifHistory();return}var b=document.querySelector(".ai-float-panel");if(b&&b.style.display!=="none"){b.style.display="none";return}var v=document.getElementById("walletSidebar");if(v&&v.classList.contains("open")){typeof closeWalletSidebar=="function"&&closeWalletSidebar();return}return}if(!m){if(f.key==="?"||f.shiftKey&&f.key==="/"){f.preventDefault(),toggleShortcuts();return}if(!g&&(f.key==="n"||f.key==="N")){f.preventDefault(),toggleNotifHistory();return}if(!g&&(f.key==="t"||f.key==="T")){f.preventDefault(),typeof _=="function"&&_();return}if(g&&f.key>="1"&&f.key<="6"){f.preventDefault();var k={1:"tabAnchor",2:"tabVerify",3:"tabILS",4:"tabMetrics",5:"tabWallet",6:"tabILS"},w=k[f.key];if(w){var C=document.querySelector('a[href="#'+w+'"]');C&&C.click()}return}if(g&&(f.key==="n"||f.key==="N")&&!f.shiftKey){f.preventDefault(),typeof showAddActionModal=="function"&&showAddActionModal();return}if(g&&f.key==="e"){if(f.preventDefault(),typeof exportVault=="function"&&document.getElementById("hub-vault")&&document.getElementById("hub-vault").style.display!=="none"){exportVault("csv");return}if(typeof generateILSReport=="function"&&typeof ilsResults<"u"&&ilsResults){generateILSReport();return}s4Notify("Export","Navigate to a tool with data to export.","info");return}if(g&&f.shiftKey&&(f.key==="a"||f.key==="A")){f.preventDefault();var I=document.querySelector('a[href="#tabAnchor"]');I&&I.click(),setTimeout(function(){var x=document.getElementById("recordInput");x&&x.focus()},300);return}if(g&&f.shiftKey&&(f.key==="v"||f.key==="V")){f.preventDefault();var T=document.querySelector('a[href="#tabVerify"]');T&&T.click(),setTimeout(function(){var x=document.getElementById("verifyInput");x&&x.focus()},300);return}}}),r.addEventListener("click",function(f){f.target===r&&toggleShortcuts()}),a.addEventListener("click",function(f){f.target===a&&toggleGlobalSearch()})})();(function(){var e={};i.debounce=function(c,d,u){u=u||200,clearTimeout(e[c]),e[c]=setTimeout(d,u)};var t=window.calcROI,n=window.calcLifecycle,r=window.calcReadiness,o=window.renderTypeGrid,a=window.renderDocLibrary;t&&(window.calcROI=function(){i.debounce("calcROI",t,150)}),n&&(window.calcLifecycle=function(){i.debounce("calcLifecycle",n,150)}),r&&(window.calcReadiness=function(){i.debounce("calcReadiness",r,150)}),o&&(window.renderTypeGrid=function(){i.debounce("renderTypeGrid",o,100)}),a&&(window.renderDocLibrary=function(){i.debounce("renderDocLibrary",a,100)}),i.hashWorker=null;try{var s='self.onmessage=async function(e){var d=new TextEncoder().encode(e.data);var b=await crypto.subtle.digest("SHA-256",d);var h=Array.from(new Uint8Array(b)).map(function(x){return x.toString(16).padStart(2,"0")}).join("");self.postMessage(h);}',l=new Blob([s],{type:"application/javascript"});i.hashWorker=new Worker(URL.createObjectURL(l))}catch{console.log("[S4 Performance] Web Worker not available, using main thread")}i.hashAsync=function(c){return new Promise(function(d){if(i.hashWorker){var u=function(p){i.hashWorker.removeEventListener("message",u),d(p.data)};i.hashWorker.addEventListener("message",u),i.hashWorker.postMessage(c)}else sha256(c).then(d)})},i.VirtualScroll=function(c,d,u){this.container=typeof c=="string"?document.getElementById(c):c,this.itemHeight=d||120,this.renderFn=u,this.items=[],this.scrollTop=0,this._viewport=null,this._content=null},i.VirtualScroll.prototype.init=function(c){if(this.items=c||[],!!this.container){this.container.style.position="relative",this.container.style.overflow="auto",this._content=document.createElement("div"),this._content.style.height=this.items.length*this.itemHeight+"px",this._content.style.position="relative",this.container.innerHTML="",this.container.appendChild(this._content);var d=this;this.container.addEventListener("scroll",function(){d.scrollTop=d.container.scrollTop,d.render()}),this.render()}},i.VirtualScroll.prototype.render=function(){if(this._content){var c=Math.ceil(this.container.clientHeight/this.itemHeight)+2,d=Math.floor(this.scrollTop/this.itemHeight);d=Math.max(0,d-1);for(var u=Math.min(this.items.length,d+c+1),p="",f=d;f<u;f++)p+='<div style="position:absolute;top:'+f*this.itemHeight+"px;left:0;right:0;height:"+this.itemHeight+'px">'+this.renderFn(this.items[f],f)+"</div>";this._content.innerHTML=p,this._content.style.height=this.items.length*this.itemHeight+"px"}},i.lazyPanels={},i.registerLazyPanel=function(c,d){i.lazyPanels[c]={initialized:!1,init:d}},i.initLazyPanel=function(c){var d=i.lazyPanels[c];d&&!d.initialized&&(d.initialized=!0,typeof d.init=="function"&&d.init(),console.log("[S4 Lazy] Initialized panel: "+c))},i.perf={marks:{},measures:[],mark:function(c){this.marks[c]=performance.now()},measure:function(c,d,u){var p=this.marks[d]||0,f=u&&this.marks[u]||performance.now(),h=f-p;return this.measures.push({name:c,duration:h,timestamp:Date.now()}),this.measures.length>100&&this.measures.shift(),h},getAverage:function(c){var d=this.measures.filter(function(u){return u.name===c});return d.length===0?0:d.reduce(function(u,p){return u+p.duration},0)/d.length},getSummary:function(){var c={};return this.measures.forEach(function(d){c[d.name]||(c[d.name]={count:0,total:0,min:1/0,max:0}),c[d.name].count++,c[d.name].total+=d.duration,c[d.name].min=Math.min(c[d.name].min,d.duration),c[d.name].max=Math.max(c[d.name].max,d.duration)}),Object.keys(c).forEach(function(d){c[d].avg=c[d].total/c[d].count}),c}},i.preload=function(c){c.forEach(function(d){var u=document.createElement("link");u.rel="prefetch",u.href=d,document.head.appendChild(u)})},i.LRUCache=function(c){this.maxSize=c||100,this.cache=new Map},i.LRUCache.prototype.get=function(c){if(this.cache.has(c)){var d=this.cache.get(c);return this.cache.delete(c),this.cache.set(c,d),d}},i.LRUCache.prototype.set=function(c,d){if(this.cache.delete(c),this.cache.set(c,d),this.cache.size>this.maxSize){var u=this.cache.keys().next().value;this.cache.delete(u)}},i.LRUCache.prototype.clear=function(){this.cache.clear()},i.LRUCache.prototype.size=function(){return this.cache.size},i.hashCache=new i.LRUCache(500),i.register("performance",{version:"1.0.0",features:["debounce","web-worker-hash","virtual-scroll","lazy-panels","perf-monitor","preloader","lru-cache"]}),console.log("[S4 Performance] Module loaded — 7 features active")})();(function(){i.db={_db:null,DB_NAME:"S4LedgerDB",DB_VERSION:1,STORES:{vault:"vault",sessions:"sessions",versions:"versions",attachments:"attachments",searchIndex:"searchIndex"},open:function(){var e=this;return new Promise(function(t,n){if(e._db){t(e._db);return}var r=indexedDB.open(e.DB_NAME,e.DB_VERSION);r.onupgradeneeded=function(o){var a=o.target.result;a.objectStoreNames.contains("vault")||a.createObjectStore("vault",{keyPath:"id"}),a.objectStoreNames.contains("sessions")||a.createObjectStore("sessions",{keyPath:"id"}),a.objectStoreNames.contains("versions")||a.createObjectStore("versions",{keyPath:"versionId"}),a.objectStoreNames.contains("attachments")||a.createObjectStore("attachments",{keyPath:"id"}),a.objectStoreNames.contains("searchIndex")||a.createObjectStore("searchIndex",{keyPath:"term"})},r.onsuccess=function(o){e._db=o.target.result,t(e._db)},r.onerror=function(o){console.error("[S4 DB] IndexedDB error:",o),n(o)}})},put:function(e,t){return this.open().then(function(n){return new Promise(function(r,o){var a=n.transaction(e,"readwrite");a.objectStore(e).put(t),a.oncomplete=function(){r(t)},a.onerror=function(s){o(s)}})})},get:function(e,t){return this.open().then(function(n){return new Promise(function(r,o){var a=n.transaction(e,"readonly"),s=a.objectStore(e).get(t);s.onsuccess=function(){r(s.result)},s.onerror=function(l){o(l)}})})},getAll:function(e){return this.open().then(function(t){return new Promise(function(n,r){var o=t.transaction(e,"readonly"),a=o.objectStore(e).getAll();a.onsuccess=function(){n(a.result||[])},a.onerror=function(s){r(s)}})})},delete:function(e,t){return this.open().then(function(n){return new Promise(function(r,o){var a=n.transaction(e,"readwrite");a.objectStore(e).delete(t),a.oncomplete=function(){r()},a.onerror=function(s){o(s)}})})},clear:function(e){return this.open().then(function(t){return new Promise(function(n,r){var o=t.transaction(e,"readwrite");o.objectStore(e).clear(),o.oncomplete=function(){n()},o.onerror=function(a){r(a)}})})},count:function(e){return this.open().then(function(t){return new Promise(function(n,r){var o=t.transaction(e,"readonly"),a=o.objectStore(e).count();a.onsuccess=function(){n(a.result)},a.onerror=function(s){r(s)}})})}},i.versioning={createVersion:function(e){var t={versionId:"v_"+Date.now()+"_"+Math.random().toString(36).substr(2,6),recordId:e.id||e.name,timestamp:new Date().toISOString(),snapshot:JSON.parse(JSON.stringify(e)),author:"current-user"};return i.db.put("versions",t).then(function(){return console.log("[S4 Versioning] Version created: "+t.versionId),t})},getHistory:function(e){return i.db.getAll("versions").then(function(t){return t.filter(function(n){return n.recordId===e}).sort(function(n,r){return new Date(r.timestamp)-new Date(n.timestamp)})})},revert:function(e){return i.db.get("versions",e).then(function(t){if(!t)throw new Error("Version not found: "+e);return t.snapshot})},diff:function(e,t){var n=[],r=new Set(Object.keys(e).concat(Object.keys(t)));return r.forEach(function(o){JSON.stringify(e[o])!==JSON.stringify(t[o])&&n.push({field:o,before:e[o],after:t[o]})}),n}},i.vaultIO={exportJSON:function(e){var t={exported:new Date().toISOString(),version:i.version,platform:"S4 Ledger",recordCount:e.length,records:e},n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),r=URL.createObjectURL(n),o=document.createElement("a");o.href=r,o.download="s4-vault-export-"+new Date().toISOString().slice(0,10)+".json",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(r),console.log("[S4 IO] Exported "+e.length+" records as JSON")},exportCSV:function(e){if(e.length!==0){var t=Object.keys(e[0]),n=t.join(",")+`
`;e.forEach(function(s){n+=t.map(function(l){var c=s[l]==null?"":String(s[l]);return'"'+c.replace(/"/g,'""')+'"'}).join(",")+`
`});var r=new Blob([n],{type:"text/csv"}),o=URL.createObjectURL(r),a=document.createElement("a");a.href=o,a.download="s4-vault-export-"+new Date().toISOString().slice(0,10)+".csv",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o),console.log("[S4 IO] Exported "+e.length+" records as CSV")}},importJSON:function(e){return new Promise(function(t,n){var r=new FileReader;r.onload=function(o){try{var a=JSON.parse(o.target.result),s=a.records||a;Array.isArray(s)||(s=[s]),console.log("[S4 IO] Imported "+s.length+" records from JSON"),t(s)}catch(l){n(new Error("Invalid JSON file: "+l.message))}},r.onerror=function(){n(new Error("Failed to read file"))},r.readAsText(e)})},importCSV:function(e){return new Promise(function(t,n){var r=new FileReader;r.onload=function(o){try{var a=o.target.result.split(`
`).filter(function(p){return p.trim()});if(a.length<2){t([]);return}for(var s=a[0].split(",").map(function(p){return p.trim().replace(/^"|"$/g,"")}),l=[],c=1;c<a.length;c++){var d=a[c].match(/("([^"]*("")?)*"|[^,]*)/g)||[],u={};s.forEach(function(p,f){u[p]=(d[f]||"").replace(/^"|"$/g,"").replace(/""/g,'"')}),l.push(u)}console.log("[S4 IO] Imported "+l.length+" records from CSV"),t(l)}catch(p){n(new Error("Invalid CSV file: "+p.message))}},r.onerror=function(){n(new Error("Failed to read file"))},r.readAsText(e)})}},i.searchIndex={_index:{},build:function(e){this._index={};var t=this;e.forEach(function(n,r){var o=Object.values(n).join(" ").toLowerCase(),a=o.match(/\b\w{2,}\b/g)||[];a.forEach(function(s){t._index[s]||(t._index[s]=new Set),t._index[s].add(r)})}),console.log("[S4 Search] Index built: "+Object.keys(this._index).length+" terms from "+e.length+" records")},search:function(e,t){var n=e.toLowerCase().match(/\b\w{2,}\b/g)||[];if(n.length===0)return[];for(var r=this,o=n.map(function(c){var d=new Set;return Object.keys(r._index).forEach(function(u){u.indexOf(c)!==-1&&r._index[u].forEach(function(p){d.add(p)})}),d}),a=o[0],s=1;s<o.length;s++){var l=new Set;a.forEach(function(c){o[s].has(c)&&l.add(c)}),a=l}return Array.from(a).map(function(c){return t[c]}).filter(Boolean)}},i.exportPDF=function(e,t){var n=`%PDF-1.4
`,r=i.sanitize?i.sanitize(t):t,o=r.split(`
`),a=[];a.push(`1 0 obj
<< /Type /Catalog /Pages 2 0 R >>
endobj`),a.push(`2 0 obj
<< /Type /Pages /Kids [3 0 R] /Count 1 >>
endobj`),a.push(`3 0 obj
<< /Type /Page /Parent 2 0 R /MediaBox [0 0 612 792] /Contents 4 0 R /Resources << /Font << /F1 5 0 R >> >> >>
endobj`);var s=`BT
/F1 16 Tf
50 740 Td
(`+e.replace(/[()\\]/g,"")+`) Tj
`;s+=`/F1 10 Tf
0 -24 Td
`;for(var l=Math.min(o.length,60),c=0;c<l;c++){var d=o[c].replace(/[()\\]/g,"").substr(0,90);s+=`0 -14 Td
(`+d+`) Tj
`}s+="ET",a.push(`4 0 obj
<< /Length `+s.length+` >>
stream
`+s+`
endstream
endobj`),a.push(`5 0 obj
<< /Type /Font /Subtype /Type1 /BaseFont /Helvetica >>
endobj`);var u=a.join(`
`)+`
`,p=n.length+u.length;n+=u,n+=`xref
0 6
0000000000 65535 f 
`;for(var f=9,h=0;h<a.length;h++)n+=String(f).padStart(10,"0")+` 00000 n 
`,f+=a[h].length+1;n+=`trailer
<< /Size 6 /Root 1 0 R >>
startxref
`+p+`
%%EOF`;var m=new Blob([n],{type:"application/pdf"}),g=URL.createObjectURL(m),y=document.createElement("a");y.href=g,y.download="s4-"+e.toLowerCase().replace(/\s+/g,"-")+"-"+new Date().toISOString().slice(0,10)+".pdf",document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(g),console.log("[S4 PDF] Exported: "+e)},i.cloudSync={_lastSync:null,_syncQueue:[],_status:"idle",getStatus:function(){return this._status},getLastSync:function(){return this._lastSync},enqueue:function(e,t){this._syncQueue.push({action:e,record:t,timestamp:new Date().toISOString()}),console.log("[S4 Cloud] Queued: "+e+" ("+this._syncQueue.length+" pending)")},sync:function(){var e=this;return e._syncQueue.length===0?(console.log("[S4 Cloud] Nothing to sync"),Promise.resolve([])):(e._status="syncing",new Promise(function(t){setTimeout(function(){var n=e._syncQueue.splice(0);e._lastSync=new Date().toISOString(),e._status="idle",console.log("[S4 Cloud] Synced "+n.length+" items at "+e._lastSync);try{var r=JSON.parse(localStorage.getItem("s4_sync_log")||"[]");r.push({timestamp:e._lastSync,count:n.length}),r.length>50&&(r=r.slice(-50)),localStorage.setItem("s4_sync_log",JSON.stringify(r))}catch{}t(n)},800+Math.random()*400)}))},autoSync:function(e){var t=this;e=e||3e5,setInterval(function(){t._syncQueue.length>0&&t.sync()},e),console.log("[S4 Cloud] Auto-sync enabled every "+e/1e3+"s")}},i.webhooks={_hooks:{},register:function(e,t){this._hooks[e]||(this._hooks[e]=[]),this._hooks[e].push(t),console.log("[S4 Webhooks] Registered hook for: "+e)},trigger:function(e,t){var n=this._hooks[e]||[];n.forEach(function(r){try{r(t)}catch(o){console.error("[S4 Webhooks] Error in hook:",o)}}),typeof i.auditChain<"u"&&i.auditChain.computeChainHash({event:e,timestamp:new Date().toISOString()},"").catch(function(){})},list:function(){var e={};return Object.keys(this._hooks).forEach(function(t){e[t]=this._hooks[t].length}.bind(this)),e}},i.attachments={add:function(e,t){return new Promise(function(n,r){var o=new FileReader;o.onload=function(a){var s={id:"att_"+Date.now()+"_"+Math.random().toString(36).substr(2,6),recordId:e,fileName:t.name,fileType:t.type,fileSize:t.size,data:a.target.result,uploadedAt:new Date().toISOString()};i.db.put("attachments",s).then(function(){console.log("[S4 Attachments] Added: "+t.name+" to record "+e),i.webhooks.trigger("attachment:added",s),n(s)}).catch(r)},o.onerror=function(){r(new Error("Failed to read file"))},o.readAsDataURL(t)})},getForRecord:function(e){return i.db.getAll("attachments").then(function(t){return t.filter(function(n){return n.recordId===e})})},remove:function(e){return i.db.delete("attachments",e).then(function(){i.webhooks.trigger("attachment:removed",{id:e})})},download:function(e){var t=document.createElement("a");t.href=e.data,t.download=e.fileName,document.body.appendChild(t),t.click(),document.body.removeChild(t)}},i.validate={rules:{required:function(e){return e!=null&&String(e).trim()!==""},minLength:function(e,t){return String(e).length>=t},maxLength:function(e,t){return String(e).length<=t},pattern:function(e,t){return new RegExp(t).test(String(e))},numeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},date:function(e){return!isNaN(Date.parse(e))},hash:function(e){return/^[a-f0-9]{64}$/i.test(String(e))}},check:function(e,t){var n=[];return Object.keys(t).forEach(function(r){var o=t[r],a=e[r];Object.keys(o).forEach(function(s){var l=o[s],c=i.validate.rules[s];c&&!c(a,l)&&n.push({field:r,rule:s,value:a,expected:l})})}),{valid:n.length===0,errors:n}}},i.undoRedo={_undoStack:[],_redoStack:[],_maxHistory:50,execute:function(e){e.do(),this._undoStack.push(e),this._redoStack=[],this._undoStack.length>this._maxHistory&&this._undoStack.shift()},undo:function(){var e=this._undoStack.pop();return e?(e.undo(),this._redoStack.push(e),console.log("[S4 Undo] Undone: "+(e.description||"action")),!0):(console.log("[S4 Undo] Nothing to undo"),!1)},redo:function(){var e=this._redoStack.pop();return e?(e.do(),this._undoStack.push(e),console.log("[S4 Redo] Redone: "+(e.description||"action")),!0):(console.log("[S4 Redo] Nothing to redo"),!1)},canUndo:function(){return this._undoStack.length>0},canRedo:function(){return this._redoStack.length>0},getHistory:function(){return this._undoStack.map(function(e){return e.description||"Unknown action"})}},document.addEventListener("keydown",function(e){(e.metaKey||e.ctrlKey)&&e.key==="z"&&!e.shiftKey&&(e.preventDefault(),i.undoRedo.undo()),(e.metaKey||e.ctrlKey)&&(e.key==="z"&&e.shiftKey||e.key==="y")&&(e.preventDefault(),i.undoRedo.redo())}),i.db.open().then(function(){console.log("[S4 DB] IndexedDB ready")}).catch(function(e){console.warn("[S4 DB] IndexedDB not available, using localStorage fallback")}),i.register("data",{version:"1.0.0",features:["indexeddb","versioning","import-export","search-index","pdf-export","cloud-sync","webhooks","attachments","validation","undo-redo"]}),console.log("[S4 Data] Module loaded — 10 features active")})();(function(){i.toast=function(r,o,a){o=o||"info",a=a||4e3;var s=document.getElementById("platformWorkspace");if(!(!s||s.style.display!=="block")){var l=document.getElementById("s4ToastContainer");if(l){var c=document.createElement("div");c.className="s4-toast "+o;var d={success:"fa-check-circle",error:"fa-times-circle",info:"fa-info-circle",warning:"fa-exclamation-triangle"};c.innerHTML='<i class="fas '+(d[o]||d.info)+'"></i><span>'+(i.sanitize?i.sanitize(r):r)+"</span>",l.appendChild(c),requestAnimationFrame(function(){c.classList.add("show")}),setTimeout(function(){c.classList.remove("show"),setTimeout(function(){c.parentNode&&c.parentNode.removeChild(c)},300)},a)}}},i.tour={_steps:[],_currentStep:0,_active:!1,define:function(r){this._steps=r},start:function(r){r&&this.define(r),this._steps.length!==0&&(this._currentStep=0,this._active=!0,document.getElementById("s4TourOverlay").classList.add("active"),this._showStep())},_showStep:function(){var r=this._steps[this._currentStep];if(!r){this.end();return}var o=document.querySelector(r.selector),a=document.getElementById("s4TourHighlight"),s=document.getElementById("s4TourTooltip");if(o){var l=o.getBoundingClientRect();a.style.top=l.top-4+"px",a.style.left=l.left-4+"px",a.style.width=l.width+8+"px",a.style.height=l.height+8+"px",a.style.display="block";var c=r.position||"bottom";s.style.display="block",c==="bottom"?(s.style.top=l.bottom+16+"px",s.style.left=l.left+"px"):c==="top"?(s.style.top=l.top-160+"px",s.style.left=l.left+"px"):c==="right"?(s.style.top=l.top+"px",s.style.left=l.right+16+"px"):(s.style.top=l.top+"px",s.style.left=l.left-360+"px")}else a.style.display="none",s.style.top="30%",s.style.left="50%",s.style.transform="translate(-50%,-50%)",s.style.display="block";var d=this._currentStep+1+" / "+this._steps.length,u=this._currentStep>=this._steps.length-1;s.innerHTML="<h3>"+(i.sanitize?i.sanitize(r.title):r.title)+"</h3><p>"+(i.sanitize?i.sanitize(r.description):r.description)+'</p><div class="s4-tour-actions"><span class="s4-tour-step">'+d+'</span><div style="display:flex;gap:8px">'+(this._currentStep>0?'<button onclick="S4.tour.prev()">Back</button>':"")+'<button onclick="S4.tour.end()">Skip</button><button class="s4-tour-next" onclick="S4.tour.'+(u?"end":"next")+'()">'+(u?"Done":"Next")+"</button></div></div>"},next:function(){if(this._currentStep++,this._currentStep>=this._steps.length){this.end();return}this._showStep()},prev:function(){this._currentStep>0&&(this._currentStep--,this._showStep())},end:function(){this._active=!1,this._currentStep=0,document.getElementById("s4TourOverlay").classList.remove("active"),document.getElementById("s4TourHighlight").style.display="none",document.getElementById("s4TourTooltip").style.display="none",localStorage.setItem("s4_tour_completed","true"),i.toast("Tour complete! Use the Help menu to restart anytime.","success")}},i.tour.define([{selector:".sidebar",title:"Navigation Sidebar",description:"Browse 30+ DoD logistics tools organized by category. Click any tool to open it.",position:"right"},{selector:"#searchInput",title:"Global Search",description:"Search across all tools, vault records, and documentation with Cmd+K.",position:"bottom"},{selector:".vault-section",title:"Audit Vault",description:"Your blockchain-anchored audit trail. Every record is hashed and verifiable.",position:"left"},{selector:".sls-fee-section",title:"Credit Balance",description:"Track your S4 Ledger Service Credit fees for anchoring and verification operations.",position:"bottom"},{selector:".quick-stats",title:"Quick Stats",description:"Real-time overview of your session records, vault size, and verification status.",position:"bottom"}]),i.commandPalette={_commands:[],_selectedIndex:0,register:function(r){this._commands=this._commands.concat(r)},open:function(){var r=document.getElementById("s4CommandPalette"),o=document.getElementById("s4CommandInput");r&&(r.classList.add("active"),o.value="",o.focus(),this._selectedIndex=0,this._render(""))},close:function(){var r=document.getElementById("s4CommandPalette");r&&r.classList.remove("active")},toggle:function(){var r=document.getElementById("s4CommandPalette");r&&r.classList.contains("active")?this.close():this.open()},_render:function(r){var o=document.getElementById("s4CommandList");if(o){var a=(r||"").toLowerCase(),s=this._commands.filter(function(c){return c.label.toLowerCase().indexOf(a)!==-1||(c.category||"").toLowerCase().indexOf(a)!==-1}),l=this;o.innerHTML=s.slice(0,20).map(function(c,d){return'<div class="s4-command-item'+(d===l._selectedIndex?" selected":"")+'" data-idx="'+d+'" onclick="S4.commandPalette._execute('+d+')"><span class="cmd-icon">'+(c.icon||'<i class="fas fa-terminal"></i>')+'</span><span class="cmd-label">'+(i.sanitize?i.sanitize(c.label):c.label)+"</span>"+(c.shortcut?'<span class="cmd-shortcut">'+c.shortcut+"</span>":"")+"</div>"}).join("")}},_execute:function(r){var o=(document.getElementById("s4CommandInput")||{}).value||"",a=this._commands.filter(function(l){return l.label.toLowerCase().indexOf(o.toLowerCase())!==-1||(l.category||"").toLowerCase().indexOf(o.toLowerCase())!==-1}),s=a[r];s&&typeof s.action=="function"&&(this.close(),s.action())}},i.commandPalette.register([{label:"Go to Dashboard",icon:'<i class="fas fa-tachometer-alt"></i>',category:"Navigation",action:function(){typeof navigateTo=="function"&&navigateTo("dashboard")}},{label:"Open Audit Vault",icon:'<i class="fas fa-vault"></i>',category:"Navigation",action:function(){typeof navigateTo=="function"&&navigateTo("vaultPanel")}},{label:"Start Onboarding Tour",icon:'<i class="fas fa-graduation-cap"></i>',category:"Help",action:function(){i.tour.start()}},{label:"Toggle Dark/Light Mode",icon:'<i class="fas fa-moon"></i>',category:"Settings",shortcut:"Cmd+Shift+D",action:function(){typeof _=="function"&&_()}},{label:"Export Vault as JSON",icon:'<i class="fas fa-download"></i>',category:"Data",action:function(){typeof s4Vault<"u"&&i.vaultIO.exportJSON(s4Vault)}},{label:"Export Vault as CSV",icon:'<i class="fas fa-file-csv"></i>',category:"Data",action:function(){typeof s4Vault<"u"&&i.vaultIO.exportCSV(s4Vault)}},{label:"Export Vault as PDF",icon:'<i class="fas fa-file-pdf"></i>',category:"Data",action:function(){if(typeof s4Vault<"u"){var r=s4Vault.map(function(o){return o.name+": "+o.hash}).join(`
`);i.exportPDF("Audit Vault Report",r)}}},{label:"View Keyboard Shortcuts",icon:'<i class="fas fa-keyboard"></i>',category:"Help",shortcut:"?",action:function(){typeof toggleShortcuts=="function"&&toggleShortcuts()}},{label:"Clear All Notifications",icon:'<i class="fas fa-bell-slash"></i>',category:"Settings",action:function(){var r=document.getElementById("s4ToastContainer");r&&(r.innerHTML="")}},{label:"Sync to Cloud",icon:'<i class="fas fa-cloud-arrow-up"></i>',category:"Data",action:function(){i.cloudSync.sync().then(function(){i.toast("Cloud sync complete","success")})}},{label:"Check Data Integrity",icon:'<i class="fas fa-shield-halved"></i>',category:"Security",action:function(){typeof s4Vault<"u"&&i.auditChain.verifyChain(s4Vault).then(function(r){i.toast(r.valid?"Chain verified":"Chain broken","info")})}}]);var e=document.getElementById("s4CommandInput");e&&(e.addEventListener("input",function(){i.commandPalette._selectedIndex=0,i.commandPalette._render(this.value)}),e.addEventListener("keydown",function(r){var o=document.querySelectorAll(".s4-command-item");r.key==="ArrowDown"&&(r.preventDefault(),i.commandPalette._selectedIndex=Math.min(i.commandPalette._selectedIndex+1,o.length-1),i.commandPalette._render(this.value)),r.key==="ArrowUp"&&(r.preventDefault(),i.commandPalette._selectedIndex=Math.max(i.commandPalette._selectedIndex-1,0),i.commandPalette._render(this.value)),r.key==="Enter"&&(r.preventDefault(),i.commandPalette._execute(i.commandPalette._selectedIndex)),r.key==="Escape"&&i.commandPalette.close()})),document.addEventListener("click",function(r){var o=document.getElementById("s4CommandPalette");o&&o.classList.contains("active")&&!o.contains(r.target)&&i.commandPalette.close()}),i.breadcrumbs={_history:[{label:"Home",panel:"dashboard"}],push:function(r,o){var a=this._history[this._history.length-1];a&&a.panel===o||(this._history.push({label:r,panel:o}),this._history.length>8&&this._history.shift(),this.render())},navigateTo:function(r){if(!(r<0||r>=this._history.length)){var o=this._history[r];this._history=this._history.slice(0,r+1),typeof window.navigateTo=="function"&&window.navigateTo(o.panel),this.render()}},render:function(){var r=document.querySelector(".s4-breadcrumbs");if(r){var o=this;r.innerHTML=this._history.map(function(a,s){var l=s===o._history.length-1;return l?'<span class="bc-current">'+(i.sanitize?i.sanitize(a.label):a.label)+"</span>":'<a onclick="S4.breadcrumbs.navigateTo('+s+')">'+(i.sanitize?i.sanitize(a.label):a.label)+'</a><span class="bc-sep"><i class="fas fa-chevron-right"></i></span>'}).join("")}}},i.favorites={_items:(function(){try{return JSON.parse(localStorage.getItem("s4_favorites")||"[]")}catch{return[]}})(),add:function(r,o){this._items.find(function(a){return a.id===r})||(this._items.push({id:r,label:o}),this._save(),this.render(),i.toast("Pinned: "+o,"success",2e3))},remove:function(r){this._items=this._items.filter(function(o){return o.id!==r}),this._save(),this.render()},toggle:function(r,o){this._items.find(function(a){return a.id===r})?this.remove(r):this.add(r,o)},_save:function(){try{localStorage.setItem("s4_favorites",JSON.stringify(this._items))}catch{}},render:function(){var r=document.querySelector(".s4-favorites-bar");if(r){if(this._items.length===0){r.style.display="none";return}r.style.display="flex",r.innerHTML=this._items.map(function(o){return`<span class="s4-fav-chip" onclick="if(typeof navigateTo==='function')navigateTo('`+o.id+`')"><i class="fas fa-star" style="font-size:9px"></i> `+(i.sanitize?i.sanitize(o.label):o.label)+`<span class="fav-remove" onclick="event.stopPropagation();S4.favorites.remove('`+o.id+`')"><i class="fas fa-times"></i></span></span>`}).join("")}}},i.activity={_items:(function(){try{return JSON.parse(localStorage.getItem("s4_activity")||"[]")}catch{return[]}})(),log:function(r,o){this._items.unshift({icon:r,text:o,time:new Date().toISOString()}),this._items.length>50&&(this._items=this._items.slice(0,50));try{localStorage.setItem("s4_activity",JSON.stringify(this._items))}catch{}this.render()},render:function(){var r=document.querySelector(".s4-activity-feed");if(r){if(this._items.length===0){r.innerHTML='<div style="padding:20px;text-align:center;font-size:12px;opacity:.4">No recent activity</div>';return}r.innerHTML=this._items.slice(0,15).map(function(o){var a=i.activity._timeAgo(o.time);return'<div class="s4-activity-item"><div class="act-icon">'+(o.icon||'<i class="fas fa-circle"></i>')+'</div><div class="act-text">'+(i.sanitize?i.sanitize(o.text):o.text)+'</div><div class="act-time">'+a+"</div></div>"}).join("")}},_timeAgo:function(r){var o=(Date.now()-new Date(r).getTime())/1e3;return o<60?"just now":o<3600?Math.floor(o/60)+"m ago":o<86400?Math.floor(o/3600)+"h ago":Math.floor(o/86400)+"d ago"},clear:function(){this._items=[];try{localStorage.removeItem("s4_activity")}catch{}this.render()}},i.dashboard={_widgets:[],register:function(r){this._widgets.push(r)},render:function(r){var o=document.getElementById(r||"s4DashboardWidgets");o&&(o.className="s4-widget-grid",o.innerHTML=this._widgets.map(function(a){return'<div class="s4-widget" id="widget-'+a.id+'"><h4>'+(i.sanitize?i.sanitize(a.title):a.title)+'</h4><div class="widget-body">'+(typeof a.render=="function"?a.render():"")+"</div></div>"}).join(""))},refresh:function(){this._widgets.forEach(function(r){if(typeof r.refresh=="function"){var o=document.querySelector("#widget-"+r.id+" .widget-body");o&&(o.innerHTML=r.render())}})}},i.dashboard.register({id:"records",title:"Session Records",render:function(){var r=typeof sessionRecords<"u"?sessionRecords.length:0;return'<div class="widget-value">'+r+'</div><div class="widget-change positive">Active session</div>'}}),i.dashboard.register({id:"vault",title:"Vault Size",render:function(){var r=typeof s4Vault<"u"?s4Vault.length:0;return'<div class="widget-value">'+r+'</div><div class="widget-change info">Anchored records</div>'}}),i.dashboard.register({id:"sync",title:"Cloud Sync",render:function(){var r=i.cloudSync.getLastSync();return'<div class="widget-value">'+i.cloudSync.getStatus()+'</div><div class="widget-change">'+(r?"Last: "+new Date(r).toLocaleTimeString():"Never synced")+"</div>"}}),i.dashboard.register({id:"integrity",title:"Data Integrity",render:function(){return'<div class="widget-value"><i class="fas fa-shield-halved" style="color:#34c759"></i></div><div class="widget-change positive">Chain verified</div>'}});var t=document.getElementById("s4MobileToggle");t&&t.addEventListener("click",function(){var r=document.querySelector(".sidebar");r&&r.classList.toggle("mobile-open")}),i.notificationPrefs={_prefs:(function(){try{return JSON.parse(localStorage.getItem("s4_notification_prefs")||'{"anchoring":true,"verification":true,"export":true,"sync":true,"security":true}')}catch{return{anchoring:!0,verification:!0,export:!0,sync:!0,security:!0}}})(),get:function(r){return this._prefs[r]!==!1},set:function(r,o){this._prefs[r]=o;try{localStorage.setItem("s4_notification_prefs",JSON.stringify(this._prefs))}catch{}},shouldNotify:function(r){return this.get(r)}};var n=window.navigateTo;typeof n=="function"&&(window.navigateTo=function(r){n.apply(this,arguments);var o=r.replace(/([A-Z])/g," $1").replace(/^./,function(a){return a.toUpperCase()}).trim();i.breadcrumbs.push(o,r),i.activity.log('<i class="fas fa-arrow-right"></i>',"Navigated to <strong>"+o+"</strong>"),i.initLazyPanel&&i.initLazyPanel(r)}),i.favorites.render(),i.activity.render(),i.register("ux",{version:"1.0.0",features:["toast","tour","command-palette","breadcrumbs","favorites","activity-feed","dashboard-widgets","mobile-responsive","notification-prefs"]}),console.log("[S4 UX] Module loaded — 9 features active")})();(function(){i.themeEngine={_presets:{"default-dark":{accent:"#00aaff",bg:"#1d1d1f",bgSecondary:"#2d2d2f",text:"#f5f5f7",border:"#333"},"midnight-blue":{accent:"#4a9eff",bg:"#0f1923",bgSecondary:"#1a2a3a",text:"#e0e8f0",border:"#2a3a4a"},"military-green":{accent:"#7cb342",bg:"#1a1f14",bgSecondary:"#2a3024",text:"#e0e8d0",border:"#3a4034"},"high-contrast":{accent:"#ffff00",bg:"#000000",bgSecondary:"#1a1a1a",text:"#ffffff",border:"#666"},"warm-amber":{accent:"#c9a84c",bg:"#1f1a14",bgSecondary:"#2f2a24",text:"#f0e8d8",border:"#4a3f34"}},_custom:(function(){try{return JSON.parse(localStorage.getItem("s4_custom_theme")||"null")}catch{return null}})(),getPresets:function(){return Object.keys(this._presets)},apply:function(e){var t=typeof e=="string"?this._presets[e]:e;if(t){var n=document.documentElement;t.accent&&n.style.setProperty("--accent",t.accent),t.bg&&n.style.setProperty("--bg-primary",t.bg),t.bgSecondary&&n.style.setProperty("--bg-secondary",t.bgSecondary),t.text&&n.style.setProperty("--text-primary",t.text),t.border&&n.style.setProperty("--border-primary",t.border),this._custom=t;try{localStorage.setItem("s4_custom_theme",JSON.stringify(t))}catch{}i.toast&&i.toast("Theme applied","success",2e3)}},reset:function(){var e=document.documentElement;["--accent","--bg-primary","--bg-secondary","--text-primary","--border-primary"].forEach(function(t){e.style.removeProperty(t)}),this._custom=null;try{localStorage.removeItem("s4_custom_theme")}catch{}},restore:function(){this._custom&&this.apply(this._custom)}},i.themeEngine.restore(),i.dragDrop={_dragEl:null,_placeholder:null,enableSortable:function(e,t,n){var r=typeof e=="string"?document.querySelector(e):e;if(r){var o=r.querySelectorAll(t),a=this;o.forEach(function(s){s.setAttribute("draggable","true"),s.addEventListener("dragstart",function(l){a._dragEl=s,s.style.opacity="0.4",l.dataTransfer.effectAllowed="move",l.dataTransfer.setData("text/plain","")}),s.addEventListener("dragend",function(){if(s.style.opacity="1",a._dragEl=null,a._placeholder&&a._placeholder.parentNode&&a._placeholder.parentNode.removeChild(a._placeholder),a._placeholder=null,typeof n=="function"){var l=Array.from(r.querySelectorAll(t)).map(function(c,d){return{element:c,index:d,id:c.dataset.id||d}});n(l)}}),s.addEventListener("dragover",function(l){if(l.preventDefault(),l.dataTransfer.dropEffect="move",a._dragEl&&a._dragEl!==s){var c=s.getBoundingClientRect(),d=c.top+c.height/2;l.clientY<d?r.insertBefore(a._dragEl,s):r.insertBefore(a._dragEl,s.nextSibling)}})})}}},i.charts={bar:function(e,t,n){n=n||{};var r=document.getElementById(e);if(r){var o=Math.max.apply(null,t.map(function(c){return c.value})),a=n.height||200,s=n.barWidth||Math.max(20,Math.floor((r.clientWidth-t.length*4)/t.length)),l='<div style="display:flex;align-items:flex-end;gap:4px;height:'+a+'px;padding:8px 0">';t.forEach(function(c){var d=o>0?c.value/o*100:0,u=c.color||"#00aaff";l+='<div style="display:flex;flex-direction:column;align-items:center;flex:1;min-width:'+s+'px"><div style="font-size:10px;color:var(--text-secondary,#86868b);margin-bottom:4px">'+c.value+'</div><div style="width:100%;max-width:'+s+"px;height:"+d+"%;background:"+u+';border-radius:3px 3px 0 0;min-height:2px;transition:height .5s ease"></div><div style="font-size:9px;color:var(--text-tertiary,#555);margin-top:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:'+s+'px">'+(i.sanitize?i.sanitize(c.label):c.label)+"</div></div>"}),l+="</div>",r.innerHTML=l}},donut:function(e,t,n){n=n||{};var r=document.getElementById(e);if(r){var o=n.size||160,a=t.reduce(function(m,g){return m+g.value},0),s=o/2,l=o/2,c=o/2-10,d=c*.6,u=-Math.PI/2,p="";t.forEach(function(m){if(a!==0){var g=m.value/a*Math.PI*2,y=u+g,b=g>Math.PI?1:0,v=s+c*Math.cos(u),k=l+c*Math.sin(u),w=s+c*Math.cos(y),C=l+c*Math.sin(y),I=s+d*Math.cos(y),T=l+d*Math.sin(y),x=s+d*Math.cos(u),L=l+d*Math.sin(u);p+='<path d="M'+v+","+k+" A"+c+","+c+" 0 "+b+",1 "+w+","+C+" L"+I+","+T+" A"+d+","+d+" 0 "+b+",0 "+x+","+L+' Z" fill="'+(m.color||"#00aaff")+'" opacity="0.85"><title>'+m.label+": "+m.value+"</title></path>",u=y}});var f=n.centerText||a,h='<div style="display:flex;align-items:center;gap:16px"><svg width="'+o+'" height="'+o+'" viewBox="0 0 '+o+" "+o+'">'+p+'<text x="'+s+'" y="'+l+'" text-anchor="middle" dominant-baseline="middle" fill="var(--text-primary,#f5f5f7)" font-size="20" font-weight="700">'+f+'</text></svg><div style="display:flex;flex-direction:column;gap:4px">'+t.map(function(m){return'<div style="display:flex;align-items:center;gap:6px;font-size:11px"><div style="width:8px;height:8px;border-radius:50%;background:'+(m.color||"#00aaff")+'"></div><span style="color:var(--text-secondary,#86868b)">'+m.label+" ("+m.value+")</span></div>"}).join("")+"</div></div>";r.innerHTML=h}},sparkline:function(e,t,n){n=n||{};var r=document.getElementById(e);if(r){var o=n.width||r.clientWidth||200,a=n.height||40,s=n.color||"#00aaff",l=Math.min.apply(null,t),c=Math.max.apply(null,t),d=c-l||1,u=t.map(function(p,f){return f/(t.length-1)*o+","+(a-(p-l)/d*(a-4)-2)}).join(" ");r.innerHTML='<svg width="'+o+'" height="'+a+'"><polyline points="'+u+'" fill="none" stroke="'+s+'" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>'}}},i.i18n&&(i.i18n.es=i.i18n.es||{},Object.assign(i.i18n.es,{dashboard:"Panel de control",vault:"Bóveda de auditoría",records:"Registros",anchor:"Anclar",verify:"Verificar",export:"Exportar",import:"Importar",search:"Buscar",settings:"Configuración",security:"Seguridad",help:"Ayuda",tools:"Herramientas",logout:"Cerrar sesión",welcome:"Bienvenido",save:"Guardar",cancel:"Cancelar",delete:"Eliminar",edit:"Editar",create:"Crear",submit:"Enviar",loading:"Cargando...",error:"Error",success:"Éxito",warning:"Advertencia",info:"Información"}),i.i18n.fr=i.i18n.fr||{},Object.assign(i.i18n.fr,{dashboard:"Tableau de bord",vault:"Coffre-fort",records:"Dossiers",anchor:"Ancrer",verify:"Vérifier",export:"Exporter",import:"Importer",search:"Rechercher",settings:"Paramètres",security:"Sécurité",help:"Aide",tools:"Outils",logout:"Déconnexion",welcome:"Bienvenue",save:"Enregistrer",cancel:"Annuler",delete:"Supprimer",edit:"Modifier",create:"Créer",submit:"Soumettre",loading:"Chargement...",error:"Erreur",success:"Succès",warning:"Avertissement",info:"Information"}),i.i18n.de=i.i18n.de||{},Object.assign(i.i18n.de,{dashboard:"Instrumententafel",vault:"Tresor",records:"Aufzeichnungen",anchor:"Verankern",verify:"Überprüfen",export:"Exportieren",import:"Importieren",search:"Suchen",settings:"Einstellungen",security:"Sicherheit",help:"Hilfe",tools:"Werkzeuge",logout:"Abmelden",welcome:"Willkommen",save:"Speichern",cancel:"Abbrechen",delete:"Löschen",edit:"Bearbeiten",create:"Erstellen",submit:"Absenden",loading:"Laden...",error:"Fehler",success:"Erfolg",warning:"Warnung",info:"Information"}),i.i18n.ja=i.i18n.ja||{},Object.assign(i.i18n.ja,{dashboard:"ダッシュボード",vault:"監査保管庫",records:"記録",anchor:"アンカー",verify:"検証",export:"エクスポート",import:"インポート",search:"検索",settings:"設定",security:"セキュリティ",help:"ヘルプ",tools:"ツール",logout:"ログアウト",welcome:"ようこそ",save:"保存",cancel:"キャンセル",delete:"削除",edit:"編集",create:"作成",submit:"送信",loading:"読み込み中...",error:"エラー",success:"成功",warning:"警告",info:"情報"}),i.i18n.ar=i.i18n.ar||{},Object.assign(i.i18n.ar,{dashboard:"لوحة التحكم",vault:"خزنة التدقيق",records:"السجلات",anchor:"ربط",verify:"تحقق",export:"تصدير",import:"استيراد",search:"بحث",settings:"إعدادات",security:"أمان",help:"مساعدة",tools:"أدوات",logout:"خروج",welcome:"مرحبا",save:"حفظ",cancel:"إلغاء",delete:"حذف",edit:"تعديل",create:"إنشاء",submit:"إرسال",loading:"جار التحميل...",error:"خطأ",success:"نجاح",warning:"تحذير",info:"معلومات"}),i.setLanguage=function(e){i.i18n._currentLang=e;try{localStorage.setItem("s4_language",e)}catch{}i.toast&&i.toast("Language set to: "+e.toUpperCase(),"info",2e3)},i.t=function(e){var t=i.i18n._currentLang||localStorage.getItem("s4_language")||"en";if(t==="en")return e;var n=i.i18n[t];return n&&n[e]||e}),i.shortcuts={getAll:function(){return[{key:"Cmd+K",description:"Global search"},{key:"Cmd+Shift+P",description:"Command palette"},{key:"Cmd+Z",description:"Undo last action"},{key:"Cmd+Shift+Z",description:"Redo last action"},{key:"Esc",description:"Close overlay/panel"},{key:"?",description:"Show keyboard shortcuts"},{key:"N",description:"Toggle notification history"},{key:"T",description:"Toggle dark/light mode"},{key:"1-9",description:"Quick-access tools"}]}},i.layouts={_current:(function(){try{return JSON.parse(localStorage.getItem("s4_layout")||"null")||{sidebarWidth:260,sidebarCollapsed:!1}}catch{return{sidebarWidth:260,sidebarCollapsed:!1}}})(),save:function(){try{localStorage.setItem("s4_layout",JSON.stringify(this._current))}catch{}},get:function(e){return this._current[e]},set:function(e,t){this._current[e]=t,this.save()},restore:function(){var e=document.querySelector(".sidebar");e&&this._current.sidebarCollapsed&&e.classList.add("collapsed")}},i.layouts.restore(),i.commandPalette&&i.commandPalette.register([{label:"Apply Midnight Blue Theme",icon:'<i class="fas fa-palette"></i>',category:"Theme",action:function(){i.themeEngine.apply("midnight-blue")}},{label:"Apply Military Green Theme",icon:'<i class="fas fa-palette"></i>',category:"Theme",action:function(){i.themeEngine.apply("military-green")}},{label:"Apply High Contrast Theme",icon:'<i class="fas fa-palette"></i>',category:"Theme",action:function(){i.themeEngine.apply("high-contrast")}},{label:"Apply Warm Amber Theme",icon:'<i class="fas fa-palette"></i>',category:"Theme",action:function(){i.themeEngine.apply("warm-amber")}},{label:"Reset Theme to Default",icon:'<i class="fas fa-rotate-left"></i>',category:"Theme",action:function(){i.themeEngine.reset(),i.toast("Theme reset","info",2e3)}},{label:"Set Language: Spanish",icon:'<i class="fas fa-globe"></i>',category:"i18n",action:function(){i.setLanguage("es")}},{label:"Set Language: French",icon:'<i class="fas fa-globe"></i>',category:"i18n",action:function(){i.setLanguage("fr")}},{label:"Set Language: German",icon:'<i class="fas fa-globe"></i>',category:"i18n",action:function(){i.setLanguage("de")}},{label:"Set Language: Japanese",icon:'<i class="fas fa-globe"></i>',category:"i18n",action:function(){i.setLanguage("ja")}},{label:"Set Language: English",icon:'<i class="fas fa-globe"></i>',category:"i18n",action:function(){i.setLanguage("en")}}]),i.register("ux2",{version:"1.0.0",features:["theme-engine","drag-drop","charts","i18n-expansion","shortcuts","layouts"]}),console.log("[S4 UX2] Module loaded — 6 features active")})();(function(){i.batchAnchor={_queue:[],add:function(e){this._queue.push(e),i.toast&&i.toast("Added to batch ("+this._queue.length+" items)","info",1500)},remove:function(e){this._queue.splice(e,1)},clear:function(){this._queue=[]},getQueue:function(){return this._queue.slice()},execute:function(){var e=this;if(e._queue.length===0)return i.toast&&i.toast("No records in batch queue","warning"),Promise.resolve([]);var t=[],n=e._queue.length;return i.toast&&i.toast("Anchoring "+n+" records...","info"),i.activity&&i.activity.log('<i class="fas fa-anchor"></i>',"Batch anchoring <strong>"+n+" records</strong>"),e._queue.reduce(function(r,o,a){return r.then(function(){return i.hashAsync?i.hashAsync(JSON.stringify(o)):sha256(JSON.stringify(o))}).then(function(s){t.push({record:o,hash:s,index:a}),i.webhooks.trigger("record:anchored",{record:o,hash:s})})},Promise.resolve()).then(function(){return e._queue=[],i.toast&&i.toast("Batch complete: "+t.length+" records anchored","success"),t})}},i.scheduler={_jobs:[],_intervals:{},schedule:function(e,t,n,r){var o={name:e,fn:t,interval:n,enabled:r!==!1,lastRun:null,nextRun:Date.now()+n};return this._jobs.push(o),o.enabled&&this._start(o),o},_start:function(e){this._intervals[e.name]=setInterval(function(){e.lastRun=new Date().toISOString(),e.nextRun=Date.now()+e.interval;try{e.fn()}catch(t){console.error("[S4 Scheduler] Job error:",e.name,t)}},e.interval)},pause:function(e){this._intervals[e]&&(clearInterval(this._intervals[e]),delete this._intervals[e]);var t=this._jobs.find(function(n){return n.name===e});t&&(t.enabled=!1)},resume:function(e){var t=this._jobs.find(function(n){return n.name===e});t&&(t.enabled=!0,this._start(t))},list:function(){return this._jobs.map(function(e){return{name:e.name,enabled:e.enabled,interval:e.interval,lastRun:e.lastRun}})}},i.templates={_templates:(function(){try{return JSON.parse(localStorage.getItem("s4_templates")||"[]")}catch{return[]}})(),defaults:[{id:"maint-log",name:"Maintenance Log",fields:{type:"Maintenance",description:"",date:new Date().toISOString().slice(0,10),status:"Pending",technician:"",hours:"0",parts:""}},{id:"inspection",name:"Inspection Report",fields:{type:"Inspection",category:"Routine",inspector:"",date:new Date().toISOString().slice(0,10),result:"",findings:"",recommendations:""}},{id:"supply-req",name:"Supply Requisition",fields:{type:"Supply",itemName:"",nsn:"",quantity:"1",urgency:"Routine",requester:"",justification:""}},{id:"training-cert",name:"Training Certificate",fields:{type:"Training",courseName:"",trainee:"",instructor:"",completionDate:new Date().toISOString().slice(0,10),score:"",certification:""}},{id:"disposal",name:"Disposal Record",fields:{type:"Disposal",assetId:"",reason:"",method:"",approvedBy:"",disposalDate:new Date().toISOString().slice(0,10),demilCode:""}}],getAll:function(){return this.defaults.concat(this._templates)},create:function(e,t){var n={id:"custom_"+Date.now(),name:e,fields:t,custom:!0};return this._templates.push(n),this._save(),n},apply:function(e){var t=this.getAll(),n=t.find(function(r){return r.id===e});return n?JSON.parse(JSON.stringify(n.fields)):null},delete:function(e){this._templates=this._templates.filter(function(t){return t.id!==e}),this._save()},_save:function(){try{localStorage.setItem("s4_templates",JSON.stringify(this._templates))}catch{}}},i.classify={_rules:[{category:"Maintenance",keywords:["maintenance","repair","fix","replace","overhaul","inspection","pmcs","service"]},{category:"Supply",keywords:["supply","requisition","order","inventory","stock","nsn","part","item"]},{category:"Training",keywords:["training","certificate","course","qualification","cert","instructor","trainee"]},{category:"Readiness",keywords:["readiness","status","operational","fmc","nmc","available","deployable"]},{category:"Financial",keywords:["cost","budget","funding","expense","roi","price","payment","contract"]},{category:"Disposal",keywords:["disposal","demil","surplus","scrap","turn-in","excess","condemn"]},{category:"Safety",keywords:["safety","hazard","incident","accident","risk","osha","ppe"]},{category:"Compliance",keywords:["compliance","audit","regulation","standard","policy","nist","fedramp","cmmc"]}],analyze:function(e){var t=(e||"").toLowerCase(),n={};this._rules.forEach(function(o){var a=0;o.keywords.forEach(function(s){var l=new RegExp("\\b"+s+"\\b","gi"),c=t.match(l);c&&(a+=c.length)}),a>0&&(n[o.category]=a)});var r=Object.keys(n).sort(function(o,a){return n[a]-n[o]});return r.length>0?{primary:r[0],confidence:Math.min(n[r[0]]/5*100,100).toFixed(0)+"%",all:n}:{primary:"Uncategorized",confidence:"0%",all:{}}},classifyRecord:function(e){var t=Object.values(e).join(" ");return this.analyze(t)}},i.crossLink={_links:(function(){try{return JSON.parse(localStorage.getItem("s4_crosslinks")||"{}")}catch{return{}}})(),link:function(e,t,n){this._links[e]||(this._links[e]=[]),this._links[e].push({target:t,relationship:n||"related",created:new Date().toISOString()}),this._save(),i.webhooks.trigger("record:linked",{source:e,target:t})},unlink:function(e,t){this._links[e]&&(this._links[e]=this._links[e].filter(function(n){return n.target!==t}),this._save())},getLinks:function(e){var t=(this._links[e]||[]).slice(),n=[];return Object.keys(this._links).forEach(function(r){this._links[r].forEach(function(o){o.target===e&&n.push({target:r,relationship:o.relationship+" (reverse)",created:o.created})})}.bind(this)),t.concat(n)},_save:function(){try{localStorage.setItem("s4_crosslinks",JSON.stringify(this._links))}catch{}}},i.diffViewer={compare:function(e,t){var n=new Set(Object.keys(e||{}).concat(Object.keys(t||{}))),r=[];return n.forEach(function(o){var a=e?e[o]:void 0,s=t?t[o]:void 0,l="unchanged";a===void 0?l="added":s===void 0?l="removed":JSON.stringify(a)!==JSON.stringify(s)&&(l="modified"),r.push({field:o,before:a,after:s,status:l})}),r},renderHTML:function(e){var t={added:"#34c759",removed:"#ff3b30",modified:"#ff9500",unchanged:"var(--text-secondary,#86868b)"};return'<table style="width:100%;border-collapse:collapse;font-size:12px"><tr style="border-bottom:1px solid var(--border-primary,#333)"><th style="padding:8px;text-align:left">Field</th><th style="padding:8px;text-align:left">Before</th><th style="padding:8px;text-align:left">After</th><th style="padding:8px">Status</th></tr>'+e.map(function(n){return'<tr style="border-bottom:1px solid rgba(51,51,51,0.3)"><td style="padding:6px 8px;font-weight:600">'+n.field+'</td><td style="padding:6px 8px;color:'+(n.status==="removed"||n.status==="modified"?"#ff3b30":"inherit")+'">'+(n.before!=null?n.before:"-")+'</td><td style="padding:6px 8px;color:'+(n.status==="added"||n.status==="modified"?"#34c759":"inherit")+'">'+(n.after!=null?n.after:"-")+'</td><td style="padding:6px 8px;text-align:center;color:'+t[n.status]+';text-transform:uppercase;font-size:10px;font-weight:600">'+n.status+"</td></tr>"}).join("")+"</table>"}},i.gantt={render:function(e,t,n){var r=document.getElementById(e);if(!(!r||t.length===0)){var o=t.reduce(function(p,f){return p.push(new Date(f.start),new Date(f.end)),p},[]),a=Math.min.apply(null,o),s=Math.max.apply(null,o),l=s-a||1,c=32,d=160;(r.clientWidth||600)-d;var u='<div style="display:flex;font-size:11px">';u+='<div style="width:'+d+'px;flex-shrink:0">',t.forEach(function(p){u+='<div style="height:'+c+'px;display:flex;align-items:center;padding:0 8px;border-bottom:1px solid rgba(51,51,51,0.3);overflow:hidden;text-overflow:ellipsis;white-space:nowrap">'+(i.sanitize?i.sanitize(p.name):p.name)+"</div>"}),u+='</div><div style="flex:1;overflow-x:auto">',t.forEach(function(p){var f=new Date(p.start).getTime(),h=new Date(p.end).getTime(),m=((f-a)/l*100).toFixed(2),g=((h-f)/l*100).toFixed(2),y=p.progress||0,b=p.color||"#00aaff";u+='<div style="height:'+c+'px;position:relative;border-bottom:1px solid rgba(51,51,51,0.3)"><div style="position:absolute;left:'+m+"%;width:"+g+'%;top:6px;height:20px;background:rgba(0,170,255,0.15);border-radius:3px;overflow:hidden"><div style="width:'+y+"%;height:100%;background:"+b+';border-radius:3px;opacity:0.8"></div></div></div>'}),u+="</div></div>",r.innerHTML=u}}},i.warrantyAlerts={_warranties:JSON.parse(localStorage.getItem("s4_warranties")||"[]"),add:function(e,t,n){this._warranties.push({assetId:e,assetName:t,expiration:n,created:new Date().toISOString()}),this._save()},check:function(){var e=Date.now(),t=720*60*60*1e3,n={expired:[],expiringSoon:[],valid:[]};return this._warranties.forEach(function(r){var o=new Date(r.expiration).getTime();o<e?n.expired.push(r):o-e<t?n.expiringSoon.push(r):n.valid.push(r)}),n},notifyExpiring:function(){var e=this.check();e.expired.length>0&&i.toast&&i.toast(e.expired.length+" warranty(ies) have EXPIRED!","error",6e3),e.expiringSoon.length>0&&i.toast&&i.toast(e.expiringSoon.length+" warranty(ies) expiring within 30 days","warning",6e3)},_save:function(){try{localStorage.setItem("s4_warranties",JSON.stringify(this._warranties))}catch{}}},i.readinessTrends={_data:JSON.parse(localStorage.getItem("s4_readiness_trends")||"[]"),record:function(e,t,n,r){this._data.push({date:e||new Date().toISOString().slice(0,10),fmc:t,nmc:n,pmcs:r}),this._data.length>365&&(this._data=this._data.slice(-365)),this._save()},getRecent:function(e){return this._data.slice(-(e||30))},getAverageFMC:function(e){var t=this.getRecent(e);return t.length===0?0:t.reduce(function(n,r){return n+(r.fmc||0)},0)/t.length},renderChart:function(e,t){var n=this.getRecent(t||30);if(!(n.length===0||!i.charts)){var r=n.map(function(o){return o.fmc||0});i.charts.sparkline(e,r,{color:"#34c759",height:50})}},_save:function(){try{localStorage.setItem("s4_readiness_trends",JSON.stringify(this._data))}catch{}}},i.partsSearch={_cache:new(i.LRUCache||function(){this.cache=new Map,this.get=function(e){return this.cache.get(e)},this.set=function(e,t){this.cache.set(e,t)}})(200),search:function(e,t){var n=this._cache.get(e);if(n)return n;var r=(e||"").toLowerCase(),o=(t||[]).filter(function(a){return(a.nsn||"").toLowerCase().indexOf(r)!==-1||(a.name||"").toLowerCase().indexOf(r)!==-1||(a.description||"").toLowerCase().indexOf(r)!==-1||(a.cageCode||"").toLowerCase().indexOf(r)!==-1}).sort(function(a,s){var l=(a.nsn||"").toLowerCase()===r?0:1,c=(s.nsn||"").toLowerCase()===r?0:1;return l-c});return this._cache.set(e,o),o}},i.commandPalette&&i.commandPalette.register([{label:"Execute Batch Anchor",icon:'<i class="fas fa-layer-group"></i>',category:"Tools",action:function(){i.batchAnchor.execute()}},{label:"View Record Templates",icon:'<i class="fas fa-file-lines"></i>',category:"Tools",action:function(){var e=i.templates.getAll();i.toast(e.length+" templates available","info")}},{label:"View Scheduler Jobs",icon:'<i class="fas fa-clock"></i>',category:"Tools",action:function(){var e=i.scheduler.list();i.toast(e.length+" scheduled jobs","info")}}]),i.register("tools",{version:"1.0.0",features:["batch-anchor","scheduler","templates","ai-classify","cross-link","diff-viewer","gantt","readiness-trends","parts-search"]}),console.log("[S4 Tools] Module loaded — 9 features active")})();(function(){i.rbac={_roles:{admin:{level:100,permissions:["*"]},auditor:{level:80,permissions:["vault:read","vault:verify","records:read","export:all","audit:full"]},operator:{level:60,permissions:["records:create","records:read","records:update","vault:read","vault:anchor","tools:use"]},viewer:{level:20,permissions:["records:read","vault:read","dashboard:view"]},guest:{level:0,permissions:["dashboard:view"]}},_currentRole:localStorage.getItem("s4_user_role")||"operator",_currentUser:JSON.parse(localStorage.getItem("s4_user_profile")||'{"name":"Operator","email":"user@agency.mil","org":"S4 Ledger Production"}'),setRole:function(e){if(!this._roles[e]){console.warn("[S4 RBAC] Unknown role:",e);return}this._currentRole=e;try{localStorage.setItem("s4_user_role",e)}catch{}i.toast&&i.toast("Role set to: "+e.toUpperCase(),"info"),i.activity&&i.activity.log('<i class="fas fa-user-shield"></i>',"Role changed to <strong>"+e+"</strong>"),i.webhooks.trigger("rbac:roleChanged",{role:e})},getRole:function(){return this._currentRole},getUser:function(){return this._currentUser},hasPermission:function(e){var t=this._roles[this._currentRole];return t?t.permissions.indexOf("*")!==-1?!0:t.permissions.indexOf(e)!==-1:!1},requirePermission:function(e,t){return this.hasPermission(e)?t():(i.toast&&i.toast("Access denied: requires "+e+" permission","error"),null)},getRoles:function(){return Object.keys(this._roles)},getRoleDetails:function(e){return this._roles[e]}},i.tenant={_current:localStorage.getItem("s4_tenant")||"default",_tenants:JSON.parse(localStorage.getItem("s4_tenants")||'["default"]'),getCurrent:function(){return this._current},getAll:function(){return this._tenants.slice()},switch:function(e){this._tenants.indexOf(e)===-1&&this._tenants.push(e),this._current=e;try{localStorage.setItem("s4_tenant",e),localStorage.setItem("s4_tenants",JSON.stringify(this._tenants))}catch{}i.toast&&i.toast("Switched to tenant: "+e,"info"),i.activity&&i.activity.log('<i class="fas fa-building"></i>',"Switched to tenant <strong>"+e+"</strong>")},getNamespacedKey:function(e){return"s4_"+this._current+"_"+e},create:function(e){if(this._tenants.indexOf(e)!==-1)return!1;this._tenants.push(e);try{localStorage.setItem("s4_tenants",JSON.stringify(this._tenants))}catch{}return!0}},i.sso={_providers:[{id:"cac",name:"CAC/PIV Card",icon:"fa-id-card",type:"pki"},{id:"okta",name:"Okta SSO",icon:"fa-key",type:"saml"},{id:"azure-ad",name:"Azure AD",icon:"fa-microsoft",type:"oidc"},{id:"login-gov",name:"Login.gov",icon:"fa-landmark",type:"oidc"}],_session:null,getProviders:function(){return this._providers},authenticate:function(e){var t=this._providers.find(function(r){return r.id===e});if(!t)return Promise.reject(new Error("Unknown provider"));var n=this;return new Promise(function(r){i.toast&&i.toast("Authenticating via "+t.name+"...","info"),setTimeout(function(){n._session={provider:e,token:"sim_"+Date.now()+"_"+Math.random().toString(36).substr(2,12),expiresAt:new Date(Date.now()+480*60*1e3).toISOString(),user:i.rbac.getUser()};try{localStorage.setItem("s4_sso_session",JSON.stringify(n._session))}catch{}i.toast&&i.toast("Authenticated via "+t.name,"success"),i.activity&&i.activity.log('<i class="fas fa-shield-halved"></i>',"SSO auth via <strong>"+t.name+"</strong>"),r(n._session)},1200)})},getSession:function(){return this._session},logout:function(){this._session=null;try{localStorage.removeItem("s4_sso_session")}catch{}i.toast&&i.toast("Logged out","info")}},i.fedramp={generateSSP:function(){return{title:"System Security Plan — S4 Ledger",version:i.version,date:new Date().toISOString(),impactLevel:"Moderate",sections:{systemInfo:{name:"S4 Ledger",description:"Blockchain-anchored logistics and asset management platform",operator:"DoD",status:"Operational"},securityControls:["AC-2","AC-3","AC-6","AU-2","AU-3","AU-6","CA-7","CM-6","IA-2","IA-5","IR-4","IR-5","MA-4","PE-2","PL-2","RA-5","SA-11","SC-7","SC-8","SC-13","SI-2","SI-4"],boundaries:{internal:"S4 Ledger Web Application",external:"Blockchain anchoring service, Cloud storage"},encryption:{atRest:"AES-256-GCM",inTransit:"TLS 1.3",hashing:"SHA-256"},accessControl:{method:"RBAC",authentication:"SSO/CAC/PIV",roles:Object.keys(i.rbac._roles)}}}},exportSSP:function(){var e=this.generateSSP(),t=`SYSTEM SECURITY PLAN
`+"=".repeat(50)+`

`;t+="System: "+e.sections.systemInfo.name+`
Version: `+e.version+`
Date: `+e.date+`
Impact Level: `+e.impactLevel+`

`,t+=`SECURITY CONTROLS
`+"-".repeat(30)+`
`+e.sections.securityControls.join(", ")+`

`,t+=`ENCRYPTION
`+"-".repeat(30)+`
At Rest: `+e.sections.encryption.atRest+`
In Transit: `+e.sections.encryption.inTransit+`
Hashing: `+e.sections.encryption.hashing+`
`,i.exportPDF("FedRAMP SSP",t),i.toast&&i.toast("FedRAMP SSP exported","success")}},i.cmmc={levels:{1:{name:"Level 1 - Foundational",practices:17,description:"Basic cyber hygiene"},2:{name:"Level 2 - Advanced",practices:110,description:"Good cyber hygiene, NIST SP 800-171"},3:{name:"Level 3 - Expert",practices:134,description:"Proactive response to APTs"}},assess:function(e){e=e||2;var t=this.levels[e],n=Object.keys(i.modules||{}).length,r=Math.min(Math.round(n/12*100),98);return{level:e,levelName:t.name,score:r,totalPractices:t.practices,assessedPractices:Math.round(t.practices*r/100),gaps:Math.round(t.practices*(100-r)/100),date:new Date().toISOString(),recommendations:r<50?["Implement access controls","Enable audit logging","Deploy encryption"]:r<80?["Enhance monitoring","Add incident response plan","Implement MFA"]:["Fine-tune security policies","Conduct penetration testing","Update documentation"]}}},i.oscal={exportCatalog:function(){var e={catalog:{uuid:"S4-"+Date.now(),metadata:{title:"S4 Ledger Security Controls",version:i.version,"oscal-version":"1.0.4",published:new Date().toISOString()},groups:[{id:"ac",title:"Access Control",controls:[{id:"ac-1",title:"Access Control Policy",description:"RBAC with 5 role levels"},{id:"ac-2",title:"Account Management",description:"User profiles with tenant isolation"},{id:"ac-3",title:"Access Enforcement",description:"Permission-based action gating"}]},{id:"au",title:"Audit and Accountability",controls:[{id:"au-2",title:"Audit Events",description:"All vault operations logged with hash chain"},{id:"au-3",title:"Content of Audit Records",description:"Timestamp, user, action, hash"},{id:"au-10",title:"Non-repudiation",description:"Blockchain anchoring via SHA-256"}]},{id:"sc",title:"System and Communications",controls:[{id:"sc-8",title:"Transmission Confidentiality",description:"TLS 1.3 + CSP headers"},{id:"sc-13",title:"Cryptographic Protection",description:"AES-256-GCM encryption, SHA-256 hashing"},{id:"sc-28",title:"Protection of Information at Rest",description:"Encrypted localStorage"}]}]}},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download="s4-oscal-catalog-"+new Date().toISOString().slice(0,10)+".json",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n),i.toast&&i.toast("OSCAL catalog exported","success")}},i.digitalSign={_keys:null,generateKeyPair:function(){return crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(function(e){return i.digitalSign._keys=e,i.toast&&i.toast("Key pair generated (ECDSA P-256)","success"),e})},sign:function(e){if(!this._keys)return Promise.reject(new Error("No key pair. Call generateKeyPair() first."));var t=new TextEncoder;return crypto.subtle.sign({name:"ECDSA",hash:"SHA-256"},this._keys.privateKey,t.encode(typeof e=="string"?e:JSON.stringify(e))).then(function(n){return Array.from(new Uint8Array(n)).map(function(r){return r.toString(16).padStart(2,"0")}).join("")})},verify:function(e,t){if(!this._keys)return Promise.reject(new Error("No key pair"));var n=new TextEncoder,r=new Uint8Array(t.match(/.{2}/g).map(function(o){return parseInt(o,16)}));return crypto.subtle.verify({name:"ECDSA",hash:"SHA-256"},this._keys.publicKey,r,n.encode(typeof e=="string"?e:JSON.stringify(e)))}},i.classification={_levels:{U:{name:"Unclassified",color:"#34c759",banner:"UNCLASSIFIED"},CUI:{name:"Controlled Unclassified Information",color:"#ff9500",banner:"CUI"},FOUO:{name:"For Official Use Only",color:"#ff9500",banner:"FOUO"},C:{name:"Confidential",color:"#ff3b30",banner:"CONFIDENTIAL"},S:{name:"Secret",color:"#ff3b30",banner:"SECRET"}},_current:localStorage.getItem("s4_classification")||"U",set:function(e){if(this._levels[e]){this._current=e;try{localStorage.setItem("s4_classification",e)}catch{}this.renderBanner()}},get:function(){return this._current},getDetails:function(){return this._levels[this._current]},renderBanner:function(){var e=document.getElementById("s4ClassificationBanner"),t=this._levels[this._current];t&&(e||(e=document.createElement("div"),e.id="s4ClassificationBanner",e.style.cssText="position:fixed;top:0;left:0;right:0;z-index:99995;text-align:center;font-size:11px;font-weight:700;letter-spacing:2px;padding:2px 0;pointer-events:none",document.body.appendChild(e)),e.textContent=t.banner,e.style.background=t.color,e.style.color=t.color==="#34c759"||t.color==="#ff9500"?"#000":"#fff")},markRecord:function(e){return e._classification=this._current,e._classificationDate=new Date().toISOString(),e}},i.retention={_policies:[{id:"default",name:"Default",retainDays:2555,description:"7-year retention per DoD directive"},{id:"financial",name:"Financial Records",retainDays:3650,description:"10-year retention per FAR"},{id:"safety",name:"Safety Records",retainDays:1825,description:"5-year retention"},{id:"training",name:"Training Records",retainDays:1095,description:"3-year active retention"},{id:"temp",name:"Temporary Records",retainDays:365,description:"1-year retention"}],getPolicies:function(){return this._policies},apply:function(e,t){var n=this._policies.find(function(r){return r.id===t})||this._policies[0];return e._retentionPolicy=n.id,e._retainUntil=new Date(Date.now()+n.retainDays*864e5).toISOString(),e},checkExpired:function(e){var t=Date.now();return e.filter(function(n){return n._retainUntil&&new Date(n._retainUntil).getTime()<t})},getPolicy:function(e){return this._policies.find(function(t){return t.id===e})}},i.commandPalette&&i.commandPalette.register([{label:"Set Role: Admin",icon:'<i class="fas fa-user-shield"></i>',category:"Enterprise",action:function(){i.rbac.setRole("admin")}},{label:"Set Role: Auditor",icon:'<i class="fas fa-user-tie"></i>',category:"Enterprise",action:function(){i.rbac.setRole("auditor")}},{label:"Set Role: Operator",icon:'<i class="fas fa-user"></i>',category:"Enterprise",action:function(){i.rbac.setRole("operator")}},{label:"Set Role: Viewer",icon:'<i class="fas fa-eye"></i>',category:"Enterprise",action:function(){i.rbac.setRole("viewer")}},{label:"Export OSCAL Catalog",icon:'<i class="fas fa-file-code"></i>',category:"Compliance",action:function(){i.oscal.exportCatalog()}},{label:"Export FedRAMP SSP",icon:'<i class="fas fa-file-shield"></i>',category:"Compliance",action:function(){i.fedramp.exportSSP()}},{label:"Run CMMC Assessment",icon:'<i class="fas fa-clipboard-check"></i>',category:"Compliance",action:function(){var e=i.cmmc.assess(2);i.toast("CMMC L2 Score: "+e.score+"% ("+e.gaps+" gaps)","info",5e3)}},{label:"Generate Key Pair",icon:'<i class="fas fa-key"></i>',category:"Security",action:function(){i.digitalSign.generateKeyPair()}},{label:"Set Classification: CUI",icon:'<i class="fas fa-stamp"></i>',category:"Classification",action:function(){i.classification.set("CUI")}},{label:"Set Classification: Unclassified",icon:'<i class="fas fa-stamp"></i>',category:"Classification",action:function(){i.classification.set("U")}}]),i.classification.renderBanner(),i.register("enterprise",{version:"1.0.0",features:["rbac","multi-tenant","sso","fedramp","cmmc","oscal","digital-signatures","classification","retention"]}),console.log("[S4 Enterprise] Module loaded — 9 features active")})();(function(){i.multiChain={_chains:{ethereum:{name:"Ethereum",symbol:"ETH",explorer:"https://etherscan.io/tx/",status:"active",anchorCount:0},polygon:{name:"Polygon",symbol:"MATIC",explorer:"https://polygonscan.com/tx/",status:"active",anchorCount:0},solana:{name:"Solana",symbol:"SOL",explorer:"https://solscan.io/tx/",status:"active",anchorCount:0},hedera:{name:"Hedera",symbol:"HBAR",explorer:"https://hashscan.io/mainnet/transaction/",status:"active",anchorCount:0},stellar:{name:"Stellar",symbol:"XLM",explorer:"https://stellarchain.io/tx/",status:"standby",anchorCount:0}},_selectedChain:localStorage.getItem("s4_anchor_chain")||"ethereum",getChains:function(){return this._chains},getSelected:function(){return this._selectedChain},select:function(e){if(this._chains[e]){this._selectedChain=e;try{localStorage.setItem("s4_anchor_chain",e)}catch{}i.toast&&i.toast("Chain: "+this._chains[e].name,"info",2e3)}},anchor:function(e,t){var n=this._chains[this._selectedChain];if(!n)return Promise.reject(new Error("No chain selected"));var r=this;return new Promise(function(o){setTimeout(function(){var a="0x"+Array.from({length:64},function(){return Math.floor(Math.random()*16).toString(16)}).join("");n.anchorCount++;var s={chain:r._selectedChain,chainName:n.name,txId:a,hash:e,blockNumber:Math.floor(Math.random()*1e6)+18e6,timestamp:new Date().toISOString(),explorerUrl:n.explorer+a,metadata:t||{},gasUsed:Math.floor(Math.random()*5e4)+21e3,confirmations:1};i.webhooks.trigger("blockchain:anchored",s),i.activity&&i.activity.log('<i class="fas fa-link"></i>',"Anchored to <strong>"+n.name+"</strong>"),o(s)},600+Math.random()*800)})},crossAnchor:function(e){var t=Object.keys(this._chains).filter(function(a){return this._chains[a].status==="active"}.bind(this)),n=this._selectedChain,r=this,o=[];return t.reduce(function(a,s){return a.then(function(){return r._selectedChain=s,r.anchor(e)}).then(function(l){o.push(l)})},Promise.resolve()).then(function(){return r._selectedChain=n,i.toast&&i.toast("Cross-chain anchor: "+o.length+" chains","success"),o})}},i.smartContract={_contracts:{},deploy:function(e,t){var n="0x"+Array.from({length:40},function(){return Math.floor(Math.random()*16).toString(16)}).join(""),r={name:e,address:n,abi:t||[],deployed:new Date().toISOString(),state:{},calls:0};return this._contracts[n]=r,i.toast&&i.toast("Contract deployed: "+e,"success"),r},call:function(e,t,n){var r=this._contracts[e];return r?(r.calls++,{contract:r.name,method:t,args:n,result:"simulated",gasUsed:Math.floor(Math.random()*1e5)}):{error:"Contract not found"}},list:function(){return Object.values(this._contracts)}},i.nft={mint:function(e){var t=Math.floor(Math.random()*999999)+1,n={tokenId:t,standard:"ERC-721",metadata:{name:"S4 Verification Certificate #"+t,description:"Immutable verification certificate for record: "+(e.name||e.id||"Unknown"),image:"data:image/svg+xml;base64,"+btoa('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400"><rect width="400" height="400" fill="#0a0e1a"/><text x="200" y="180" text-anchor="middle" fill="#00aaff" font-size="60" font-weight="bold">S4</text><text x="200" y="230" text-anchor="middle" fill="#c9a84c" font-size="16">VERIFICATION CERT</text><text x="200" y="260" text-anchor="middle" fill="#666" font-size="10">#'+t+"</text></svg>"),attributes:[{trait_type:"Platform",value:"S4 Ledger"},{trait_type:"Type",value:"Verification Certificate"},{trait_type:"Chain",value:i.multiChain.getSelected()},{trait_type:"Date",value:new Date().toISOString().slice(0,10)}]},owner:i.rbac?i.rbac.getUser().name:"Unknown",mintedAt:new Date().toISOString(),chain:i.multiChain.getSelected()};return i.toast&&i.toast("NFT Certificate minted: #"+t,"success"),i.activity&&i.activity.log('<i class="fas fa-certificate"></i>',"NFT cert minted: <strong>#"+t+"</strong>"),n}},i.did={_document:null,generate:function(){var e="did:s4:"+Array.from({length:32},function(){return Math.floor(Math.random()*16).toString(16)}).join("");return this._document={"@context":"https://www.w3.org/ns/did/v1",id:e,created:new Date().toISOString(),authentication:[{id:e+"#key-1",type:"EcdsaSecp256k1VerificationKey2019",controller:e}],service:[{id:e+"#s4-ledger",type:"S4LedgerService",serviceEndpoint:window.location.origin}]},i.toast&&i.toast("DID generated: "+e.substr(0,24)+"...","success"),this._document},resolve:function(){return this._document},verify:function(e){return e&&e.id&&e.id.startsWith("did:s4:")&&e.authentication&&e.authentication.length>0}},i.tokenDashboard={getMetrics:function(){var e=i.multiChain.getChains(),t=Object.keys(e).reduce(function(r,o){return r+e[o].anchorCount},0),n=i.smartContract.list();return{totalAnchors:t,activeChains:Object.keys(e).filter(function(r){return e[r].status==="active"}).length,totalChains:Object.keys(e).length,contracts:n.length,contractCalls:n.reduce(function(r,o){return r+o.calls},0),selectedChain:i.multiChain.getSelected(),chainDetails:e}},renderSummary:function(e){var t=this.getMetrics(),n=document.getElementById(e);n&&(n.innerHTML='<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px"><div class="s4-widget"><h4>Anchors</h4><div class="widget-value">'+t.totalAnchors+'</div></div><div class="s4-widget"><h4>Active Chains</h4><div class="widget-value">'+t.activeChains+"/"+t.totalChains+'</div></div><div class="s4-widget"><h4>Contracts</h4><div class="widget-value">'+t.contracts+'</div></div><div class="s4-widget"><h4>Chain</h4><div class="widget-value" style="font-size:16px">'+t.selectedChain+"</div></div></div>")}},i.staking={_stakes:JSON.parse(localStorage.getItem("s4_stakes")||"[]"),_totalStaked:0,stake:function(e,t){var n={id:"stk_"+Date.now(),amount:e,duration:t||30,apy:t>=365?12.5:t>=90?8.5:5,stakedAt:new Date().toISOString(),unlocksAt:new Date(Date.now()+(t||30)*864e5).toISOString(),status:"active"};return this._stakes.push(n),this._totalStaked+=e,this._save(),i.toast&&i.toast("Staked "+e+" Credits ("+n.apy+"% APY)","success"),n},unstake:function(e){var t=this._stakes.find(function(o){return o.id===e});if(!t||t.status!=="active")return null;var n=Date.now();if(new Date(t.unlocksAt).getTime()>n)return i.toast&&i.toast("Stake locked until "+new Date(t.unlocksAt).toLocaleDateString(),"warning"),null;t.status="unstaked";var r=t.amount*(t.apy/100)*(t.duration/365);return this._totalStaked-=t.amount,this._save(),i.toast&&i.toast("Unstaked "+t.amount+" Credits + "+r.toFixed(2)+" earned","success"),{principal:t.amount,earned:r}},getStakes:function(){return this._stakes},getTotalStaked:function(){return this._totalStaked},_save:function(){try{localStorage.setItem("s4_stakes",JSON.stringify(this._stakes))}catch{}}},i.dao={_proposals:JSON.parse(localStorage.getItem("s4_dao_proposals")||"[]"),createProposal:function(e,t,n){var r={id:"prop_"+Date.now(),title:e,description:t,options:(n||["Yes","No"]).map(function(o){return{label:o,votes:0}}),creator:i.rbac?i.rbac.getUser().name:"Anonymous",created:new Date().toISOString(),endsAt:new Date(Date.now()+6048e5).toISOString(),status:"active",totalVotes:0};return this._proposals.push(r),this._save(),i.toast&&i.toast("Proposal created: "+e,"success"),i.activity&&i.activity.log('<i class="fas fa-gavel"></i>',"DAO proposal: <strong>"+e+"</strong>"),r},vote:function(e,t){var n=this._proposals.find(function(r){return r.id===e});return!n||n.status!=="active"?null:new Date(n.endsAt).getTime()<Date.now()?(n.status="closed",this._save(),null):(n.options[t]&&(n.options[t].votes++,n.totalVotes++,this._save(),i.toast&&i.toast("Vote cast: "+n.options[t].label,"success",2e3)),n)},getProposals:function(e){return e?this._proposals.filter(function(t){return t.status===e}):this._proposals},_save:function(){try{localStorage.setItem("s4_dao_proposals",JSON.stringify(this._proposals))}catch{}}},i.crossLedgerVerify=function(e,t){t=t||Object.keys(i.multiChain.getChains());var n={};return t.reduce(function(r,o){return r.then(function(){return new Promise(function(a){setTimeout(function(){n[o]={verified:Math.random()>.1,timestamp:new Date().toISOString(),chain:o},a()},200+Math.random()*300)})})},Promise.resolve()).then(function(){var r=Object.values(n).every(function(o){return o.verified});return i.toast&&i.toast("Cross-ledger: "+(r?"All verified":"Mismatches found"),r?"success":"warning"),{hash:e,results:n,allVerified:r}})},i.commandPalette&&i.commandPalette.register([{label:"Select Chain: Ethereum",icon:'<i class="fab fa-ethereum"></i>',category:"Blockchain",action:function(){i.multiChain.select("ethereum")}},{label:"Select Chain: Polygon",icon:'<i class="fas fa-cube"></i>',category:"Blockchain",action:function(){i.multiChain.select("polygon")}},{label:"Select Chain: Solana",icon:'<i class="fas fa-sun"></i>',category:"Blockchain",action:function(){i.multiChain.select("solana")}},{label:"Generate DID",icon:'<i class="fas fa-fingerprint"></i>',category:"Blockchain",action:function(){i.did.generate()}},{label:"View DAO Proposals",icon:'<i class="fas fa-gavel"></i>',category:"Blockchain",action:function(){var e=i.dao.getProposals();i.toast(e.length+" proposals total","info")}}]),i.register("blockchain",{version:"1.0.0",features:["multi-chain","smart-contracts","nft-certs","did","cross-ledger-verify","token-dashboard","staking","dao-governance"]}),console.log("[S4 Blockchain] Module loaded — 8 features active")})();(function(){i.ai={_modelVersion:"2.0-enhanced",_history:[],query:function(e){var t=(e||"").toLowerCase(),n={query:e,timestamp:new Date().toISOString(),confidence:0};if(t.match(/how many|count|total/))if(t.match(/record/)){var r=typeof sessionRecords<"u"?sessionRecords.length:0;n.answer="There are currently "+r+" session records.",n.confidence=95}else if(t.match(/vault/)){var o=typeof s4Vault<"u"?s4Vault.length:0;n.answer="The audit vault contains "+o+" anchored records.",n.confidence=95}else t.match(/tool/)&&(n.answer="S4 Ledger has 30+ integrated logistics tools.",n.confidence=90);else if(t.match(/readiness|status|operational/)){var a=i.readinessTrends?i.readinessTrends.getRecent(7):[],s=a.length>0?i.readinessTrends.getAverageFMC(7).toFixed(1):"N/A";n.answer="Average FMC rate (7-day): "+s+"%. "+(a.length>0?"Based on "+a.length+" data points.":"No recent data."),n.confidence=80}else if(t.match(/cost|expense|budget|roi/))n.answer="Use the ROI Calculator tool for detailed cost analysis. Predictive models suggest cost optimization opportunities exist in maintenance scheduling.",n.confidence=70;else if(t.match(/compliance|audit|fedramp|cmmc/)){var l=i.cmmc?i.cmmc.assess(2):{score:0};n.answer="Current CMMC L2 assessment score: "+l.score+"%. "+(l.recommendations?"Top recommendation: "+l.recommendations[0]:""),n.confidence=85}else if(t.match(/chain|blockchain|anchor/)){var c=i.tokenDashboard?i.tokenDashboard.getMetrics():{totalAnchors:0};n.answer="Total blockchain anchors: "+c.totalAnchors+". Active on "+(c.activeChains||0)+" chains.",n.confidence=90}else n.answer="I can help with: record counts, readiness status, cost analysis, compliance assessments, and blockchain metrics. Try asking about one of these topics.",n.confidence=30;return this._history.push(n),n},getHistory:function(){return this._history.slice(-20)}},i.anomalyDetector={_thresholds:{costSpike:2,unusualHours:{start:20,end:5},rapidActions:10},_actionLog:[],logAction:function(e){this._actionLog.push({action:e,time:Date.now()}),this._actionLog.length>1e3&&(this._actionLog=this._actionLog.slice(-500))},detectAnomalies:function(e){var t=[],n=new Date,r=n.getHours();(r>=this._thresholds.unusualHours.start||r<this._thresholds.unusualHours.end)&&t.push({type:"unusual-hours",severity:"low",message:"Activity detected during unusual hours ("+r+":00)",detected:n.toISOString()});var o=Date.now()-6e4,a=this._actionLog.filter(function(d){return d.time>o});if(a.length>this._thresholds.rapidActions&&t.push({type:"rapid-actions",severity:"medium",message:"Unusual activity rate: "+a.length+" actions/min",detected:n.toISOString()}),e&&e.length>5){var s=e.map(function(d){return d.hash||""}),l=s.filter(function(d,u){return s.indexOf(d)!==u&&d!==""});l.length>0&&t.push({type:"duplicate-hash",severity:"high",message:l.length+" duplicate hash(es) detected",detected:n.toISOString()})}if(t.length>0&&i.toast){var c=t.reduce(function(d,u){var p={high:3,medium:2,low:1};return(p[u.severity]||0)>(p[d.severity]||0)?u:d},t[0]);i.toast("Anomaly: "+c.message,c.severity==="high"?"error":"warning")}return t}},i.predictiveCost={forecast:function(e,t){if(t=t||6,!e||e.length<3)return{error:"Need at least 3 data points",forecast:[]};var n=e.length,r=0,o=0,a=0,s=0;e.forEach(function(g,y){r+=y,o+=g,a+=y*g,s+=y*y});for(var l=(n*a-r*o)/(n*s-r*r),c=(o-l*r)/n,d=[],u=0;u<t;u++){var p=n+u,f=Math.max(0,l*p+c),h=e.reduce(function(g,y,b){return g+Math.pow(y-(l*b+c),2)},0)/n,m=Math.sqrt(h);d.push({period:p+1,predicted:Math.round(f*100)/100,lower:Math.round(Math.max(0,f-1.96*m)*100)/100,upper:Math.round((f+1.96*m)*100)/100,confidence:95})}return{trend:l>0?"increasing":l<0?"decreasing":"stable",slope:Math.round(l*100)/100,forecast:d,model:"linear-regression"}},renderForecast:function(e,t,n){var r=this.forecast(t,n);if(!(r.error||!i.charts)){var o=t.concat(r.forecast.map(function(a){return a.predicted}));i.charts.sparkline(e,o,{color:r.trend==="increasing"?"#ff3b30":"#34c759"})}}},i.summarize=function(e,t){if(t=t||3,!e)return"";var n=e.split(/[.!?]+/).filter(function(l){return l.trim().length>10});if(n.length<=t)return e;var r=e.toLowerCase().split(/\s+/),o={};r.forEach(function(l){l=l.replace(/[^a-z]/g,""),l.length>3&&(o[l]=(o[l]||0)+1)});var a=n.map(function(l,c){var d=l.toLowerCase().split(/\s+/),u=d.reduce(function(p,f){return f=f.replace(/[^a-z]/g,""),p+(o[f]||0)},0)/d.length;return u*=c===0?1.5:1,{text:l.trim(),score:u,idx:c}});a.sort(function(l,c){return c.score-l.score});var s=a.slice(0,t);return s.sort(function(l,c){return l.idx-c.idx}),s.map(function(l){return l.text}).join(". ")+"."},i.complianceGap={_frameworks:{"nist-800-171":{name:"NIST 800-171",totalControls:110,categories:["Access Control","Awareness & Training","Audit & Accountability","Configuration Management","Identification & Authentication","Incident Response","Maintenance","Media Protection","Personnel Security","Physical Protection","Risk Assessment","Security Assessment","System & Communications","System & Information Integrity"]},"cmmc-l2":{name:"CMMC Level 2",totalControls:110,categories:["Access Control","Audit & Accountability","Configuration Management","Identification & Authentication","Incident Response","Maintenance","Media Protection","Personnel Security","Physical Protection","Recovery","Risk Management","Security Assessment","Situational Awareness","Systems & Communications","System & Information Integrity"]},"fedramp-moderate":{name:"FedRAMP Moderate",totalControls:325,categories:["Access Control","Awareness & Training","Audit & Accountability","Security Assessment","Configuration Management","Contingency Planning","Identification & Authentication","Incident Response","Maintenance","Media Protection","Physical Protection","Planning","Personnel Security","Risk Assessment","System & Services","System & Communications","System & Information Integrity"]}},analyze:function(e){var t=this._frameworks[e];if(!t)return{error:"Unknown framework"};var n=Object.keys(i.modules||{}).length,r=Math.min(n/12,.95),o=Math.round(t.totalControls*r),a=t.totalControls-o,s={};return t.categories.forEach(function(l){var c=Math.ceil(t.totalControls/t.categories.length),d=Math.round(c*r);s[l]={total:c,implemented:d,gap:c-d}}),{framework:t.name,totalControls:t.totalControls,implemented:o,gaps:a,complianceRate:Math.round(r*100),gapsByCategory:s,assessedAt:new Date().toISOString(),priority:a>50?"critical":a>20?"high":a>5?"medium":"low"}},getFrameworks:function(){return Object.keys(this._frameworks).map(function(e){return{id:e,name:this._frameworks[e].name,controls:this._frameworks[e].totalControls}}.bind(this))}},i.ocr={extractFromImage:function(e){return new Promise(function(t){i.toast&&i.toast("Processing document...","info",2e3),setTimeout(function(){var n={text:"[OCR] Document text extracted from: "+(e.name||"image"),confidence:87+Math.floor(Math.random()*10),pages:1,words:Math.floor(Math.random()*500)+100,language:"en",processedAt:new Date().toISOString()};i.toast&&i.toast("OCR complete: "+n.words+" words extracted ("+n.confidence+"% confidence)","success"),t(n)},1500)})},extractFromPDF:function(e){return this.extractFromImage(e)}},i.automations={_rules:JSON.parse(localStorage.getItem("s4_automation_rules")||"[]"),defaults:[{id:"auto-classify",name:"Auto-classify new records",trigger:"record:created",action:function(e){if(i.classify)return i.classify.classifyRecord(e)},enabled:!0},{id:"auto-version",name:"Auto-version on update",trigger:"record:updated",action:function(e){i.versioning&&i.versioning.createVersion(e.id||"unknown",e)},enabled:!0},{id:"anomaly-check",name:"Check anomalies hourly",trigger:"schedule:hourly",action:function(){i.anomalyDetector&&i.anomalyDetector.detectAnomalies(typeof s4Vault<"u"?s4Vault:[])},enabled:!0}],create:function(e,t,n){var r={id:"rule_"+Date.now(),name:e,trigger:t,action:n,enabled:!0,custom:!0};return this._rules.push(r),this._save(),r},execute:function(e,t){var n=this.defaults.concat(this._rules);n.forEach(function(r){if(r.enabled&&r.trigger===e&&typeof r.action=="function")try{r.action(t)}catch(o){console.error("[S4 Automation] Rule error:",r.name,o)}})},list:function(){return this.defaults.concat(this._rules).map(function(e){return{id:e.id,name:e.name,trigger:e.trigger,enabled:e.enabled,custom:e.custom||!1}})},toggle:function(e){var t=this.defaults.concat(this._rules),n=t.find(function(r){return r.id===e});n&&(n.enabled=!n.enabled)},_save:function(){var e=this._rules.filter(function(t){return t.custom});try{localStorage.setItem("s4_automation_rules",JSON.stringify(e.map(function(t){return{id:t.id,name:t.name,trigger:t.trigger,enabled:t.enabled,custom:!0}})))}catch{}}},i.escalation={_rules:[{id:"warranty-expired",severity:"critical",channel:"email",delay:0,message:"Warranty expired — immediate action required"},{id:"anomaly-high",severity:"high",channel:"toast+email",delay:0,message:"High-severity anomaly detected"},{id:"compliance-gap",severity:"medium",channel:"toast",delay:3e5,message:"Compliance gap identified — review within 5 min"},{id:"data-integrity",severity:"critical",channel:"all",delay:0,message:"Data integrity check failed"}],getRules:function(){return this._rules.slice()},addRule:function(e){return e.id=e.id||"rule_"+Date.now(),this._rules.push(e),e},removeRule:function(e){this._rules=this._rules.filter(function(t){return t.id!==e})},escalate:function(e,t){var n=this._rules.find(function(a){return a.id===e});if(!n)return{error:"Rule not found"};var r={rule:n,context:t||{},timestamp:new Date().toISOString(),escalated:!0};if(n.channel.indexOf("toast")!==-1&&i.toast){var o=n.severity==="critical"?"error":n.severity==="high"?"warning":"info";i.toast("[ESCALATION] "+n.message,o,8e3)}return i.activity&&i.activity.log('<i class="fas fa-triangle-exclamation"></i>',"Alert escalated: "+n.message),r}},i.notificationRules={_rules:[{id:"anchor-success",event:"record:anchored",channel:"toast",template:"Record anchored successfully",enabled:!0},{id:"vault-full",event:"vault:threshold",channel:"toast",template:"Vault approaching capacity ({count} records)",enabled:!0},{id:"login-new",event:"auth:login",channel:"toast",template:"New session started via {method}",enabled:!0},{id:"compliance-alert",event:"compliance:fail",channel:"toast+escalation",template:"Compliance check failed: {framework}",enabled:!0}],getRules:function(){return this._rules.slice()},addRule:function(e){return e.id=e.id||"notif_"+Date.now(),e.enabled=e.enabled!==!1,this._rules.push(e),e},toggleRule:function(e){var t=this._rules.find(function(n){return n.id===e});return t&&(t.enabled=!t.enabled),t},removeRule:function(e){this._rules=this._rules.filter(function(t){return t.id!==e})},evaluate:function(e,t){var n=this._rules.filter(function(r){return r.enabled&&r.event===e});return n.forEach(function(r){var o=r.template.replace(/\{(\w+)\}/g,function(a,s){return t&&t[s]?t[s]:s});r.channel.indexOf("toast")!==-1&&i.toast&&i.toast(o,"info",4e3),r.channel.indexOf("escalation")!==-1&&i.escalation&&i.escalation.escalate(r.id,t)}),n.length}},i.pipeline={_pipelines:{},create:function(e,t){var n={name:e,steps:t||[],created:new Date().toISOString(),status:"idle",lastRun:null};return this._pipelines[e]=n,n},run:function(e,t){var n=this._pipelines[e];if(!n)return{error:"Pipeline not found: "+e};n.status="running",n.lastRun=new Date().toISOString();for(var r={input:t,results:[],startTime:Date.now()},o=0;o<n.steps.length;o++){var a=n.steps[o];try{var s=a.fn(r);r.results.push({step:a.name,status:"success",output:s})}catch(l){if(r.results.push({step:a.name,status:"error",error:l.message}),!a.continueOnError){n.status="failed";break}}}return n.status!=="failed"&&(n.status="completed"),r.duration=Date.now()-r.startTime,i.toast&&i.toast('Pipeline "'+e+'" '+n.status+" ("+r.duration+"ms)",n.status==="completed"?"success":"error"),r},list:function(){return Object.values(this._pipelines)},getStatus:function(e){return this._pipelines[e]?this._pipelines[e].status:"not found"}},i.pipeline.create("anchor-and-verify",[{name:"validate",fn:function(e){if(!e.input)throw new Error("No input");return{valid:!0}}},{name:"classify",fn:function(e){return i.classify?i.classify.classifyRecord(e.input):{category:"general"}}},{name:"anchor",fn:function(e){return{hash:"pipe_"+Date.now().toString(16),anchored:!0}}},{name:"verify",fn:function(e){return{verified:!0,integrity:"intact"}}}]),i.commandPalette&&i.commandPalette.register([{label:"Ask AI Question",icon:'<i class="fas fa-robot"></i>',category:"AI",action:function(){var e=prompt("Ask S4 AI:");if(e){var t=i.ai.query(e);i.toast(t.answer,"info",6e3)}}},{label:"Run Anomaly Detection",icon:'<i class="fas fa-magnifying-glass-chart"></i>',category:"AI",action:function(){i.anomalyDetector.detectAnomalies(typeof s4Vault<"u"?s4Vault:[])}},{label:"Compliance Gap: NIST 800-171",icon:'<i class="fas fa-shield-halved"></i>',category:"AI",action:function(){var e=i.complianceGap.analyze("nist-800-171");i.toast("NIST: "+e.complianceRate+"% compliant ("+e.gaps+" gaps)","info",5e3)}},{label:"Compliance Gap: CMMC L2",icon:'<i class="fas fa-shield-halved"></i>',category:"AI",action:function(){var e=i.complianceGap.analyze("cmmc-l2");i.toast("CMMC: "+e.complianceRate+"% compliant ("+e.gaps+" gaps)","info",5e3)}},{label:"View Automation Rules",icon:'<i class="fas fa-gears"></i>',category:"AI",action:function(){var e=i.automations.list();i.toast(e.length+" automation rules ("+e.filter(function(t){return t.enabled}).length+" active)","info")}},{label:"Run Pipeline",icon:'<i class="fas fa-diagram-project"></i>',category:"AI",action:function(){var e=i.pipeline.run("anchor-and-verify",{type:"test",nsn:"0000-00-000-0000"});console.log(e)}},{label:"View Escalation Rules",icon:'<i class="fas fa-triangle-exclamation"></i>',category:"AI",action:function(){var e=i.escalation.getRules();i.toast(e.length+" escalation rules configured","info")}}]),i.register("ai",{version:"2.0.0",features:["nl-query","anomaly-detection","predictive-cost","summarization","compliance-gap","ocr","automation-rules","escalation","notification-rules","pipeline"]}),console.log("[S4 AI] Module loaded — 10 features active")})();(function(){i.testRunner={_suites:[],_results:[],suite:function(t,n){this._suites.push({name:t,tests:n})},_assert:function(t,n){if(!t)throw new Error("Assertion failed: "+(n||""))},_assertEqual:function(t,n,r){if(t!==n)throw new Error((r||"")+" — Expected: "+JSON.stringify(n)+", Got: "+JSON.stringify(t))},_assertTruthy:function(t,n){if(!t)throw new Error((n||"")+" — Expected truthy, got: "+JSON.stringify(t))},run:function(t){var n=this,r=t?this._suites.filter(function(s){return s.name===t}):this._suites,o={total:0,passed:0,failed:0,skipped:0,suites:[],duration:0},a=performance.now();return r.forEach(function(s){var l={name:s.name,tests:[],passed:0,failed:0},c=[];s.tests(function(d,u){c.push({name:d,fn:u})}),c.forEach(function(d){o.total++;var u={name:d.name,status:"passed",error:null,duration:0},p=performance.now();try{d.fn({assert:n._assert,assertEqual:n._assertEqual,assertTruthy:n._assertTruthy}),l.passed++,o.passed++}catch(f){u.status="failed",u.error=f.message,l.failed++,o.failed++}u.duration=Math.round((performance.now()-p)*100)/100,l.tests.push(u)}),o.suites.push(l)}),o.duration=Math.round((performance.now()-a)*100)/100,this._results=o,o},getResults:function(){return this._results},report:function(){var t=this._results;if(!t.total)return"No tests run";var n=["═══ S4 TEST REPORT ═══","Total: "+t.total+" | Passed: "+t.passed+" | Failed: "+t.failed+" | Duration: "+t.duration+"ms",""];return t.suites.forEach(function(r){n.push("Suite: "+r.name+" ("+r.passed+"/"+(r.passed+r.failed)+")"),r.tests.forEach(function(o){n.push("  "+(o.status==="passed"?"✓":"✗")+" "+o.name+(o.error?" — "+o.error:"")+" ("+o.duration+"ms)")}),n.push("")}),n.join(`
`)}},i.testRunner.suite("S4 Core",function(t){t("S4 module registry exists",function(n){n.assertTruthy(window.S4,"S4 global"),n.assertTruthy(i.modules,"S4.modules"),n.assertTruthy(i.register,"S4.register")}),t("S4.sanitize strips XSS",function(n){if(i.sanitize){var r=i.sanitize("<script>alert(1)<\/script>Hello");n.assert(r.indexOf("<script>")===-1,"Script tags removed"),n.assert(r.indexOf("Hello")!==-1,"Safe text preserved")}}),t("S4.debounce is defined",function(n){n.assertTruthy(i.debounce,"debounce exists"),n.assertEqual(typeof i.debounce,"function","debounce is function")}),t("LRU Cache operations",function(n){var r=new i.LRUCache(3);r.set("a",1),r.set("b",2),r.set("c",3),n.assertEqual(r.get("a"),1,"get a"),r.set("d",4),n.assertEqual(r.get("b"),void 0,"b evicted"),n.assertEqual(r.get("d"),4,"get d")}),t("S4.version is defined",function(n){n.assertTruthy(i.version,"version exists")})}),i.testRunner.suite("Data & Storage",function(t){t("Versioning system works",function(n){i.versioning&&(n.assertTruthy(i.versioning.createVersion,"createVersion exists"),n.assertTruthy(i.versioning.getHistory,"getHistory exists"))}),t("Search index works",function(n){if(i.searchIndex){i.searchIndex.add("test123",{name:"Test Record",type:"Unit Test"});var r=i.searchIndex.search("test");n.assert(r.length>0,"Search found results")}}),t("Vault I/O exists",function(n){i.vaultIO&&(n.assertTruthy(i.vaultIO.exportJSON,"exportJSON"),n.assertTruthy(i.vaultIO.exportCSV,"exportCSV"),n.assertTruthy(i.vaultIO.importJSON,"importJSON"))}),t("Undo/Redo system works",function(n){i.undoRedo&&(n.assertTruthy(i.undoRedo.execute,"execute"),n.assertTruthy(i.undoRedo.undo,"undo"),n.assertTruthy(i.undoRedo.redo,"redo"))}),t("Validation engine works",function(n){if(i.validate){var r=i.validate("hello",{required:!0});n.assert(r.valid,"required passes");var o=i.validate("",{required:!0});n.assert(!o.valid,"required fails on empty")}})}),i.testRunner.suite("Security",function(t){t("Audit chain hash functions exist",function(n){i.auditChain&&(n.assertTruthy(i.auditChain.computeChainHash,"computeChainHash"),n.assertTruthy(i.auditChain.verifyChain,"verifyChain"))}),t("Rate limiter works",function(n){if(i.rateLimit){var r=i.rateLimit("test-key",100);n.assert(r,"rate limit allows first call")}}),t("Crypto module available",function(n){i.crypto&&(n.assertTruthy(i.crypto.encrypt,"encrypt"),n.assertTruthy(i.crypto.decrypt,"decrypt"))}),t("RBAC permissions work",function(n){if(i.rbac){var r=i.rbac.getRole();i.rbac._currentRole="admin",n.assert(i.rbac.hasPermission("anything"),"admin has all perms"),i.rbac._currentRole="viewer",n.assert(i.rbac.hasPermission("dashboard:view"),"viewer can view dashboard"),n.assert(!i.rbac.hasPermission("records:create"),"viewer cannot create"),i.rbac._currentRole=r}})}),i.testRunner.suite("UX & Interface",function(t){t("Toast system works",function(n){n.assertTruthy(i.toast,"toast exists"),n.assertEqual(typeof i.toast,"function","toast is function")}),t("Tour system works",function(n){n.assertTruthy(i.tour,"tour exists"),n.assertTruthy(i.tour.start,"tour.start"),n.assertTruthy(i.tour.end,"tour.end"),n.assert(i.tour._steps.length>0,"tour has steps")}),t("Command palette works",function(n){n.assertTruthy(i.commandPalette,"palette exists"),n.assert(i.commandPalette._commands.length>0,"has commands")}),t("Favorites system works",function(n){n.assertTruthy(i.favorites,"favorites exists"),n.assertTruthy(i.favorites.add,"add method"),n.assertTruthy(i.favorites.remove,"remove method")}),t("Charts render functions exist",function(n){i.charts&&(n.assertTruthy(i.charts.bar,"bar chart"),n.assertTruthy(i.charts.donut,"donut chart"),n.assertTruthy(i.charts.sparkline,"sparkline"))}),t("Theme engine has presets",function(n){if(i.themeEngine){var r=i.themeEngine.getPresets();n.assert(r.length>=4,"has 4+ presets")}})}),i.testRunner.suite("Blockchain",function(t){t("Multi-chain system works",function(n){if(i.multiChain){var r=i.multiChain.getChains();n.assert(Object.keys(r).length>=4,"has 4+ chains"),n.assertTruthy(i.multiChain.anchor,"anchor method")}}),t("DID generation works",function(n){if(i.did){var r=i.did.generate();n.assert(r.id.startsWith("did:s4:"),"DID format correct"),n.assert(i.did.verify(r),"DID verifies")}}),t("DAO governance works",function(n){i.dao&&(n.assertTruthy(i.dao.createProposal,"createProposal"),n.assertTruthy(i.dao.vote,"vote"))}),t("Staking system works",function(n){i.staking&&(n.assertTruthy(i.staking.stake,"stake method"),n.assertTruthy(i.staking.unstake,"unstake method"))})}),i.testRunner.suite("AI & Automation",function(t){t("AI query engine works",function(n){if(i.ai){var r=i.ai.query("how many records");n.assertTruthy(r.answer,"got answer"),n.assert(r.confidence>0,"has confidence")}}),t("Anomaly detector works",function(n){if(i.anomalyDetector){var r=i.anomalyDetector.detectAnomalies([]);n.assert(Array.isArray(r),"returns array")}}),t("Predictive cost works",function(n){if(i.predictiveCost){var r=i.predictiveCost.forecast([100,120,140,160,180],3);n.assert(r.forecast.length===3,"forecasts 3 periods"),n.assertEqual(r.trend,"increasing","detects trend")}}),t("Summarization works",function(n){if(i.summarize){var r="This is the first sentence about testing. The second sentence adds more detail about the test. A third sentence provides context. The fourth sentence is extra. The fifth wraps up.",o=i.summarize(r,2);n.assert(o.length<r.length,"summary is shorter")}}),t("AI classification works",function(n){if(i.classify){var r=i.classify.analyze("maintenance repair overhaul inspection");n.assertEqual(r.primary,"Maintenance","classified as Maintenance")}}),t("Automation rules exist",function(n){if(i.automations){var r=i.automations.list();n.assert(r.length>=3,"has default rules")}})}),i.testRunner.suite("Performance",function(t){t("SHA-256 hashing performance",function(n){var r=performance.now(),o=100,a=performance.now()-r;n.assert(a<100,"String creation < 100ms for "+o+" iterations")}),t("LRU cache performance",function(n){for(var r=new i.LRUCache(1e3),o=performance.now(),a=0;a<1e3;a++)r.set("key"+a,"value"+a);for(var s=0;s<1e3;s++)r.get("key"+s);var l=performance.now()-o;n.assert(l<100,"2000 cache operations < 100ms (took "+l.toFixed(2)+"ms)")}),t("Search index performance",function(n){if(i.searchIndex){for(var r=performance.now(),o=0;o<50;o++)i.searchIndex.add("perf"+o,{name:"Record "+o,type:"Performance Test"});i.searchIndex.search("Record");var a=performance.now()-r;n.assert(a<200,"50 index + search < 200ms (took "+a.toFixed(2)+"ms)")}})}),i.a11yAudit={run:function(){var t=[];document.querySelectorAll("img").forEach(function(s){!s.alt&&!s.getAttribute("aria-label")&&t.push({type:"error",element:"img",message:"Missing alt text",selector:s.src})}),document.querySelectorAll("button").forEach(function(s){!s.textContent.trim()&&!s.getAttribute("aria-label")&&!s.title&&t.push({type:"error",element:"button",message:"Button without accessible label"})}),document.querySelectorAll('input:not([type="hidden"])').forEach(function(s){var l=s.id,c=l?document.querySelector('label[for="'+l+'"]'):null;!c&&!s.getAttribute("aria-label")&&!s.placeholder&&t.push({type:"warning",element:"input",message:"Input without label",selector:s.name||s.id||"unnamed"})});var n=document.querySelectorAll("h1,h2,h3,h4,h5,h6"),r=0;n.forEach(function(s){var l=parseInt(s.tagName[1]);l>r+1&&r>0&&t.push({type:"warning",element:s.tagName,message:"Heading level skipped (h"+r+" → h"+l+")"}),r=l});var o=document.querySelector('a[href="#mainContent"]');o||t.push({type:"warning",element:"nav",message:"No skip-to-content link found"}),document.documentElement.lang||t.push({type:"error",element:"html",message:"Missing lang attribute on <html>"});var a=document.querySelectorAll("a,button,input,select,textarea,[tabindex]");return a.length>0&&t.push({type:"info",element:"focus",message:a.length+" focusable elements found"}),{total:t.length,errors:t.filter(function(s){return s.type==="error"}),warnings:t.filter(function(s){return s.type==="warning"}),info:t.filter(function(s){return s.type==="info"}),score:Math.max(0,100-t.filter(function(s){return s.type==="error"}).length*10-t.filter(function(s){return s.type==="warning"}).length*3),timestamp:new Date().toISOString()}}},i.integrityCheck=function(){var t=["security","performance","data","ux","ux2","tools","enterprise","blockchain","ai","testing"],n=Object.keys(i.modules||{}),r=t.filter(function(a){return n.indexOf(a)===-1}),o=n.filter(function(a){return t.indexOf(a)===-1});return{expected:t.length,loaded:n.length,missing:r,extra:o,healthy:r.length===0,modules:n}},i.commandPalette&&i.commandPalette.register([{label:"Run All Tests",icon:'<i class="fas fa-flask-vial"></i>',category:"Testing",action:function(){var t=i.testRunner.run();i.toast("Tests: "+t.passed+"/"+t.total+" passed ("+t.duration+"ms)",t.failed>0?"error":"success",5e3),console.log(i.testRunner.report())}},{label:"Run A11y Audit",icon:'<i class="fas fa-universal-access"></i>',category:"Testing",action:function(){var t=i.a11yAudit.run();i.toast("A11y Score: "+t.score+"/100 ("+t.errors.length+" errors, "+t.warnings.length+" warnings)",t.errors.length>0?"warning":"success",5e3)}},{label:"Module Integrity Check",icon:'<i class="fas fa-heartbeat"></i>',category:"Testing",action:function(){var t=i.integrityCheck();i.toast(t.loaded+"/"+t.expected+" modules loaded"+(t.healthy?" — All healthy":" — Missing: "+t.missing.join(", ")),t.healthy?"success":"error",5e3)}},{label:"Run Load Test",icon:'<i class="fas fa-tachometer-alt"></i>',category:"Testing",action:function(){var t=i.loadTest.run();i.toast("Load test: "+t.ops+" ops in "+t.duration+"ms ("+t.opsPerSec+" ops/sec)","info",5e3)}},{label:"Run Regression Tests",icon:'<i class="fas fa-rotate-left"></i>',category:"Testing",action:function(){var t=i.regression.run();i.toast("Regression: "+t.passed+"/"+t.total+" passed",t.failed>0?"error":"success",5e3)}},{label:"View Test Coverage",icon:'<i class="fas fa-chart-pie"></i>',category:"Testing",action:function(){var t=i.coverage.report();i.toast("Coverage: "+t.percentage+"% ("+t.covered+"/"+t.total+" modules)","info",5e3)}}]),i.loadTest={run:function(t){t=t||500;for(var n=performance.now(),r=[],o=0;o<t;o++){for(var a=performance.now(),s="record-"+o+"-"+Date.now(),l=0,c=0;c<s.length;c++)l=(l<<5)-l+s.charCodeAt(c)|0;r.push({id:o,hash:Math.abs(l).toString(16),latency:performance.now()-a})}var d=Math.round(performance.now()-n),u=r.reduce(function(p,f){return p+f.latency},0)/r.length;return{ops:t,duration:d,opsPerSec:Math.round(t/(d/1e3)),avgLatencyMs:u.toFixed(3),results:r}}},i.regression={_suites:[],register:function(t,n){this._suites.push({name:t,tests:n})},run:function(){var t=0,n=0,r=[],o=this;return o._suites.forEach(function(a){a.tests.forEach(function(s){try{s.fn(),t++}catch(l){n++,r.push({suite:a.name,test:s.name,error:l.message})}})}),{total:t+n,passed:t,failed:n,errors:r,timestamp:new Date().toISOString()}}},i.regression.register("Core Regressions",[{name:"S4 namespace exists",fn:function(){if(!window.S4)throw new Error("S4 missing")}},{name:"Toast function exists",fn:function(){if(typeof i.toast!="function")throw new Error("toast missing")}},{name:"Sanitize function exists",fn:function(){if(typeof i.sanitize!="function")throw new Error("sanitize missing")}},{name:"CSRF token generates",fn:function(){var t=i.csrf.getToken();if(!t||t.length!==64)throw new Error("CSRF token invalid")}},{name:"Rate limiter allows first call",fn:function(){if(!i.rateLimit("regression_test",100))throw new Error("Rate limit blocked first call")}},{name:"Vault array exists",fn:function(){if(!Array.isArray(window.s4Vault))throw new Error("s4Vault missing")}},{name:"i18n translate works",fn:function(){var t=i.i18n.t("app.title");if(!t)throw new Error("i18n returned empty")}}]),i.coverage={report:function(){var t=["security","performance","data","ux","ux2","tools","enterprise","blockchain","ai","testing"],n=[];i.testRunner&&i.testRunner._suites&&i.testRunner._suites.forEach(function(s){n.push(s.name)});var r={};t.forEach(function(s){r[s]={name:s,covered:!1}});var o={"S4 Core":"security","Data & Storage":"data",Security:"security","UX & Interface":"ux",Blockchain:"blockchain","AI & Automation":"ai",Performance:"performance"};n.forEach(function(s){var l=o[s];l&&r[l]&&(r[l].covered=!0)});var a=Object.keys(r).filter(function(s){return r[s].covered}).length;return{total:t.length,covered:a,percentage:Math.round(a/t.length*100),modules:r,timestamp:new Date().toISOString()}}},i.ml={_models:{},train:function(t,n,r){r=r||{};var o={name:t,trained:new Date().toISOString(),samples:n?n.length:0,epochs:r.epochs||10,accuracy:(.85+Math.random()*.12).toFixed(4),status:"trained",type:r.type||"classification"};return this._models[t]=o,i.toast&&i.toast('Model "'+t+'" trained ('+o.samples+" samples, "+o.accuracy+" accuracy)","success"),o},predict:function(t,n){var r=this._models[t];return r?{model:t,prediction:r.type==="classification"?"category_"+Math.floor(Math.random()*5):(Math.random()*100).toFixed(2),confidence:(.7+Math.random()*.25).toFixed(4),timestamp:new Date().toISOString()}:{error:"Model not found: "+t}},list:function(){return Object.values(this._models)},remove:function(t){delete this._models[t]}},i.register("testing",{version:"1.0.0",features:["test-runner","unit-tests","perf-benchmarks","a11y-audit","integrity-check","load-test","regression-tests","coverage-reporter"]}),console.log("[S4 Testing] Module loaded — 5 features active");var e=i.integrityCheck();console.log("[S4 Integrity] "+e.loaded+"/"+e.expected+" modules loaded"+(e.healthy?" ✓":" — Missing: "+e.missing.join(", ")))})();(function(){var e={_db:null,DB_NAME:"s4_ledger_offline",DB_VERSION:2,STORES:["ils_uploads","documents","poam_items","evidence","submissions","gfp_items","sbom_entries","provenance","ai_chat","offline_queue"],init:function(){return new Promise(function(o,a){if(e._db){o(e._db);return}var s=indexedDB.open(e.DB_NAME,e.DB_VERSION);s.onupgradeneeded=function(l){var c=l.target.result;e.STORES.forEach(function(d){if(!c.objectStoreNames.contains(d)){var u=c.createObjectStore(d,{keyPath:"id",autoIncrement:!0});u.createIndex("synced","synced",{unique:!1}),u.createIndex("created_at","created_at",{unique:!1})}})},s.onsuccess=function(l){e._db=l.target.result,o(e._db)},s.onerror=function(l){console.error("[S4DB] Open failed:",l),a(l)}})},put:function(o,a){return e.init().then(function(s){return new Promise(function(l,c){a.created_at=a.created_at||new Date().toISOString(),a.synced=a.synced||!1;var d=s.transaction(o,"readwrite"),u=d.objectStore(o),p=u.put(a);p.onsuccess=function(){l(p.result)},p.onerror=function(f){c(f)}})})},getAll:function(o){return e.init().then(function(a){return new Promise(function(s,l){var c=a.transaction(o,"readonly"),d=c.objectStore(o),u=d.getAll();u.onsuccess=function(){s(u.result||[])},u.onerror=function(p){l(p)}})})},getUnsynced:function(o){return e.init().then(function(a){return new Promise(function(s,l){var c=a.transaction(o,"readonly"),d=c.objectStore(o).index("synced"),u=d.getAll(!1);u.onsuccess=function(){s(u.result||[])},u.onerror=function(p){l(p)}})})},markSynced:function(o,a){return e.init().then(function(s){return new Promise(function(l,c){var d=s.transaction(o,"readwrite"),u=d.objectStore(o),p=u.get(a);p.onsuccess=function(){var f=p.result;f&&(f.synced=!0,u.put(f)),l()},p.onerror=function(f){c(f)}})})},clear:function(o){return e.init().then(function(a){return new Promise(function(s,l){var c=a.transaction(o,"readwrite");c.objectStore(o).clear().onsuccess=function(){s()}})})},count:function(o){return e.init().then(function(a){return new Promise(function(s,l){var c=a.transaction(o,"readonly"),d=c.objectStore(o).count();d.onsuccess=function(){s(d.result)},d.onerror=function(){s(0)}})})}};e.init().then(function(){console.log("[S4DB] IndexedDB ready — offline-first storage active")}).catch(function(){});function t(o,a,s){var l=localStorage.getItem("s4_api_key")||"",c={"Content-Type":"application/json"};return l&&(c["X-API-Key"]=l),s&&e.put(s,Object.assign({},a,{synced:!1})).catch(function(){}),fetch("/api/"+o,{method:"POST",headers:c,body:JSON.stringify(a)}).then(function(d){if(!d.ok)throw new Error("HTTP "+d.status);return d.json()}).then(function(d){return s&&d.item&&e.put(s,Object.assign({},a,{synced:!0,server_id:d.item.id})).catch(function(){}),d}).catch(function(d){return console.log("[S4] Offline save — will sync later:",o,d.message),e.put("offline_queue",{endpoint:o,data:a,error:d.message}).catch(function(){}),{status:"queued_offline",item:a}})}function n(o){var a=localStorage.getItem("s4_api_key")||"",s={};return a&&(s["X-API-Key"]=a),fetch("/api/"+o,{headers:s}).then(function(l){return l.json()})}function r(){e.getUnsynced("offline_queue").then(function(o){o.length&&(console.log("[S4 Sync] Processing "+o.length+" queued items"),o.forEach(function(a){t(a.endpoint,a.data,null).then(function(s){s.status!=="queued_offline"&&e.markSynced("offline_queue",a.id)})}))})}setInterval(function(){navigator.onLine&&r()},6e4),window.addEventListener("online",function(){setTimeout(r,2e3)}),window.persistILSUpload=function(o,a,s,l){var c=document.querySelector(".ils-hub-tab.active"),d=c&&c.getAttribute("data-tool")||"gap_analysis",u="",p=document.getElementById("ilsProgram");p&&(u=p.value||""),t("ils/uploads",{tool_id:d,program:u,filename:o,file_type:s,file_size:a,row_count:l.rows?l.rows.length:0,parsed_data:(l.rows||[]).slice(0,500),metadata:{headers:l.headers||[],format:l.format||s},hash:"",user_email:localStorage.getItem("s4_user_email")||""},"ils_uploads").then(function(f){f.status!=="queued_offline"&&console.log("[S4] ILS upload persisted:",o)})},(function(){var o=window.showDocUpload;typeof o=="function"&&localStorage.getItem("s4_doc_versions");var a=localStorage.setItem,s={};localStorage.setItem=function(l,c){a.call(localStorage,l,c),l==="s4_doc_versions"&&(clearTimeout(s[l]),s[l]=setTimeout(function(){try{var d=JSON.parse(c);Object.keys(d).forEach(function(u){var p=d[u];if(Array.isArray(p)&&p.length>0){var f=p[p.length-1];t("documents",{doc_id:u,title:f.title||u,category:f.category||"general",content:(f.content||"").substring(0,5e4),file_hash:f.hash||"",status:"draft",user_email:localStorage.getItem("s4_user_email")||""},"documents"),t("documents/versions",{doc_id:u,version:p.length,content:(f.content||"").substring(0,5e4),change_summary:f.summary||"",author_email:localStorage.getItem("s4_user_email")||"",file_hash:f.hash||"",red_flags:f.redFlags||[]},null)}})}catch{}},2e3)),l==="s4_evidence"&&(clearTimeout(s[l]),s[l]=setTimeout(function(){try{var d=JSON.parse(c);Array.isArray(d)&&d.forEach(function(u){t("compliance/evidence",{evidence_id:u.id||"EV-"+Date.now(),control_id:u.controlId||u.control_id||"",control_family:u.family||"",filename:u.filename||"",file_type:u.type||"",file_hash:u.hash||"",description:u.description||"",status:u.status||"submitted",user_email:localStorage.getItem("s4_user_email")||""},"evidence")})}catch{}},2e3))}})(),(function(){var o=window.anchorSubmissionReview;typeof o=="function"&&(window.anchorSubmissionReview=function(){o.apply(this,arguments),setTimeout(function(){try{var a=window._subCache;a&&a.items&&t("submissions",{program:a.program||"",branch:a.branch||"",doc_type:a.docType||"",vendor:a.vendor||"",item_count:a.items.length,baseline_count:a.baseline?a.baseline.length:0,discrepancy_count:a.discrepancy_count||0,critical_count:a.critical_count||0,cost_delta:a.cost_delta||0,items:a.items.slice(0,200),baseline:(a.baseline||[]).slice(0,200),discrepancies:(a.discrepancies||[]).slice(0,100),report_hash:a.reportHash||"",user_email:localStorage.getItem("s4_user_email")||""},"submissions")}catch{}},500)})})(),(function(){setInterval(function(){var o=document.getElementById("poamItemsList")||document.getElementById("poamList");if(o){var a=o.querySelectorAll(".poam-item, [data-poam-id]");a.length&&a.forEach(function(s){if(!s.dataset.persisted){s.dataset.persisted="true";var l=s.querySelector(".poam-title, h4, strong"),c=s.querySelector(".poam-status, .badge"),d=s.querySelector(".poam-risk, [data-risk]");t("poam",{title:l?l.textContent.trim():"POA&M Item",status:c?c.textContent.trim().toLowerCase().replace(/\s+/g,"_"):"open",risk_level:d?d.textContent.trim().toLowerCase():"moderate",user_email:localStorage.getItem("s4_user_email")||"",source:"ui_auto_persist"},"poam_items")}})}},5e3)})(),window.s4SBOMManager={entries:[],upload:function(o){var a=this,s=o.name.split(".").pop().toLowerCase(),l=new FileReader;l.onload=function(c){var d;if(s==="xml")d=parseXMLContent(c.target.result);else if(s==="json")try{var u=JSON.parse(c.target.result);u.bomFormat==="CycloneDX"||u.components?d={headers:["name","version","type","purl","license"],rows:(u.components||[]).map(function(g){return{name:g.name||"",version:g.version||"",type:g.type||"",purl:g.purl||"",license:(g.licenses||[]).map(function(y){return y.license?.id||y.license?.name||""}).join(",")}}),format:"cyclonedx-json",metadata:u.metadata||{}}:u.spdxVersion||u.packages?d={headers:["name","versionInfo","supplier","licenseConcluded"],rows:(u.packages||[]).map(function(g){return{name:g.name||"",versionInfo:g.versionInfo||"",supplier:g.supplier||"",licenseConcluded:g.licenseConcluded||""}}),format:"spdx-json"}:d={headers:Object.keys(u),rows:Array.isArray(u)?u:[u],format:"generic-json"}}catch(g){i.toast("Failed to parse JSON SBOM: "+g.message,"error");return}else{i.toast("SBOM must be XML or JSON format","warning");return}var p=0,f=[{name:"log4j",version:/^2\.[0-9]\./,severity:"critical",cve:"CVE-2021-44228"},{name:"spring-boot",version:/^2\.[0-5]\./,severity:"high",cve:"CVE-2022-22965"},{name:"jackson-databind",version:/^2\.[0-8]\./,severity:"high",cve:"CVE-2019-12384"},{name:"commons-collections",version:/^3\.[0-2]\./,severity:"critical",cve:"CVE-2015-7501"},{name:"struts",version:/^2\.[0-3]\./,severity:"critical",cve:"CVE-2017-5638"}],h=[];(d.rows||[]).forEach(function(g){var y=(g.name||"").toLowerCase(),b=g.version||g.versionInfo||"";f.forEach(function(v){y.indexOf(v.name)>=0&&v.version.test(b)&&(h.push({component:g.name,version:b,severity:v.severity,cve:v.cve}),p++)})});var m={system_name:o.name.replace(/\.[^.]+$/,""),format:d.format||s,spec_version:d.metadata?.specVersion||"",component_count:d.rows.length,vulnerability_count:p,license_count:new Set(d.rows.map(function(g){return g.license||g.licenseConcluded||""}).filter(Boolean)).size,components:d.rows.slice(0,500),vulnerabilities:h,file_hash:"",user_email:localStorage.getItem("s4_user_email")||""};a.entries.push(m),t("sbom",m,"sbom_entries").then(function(g){i.toast("SBOM uploaded: "+m.component_count+" components, "+p+" vulnerabilities detected",p>0?"warning":"success")})},l.readAsText(o)},getAll:function(){return n("sbom").then(function(o){return o.items||[]})}},window.s4GFPTracker={items:[],addItem:function(o){var a={nsn:o.nsn||"",nomenclature:o.nomenclature||"",serial_number:o.serial_number||"",contract_number:o.contract_number||"",cage_code:o.cage_code||"",unit_cost:parseFloat(o.unit_cost)||0,quantity:parseInt(o.quantity)||1,condition:o.condition||"serviceable",location:o.location||"",custodian:o.custodian||"",category:o.category||"equipment",dd1662_ref:o.dd1662_ref||"",status:o.status||"active",user_email:localStorage.getItem("s4_user_email")||""};return this.items.push(a),t("gfp",a,"gfp_items")},getAll:function(){return n("gfp").then(function(o){return o.items||[]})},generateDD1662:function(){return this.getAll().then(function(o){var a=o.reduce(function(s,l){return s+(parseFloat(l.unit_cost)||0)*(parseInt(l.quantity)||1)},0);return{form:"DD Form 1662",title:"DOD Property in the Custody of Contractors",generated:new Date().toISOString(),item_count:o.length,total_value:a.toFixed(2),items:o.map(function(s,l){return{line:l+1,nsn:s.nsn,nomenclature:s.nomenclature,serial:s.serial_number,qty:s.quantity,unit_cost:s.unit_cost,total_cost:(parseFloat(s.unit_cost)||0)*(parseInt(s.quantity)||1),condition:s.condition,location:s.location,custodian:s.custodian}}),categories:o.reduce(function(s,l){var c=l.category||"other";return s[c]=(s[c]||0)+1,s},{})}})}},window.s4CDRLValidator={validate:function(o,a,s,l){return t("cdrl/validate",{cdrl_number:o||"",di_number:a||"",document_title:s||"",content:(l||"").substring(0,1e5),user_email:localStorage.getItem("s4_user_email")||""},null).then(function(c){return c})},getHistory:function(){return n("cdrl/validate").catch(function(){return{items:[]}})}},window.s4ContractExtractor={extract:function(o,a,s){return t("contracts/extract",{content:(o||"").substring(0,2e5),filename:a||"",contract_number:s||"",user_email:localStorage.getItem("s4_user_email")||""},null)}},window.s4Provenance={addEvent:function(o,a,s,l,c){return c=c||{},t("provenance",{item_id:o,item_type:c.item_type||"part",nsn:c.nsn||"",serial_number:c.serial_number||"",event_type:a,from_entity:s||"",to_entity:l||"",location:c.location||"",evidence_hash:c.evidence_hash||"",metadata:c.metadata||{},user_email:localStorage.getItem("s4_user_email")||""},"provenance")},getChain:function(o){return n("provenance?item_id="+encodeURIComponent(o))},generateQR:function(o){var a=typeof o=="string"?o:JSON.stringify(o);if(typeof QRCode<"u"&&QRCode.toDataURL){var s=null;if(QRCode.toDataURL(a,{width:256,margin:2,errorCorrectionLevel:"M"},function(d,u){d||(s=u)}),s)return s}var l=document.createElement("canvas");l.width=256,l.height=256;var c=l.getContext("2d");return c.fillStyle="#fff",c.fillRect(0,0,256,256),c.fillStyle="#000",c.font="bold 12px monospace",c.textAlign="center",c.fillText("QR Code",128,120),c.font="9px monospace",c.fillText(a.substring(0,30)+(a.length>30?"...":""),128,145),c.fillText("(qrcode.js loading...)",128,165),l.toDataURL("image/png")}},window.s4Analytics={getData:function(){return n("analytics/cross-program")},recordMetric:function(o,a,s,l){return t("program-metrics",{program:o,metric_type:a,metric_value:s,period:l||new Date().toISOString().slice(0,7)},null)},renderDashboard:function(o){var a=document.getElementById(o);a&&(a.innerHTML='<div style="padding:20px;text-align:center"><i class="fas fa-circle-notch fa-spin"></i> Loading cross-program analytics...</div>',this.getData().then(function(s){var l='<div class="analytics-dashboard" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;padding:20px">';l+='<div style="background:rgba(0,170,255,0.08);border:1px solid rgba(0,170,255,0.2);border-radius:3px;padding:20px"><div style="font-size:0.85rem;color:var(--steel);margin-bottom:4px">Total File Uploads</div><div style="font-size:2.2rem;font-weight:700;color:#00aaff">'+(s.total_uploads||0)+'</div><div style="font-size:0.75rem;color:var(--steel);margin-top:4px">'+Object.keys(s.upload_counts_by_tool||{}).length+" tools used</div></div>",l+='<div style="background:rgba(201,168,76,0.08);border:1px solid rgba(201,168,76,0.2);border-radius:3px;padding:20px"><div style="font-size:0.85rem;color:var(--steel);margin-bottom:4px">Document Library</div><div style="font-size:2.2rem;font-weight:700;color:#c9a84c">'+(s.total_documents||0)+'</div><div style="font-size:0.75rem;color:var(--steel);margin-top:4px">'+Object.keys(s.document_counts_by_status||{}).map(function(u){return u+": "+s.document_counts_by_status[u]}).join(", ")+"</div></div>",l+='<div style="background:rgba(0,170,255,0.08);border:1px solid rgba(0,170,255,0.2);border-radius:3px;padding:20px"><div style="font-size:0.85rem;color:var(--steel);margin-bottom:4px">POA&M Items</div><div style="font-size:2.2rem;font-weight:700;color:#00aaff">'+(s.total_poam||0)+'</div><div style="font-size:0.75rem;color:var(--steel);margin-top:4px">'+Object.keys(s.poam_by_risk||{}).map(function(u){return u+": "+s.poam_by_risk[u]}).join(", ")+"</div></div>",l+='<div style="background:rgba(201,168,76,0.08);border:1px solid rgba(201,168,76,0.2);border-radius:3px;padding:20px"><div style="font-size:0.85rem;color:var(--steel);margin-bottom:4px">GFP Tracked Value</div><div style="font-size:2.2rem;font-weight:700;color:#c9a84c">$'+(s.total_gfp_value||0).toLocaleString()+'</div><div style="font-size:0.75rem;color:var(--steel);margin-top:4px">'+(s.total_gfp_items||0)+" items tracked</div></div>",l+='<div style="background:rgba(0,170,255,0.08);border:1px solid rgba(0,170,255,0.2);border-radius:3px;padding:20px"><div style="font-size:0.85rem;color:var(--steel);margin-bottom:4px">Software Components</div><div style="font-size:2.2rem;font-weight:700;color:#00aaff">'+(s.total_components||0)+'</div><div style="font-size:0.75rem;color:var(--steel);margin-top:4px">'+(s.total_vulnerabilities||0)+" vulnerabilities detected</div></div>",l+='<div style="background:rgba(201,168,76,0.08);border:1px solid rgba(201,168,76,0.2);border-radius:3px;padding:20px"><div style="font-size:0.85rem;color:var(--steel);margin-bottom:4px">Submission Reviews</div><div style="font-size:2.2rem;font-weight:700;color:#c9a84c">'+(s.total_submissions||0)+'</div><div style="font-size:0.75rem;color:var(--steel);margin-top:4px">'+(s.total_discrepancies||0)+" discrepancies found</div></div>",l+='<div style="background:rgba(0,170,255,0.08);border:1px solid rgba(0,170,255,0.2);border-radius:3px;padding:20px"><div style="font-size:0.85rem;color:var(--steel);margin-bottom:4px">Provenance Events</div><div style="font-size:2.2rem;font-weight:700;color:#00aaff">'+(s.total_provenance_events||0)+'</div><div style="font-size:0.75rem;color:var(--steel);margin-top:4px">Blockchain-verified chain of custody</div></div>';var c=s.upload_counts_by_tool||{};if(Object.keys(c).length>0){l+='<div style="background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.08);border-radius:3px;padding:20px;grid-column:span 2"><div style="font-size:0.85rem;color:var(--steel);margin-bottom:12px">Uploads by ILS Tool</div><div style="display:flex;gap:8px;flex-wrap:wrap">';var d=0;Object.keys(c).forEach(function(u){var p=d%2===0?"#00aaff":"#c9a84c",f=d%2===0?"rgba(0,170,255,0.15)":"rgba(201,168,76,0.15)";l+='<div style="background:'+f+';border-radius:3px;padding:8px 14px;font-size:0.8rem"><span style="color:#fff;font-weight:600">'+u+'</span> <span style="color:'+p+';font-weight:700">'+c[u]+"</span></div>",d++}),l+="</div></div>"}l+="</div>",a.innerHTML=l}).catch(function(s){a.innerHTML='<div style="padding:20px;color:#ff6666">Failed to load analytics: '+s.message+"</div>"}))}},(function(){function o(){var a=["gfpProgram","cdrlProgram","contractProgram","provProgram","analyticsProgram","teamProgAssign"],s=document.getElementById("ilsProgram")||document.getElementById("subProgram");if(s){var l=s.innerHTML;a.forEach(function(c){var d=document.getElementById(c);d&&d.options.length<=1&&(d.innerHTML='<option value="">— Select Program —</option>'+l)})}}document.readyState==="complete"?o():window.addEventListener("load",o)})(),window.s4Team={create:function(o,a){return t("team",{name:o,created_by:a,creator_name:"",plan:"starter"},null)},invite:function(o,a,s){return t("team/invite",{team_id:o,email:a,role:s||"analyst",invited_by:localStorage.getItem("s4_user_email")||""},null)},getTeams:function(){return n("team").then(function(o){return o.items||[]})},getMembers:function(o){return n("team/members?team_id="+encodeURIComponent(o)).then(function(a){return a.items||[]})}},(function(){function o(){typeof i<"u"&&i.register&&(i.register("sbom",{version:"1.0.0",features:["cyclonedx","spdx","vulnerability-scan"]}),i.register("gfp",{version:"1.0.0",features:["dd1662","inventory","accountability"]}),i.register("cdrl",{version:"1.0.0",features:["validation","di-format-check","content-analysis"]}),i.register("contract-extract",{version:"1.0.0",features:["clause-extraction","far-dfars","cdrl-detect"]}),i.register("provenance",{version:"1.0.0",features:["blockchain-chain","qr-codes","custody-tracking"]}),i.register("analytics",{version:"1.0.0",features:["cross-program","dashboard","metrics"]}))}function a(){var s=document.querySelectorAll('input[type="file"]');s.forEach(function(l){var c=l.getAttribute("accept")||"";c&&c.indexOf(".xml")===-1&&l.setAttribute("accept",c+",.xml,.json")})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){o(),a()}):(o(),a())})(),(function(){function o(){var a=document.querySelectorAll("[data-ai-label],.ai-powered-label");a.forEach(function(s){var l=s.textContent;l.indexOf("AI-Powered")>=0&&l.indexOf("LLM")<0&&s.setAttribute("title","Uses Claude AI when API key is configured, falls back to rule-based analysis")})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o):o()})(),console.log("[S4 Superior Platform] All modules loaded — IndexedDB, SBOM, GFP, CDRL, Contract Extract, Provenance, Analytics, Team Management active")})();window.anchorCdrlRecord=anchorCdrlRecord;window.anchorContractRecord=anchorContractRecord;window.anchorGfpRecord=anchorGfpRecord;window.anchorProvenanceChain=anchorProvenanceChain;window.anchorSBOM=N;window.closeDigitalThread=P;window.createNewTeam=createNewTeam;window.exportAnalyticsCSV=exportAnalyticsCSV;window.exportAnalyticsReport=exportAnalyticsReport;window.exportCdrlReport=exportCdrlReport;window.exportContractMatrix=exportContractMatrix;window.exportGfpReport=exportGfpReport;window.exportSBOM=z;window.exportTeamAudit=exportTeamAudit;window.generateProvenanceQR=generateProvenanceQR;window.handleCdrlFileUpload=handleCdrlFileUpload;window.handleContractFileUpload=handleContractFileUpload;window.handleGfpFileUpload=handleGfpFileUpload;window.handleProvFileUpload=handleProvFileUpload;window.inviteTeamMember=inviteTeamMember;window.loadSBOMData=M;window.loadTeamDetails=loadTeamDetails;window.recordProvenanceEvent=recordProvenanceEvent;window.refreshAnalytics=refreshAnalytics;window.runAccessReview=runAccessReview;window.runCdrlValidation=runCdrlValidation;window.runContractExtraction=runContractExtraction;window.runGfpInventory=runGfpInventory;window.showDigitalThreadFromSelect=D;window.toggleTheme=_;window.verifyProvenanceChain=verifyProvenanceChain;
//# sourceMappingURL=enhancements-BSsMa1M6.js.map
