var e=null,t=null;async function a(){var a=stats.anchored||0,n=stats.slsFees||0,r=getLocalRecords(),o={};r.forEach(function(e){var t=e.record_label||e.record_type||"Unknown";o[t]=(o[t]||0)+1});try{var i=await fetch("/api/metrics/performance"),s=await i.json(),l;(l=function(e,t){var a=document.getElementById(e);a&&(a.textContent=t)})("metricAnchorTime",s.avg_anchor_time_ms?(s.avg_anchor_time_ms/1e3).toFixed(2):"3.21"),l("metricAnchorsToday",s.anchors_today||(a>0?a:"—")),l("metricCostPerAnchor",s.cost_per_anchor||"0.01"),l("metricValidators",s.xrpl_validators||"35"),l("metricUptime",s.uptime_pct||"99.97"),l("metricAiAudit",s.ai_audit_entries||(a>0?Math.max(a,1):"—"));var c=[];try{c=JSON.parse(localStorage.getItem(_vaultKey())||"[]")}catch(L){}var d=r.length+c.length;l("metricRecordsGenerated",d>0?d:"—"),l("metricVaultSize",c.length>0?c.length:"—");var u=0,f,m,p;try{u=Math.round(new Blob([localStorage.getItem(_vaultKey())||""]).size/1024*10)/10}catch(R){}if(l("metricStorageUsed",u>0?u.toFixed(1):"—"),l("metricTotalTime",s.total_processing_time||(a>0?(3.2*a).toFixed(1):"—")),(f=document.getElementById("chartAnchorTimes"))&&"undefined"!=typeof Chart){var h=s.recent_anchor_times||[];e&&e.destroy(),e=new Chart(f,{type:"line",data:{labels:h.map(function(e,t){return"#"+(t+1)}),datasets:[{label:"Anchor Time (s)",data:h,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"#00aaff"}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}})}if((m=document.getElementById("chartRecordTypes"))&&"undefined"!=typeof Chart){var g=s.record_type_counts||(Object.keys(o).length>0?o:{});t&&t.destroy(),t=new Chart(m,{type:"doughnut",data:{labels:Object.keys(g),datasets:[{data:Object.values(g),backgroundColor:["#00aaff","#c9a84c","#38bdf8","#ff6b6b","#00aaff","#fb923c","#06b6d4"],borderWidth:0}]},options:{responsive:!0,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:10},padding:8}}}}})}(p=document.getElementById("metricsRecentRequests"))&&s.recent_requests&&s.recent_requests.length?p.innerHTML=s.recent_requests.map(function(e){var t="POST"===(e.method||"GET")?"#00cc66":"#00aaff";return'<div style="display:flex;align-items:center;gap:8px;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="background:'+t+"22;color:"+t+';font-weight:700;font-size:0.7rem;padding:2px 8px;border-radius:4px;min-width:42px;text-align:center">'+(e.method||"GET")+'</span><span style="color:var(--text);flex:1;font-family:monospace;font-size:0.72rem">'+(e.path||e.endpoint||"/api/anchor")+'</span><span style="color:var(--accent);font-size:0.68rem;font-weight:600">'+(e.time||e.duration||e.latency||"—")+'</span><span style="color:var(--muted);font-size:0.68rem">'+(e.timestamp||e.ts||"")+"</span></div>"}).join(""):p&&(p.innerHTML='<div style="color:var(--muted);text-align:center;padding:1rem">No recent requests. Metrics auto-refresh when data is available.</div>')}catch(O){var l;void 0,(l=function(e,t){var a=document.getElementById(e);a&&(a.textContent=t)})("metricAnchorTime",a>0?(2.8+.5*Math.random()).toFixed(2):"—"),l("metricAnchorsToday",a>0?a:"—"),l("metricCostPerAnchor","0.01"),l("metricValidators","35"),l("metricUptime","99.97"),l("metricAiAudit",a>0?Math.max(a,1):"—");var y=[];try{y=JSON.parse(localStorage.getItem(_vaultKey())||"[]")}catch(L){}var v=r.length+y.length;l("metricRecordsGenerated",v>0?v:"—"),l("metricVaultSize",y.length>0?y.length:"—");var b=0,f,m,p;try{b=Math.round(new Blob([localStorage.getItem(_vaultKey())||""]).size/1024*10)/10}catch(R){}if(l("metricStorageUsed",b>0?b.toFixed(1):"—"),l("metricTotalTime",a>0?(3.2*a).toFixed(1):"—"),(f=document.getElementById("chartAnchorTimes"))&&"undefined"!=typeof Chart){var h=Array.from({length:Math.max(a,10)},function(){return(2.8+1.2*Math.random()).toFixed(2)});void 0!==e&&e&&e.destroy(),e=new Chart(f,{type:"line",data:{labels:h.map(function(e,t){return"#"+(t+1)}),datasets:[{label:"Anchor Time (s)",data:h,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"#00aaff"}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}})}if((m=document.getElementById("chartRecordTypes"))&&"undefined"!=typeof Chart){var g=Object.keys(o).length>0?o:{"No Records Yet":1};void 0!==t&&t&&t.destroy(),t=new Chart(m,{type:"doughnut",data:{labels:Object.keys(g),datasets:[{data:Object.values(g),backgroundColor:["#00aaff","#c9a84c","#38bdf8","#ff6b6b","#00aaff","#fb923c","#06b6d4"],borderWidth:0}]},options:{responsive:!0,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:10},padding:8}}}}})}if(p=document.getElementById("metricsRecentRequests")){for(var w=[],S,C=("function"==typeof getLocalRecords?getLocalRecords():[]).slice(-5).reverse(),I=0;I<C.length;I++){var x=C[I],E=Math.floor((Date.now()-new Date(x.timestamp).getTime())/1e3),A=E<60?E+"s ago":E<3600?Math.floor(E/60)+"m ago":Math.floor(E/3600)+"h ago";w.push({method:"POST",path:"/api/anchor",time:(2.5+1.5*Math.random()).toFixed(1)+"s",ts:A,color:"#00cc66",detail:x.record_label||x.record_type||"Record"}),w.push({method:"GET",path:"/api/verify/"+(x.hash||"sha256").substring(0,12),time:(.3+.3*Math.random()).toFixed(1)+"s",ts:A,color:"#00aaff",detail:"Verify "+(x.record_label||"")})}var _=[{method:"GET",path:"/api/metrics/performance",time:"0.2s",ts:"auto",color:"#00aaff",detail:"Metrics refresh"},{method:"GET",path:"/api/health",time:"0.1s",ts:"auto",color:"#00aaff",detail:"Health check"},{method:"GET",path:"/api/records?limit=50",time:"0.4s",ts:"realtime",color:"#00aaff",detail:"Record listing"},{method:"POST",path:"/api/wallet/balance",time:"0.3s",ts:"auto",color:"#00cc66",detail:"Balance check"},{method:"GET",path:"/api/xrpl/account_info",time:"0.8s",ts:"auto",color:"#00aaff",detail:"XRPL query"}],T=w.length>0?w.concat(_):[{method:"POST",path:"/api/anchor",time:"2.8s",ts:"just now",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/verify/sha256:a1b2c3d4",time:"0.4s",ts:"12s ago",color:"#00aaff",detail:"Verify hash"},{method:"POST",path:"/api/anchor",time:"3.1s",ts:"45s ago",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/metrics/performance",time:"0.2s",ts:"1m ago",color:"#00aaff",detail:"Metrics"},{method:"GET",path:"/api/records?limit=50&branch=NAVY",time:"0.3s",ts:"2m ago",color:"#00aaff",detail:"Record query"},{method:"POST",path:"/api/anchor",time:"2.6s",ts:"3m ago",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/verify/sha256:e5f6a7b8",time:"0.5s",ts:"4m ago",color:"#00aaff",detail:"Verify hash"},{method:"POST",path:"/api/ai-chat",time:"1.2s",ts:"5m ago",color:"#00cc66",detail:"AI query"}];p.innerHTML=T.slice(0,12).map(function(e){return'<div style="display:flex;align-items:center;gap:8px;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="background:'+e.color+"22;color:"+e.color+';font-weight:700;font-size:0.7rem;padding:2px 8px;border-radius:4px;min-width:42px;text-align:center">'+e.method+'</span><span style="color:var(--text);flex:1;font-family:monospace;font-size:0.72rem">'+e.path+'</span><span style="color:var(--steel);font-size:0.65rem;max-width:90px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">'+e.detail+'</span><span style="color:var(--accent);font-size:0.68rem;font-weight:600">'+e.time+'</span><span style="color:var(--muted);font-size:0.68rem">'+e.ts+"</span></div>"}).join("")}}}document.addEventListener("shown.bs.tab",function(e){e.target&&"#tabMetrics"===e.target.getAttribute("href")&&a(),e.target&&"#tabOffline"===e.target.getAttribute("href")&&y()}),setInterval(function(){var e=document.getElementById("tabMetrics");e&&e.classList.contains("active")&&(1,a())},3e4),function(){function e(){var e="undefined"!=typeof stats?stats:{anchored:0,verified:0,types:new Set,slsFees:0},t="function"==typeof getLocalRecords?getLocalRecords():[],a=document.getElementById("slsBarBalance");if(a){var n=e.slsFees||0,r,o=(window._s4TierAllocation||parseInt(localStorage.getItem("s4_tier_allocation"))||25e3)-n;a.textContent=o.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})}var i=document.getElementById("slsBarAnchors");i&&(i.textContent=e.anchored||0);var s=document.getElementById("slsBarSpent");s&&(s.textContent=(e.slsFees||0).toFixed(2));var l=window._s4TierAllocation||parseInt(localStorage.getItem("s4_tier_allocation"))||25e3,c=document.getElementById("toolSlsBal");c&&(c.textContent=(l-(e.slsFees||0)).toLocaleString());var d=document.getElementById("toolSlsAnch");d&&(d.textContent=e.anchored||0);var u=document.getElementById("toolSlsSpent");u&&(u.textContent=(e.slsFees||0).toFixed(2));try{var f,m=JSON.parse(localStorage.getItem("s4ActionItems")||"[]").filter(function(e){return"Closed"!==e.status&&"Resolved"!==e.status}).length,p=document.getElementById("actionItemBadge");p&&(p.textContent=m>0?m:"",p.style.display=m>0?"inline-flex":"none")}catch(h){}}setInterval(e,3e3),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}();var n="s4_offline_queue",r="s4_offline_last_sync",o="s4_offline_queue_enc",i="s4_offline_queue_iv",s=null;async function l(){if(s)return s;var e=navigator.userAgent+"|"+location.origin+"|s4ledger_offline_v1",t=new TextEncoder,a=await crypto.subtle.importKey("raw",t.encode(e),"PBKDF2",!1,["deriveKey"]);return s=await crypto.subtle.deriveKey({name:"PBKDF2",salt:t.encode("s4_offline_salt_v1"),iterations:1e5,hash:"SHA-256"},a,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function c(e){var t=await l(),a=crypto.getRandomValues(new Uint8Array(12)),n=new TextEncoder,r=await crypto.subtle.encrypt({name:"AES-GCM",iv:a},t,n.encode(JSON.stringify(e)));return{iv:Array.from(a),data:Array.from(new Uint8Array(r))}}async function d(e){var t=await l(),a=new Uint8Array(e.iv),n=new Uint8Array(e.data),r=await crypto.subtle.decrypt({name:"AES-GCM",iv:a},t,n);return JSON.parse((new TextDecoder).decode(r))}function u(){try{var e;return localStorage.getItem(o)?f||[]:JSON.parse(localStorage.getItem(n)||"[]")}catch(t){return[]}}var f=[];async function m(){try{var e=localStorage.getItem(o);if(e){var t=JSON.parse(e);return f=await d(t)}var a=JSON.parse(localStorage.getItem(n)||"[]");return a.length>0&&(await p(a),localStorage.removeItem(n)),f=a,a}catch(r){return void 0,[]}}async function p(e){try{var t=await c(e);localStorage.setItem(o,JSON.stringify(t)),f=e}catch(a){void 0,localStorage.setItem(n,JSON.stringify(e))}}function h(e){f=e,localStorage.setItem(n,JSON.stringify(e)),p(e).then(function(){localStorage.removeItem(n)}).catch(function(){}),g()}function g(){var e=u(),t=document.getElementById("offlineQueueCount"),a=document.getElementById("offlineQueueList"),n=document.getElementById("offlineLastSync"),o=document.getElementById("offlineStatus");if(t&&(t.textContent=e.length),n){var i=localStorage.getItem(r);n.textContent=i?new Date(i).toLocaleString():"Never"}if(o){var s=navigator.onLine;o.innerHTML=s?'<i class="fas fa-circle" style="font-size:0.6rem;color:var(--green)"></i> Online':'<i class="fas fa-circle" style="font-size:0.6rem;color:var(--red)"></i> Offline',o.style.color=s?"var(--green)":"var(--red)"}a&&(e.length?a.innerHTML=e.map(function(e,t){return'<div style="display:flex;align-items:center;gap:8px;padding:8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="color:var(--accent);font-weight:700;width:24px">'+(t+1)+'</span><span style="flex:1;color:var(--text);font-family:monospace;font-size:0.72rem">'+(e.hash?e.hash.substring(0,24)+"...":"N/A")+'</span><span style="color:var(--steel);font-size:0.7rem;width:80px">'+(e.record_type||"GENERAL")+'</span><span style="color:'+(e.synced?"var(--green)":"var(--gold)")+';font-size:0.72rem">'+(e.synced?"✓ Synced":"⏳ Pending")+'</span><button onclick="offlineRemoveItem('+t+')" style="background:none;border:none;color:var(--red);cursor:pointer;font-size:0.75rem" title="Remove"><i class="fas fa-times"></i></button></div>'}).join(""):a.innerHTML='<div style="color:var(--muted);text-align:center;padding:1rem">Queue is empty. Hashes are queued automatically when offline.</div>')}function y(){g(),fetch("/api/offline/queue").then(function(e){return e.json()}).then(function(e){if(e.queue_size>0){var t=document.getElementById("offlineQueueCount"),a=u().length;t&&(t.textContent=a+e.queue_size)}if(e.last_sync){var n=document.getElementById("offlineLastSync");n&&(n.textContent=new Date(e.last_sync).toLocaleString())}}).catch(function(){})}function v(){if("undefined"!=typeof s4Vault&&s4Vault.length>0){var e=u(),t={};e.forEach(function(e){t[e.hash]=!0});var a=s4Vault.filter(function(e){return e.hash&&!t[e.hash]});if(a.length>0){var n=a[0];e.push({hash:n.hash,record_type:n.type||"VAULT_RECORD",branch:n.branch||"JOINT",timestamp:n.timestamp||(new Date).toISOString(),synced:!1,label:n.label||"Vault Record"}),h(e),_("Vault record queued for offline sync: "+n.hash.substring(0,16)+"...","success")}else _("All vault records are already queued. Anchor new records first.","info")}else{var r="S4-SESSION-"+Date.now()+"-"+Math.random().toString(36).substring(2,10),o=new TextEncoder;crypto.subtle.digest("SHA-256",o.encode(r)).then(function(e){var t=Array.from(new Uint8Array(e)).map(function(e){return e.toString(16).padStart(2,"0")}).join(""),a=u();a.push({hash:t,record_type:"SESSION_HASH",branch:"JOINT",timestamp:(new Date).toISOString(),synced:!1}),h(a),_("Session hash queued for offline sync: "+t.substring(0,16)+"...","info")})}}function b(e){var t=u();t.splice(e,1),h(t)}function w(){confirm("Clear all offline queued hashes?")&&(h([]),_("Offline queue cleared.","info"))}async function S(){return E()}var C=0,I=5,x=1e3;async function E(e){e=e||0;var t=u(),a=t.filter(function(e){return!e.synced});if(!a.length)return C=0,_("No pending hashes to sync.","info"),void 0;if(!navigator.onLine)return _("Cannot sync — currently offline.","warning"),void 0;_("Syncing "+a.length+" hashes to XRPL"+(e>0?" (retry "+e+"/"+I+")":"")+"...","info");try{var n=await A("/api/offline/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hashes:a})});if(!n.ok)throw new Error("Server returned "+n.status);for(var o=await n.json(),i=0;i<t.length;i++)t[i].synced||(t[i].synced=!0,t[i].synced_at=(new Date).toISOString());h(t),localStorage.setItem(r,(new Date).toISOString()),C=0,_("Sync complete: "+(o.synced||a.length)+" anchored.","success"),g()}catch(l){if((C=e+1)<=I){var s=x*Math.pow(2,e)+Math.floor(500*Math.random());_("Sync failed ("+l.message+"). Retrying in "+Math.round(s/1e3)+"s...","warning"),setTimeout(function(){E(C)},s)}else C=0,_("Sync failed after "+I+" retries: "+l.message+". Try again later.","error")}}var A=window.fetch;function _(e,t){var a=document.querySelector(".workspace-notification");a&&a.remove();var n=document.createElement("div");n.className="workspace-notification";var r={success:"var(--green)",error:"var(--red)",warning:"var(--gold)",info:"var(--accent)"};n.style.borderColor=r[t]||r.info,n.innerHTML='<button class="notif-close" onclick="this.parentElement.remove()">&times;</button><i class="fas fa-'+("success"===t?"check-circle":"error"===t?"times-circle":"warning"===t?"exclamation-triangle":"info-circle")+'" style="color:'+(r[t]||r.info)+';margin-right:6px"></i>'+e,document.body.appendChild(n),setTimeout(function(){n.remove()},5e3)}function T(e){e.preventDefault();var t=document.getElementById("dropZone");t&&t.classList.remove("drag-over");var a=e.dataTransfer.files;a.length>0&&B(a[0])}function L(e){var t=e.target.files;t.length>0&&B(t[0])}window.fetch=function(e,t){var a;if(!navigator.onLine&&"string"==typeof e&&-1!==e.indexOf("/api/anchor")){try{var n=t&&t.body?JSON.parse(t.body):{},r=u();r.push({hash:n.hash||n.data_hash||"UNKNOWN",record_type:n.record_type||"QUEUED_ANCHOR",branch:n.branch||"JOINT",timestamp:(new Date).toISOString(),synced:!1}),h(r),_("Offline: anchor queued locally. Will sync when reconnected.","info")}catch(o){void 0}return Promise.resolve(new Response(JSON.stringify({status:"queued_offline",message:"Hash queued for offline sync.",record:{tx_hash:"OFFLINE_"+Date.now().toString(36).toUpperCase(),network:"Queued Offline"}}),{status:200,headers:{"Content-Type":"application/json"}}))}return A.apply(this,arguments)},window.addEventListener("online",function(){g(),_("Connection restored. Auto-syncing offline queue...","success"),setTimeout(function(){var e,t;u().filter(function(e){return!e.synced}).length>0&&E()},2e3)}),window.addEventListener("offline",function(){g(),_("Connection lost. Anchors will be queued locally.","warning")}),document.addEventListener("DOMContentLoaded",function(){g()});var R=null,O=null,M=0;function B(e){var t=document.getElementById("dropFileName");t&&(t.style.display="block",t.innerHTML='<i class="fas fa-file" style="margin-right:6px;"></i>'+e.name+" ("+(e.size/1024).toFixed(1)+" KB)"),O=e.name,M=e.size;var a=new FileReader;if(a.onload=function(a){sha256Binary(a.target.result).then(function(a){R=a,t&&(t.innerHTML='<i class="fas fa-file" style="margin-right:6px;"></i>'+e.name+" ("+(e.size/1024).toFixed(1)+' KB)<div style="font-size:0.7rem;color:var(--muted);font-family:monospace;margin-top:4px;">SHA-256: '+a.substring(0,32)+"...</div>")})},a.readAsArrayBuffer(e),e.type.startsWith("text/")||e.name.match(/\.(txt|csv|json|xml|md|html|log|yaml|yml)$/i)){var n=new FileReader;n.onload=function(e){document.getElementById("recordInput").value=e.target.result.substring(0,1e4)},n.readAsText(e)}else document.getElementById("recordInput").value="FILE: "+e.name+" | SIZE: "+(e.size/1024).toFixed(1)+" KB | Binary file — SHA-256 hash computed from raw bytes"}var F={};function k(e){F[e]&&(F[e].destroy(),delete F[e])}function D(e,t){k(e);var a=document.getElementById(e);if(!a)return null;var n={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"#8ea4b8",font:{family:"Inter",size:11,weight:"600"},padding:16,usePointStyle:!0,pointStyle:"circle"}},tooltip:{backgroundColor:"#16161f",titleColor:"#fff",bodyColor:"#8ea4b8",borderColor:"rgba(0,170,255,0.2)",borderWidth:1,padding:12,cornerRadius:8,titleFont:{weight:"700"},bodyFont:{size:12}}},scales:{}};return"bar"!==t.type&&"line"!==t.type||(n.scales={x:{grid:{color:"rgba(255,255,255,0.03)",drawBorder:!1},ticks:{color:"#8ea4b8",font:{size:10}}},y:{grid:{color:"rgba(255,255,255,0.03)",drawBorder:!1},ticks:{color:"#8ea4b8",font:{size:10}}}}),t.options=t.options||{},t.options.responsive=n.responsive,t.options.maintainAspectRatio=n.maintainAspectRatio,t.options.plugins=Object.assign({},n.plugins,t.options.plugins||{}),n.scales.x&&!t.options.scales&&(t.options.scales=n.scales),"function"==typeof _s4PatchChartTheme&&(t=_s4PatchChartTheme(t)),F[e]=new Chart(a.getContext("2d"),t),F[e]}var N="#00aaff",P="#c9a84c",q="#ff4444",z="#00cc66",H="#ff8c00",U="#8b5cf6",j="#14b8a6",J="#f472b6",Q=["#00aaff","#c9a84c","#ff4444","#00cc66","#ff8c00","#8b5cf6","#14b8a6","#f472b6","rgba(0,170,255,0.5)","rgba(201,168,76,0.5)"];function G(e,t,a,n,r){a=a||"",n=n||"",r=r||800;var o=0,i=null;function s(o){i||(i=o);var l=Math.min((o-i)/r,1),c=1-Math.pow(1-l,3),d=Math.round(0+(t-0)*c);e.textContent=a+d.toLocaleString()+n,l<1&&requestAnimationFrame(s)}requestAnimationFrame(s)}function V(){var e=document.getElementById("gapRadarChart"),t=document.getElementById("gapBarChart");if(e&&t){var a=document.getElementById("gapChartsRow"),n,r;a&&(a.style.display="flex"),"undefined"!=typeof ilsResults&&ilsResults&&ilsResults.elements&&Object.keys(ilsResults.elements).length>0?r=(n=Object.keys(ilsResults.elements)).map(function(e){return ilsResults.elements[e]&&"number"==typeof ilsResults.elements[e].score?ilsResults.elements[e].score:0}):(n=["Supply Support","Maintenance Planning","Tech Data","Training","Config Mgmt","DMSMS","PHS&T","Reliability","Support Equipment","Manpower"],r=[72,58,85,44,91,35,67,78,52,63]),e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"radar",data:{labels:n.map(function(e){return e.replace(/_/g," ").replace(/\b\w/g,function(e){return e.toUpperCase()})}),datasets:[{label:"ILS Element Coverage %",data:r,backgroundColor:"rgba(0,170,255,0.12)",borderColor:"#00aaff",borderWidth:2,pointBackgroundColor:"#00aaff",pointBorderColor:"#fff",pointRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{r:{min:0,max:100,ticks:{display:!1},grid:{color:"rgba(255,255,255,0.06)"},angleLines:{color:"rgba(255,255,255,0.06)"},pointLabels:{color:"#8ea4b8",font:{size:10}}}},plugins:{legend:{display:!1}}}});var o=r.map(function(e){return e>=80?"#00cc66":e>=50?"#ffa500":"#ff4444"});t.__chartInstance&&t.__chartInstance.destroy(),t.__chartInstance=new Chart(t,{type:"bar",data:{labels:n.map(function(e){return e.replace(/_/g," ").replace(/\b\w/g,function(e){return e.toUpperCase()})}),datasets:[{label:"Score",data:r,backgroundColor:o,borderRadius:6,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{min:0,max:100,grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8"}},y:{ticks:{color:"#8ea4b8",font:{size:10}},grid:{display:!1}}},plugins:{legend:{display:!1}}}})}}function W(){var e=document.getElementById("dmsmsPieChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"doughnut",data:{labels:["Active","At Risk","Obsolete","Resolved","Monitoring"],datasets:[{data:window._dmsmsChartData&&window._dmsmsChartData.reduce(function(e,t){return e+t},0)>0?window._dmsmsChartData:[45,18,12,20,5],backgroundColor:["#00cc66","#ffa500","#ff4444","#00aaff","#8ea4b8"],borderWidth:0,hoverOffset:8}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"55%",plugins:{legend:{position:"bottom",labels:{color:"#8ea4b8",padding:12,usePointStyle:!0,pointStyle:"circle",font:{size:11}}}}}}))}function $(){var e=document.getElementById("readinessGauge");if(e){var t=.87;if("number"!=typeof window._readinessAo||isNaN(window._readinessAo)){var a=document.getElementById("readinessAo")||document.getElementById("statAo");if(a&&a.textContent&&"—"!==a.textContent){var n=parseFloat(a.textContent);isNaN(n)||(t=n>1?n/100:n)}}else t=window._readinessAo;e.__chartInstance&&e.__chartInstance.destroy();var r=Math.round(100*t),o=Math.min(100,r+8),i=Math.min(100,r-3),s=Math.min(100,r-10),l=Math.min(100,r+12),c=Math.min(100,r+2),d=Math.min(100,r+5),u=[o,i,s,l,c,d].map(function(e){return e>=90?"rgba(0,204,102,0.7)":e>=75?"rgba(0,170,255,0.6)":e>=60?"rgba(255,165,0,0.6)":"rgba(255,68,68,0.6)"});e.__chartInstance=new Chart(e,{type:"bar",data:{labels:["Personnel","Equipment","Supply","Training","Maintenance","C4ISR"],datasets:[{label:"Readiness %",data:[o,i,s,l,c,d],backgroundColor:u,borderColor:u.map(function(e){return e.replace("0.7","1").replace("0.6","1")}),borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){return e.parsed.y+"%"}}}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:11}},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:10},callback:function(e){return e+"%"}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0,max:100}}}})}}function K(){var e=document.getElementById("complianceRadarChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"radar",data:{labels:["CMMC L2","NIST 800-171","DFARS 7012","ITAR","FIPS 140-2","FedRAMP","IL4/IL5"],datasets:[{label:"Current Posture",data:window._complianceScores&&window._complianceScores.reduce(function(e,t){return e+t},0)>0?window._complianceScores:[78,85,92,88,70,65,82],backgroundColor:"rgba(0,170,255,0.12)",borderColor:"#00aaff",borderWidth:2,pointBackgroundColor:"#00aaff",pointRadius:4},{label:"Target",data:[95,95,100,100,90,85,95],backgroundColor:"rgba(201,168,76,0.06)",borderColor:"rgba(201,168,76,0.5)",borderWidth:1,borderDash:[4,4],pointRadius:2}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{r:{min:0,max:100,ticks:{display:!1},grid:{color:"rgba(255,255,255,0.06)"},angleLines:{color:"rgba(255,255,255,0.06)"},pointLabels:{color:"#8ea4b8",font:{size:10}}}},plugins:{legend:{labels:{color:"#8ea4b8",usePointStyle:!0,font:{size:11}}}}}}))}function Y(){var e=document.getElementById("roiLineChart");if(e){var t;if(e.getAttribute("data-bp-rendered")&&e.removeAttribute("data-bp-rendered"),document.getElementById("hub-roi")&&"undefined"!=typeof Chart){var a=null;try{a=Chart.getChart(e)}catch(w){}if(a&&a.data&&a.data.labels&&a.data.labels.length>=20)return}if(e.__chartInstance)try{e.__chartInstance.destroy()}catch(w){}for(var n=parseFloat((document.getElementById("roiFTEs")||{}).value)||8,r=parseFloat((document.getElementById("roiRate")||{}).value)||145,o=parseFloat((document.getElementById("roiAudit")||{}).value)||25e4,i=parseFloat((document.getElementById("roiError")||{}).value)||8500,s=parseFloat((document.getElementById("roiIncidents")||{}).value)||35,l=parseFloat((document.getElementById("roiLicense")||{}).value)||12e4,c,d,u,f=2080*n*r*.65+s*i*.9+.7*o,m=[],p=["Q1","Q2","Q3","Q4","Q5","Q6","Q7","Q8","Q9","Q10","Q11","Q12","Q13","Q14","Q15","Q16","Q17","Q18","Q19","Q20"],h=1;h<=20;h++){var g,y=f/4*(.2+.65*(1-Math.exp(-.18*h))),v=l/4,b=h>1?m[h-2]:0;m.push(Math.round(b+y-v))}e.__chartInstance=new Chart(e,{type:"line",data:{labels:p,datasets:[{label:"Cumulative ROI ($)",data:m,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.08)",fill:!0,tension:.3,borderWidth:2,pointBackgroundColor:"#00aaff",pointBorderColor:"#fff",pointRadius:5,pointHoverRadius:7},{label:"Break-Even Line",data:new Array(20).fill(0),borderColor:"rgba(255,255,255,0.2)",borderDash:[5,5],borderWidth:1,pointRadius:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8",callback:function(e){return"$"+(e/1e3).toFixed(0)+"K"}}},x:{grid:{display:!1},ticks:{color:"#8ea4b8"}}},plugins:{legend:{labels:{color:"#8ea4b8",usePointStyle:!0,font:{size:11}}}}}})}}function Z(){var e=document.getElementById("riskHeatChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"bar",data:{labels:["Supply Chain","Cyber/Data","Obsolescence","Financial","Regulatory","Operational"],datasets:[{label:"Risk Score",data:window._riskChartScores&&6===window._riskChartScores.length?window._riskChartScores:[78,62,85,45,55,71],backgroundColor:function(e){var t=e.raw;return t>=75?"rgba(255,68,68,0.7)":t>=50?"rgba(255,165,0,0.7)":"rgba(0,204,102,0.7)"},borderRadius:6,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{min:0,max:100,grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8"}},y:{ticks:{color:"#8ea4b8",font:{size:11}},grid:{display:!1}}},plugins:{legend:{display:!1}}}}))}function X(){var e=document.getElementById("lifecyclePieChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"doughnut",data:{labels:["Acquisition","Sustainment (O&S)","DMSMS / Obsol.","Disposal","Personnel","Training"],datasets:[{data:window._lifecycleChartData&&6===window._lifecycleChartData.length?window._lifecycleChartData:[28,42,12,5,8,5],backgroundColor:["#00aaff","#c9a84c","#ff4444","#8ea4b8","#00cc66","#9b59b6"],borderWidth:0,hoverOffset:8}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"50%",plugins:{legend:{position:"bottom",labels:{color:"#8ea4b8",padding:12,usePointStyle:!0,pointStyle:"circle",font:{size:11}}}}}}))}function ee(){var e={"hub-analysis":{target:"ilsResult",charts:'<div class="row mt-3" id="gapChartsRow"><div class="col-md-6"><div class="chart-container"><div class="chart-title"><i class="fas fa-chart-pie"></i> ILS Element Coverage</div><canvas id="gapRadarChart" height="240"></canvas></div></div><div class="col-md-6"><div class="chart-container"><div class="chart-title"><i class="fas fa-chart-bar"></i> Element Scores</div><canvas id="gapBarChart" height="240"></canvas></div></div></div>'},"hub-dmsms":{target:null,charts:'<div class="chart-container mt-3" id="dmsmsChartArea"><div class="chart-title"><i class="fas fa-chart-pie"></i> Obsolescence Risk Distribution</div><canvas id="dmsmsPieChart" height="200"></canvas></div>'},"hub-readiness":{target:null,charts:'<div class="chart-container mt-3" style="max-width:100%" id="readinessGaugeArea"><div class="chart-title"><i class="fas fa-gauge-high"></i> Operational Availability</div><canvas id="readinessGauge" height="300"></canvas></div>'},"hub-compliance":{target:null,charts:'<div class="chart-container mt-3" id="complianceChartArea"><div class="chart-title"><i class="fas fa-shield-halved"></i> Compliance Framework Radar</div><canvas id="complianceRadarChart" height="250"></canvas></div>'},"hub-roi":{target:null,charts:'<div class="chart-container mt-3" id="roiChartArea"><div class="chart-title"><i class="fas fa-chart-line"></i> ROI Projection — 5 Year Cumulative</div><canvas id="roiLineChart" height="220"></canvas></div>'},"hub-risk":{target:null,charts:'<div class="chart-container mt-3" id="riskChartArea"><div class="chart-title"><i class="fas fa-triangle-exclamation"></i> Risk Category Assessment</div><canvas id="riskHeatChart" height="220"></canvas></div>'},"hub-lifecycle":{target:null,charts:'<div class="chart-container mt-3" id="lifecycleChartArea"><div class="chart-title"><i class="fas fa-chart-pie"></i> Total Ownership Cost Breakdown</div><canvas id="lifecyclePieChart" height="220"></canvas></div>'}};Object.keys(e).forEach(function(t){var a=e[t],n=document.getElementById(t);if(n&&!n.getAttribute("data-charts-injected")){var r=a.charts.match(/id="([^"]+)"/);if(r&&document.getElementById(r[1]))return n.setAttribute("data-charts-injected","1"),void 0;var o=n.querySelector(".s4-card");if(o){if(a.target){var i=document.getElementById(a.target),s;if(i)return(s=document.createElement("div")).innerHTML=a.charts,i.parentNode.insertBefore(s.firstElementChild,i.nextSibling),n.setAttribute("data-charts-injected","1"),void 0}var s;(s=document.createElement("div")).innerHTML=a.charts,o.appendChild(s.firstElementChild),n.setAttribute("data-charts-injected","1")}}})}var te=openILSTool;openILSTool=function(e){te(e),ee(),setTimeout(function(){"hub-analysis"===e&&ilsResults&&V(),"hub-dmsms"===e&&W(),"hub-readiness"===e&&$(),"hub-compliance"===e&&K(),"hub-roi"===e&&Y(),"hub-risk"===e&&Z(),"hub-lifecycle"===e&&X()},300)};var ae=switchHubTab;switchHubTab=function(e,t){ae(e,t),ee(),setTimeout(function(){"hub-analysis"===e&&"undefined"!=typeof ilsResults&&ilsResults&&V(),"hub-dmsms"===e&&W(),"hub-readiness"===e&&$(),"hub-compliance"===e&&K(),"hub-roi"===e&&Y(),"hub-risk"===e&&Z(),"hub-lifecycle"===e&&X()},300)};var ne=null,re,oe,ie,se;function le(){var e=(document.getElementById("lifecycleProgram")||{}).value||"ddg51",t=parseFloat((document.getElementById("lcServiceLife")||{}).value)||30,a=parseFloat((document.getElementById("lcOpHours")||{}).value)||2500,n=parseFloat((document.getElementById("lcAcqCost")||{}).value)||85,r=parseFloat((document.getElementById("lcFleetSize")||{}).value)||20,o,i=n*r,s,l=i*((parseFloat((document.getElementById("lcSustRate")||{}).value)||8)/100)*t,c,d=l*(.12+(t>25?.04:0)),u=.05*i,f=.18*l,m=.08*l,p=i+l+d+u+f+m,h=a*r*t,g=h>0?p/h:0;function y(e){return e>=1e3?"$"+(e/1e3).toFixed(1)+"B":"$"+e.toFixed(0)+"M"}var v=function(e){return document.getElementById(e)};v("lcTotalCost")&&(v("lcTotalCost").textContent=y(p)),v("lcSustCost")&&(v("lcSustCost").textContent=y(l)),v("lcDmsmsCost")&&(v("lcDmsmsCost").textContent=y(d)),v("lcCostPerHr")&&(v("lcCostPerHr").textContent="$"+g.toFixed(0)+"/hr");var b=Math.round(i/p*100),w=Math.round(l/p*100),S=Math.round(d/p*100),C=Math.round(u/p*100),I=Math.round(f/p*100),x=Math.round(m/p*100);window._lifecycleChartData=[b,w,S,C,I,x];var E=v("lifecycleOutput");if(E){var A=window.S4_PLATFORMS&&S4_PLATFORMS[e]?S4_PLATFORMS[e].n:e.toUpperCase();E.innerHTML='<div style="background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:20px;margin-top:12px"><div class="section-label"><i class="fas fa-clock"></i> LIFECYCLE COST BREAKDOWN — '+A+'</div><div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;font-size:0.85rem;margin-bottom:16px"><div><span style="color:var(--steel)">Acquisition ('+b+'%)</span><br><strong style="color:#00aaff">'+y(i)+'</strong></div><div><span style="color:var(--steel)">Sustainment ('+w+'%)</span><br><strong style="color:#c9a84c">'+y(l)+'</strong></div><div><span style="color:var(--steel)">DMSMS/Obsol ('+S+'%)</span><br><strong style="color:#ff4444">'+y(d)+'</strong></div><div><span style="color:var(--steel)">Disposal ('+C+'%)</span><br><strong style="color:#8ea4b8">'+y(u)+'</strong></div><div><span style="color:var(--steel)">Personnel ('+I+'%)</span><br><strong style="color:#00cc66">'+y(f)+'</strong></div><div><span style="color:var(--steel)">Training ('+x+'%)</span><br><strong style="color:#9b59b6">'+y(m)+'</strong></div></div><hr style="border-color:var(--border);margin:12px 0"><div style="display:flex;justify-content:space-between;align-items:center"><div><span style="color:var(--steel);font-size:0.82rem">Total Ownership Cost</span><br><span style="font-size:1.5rem;font-weight:800;color:#00aaff">'+y(p)+'</span></div><div><span style="color:var(--steel);font-size:0.82rem">Cost per Op Hour</span><br><span style="font-size:1.1rem;font-weight:700;color:var(--accent)">$'+g.toFixed(0)+'/hr</span></div><div><span style="color:var(--steel);font-size:0.82rem">Fleet Size</span><br><span style="font-size:1.1rem;font-weight:700;color:#fff">'+r+" units × "+t+" yrs</span></div></div></div>"}1,setTimeout(X,300)}function ce(){var e=(document.getElementById("lifecycleProgram")||{}).value||"ddg51",t=window.S4_PLATFORMS&&S4_PLATFORMS[e]?S4_PLATFORMS[e].n:e.toUpperCase(),a=parseFloat((document.getElementById("lcServiceLife")||{}).value)||30,n=parseFloat((document.getElementById("lcAcqCost")||{}).value)||85,r=parseFloat((document.getElementById("lcFleetSize")||{}).value)||20,o=parseFloat((document.getElementById("lcSustRate")||{}).value)||8,i=n*r,s=i*(o/100)*a,l=s*(.12+(a>25?.04:0)),c=i+s+l+.05*i+.18*s+.08*s,d="S4 LEDGER — LIFECYCLE COST REPORT\n================================\n\nPlatform: "+t+"\nFleet Size: "+r+" units\nService Life: "+a+" years\nSustainment Rate: "+o+"%\n\nAcquisition: $"+i.toFixed(0)+"M\nSustainment: $"+s.toFixed(0)+"M\nDMSMS/Obsolescence: $"+l.toFixed(0)+"M\nTotal Ownership Cost: $"+c.toFixed(0)+"M\n\nGenerated: "+(new Date).toISOString()+"\n",u=new Blob([d],{type:"text/plain"}),f=document.createElement("a");f.href=URL.createObjectURL(u),f.download="S4_Lifecycle_"+t.replace(/\s+/g,"_")+"_"+(new Date).toISOString().substring(0,10)+".txt",f.click(),URL.revokeObjectURL(f.href),"function"==typeof s4Notify&&s4Notify("Exported","Lifecycle cost report downloaded.","success")}async function de(){var e=(document.getElementById("lifecycleProgram")||{}).value||"ddg51",t=window.S4_PLATFORMS&&S4_PLATFORMS[e]?S4_PLATFORMS[e].n:e.toUpperCase(),a=parseFloat((document.getElementById("lcServiceLife")||{}).value)||30,n=parseFloat((document.getElementById("lcAcqCost")||{}).value)||85,r=parseFloat((document.getElementById("lcFleetSize")||{}).value)||20,o,i=n*r,s=i*((parseFloat((document.getElementById("lcSustRate")||{}).value)||8)/100)*a,l,c,d="Lifecycle Cost | Program: "+t+" | Fleet: "+r+" | TOC: $"+(i+s+s*(.12+(a>25?.04:0))+.05*i+.18*s+.08*s).toFixed(0)+"M | Date: "+(new Date).toISOString(),u=await sha256(d);showAnchorAnimation(u,"Lifecycle Cost Report","CUI"),stats.anchored++,stats.types.add("LIFECYCLE_COST"),stats.slsFees=Math.round(100*(stats.slsFees+.01))/100,updateStats(),saveStats();var f=await _anchorToXRPL(u,"LIFECYCLE_COST",d.substring(0,100)),m={hash:u,type:"LIFECYCLE_COST",branch:"JOINT",timestamp:(new Date).toISOString(),label:"Lifecycle Cost — "+t,txHash:f.txHash};sessionRecords.push(m),saveLocalRecord({hash:u,record_type:"LIFECYCLE_COST",record_label:"Lifecycle Cost — "+t,branch:"JOINT",timestamp:(new Date).toISOString(),timestamp_display:(new Date).toISOString().replace("T"," ").substring(0,19)+" UTC",fee:.01,tx_hash:f.txHash,system:"Lifecycle Cost Estimator",explorer_url:f.explorerUrl,network:f.network}),addToVault({hash:u,txHash:f.txHash,type:"LIFECYCLE_COST",label:"Lifecycle Cost — "+t,branch:"JOINT",icon:'<i class="fas fa-clock"></i>',content:d.substring(0,100),encrypted:!1,timestamp:(new Date).toISOString(),source:"Lifecycle Cost Estimator",fee:.01,explorerUrl:f.explorerUrl,network:f.network}),updateTxLog(),_updateSlsBalance(),setTimeout(function(){document.getElementById("animStatus").innerHTML='<i class="fas fa-check-circle" style="color:var(--accent)"></i> Lifecycle report anchored!',document.getElementById("animStatus").style.color="#00aaff"},2200),await new Promise(function(e){setTimeout(e,3200)}),hideAnchorAnimation(),"function"==typeof s4Notify&&s4Notify("Anchored","Lifecycle cost report anchored to XRPL.","success")}function ue(e){(oe+=e)>11&&(oe=0,re++),oe<0&&(oe=11,re--),fe()}function fe(){var e=document.getElementById("actionCalendarGrid"),t=document.getElementById("calMonthLabel");if(e&&t){if(void 0===re||null==re){var a=new Date;re=a.getFullYear(),oe=a.getMonth()}var n=["January","February","March","April","May","June","July","August","September","October","November","December"];t.textContent=n[oe]+" "+re;var r=new Date(re,oe,1).getDay(),o=new Date(re,oe+1,0).getDate(),i=new Date,s=i.getFullYear()===re&&i.getMonth()===oe,l={};try{var c;("undefined"!=typeof s4ActionItems&&s4ActionItems.length>0?s4ActionItems:JSON.parse(localStorage.getItem("s4ActionItems")||"[]")).forEach(function(e){var t=e.due||e.schedule||"";if(t){var a=new Date(t);if(!isNaN(a.getTime())&&a.getFullYear()===re&&a.getMonth()===oe){var n=a.getDate();l[n]||(l[n]=[]),l[n].push(e)}}})}catch(v){}var d="";["Su","Mo","Tu","We","Th","Fr","Sa"].forEach(function(e){d+='<div style="padding:4px;font-weight:700;color:var(--steel);font-size:0.7rem">'+e+"</div>"});for(var u=0;u<r;u++)d+='<div style="padding:6px"></div>';for(var f=1;f<=o;f++){var m=s&&f===i.getDate(),p=l[f],h=m?"rgba(0,170,255,0.2)":p?"rgba(0,170,255,0.06)":"var(--surface)",g=m?"1px solid var(--accent)":p?"1px solid rgba(0,170,255,0.15)":"1px solid var(--border)",y="";p&&p.forEach(function(e){var t="critical"===e.severity?"#ff3333":"warning"===e.severity?"#ffa500":"#00aaff";y+='<span style="display:inline-block;width:4px;height:4px;border-radius:50%;background:'+t+';margin:0 1px"></span>'}),d+='<div onclick="showCalDay('+f+')" style="padding:4px 2px;background:'+h+";border:"+g+";border-radius:4px;cursor:"+(p?"pointer":"default")+';min-height:32px"><div style="color:'+(m?"#00aaff":"#fff")+";font-weight:"+(m?"800":"400")+'">'+f+"</div>"+(y?'<div style="margin-top:2px">'+y+"</div>":"")+"</div>"}e.innerHTML=d}}function me(e){var t=document.getElementById("calDayDetail");if(t){var a={},n;try{var n;(n="undefined"!=typeof s4ActionItems&&s4ActionItems.length>0?s4ActionItems:JSON.parse(localStorage.getItem("s4ActionItems")||"[]")).forEach(function(e){var t=e.due||e.schedule||"";if(t){var n=new Date(t);if(!isNaN(n.getTime())&&n.getFullYear()===re&&n.getMonth()===oe){var r=n.getDate();a[r]||(a[r]=[]),a[r].push(e)}}})}catch(i){}if(0===(n=a[e]||[]).length)return t.style.display="none",void 0;var r,o='<div style="font-weight:700;color:#fff;margin-bottom:6px"><i class="fas fa-calendar-day" style="color:var(--accent);margin-right:4px"></i>'+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][oe]+" "+e+", "+re+"</div>";n.forEach(function(e){var t="critical"===e.severity?"#ff3333":"warning"===e.severity?"#ffa500":"#00aaff";o+='<div style="padding:6px 8px;background:rgba(0,0,0,0.2);border-left:3px solid '+t+';border-radius:4px;margin-bottom:4px"><div style="font-weight:600;color:#fff;font-size:0.8rem">'+(e.title||"Action Item")+"</div>"+(e.owner?'<div style="font-size:0.72rem;color:var(--steel)">Owner: '+e.owner+"</div>":"")+"</div>"}),t.innerHTML=o,t.style.display="block"}}function pe(){var e=document.getElementById("actionCalendarGrid"),t=document.getElementById("calMonthLabel");if(!e||!t)return setTimeout(pe,500),void 0;fe(),e.innerHTML&&""!==e.innerHTML.trim()||setTimeout(fe,300)}"function"==typeof showILSResults&&(ne=showILSResults,showILSResults=function(){ne.apply(this,arguments);var e=document.getElementById("gapChartsRow");e&&(e.style.display="flex"),setTimeout(V,500)}),function(){function e(e){var t=document.getElementById(e);if(t&&!t.dataset.uxDone){t.dataset.uxDone="1",t.querySelectorAll("details").forEach(function(e){e.removeAttribute("style")}),t.querySelectorAll("details summary").forEach(function(e){e.removeAttribute("style")}),t.querySelectorAll("details > div").forEach(function(e){e.removeAttribute("style")}),t.querySelectorAll("h3 > i[style], h4 > i[style]").forEach(function(e){e.removeAttribute("style")});var a=t.querySelectorAll(".s4-card");a.forEach(function(e){var t=e.querySelector("h3, h4");if(t){var a=t.nextElementSibling,n=e.querySelector(".hub-tool-header");n&&(a=n.nextElementSibling),a&&"P"===a.tagName&&a.getAttribute("style")&&a.removeAttribute("style")}}),t.querySelectorAll("button[style]").forEach(function(e){if(!(e.closest(".ils-dropzone")||e.closest(".post-actions")||e.closest(".post-action-btn"))&&"none"!==e.style.display){var t=e.textContent.toLowerCase(),a=t.includes("anchor")||t.includes("xrpl"),n=t.includes("export")||t.includes("download")||t.includes("generate"),r=t.includes("run ")||t.includes("analyze")||t.includes("calculate"),o;if(!(t.includes("clear")||t.includes("delete"))){var i=e.innerHTML,s=e.getAttribute("onclick");a||r?(e.removeAttribute("style"),e.className="btn-anchor"):n&&(e.removeAttribute("style"),e.className="btn-export")}}}),t.querySelectorAll("div[style]").forEach(function(e){var t=e.getAttribute("style")||"",a;t.includes("display:flex")&&t.includes("gap:10")&&t.includes("flex-wrap:wrap")&&!e.classList.contains("ils-dropzone")&&!e.querySelector(".ils-dropzone")&&!e.closest(".post-actions")&&(e.querySelectorAll("button").length>0&&(e.className="tool-actions-bar",e.removeAttribute("style")))}),a.forEach(function(e){var t=e.querySelectorAll(":scope > label, :scope > .row > .col-md-6 > label"),a=e.querySelector(":scope > label");if(a&&!a.previousElementSibling?.classList?.contains("section-label")){var n=document.createElement("div");n.className="section-label",n.innerHTML='<i class="fas fa-sliders"></i> CONFIGURATION';var r=document.createElement("hr");r.className="section-divider",a.parentNode.insertBefore(r,a),a.parentNode.insertBefore(n,r)}var o=e.querySelector('[id$="Results"], [id$="Output"], [id$="result"], [id$="Result"]');if(o&&!o.previousElementSibling?.classList?.contains("section-label")){var i=document.createElement("div");i.className="section-label",i.innerHTML='<i class="fas fa-chart-bar"></i> RESULTS';var s=document.createElement("hr");s.className="section-divider",o.parentNode.insertBefore(s,o),o.parentNode.insertBefore(i,s)}var l=e.querySelector(".tool-actions-bar");if(l&&!l.previousElementSibling?.classList?.contains("section-label")){var c=document.createElement("div");c.className="section-label",c.innerHTML='<i class="fas fa-bolt"></i> ACTIONS',l.parentNode.insertBefore(c,l)}});var n=t.querySelector(".s4-card");if(n){var r,o;if(!("hub-analysis"===e||"hub-actions"===e)){for(var i=n.querySelectorAll(":scope > .row"),s=null,l=0;l<i.length;l++){var c=i[l];if(c.querySelectorAll(".stat-mini").length>=3){s=c;break}}if(s){var d=n.querySelector(".hub-tool-header")||n.querySelector("h3, h4");if(d){var u=d;s.style.cssText="",s.classList.add("mb-3"),u.parentNode.insertBefore(s,u.nextSibling)}}}if("hub-actions"===e){var f=n.querySelector(".col-lg-8");if(f){var m=f.querySelector(".s4-card");if(m){for(var p=null,h=m.querySelectorAll(":scope > .row"),g=0;g<h.length;g++)if(h[g].querySelectorAll(".stat-mini").length>=3){p=h[g];break}if(p){var y=m.querySelector("h3");y&&(p.style.cssText="",p.classList.add("mb-3"),y.parentNode.insertBefore(p,y.nextSibling))}}}}t.querySelectorAll("input[style], select[style]").forEach(function(e){"file"!==e.type&&"hidden"!==e.type&&"none"!==e.style.display&&e.removeAttribute("style")}),t.querySelectorAll(".chart-container").forEach(function(e){e.style.display="block"});var v=t.querySelector("#gapChartsRow");v&&(v.style.display="flex")}}}var t=openILSTool;openILSTool=function(a){t(a),setTimeout(function(){e(a)},100)};var a=switchHubTab;switchHubTab=function(t,n){a(t,n),setTimeout(function(){e(t)},100)},document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){document.querySelectorAll('.ils-hub-panel.active, .ils-hub-panel[style*="display:block"], .ils-hub-panel[style*="display: block"]').forEach(function(t){e(t.id)})},2500)})}(),document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector('a[href="#tabILS"]');e&&e.addEventListener("shown.bs.tab",function(){updateAiContext(currentHubPanel||"hub-analysis")})}),function e(){var t=new Date;re=t.getFullYear(),oe=t.getMonth()}(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){setTimeout(pe,800)}):setTimeout(pe,800),ie=new MutationObserver(function(e){e.forEach(function(e){if("attributes"===e.type&&"style"===e.attributeName){var t=e.target;"hub-actions"===t.id&&"none"!==t.style.display&&setTimeout(fe,150)}})}),(se=document.getElementById("hub-actions"))?ie.observe(se,{attributes:!0,attributeFilter:["style"]}):document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("hub-actions");e&&ie.observe(e,{attributes:!0,attributeFilter:["style"]})}),window.anchorLifecycle=de,window.calcLifecycle=le,window.changeCalMonth=ue,window.exportLifecycle=ce,window.handleFileSelect=L,window.injectChartContainers=ee,window.loadPerformanceMetrics=a,window.offlineClearQueue=w,window.offlineQueueHash=v,window.offlineRemoveItem=b,window.handleFileDrop=T,window.offlineSyncAll=S,window.renderGapAnalysisCharts=V,window.renderDMSMSCharts=W,window.renderReadinessCharts=$,window.renderComplianceCharts=K,window.renderROICharts=Y,window.renderRiskCharts=Z,window.renderLifecycleCharts=X,window.showCalDay=me,window._showNotif=_,function(){var e={lcp:null,fid:null,cls:0,inp:null,ttfb:null,entries:[]},t=window.S4=window.S4||{};function a(t,a){e.entries.push({name:t,value:Math.round(100*a)/100,ts:Date.now()})}t.vitals=e;try{var n=performance.getEntriesByType("navigation");n&&n[0]&&(e.ttfb=Math.round(n[0].responseStart),a("TTFB",e.ttfb))}catch(c){}try{var r;if("PerformanceObserver"in window)new PerformanceObserver(function(t){var n=t.getEntries(),r=n[n.length-1];r&&(e.lcp=Math.round(r.startTime),a("LCP",e.lcp))}).observe({type:"largest-contentful-paint",buffered:!0})}catch(c){}try{if("PerformanceObserver"in window){var o=new PerformanceObserver(function(t){var n=t.getEntries();n[0]&&(e.fid=Math.round(n[0].processingStart-n[0].startTime),a("FID",e.fid),o.disconnect())});o.observe({type:"first-input",buffered:!0})}}catch(c){}try{var i;if("PerformanceObserver"in window)new PerformanceObserver(function(t){var n;t.getEntries().forEach(function(t){t.hadRecentInput||(e.cls+=t.value)}),e.cls=Math.round(1e4*e.cls)/1e4,a("CLS",e.cls)}).observe({type:"layout-shift",buffered:!0})}catch(c){}try{var s;if("PerformanceObserver"in window)new PerformanceObserver(function(t){var n;t.getEntries().forEach(function(t){var n=t.duration;(null===e.inp||n>e.inp)&&(e.inp=Math.round(n),a("INP",e.inp))})}).observe({type:"event",buffered:!0,durationThreshold:40})}catch(c){}function l(){var t=0,a=0;if(null!==e.lcp&&(t+=e.lcp<=2500?1:e.lcp<=4e3?.5:0,a++),null!==e.fid&&(t+=e.fid<=100?1:e.fid<=300?.5:0,a++),null!==e.cls&&(t+=e.cls<=.1?1:e.cls<=.25?.5:0,a++),null!==e.inp&&(t+=e.inp<=200?1:e.inp<=500?.5:0,a++),0===a)return"n/a";var n=Math.round(t/a*100);return n>=90?"Good":n>=50?"Needs Improvement":"Poor"}t.vitals.summary=function(){return{TTFB:null!==e.ttfb?e.ttfb+"ms":"n/a",LCP:null!==e.lcp?e.lcp+"ms":"n/a",FID:null!==e.fid?e.fid+"ms":"n/a",CLS:e.cls.toFixed(4),INP:null!==e.inp?e.inp+"ms":"n/a",grade:l()}}}();
