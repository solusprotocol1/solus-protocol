import"./engine-BjG9HHxX.js";import"./enhancements-BaPcmpDQ.js";!function e(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&o(e)}).observe(document,{childList:!0,subtree:!0})}function n(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}function o(e){if(e.ep)return;e.ep=!0;const t=n(e);fetch(e.href,t)}}(),window.supabase&&(window._sbClient=window.supabase.createClient("https://ysmwkkdpjgjokukxolel.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlzbXdra2Rwamdqb2t1a3hvbGVsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwMzA3NDQsImV4cCI6MjA4NzYwNjc0NH0.4u56RJ61Q5cqnqMqIEWwg50q6MlV8bEvueA45enQgxE")),document.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()},!1),document.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation()},!1),window.S4=window.S4||{version:"5.12.0",env:"production",buildDate:"2026-02-26",modules:{},register:function(e,t){this.modules[e]=t},getModule:function(e){return this.modules[e]||null}},function(){S4.metrics={_data:{lcp:null,fid:null,cls:0,ttfb:null,fcp:null,errors:[],apiLatency:[]},_startTime:performance.now(),record:function(e,t){this._data[e]=t},addApiLatency:function(e,t){this._data.apiLatency.push({endpoint:e,ms:t,ts:Date.now()}),this._data.apiLatency.length>200&&this._data.apiLatency.shift()},getReport:function(){return Object.assign({},this._data,{uptime:Math.round((performance.now()-this._startTime)/1e3),memoryMB:performance.memory?Math.round(performance.memory.usedJSHeapSize/1048576):null,version:S4.version,env:S4.env,timestamp:(new Date).toISOString()})}};try{"undefined"!=typeof PerformanceObserver&&(new PerformanceObserver(function(e){var t=e.getEntries();t.length>0&&S4.metrics.record("lcp",Math.round(t[t.length-1].startTime))}).observe({type:"largest-contentful-paint",buffered:!0}),new PerformanceObserver(function(e){var t=e.getEntries();t.length>0&&S4.metrics.record("fid",Math.round(t[0].processingStart-t[0].startTime))}).observe({type:"first-input",buffered:!0}),new PerformanceObserver(function(e){var t;e.getEntries().forEach(function(e){e.hadRecentInput||(S4.metrics._data.cls+=e.value)}),S4.metrics._data.cls=Math.round(1e3*S4.metrics._data.cls)/1e3}).observe({type:"layout-shift",buffered:!0}),new PerformanceObserver(function(e){var t;e.getEntries().forEach(function(e){"first-contentful-paint"===e.name&&S4.metrics.record("fcp",Math.round(e.startTime))})}).observe({type:"paint",buffered:!0}))}catch(t){}window.addEventListener("load",function(){try{var e=performance.getEntriesByType("navigation")[0];e&&S4.metrics.record("ttfb",Math.round(e.responseStart-e.requestStart))}catch(t){}}),S4.errorReporter={_queue:[],_maxQueue:50,report:function(e){var t={message:"string"==typeof e?e:e.message||"Unknown error",stack:e.stack||null,url:window.location.href,timestamp:(new Date).toISOString(),version:S4.version,userAgent:navigator.userAgent.substring(0,200)};this._queue.push(t),this._queue.length>this._maxQueue&&this._queue.shift(),console.error("[S4 Error]",t.message)},flush:async function(){if(0!==this._queue.length){var e=this._queue.splice(0);try{await fetch("/api/errors/report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({errors:e,session:sessionStorage.getItem("s4_session_id")||"unknown"})})}catch(t){this._queue=e.concat(this._queue)}}}},setInterval(function(){S4.errorReporter.flush()},6e4),window.addEventListener("beforeunload",function(){S4.errorReporter.flush()});var e=window.fetch;window.fetch=function(t,n){var o=performance.now(),a="string"==typeof t?t:t.url||"";if(a.startsWith("/api/"))if((n=n||{}).headers=n.headers||{},"function"==typeof n.headers.set);else{var r=sessionStorage.getItem("s4_auth_token");r&&(n.headers.Authorization="Bearer "+r);var i=S4.csrf?S4.csrf.getToken():null;i&&(n.headers["X-CSRF-Token"]=i),n.headers["X-S4-Version"]=S4.version,n.headers["X-S4-Client"]="web-prod"}return e.call(window,t,n).then(function(e){return a.startsWith("/api/")&&S4.metrics.addApiLatency(a.split("?")[0],Math.round(performance.now()-o)),e}).catch(function(e){throw a.startsWith("/api/")&&S4.metrics.addApiLatency(a.split("?")[0],-1),e})},S4.healthCheck=function(){var e={serviceWorker:"serviceWorker"in navigator,crypto:"undefined"!=typeof crypto&&void 0!==crypto.subtle,indexedDB:"undefined"!=typeof indexedDB,localStorage:function(){try{return localStorage.setItem("_hc","1"),localStorage.removeItem("_hc"),!0}catch(t){return!1}}(),webSocket:"undefined"!=typeof WebSocket,fetchAPI:"undefined"!=typeof fetch,webCrypto:"undefined"!=typeof crypto&&void 0!==crypto.subtle&&"function"==typeof crypto.subtle.digest,performance:"undefined"!=typeof PerformanceObserver};return e.allPassing=Object.values(e).every(function(e){return!0===e}),e},S4.register("monitoring",{version:"1.0.0",features:["web-vitals","error-reporter","api-interceptor","health-check"]}),console.log("[S4 Production] Monitoring module loaded — v"+S4.version+" ("+S4.env+")")}(),S4.i18n={locale:(navigator.language||"en").split("-")[0],catalogs:{en:{"app.name":"S4 Ledger","nav.platform":"Platform","nav.useCases":"Use Cases","nav.pricing":"Pricing","nav.company":"Company","nav.docs":"Docs","nav.contact":"Contact Us","anchor.title":"Anchor Channel","anchor.placeholder":"Or paste/type your defense logistics record here...","anchor.button":"Anchor Record","verify.title":"Verify Channel","verify.placeholder":"Paste the original defense record content here...","vault.title":"Audit Record Vault","vault.empty":"No anchored records yet. Records will appear here automatically as you anchor them.","vault.search":"Search records by type, hash, content...","vault.exportCSV":"Export CSV","vault.exportXLSX":"Export XLSX","vault.reverifyAll":"Re-Verify All","vault.clear":"Clear Vault","toast.missingContent":"Please enter record content.","toast.noProgram":"Please select a program first.","toast.noAnalysis":"Run analysis first.","toast.copied":"Copied to clipboard!","toast.exported":"records exported.","toast.verified":"records re-verified.","shortcuts.title":"Keyboard Shortcuts","search.placeholder":"Search records, vault, tools, documents...","search.noResults":"No results found"}},setLocale:function(e){this.locale=e},t:function(e){var t;return(this.catalogs[this.locale]||this.catalogs.en)[e]||this.catalogs.en[e]||e}},window.S4.t=S4.i18n.t.bind(S4.i18n);var e=[],t=null;function n(){if(0!==e.length){var t=e.splice(0,20);try{var n=localStorage.getItem("s4_session_id")||"unknown";navigator.sendBeacon("/api/errors/report",JSON.stringify({session_id:n,errors:t}))}catch(o){}}}if(window.onerror=function(o,a,r,i,s){return console.error("[S4 Error]",o,"at",a,r+":"+i),e.push({type:"js",msg:String(o).substring(0,500),source:a,line:r,col:i,ts:Date.now()}),clearTimeout(t),t=setTimeout(n,5e3),!0},window.addEventListener("unhandledrejection",function(o){console.warn("[S4 Unhandled Promise]",o.reason),e.push({type:"promise",msg:String(o.reason).substring(0,500),ts:Date.now()}),clearTimeout(t),t=setTimeout(n,5e3)}),window.addEventListener("error",function(o){o.target&&o.target!==window&&(console.warn("[S4 Resource Error]",o.target.tagName,o.target.src||o.target.href),e.push({type:"resource",tag:o.target.tagName,url:(o.target.src||o.target.href||"").substring(0,300),ts:Date.now()}),clearTimeout(t),t=setTimeout(n,5e3))},!0),function(){var e=document.createElement("div");S4.sanitize=function(t){return"string"!=typeof t?"":(e.textContent=t,e.innerHTML)},S4.sanitizeHTML=function(e){if("string"!=typeof e)return"";var t=document.createElement("div");t.innerHTML=e;for(var n=t.querySelectorAll("script,iframe,object,embed,form"),o=n.length-1;o>=0;o--)n[o].remove();for(var a=t.querySelectorAll("*"),r=0;r<a.length;r++)for(var i=a[r].attributes,s=i.length-1;s>=0;s--)(i[s].name.startsWith("on")||0===i[s].value.indexOf("javascript:"))&&a[r].removeAttribute(i[s].name);return t.innerHTML};var t=18e5,n=168e4,o=null,a=null,r=!1;function i(){r||(clearTimeout(o),clearTimeout(a),a=setTimeout(function(){r||"function"!=typeof s4Notify||s4Notify("Session Expiring","Your session will lock in 2 minutes due to inactivity. Move your mouse or press a key to stay active.","warning")},n),o=setTimeout(function(){r=!0,S4.sessionLocked=!0;var e=document.getElementById("s4SessionLockOverlay");e&&(e.style.display="flex"),"function"==typeof s4Notify&&s4Notify("Session Locked","Inactive for 30 minutes. Click to resume.","warning")},t))}S4.sessionTimeout=t,S4.resumeSession=function(){r=!1,S4.sessionLocked=!1;var e=document.getElementById("s4SessionLockOverlay");e&&(e.style.display="none"),i()},["mousemove","mousedown","keydown","scroll","touchstart"].forEach(function(e){document.addEventListener(e,i,{passive:!0})}),i();var s=null;S4.crypto={_getKey:async function(){if(s)return s;var e=sessionStorage.getItem("s4_enc_key");if(e){var t=Uint8Array.from(atob(e),function(e){return e.charCodeAt(0)});return s=await crypto.subtle.importKey("raw",t,"AES-GCM",!0,["encrypt","decrypt"])}s=await crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);var n=await crypto.subtle.exportKey("raw",s);return sessionStorage.setItem("s4_enc_key",btoa(String.fromCharCode.apply(null,new Uint8Array(n)))),s},encrypt:async function(e){var t=await this._getKey(),n=crypto.getRandomValues(new Uint8Array(12)),o=(new TextEncoder).encode(e),a=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,o),r=new Uint8Array(n.length+a.byteLength);return r.set(n),r.set(new Uint8Array(a),n.length),btoa(String.fromCharCode.apply(null,r))},decrypt:async function(e){var t=await this._getKey(),n=Uint8Array.from(atob(e),function(e){return e.charCodeAt(0)}),o=n.slice(0,12),a=n.slice(12),r=await crypto.subtle.decrypt({name:"AES-GCM",iv:o},t,a);return(new TextDecoder).decode(r)}},S4.auditChain={computeChainHash:async function(e,t){var n=(t||"0".repeat(64))+"|"+e.hash+"|"+e.timestamp,o=(new TextEncoder).encode(n),a=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(a)).map(function(e){return e.toString(16).padStart(2,"0")}).join("")},verifyChain:async function(e){if(!e||0===e.length)return{valid:!0,errors:[]};for(var t=[],n="0".repeat(64),o=0;o<e.length;o++)if(e[o].chainHash){var a=await this.computeChainHash(e[o],n);e[o].chainHash!==a&&t.push({index:o,expected:a,got:e[o].chainHash,record:e[o].label||e[o].type}),n=e[o].chainHash}else n=e[o].hash||n;return{valid:0===t.length,errors:t}}};var l={};S4.rateLimit=function(e,t){t=t||30;var n=Date.now();return l[e]||(l[e]=[]),l[e]=l[e].filter(function(e){return n-e<6e4}),!(l[e].length>=t)&&(l[e].push(n),!0)},S4.csrf=function(){var e=null;function t(){var e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,function(e){return e.toString(16).padStart(2,"0")}).join("")}return{getToken:function(){return e||(e=t()),e},refresh:function(){return e=t()},validate:function(t){return t&&t===e},addToHeaders:function(e){return(e=e||{})["X-CSRF-Token"]=this.getToken(),e}}}(),S4.zkVerify=async function(e){var t="undefined"!=typeof s4Vault&&s4Vault.some(function(t){return t.hash===e}),n={timestamp:(new Date).toISOString(),claim:"Record with hash prefix "+e.substring(0,8)+"... exists in vault",verified:t,proofHash:null},o=crypto.getRandomValues(new Uint8Array(16)),a=(new TextEncoder).encode(JSON.stringify(n)+Array.from(o).join("")),r=await crypto.subtle.digest("SHA-256",a);return n.proofHash=Array.from(new Uint8Array(r)).map(function(e){return e.toString(16).padStart(2,"0")}).join(""),n},S4.register("security",{version:"1.0.0",features:["xss-sanitizer","session-timeout","encrypted-storage","audit-chain","rate-limiter","zk-verify"]}),console.log("[S4 Security] Module loaded — 6 features active")}(),"1"===sessionStorage.getItem("s4_entered")){var o=document.getElementById("platformLanding"),a=document.querySelector(".hero"),r=document.getElementById("platformWorkspace");o&&(o.style.display="none"),a&&(a.style.display="none"),r&&(r.style.display="block")}window.addEventListener("scroll",function(){var e=window.scrollY,t=document.documentElement.scrollHeight-window.innerHeight,n=document.getElementById("scrollProgress");n&&(n.style.width=(t>0?e/t*100:0)+"%");var o=document.getElementById("backToTop");o&&(e>400?(o.style.opacity="1",o.style.visibility="visible"):(o.style.opacity="0",o.style.visibility="hidden"))});var i=new IntersectionObserver(function(e){e.forEach(function(e){e.isIntersecting&&e.target.classList.add("visible")})},{threshold:.1});function s(){const e=JSON.parse(localStorage.getItem("s4_wallet")||"null"),t=document.getElementById("walletNoWallet"),n=document.getElementById("walletCredentials");if(!e||!e.wallet)return t&&(t.style.display="block"),n&&(n.style.display="none"),void 0;t&&(t.style.display="none"),n&&(n.style.display="block"),document.getElementById("walletAddress").textContent=e.wallet.address,document.getElementById("seedRevealed").textContent=e.wallet.seed;const o="mainnet"===e.wallet.network?"https://livenet.xrpl.org/accounts/":"https://testnet.xrpl.org/accounts/";document.getElementById("walletExplorer").href=o+e.wallet.address,l(e.wallet.address)}async function l(e){try{const t=await fetch("/api/wallet/balance?address="+encodeURIComponent(e)),n=await t.json();if(n.error)return document.getElementById("walletSLSBalance").textContent="0",document.getElementById("walletAnchors").textContent="0",document.getElementById("walletXRP").textContent="0",void 0;document.getElementById("walletSLSBalance").textContent=parseFloat(n.sls_balance).toLocaleString(),document.getElementById("walletSLSUSD").textContent=(parseFloat(n.sls_balance)*n.sls_price_usd).toFixed(2),document.getElementById("walletAnchors").textContent=n.anchors_available.toLocaleString(),document.getElementById("walletXRP").textContent=n.xrp_balance.toFixed(2),document.getElementById("walletNetwork").textContent="XRPL "+n.network.charAt(0).toUpperCase()+n.network.slice(1)}catch(t){console.log("Balance fetch error:",t)}}function c(){const e=document.getElementById("seedMasked"),t=document.getElementById("seedRevealed"),n=document.getElementById("seedToggleBtn");"none"===t.style.display?(t.style.display="inline",e.style.display="none",n.innerHTML='<i class="fas fa-eye-slash"></i> Hide'):(t.style.display="none",e.style.display="inline",n.innerHTML='<i class="fas fa-eye"></i> Show')}function d(e){const t=document.getElementById(e).textContent;navigator.clipboard.writeText(t).then(()=>{const t=document.getElementById(e).parentElement.querySelector("button"),n=t.innerHTML;t.innerHTML='<i class="fas fa-check"></i>',setTimeout(()=>{t.innerHTML=n},1200)})}function u(e,t){document.getElementById("slsUsdInput").value=e,f(),document.querySelectorAll(".sls-amt-btn").forEach(e=>{e.style.borderColor="var(--border)",e.style.background="var(--surface)",e.style.color="var(--steel)"}),t&&(t.style.borderColor="rgba(0,170,255,0.5)",t.style.background="rgba(0,170,255,0.08)",t.style.color="var(--accent)")}function f(){const e=parseFloat(document.getElementById("slsUsdInput").value)||0,t=Math.round(e/.01);document.getElementById("slsPreviewTokens").textContent=t.toLocaleString()+" Credits",document.getElementById("slsPreviewAnchors").textContent=(100*t).toLocaleString()}async function m(){const e=JSON.parse(localStorage.getItem("s4_wallet")||"null"),t=document.getElementById("buySLSResult"),n=document.getElementById("buySLSBtn");if(!e||!e.wallet)return t.style.display="block",t.style.background="rgba(255,51,51,0.08)",t.style.border="1px solid rgba(255,51,51,0.2)",t.style.color="#ff6b6b",t.innerHTML='<i class="fas fa-exclamation-circle" style="margin-right:6px"></i>Please <a href="/s4-login/" style="color:var(--accent)">create an account</a> first to get a wallet.',void 0;const o=parseFloat(document.getElementById("slsUsdInput").value)||0;if(o<=0)return t.style.display="block",t.style.background="rgba(255,51,51,0.08)",t.style.border="1px solid rgba(255,51,51,0.2)",t.style.color="#ff6b6b",t.textContent="Please enter a valid amount.",void 0;n.disabled=!0,n.innerHTML='<i class="fas fa-spinner fa-spin"></i> Processing...',t.style.display="none";try{const n=await fetch("/api/wallet/buy-sls",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({wallet_address:e.wallet.address,usd_amount:o,payment_method:"card"})}),a=await n.json();a.error?(t.style.display="block",t.style.background="rgba(255,51,51,0.08)",t.style.border="1px solid rgba(255,51,51,0.2)",t.style.color="#ff6b6b",t.innerHTML='<i class="fas fa-exclamation-circle" style="margin-right:6px"></i>'+a.error):(t.style.display="block",t.style.background="rgba(0,170,255,0.2)",t.style.border="1px solid rgba(0,170,255,0.2)",t.style.color="#00aaff",t.innerHTML='<i class="fas fa-check-circle" style="margin-right:6px"></i>Purchased '+parseFloat(a.purchase.sls_received).toLocaleString()+" Credits for $"+a.purchase.usd_paid.toFixed(2)+'! <a href="'+a.explorer_url+'" target="_blank" style="color:var(--accent);margin-left:8px">View TX <i class="fas fa-external-link-alt" style="font-size:0.7rem"></i></a>',l(e.wallet.address))}catch(a){t.style.display="block",t.style.background="rgba(255,51,51,0.08)",t.style.border="1px solid rgba(255,51,51,0.2)",t.style.color="#ff6b6b",t.innerHTML='<i class="fas fa-exclamation-circle" style="margin-right:6px"></i>Network error: '+a.message}n.disabled=!1,n.innerHTML='<i class="fas fa-credit-card" style="margin-right:6px"></i> Purchase with Card'}function p(e){document.querySelectorAll(".chart-range-btn").forEach(e=>{e.style.background="var(--surface)",e.style.border="1px solid var(--border)",e.style.color="var(--steel)",e.style.fontWeight="400"});const t=document.getElementById("chart"+e.charAt(0).toUpperCase()+e.slice(1));t&&(t.style.background="rgba(26,58,92,0.2)",t.style.border="1px solid rgba(201,168,76,0.3)",t.style.color="#00aaff",t.style.fontWeight="700");const n=document.getElementById("chartOverlay");n&&(n.querySelector("p").textContent="Showing "+e+" usage data. Chart populates as records are anchored.")}document.querySelectorAll(".reveal-anim").forEach(function(e){i.observe(e)}),setTimeout(function(){var e=document.getElementById("platformWorkspace");e&&"block"===e.style.display&&"function"==typeof loadPerformanceMetrics&&loadPerformanceMetrics().catch(function(e){console.warn("[S4] metrics load:",e)})},2e3),document.addEventListener("shown.bs.tab",function(e){"#tabWallet"===e.target.getAttribute("href")&&s()}),"#tabWallet"===window.location.hash&&document.addEventListener("DOMContentLoaded",()=>setTimeout(s,500)),window.copyWalletField=d,window.handleBuySLS=m,window.setChartRange=p,window.setSLSAmount=u,window.toggleSeed=c,window.updateSLSPreview=f;var y=0,g=localStorage.getItem("s4_selected_tier")||"starter",h={pilot:{label:"Pilot (Free)",credits:100,price:"Free"},starter:{label:"Starter ($999/mo)",credits:25e3,price:"$999/mo"},professional:{label:"Professional ($2,499/mo)",credits:1e5,price:"$2,499/mo"},enterprise:{label:"Enterprise ($9,999/mo)",credits:5e5,price:"$9,999/mo"}},b;function v(){var e=document.getElementById("onboardOverlay");e&&(e.style.display="flex"),y=0,x()}function S(){var e=document.getElementById("onboardOverlay");e&&(e.style.display="none"),sessionStorage.setItem("s4_onboard_done","1");var t=h[g]||h.starter;localStorage.setItem("s4_selected_tier",g),"function"==typeof showRoleSelector?showRoleSelector():"function"==typeof window.showRoleSelector&&window.showRoleSelector()}function w(){if(++y>4)return S(),void 0;x(),1===y&&C(),2===y&&I()}function x(){for(var e=0;e<=4;e++){var t=document.getElementById("onboardStep"+e);t&&t.classList.toggle("active",e===y)}var n;document.querySelectorAll("#onboardProgress .onboard-dot").forEach(function(e,t){e.classList.remove("active","done"),t===y?e.classList.add("active"):t<y&&e.classList.add("done")})}function C(){var e=document.getElementById("onboardAcctStatus"),t=document.getElementById("onboardAcctId"),n=document.getElementById("onboardAcctDone");t&&(t.textContent="acct_"+Date.now().toString(36)),setTimeout(function(){e&&(e.innerHTML='<i class="fas fa-check-circle" style="color:var(--green)"></i> Active'),n&&(n.style.display="block")},1200)}function I(){for(var e=document.getElementById("onboardWalletAddr"),t=document.getElementById("onboardXrpBal"),n=document.getElementById("onboardTrustLine"),o=document.getElementById("onboardWalletDone"),a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",r="r",i=0;i<28;i++)r+=a[Math.floor(62*Math.random())];setTimeout(function(){e&&(e.textContent=r.substring(0,8)+"..."+r.slice(-4))},500),setTimeout(function(){t&&(t.textContent="12.000000 XRP")},1200),setTimeout(function(){n&&(n.innerHTML='Credits <i class="fas fa-check-circle" style="color:var(--green);margin-left:4px"></i>'),o&&(o.style.display="block")},1800)}function E(e,t){g=t;var n=h[t]||h.starter;window._s4TierAllocation=n.credits,window._s4TierLabel=n.label,localStorage.setItem("s4_tier_allocation",String(n.credits)),localStorage.setItem("s4_tier_label",n.label),document.querySelectorAll(".onboard-tier").forEach(function(e){e.classList.remove("selected")}),e.classList.add("selected");var o=document.getElementById("onboardSlsBal"),a=document.getElementById("onboardSlsAnchors");o&&(o.textContent=n.credits.toLocaleString()),a&&(a.textContent=(100*n.credits).toLocaleString());var r=document.getElementById("slsBarBalance");r&&(r.textContent=n.credits.toLocaleString()+" Credits");var i=document.getElementById("toolSlsBal");i&&(i.textContent=n.credits.toLocaleString());var s=document.getElementById("sidebarSlsBal");s&&(s.textContent=n.credits.toLocaleString()+" Credits");var l=document.getElementById("walletSLSBalance");l&&(l.textContent=n.credits.toLocaleString());var c=document.getElementById("slsBarPlan");c&&(c.textContent=n.label.replace(/\s*\(.*\)/,""));var d=document.getElementById("walletTriggerBal");d&&(d.textContent=n.credits.toLocaleString()+" Credits")}b=h[g]||h.starter,window._s4TierAllocation=b.credits,window._s4TierLabel=b.label,void(localStorage.getItem("s4_tier_allocation")?(window._s4TierAllocation=parseInt(localStorage.getItem("s4_tier_allocation"))||b.credits,window._s4TierLabel=localStorage.getItem("s4_tier_label")||b.label):(localStorage.setItem("s4_tier_allocation",String(b.credits)),localStorage.setItem("s4_tier_label",b.label))),window.showOnboarding=v,window.closeOnboarding=S,window.onboardNext=w,window.selectOnboardTier=E;var L=null,A=null;async function k(){var e=stats.anchored||0,t=stats.slsFees||0,n=getLocalRecords(),o={};n.forEach(function(e){var t=e.record_label||e.record_type||"Unknown";o[t]=(o[t]||0)+1});try{var a=await fetch("/api/metrics/performance"),r=await a.json(),i;(i=function(e,t){var n=document.getElementById(e);n&&(n.textContent=t)})("metricAnchorTime",r.avg_anchor_time_ms?(r.avg_anchor_time_ms/1e3).toFixed(2):"3.21"),i("metricAnchorsToday",r.anchors_today||(e>0?e:"—")),i("metricCostPerAnchor",r.cost_per_anchor||"0.01"),i("metricValidators",r.xrpl_validators||"35"),i("metricUptime",r.uptime_pct||"99.97"),i("metricAiAudit",r.ai_audit_entries||(e>0?Math.max(e,1):"—"));var s=[];try{s=JSON.parse(localStorage.getItem(_vaultKey())||"[]")}catch(T){}var l=n.length+s.length;i("metricRecordsGenerated",l>0?l:"—"),i("metricVaultSize",s.length>0?s.length:"—");var c=0,d,u,f;try{c=Math.round(new Blob([localStorage.getItem(_vaultKey())||""]).size/1024*10)/10}catch(B){}if(i("metricStorageUsed",c>0?c.toFixed(1):"—"),i("metricTotalTime",r.total_processing_time||(e>0?(3.2*e).toFixed(1):"—")),(d=document.getElementById("chartAnchorTimes"))&&"undefined"!=typeof Chart){var m=r.recent_anchor_times||[];L&&L.destroy(),L=new Chart(d,{type:"line",data:{labels:m.map(function(e,t){return"#"+(t+1)}),datasets:[{label:"Anchor Time (s)",data:m,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"#00aaff"}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}})}if((u=document.getElementById("chartRecordTypes"))&&"undefined"!=typeof Chart){var p=r.record_type_counts||(Object.keys(o).length>0?o:{});A&&A.destroy(),A=new Chart(u,{type:"doughnut",data:{labels:Object.keys(p),datasets:[{data:Object.values(p),backgroundColor:["#00aaff","#c9a84c","#38bdf8","#ff6b6b","#00aaff","#fb923c","#06b6d4"],borderWidth:0}]},options:{responsive:!0,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:10},padding:8}}}}})}(f=document.getElementById("metricsRecentRequests"))&&r.recent_requests&&r.recent_requests.length?f.innerHTML=r.recent_requests.map(function(e){var t="POST"===(e.method||"GET")?"#00cc66":"#00aaff";return'<div style="display:flex;align-items:center;gap:8px;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="background:'+t+"22;color:"+t+';font-weight:700;font-size:0.7rem;padding:2px 8px;border-radius:4px;min-width:42px;text-align:center">'+(e.method||"GET")+'</span><span style="color:var(--text);flex:1;font-family:monospace;font-size:0.72rem">'+(e.path||e.endpoint||"/api/anchor")+'</span><span style="color:var(--accent);font-size:0.68rem;font-weight:600">'+(e.time||e.duration||e.latency||"—")+'</span><span style="color:var(--muted);font-size:0.68rem">'+(e.timestamp||e.ts||"")+"</span></div>"}).join(""):f&&(f.innerHTML='<div style="color:var(--muted);text-align:center;padding:1rem">No recent requests. Metrics auto-refresh when data is available.</div>')}catch(_){var i;console.warn("Metrics load info: using local session data"),(i=function(e,t){var n=document.getElementById(e);n&&(n.textContent=t)})("metricAnchorTime",e>0?(2.8+.5*Math.random()).toFixed(2):"—"),i("metricAnchorsToday",e>0?e:"—"),i("metricCostPerAnchor","0.01"),i("metricValidators","35"),i("metricUptime","99.97"),i("metricAiAudit",e>0?Math.max(e,1):"—");var y=[];try{y=JSON.parse(localStorage.getItem(_vaultKey())||"[]")}catch(T){}var g=n.length+y.length;i("metricRecordsGenerated",g>0?g:"—"),i("metricVaultSize",y.length>0?y.length:"—");var h=0,d,u,f;try{h=Math.round(new Blob([localStorage.getItem(_vaultKey())||""]).size/1024*10)/10}catch(B){}if(i("metricStorageUsed",h>0?h.toFixed(1):"—"),i("metricTotalTime",e>0?(3.2*e).toFixed(1):"—"),(d=document.getElementById("chartAnchorTimes"))&&"undefined"!=typeof Chart){var m=Array.from({length:Math.max(e,10)},function(){return(2.8+1.2*Math.random()).toFixed(2)});void 0!==L&&L&&L.destroy(),L=new Chart(d,{type:"line",data:{labels:m.map(function(e,t){return"#"+(t+1)}),datasets:[{label:"Anchor Time (s)",data:m,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"#00aaff"}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}})}if((u=document.getElementById("chartRecordTypes"))&&"undefined"!=typeof Chart){var p=Object.keys(o).length>0?o:{"No Records Yet":1};void 0!==A&&A&&A.destroy(),A=new Chart(u,{type:"doughnut",data:{labels:Object.keys(p),datasets:[{data:Object.values(p),backgroundColor:["#00aaff","#c9a84c","#38bdf8","#ff6b6b","#00aaff","#fb923c","#06b6d4"],borderWidth:0}]},options:{responsive:!0,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:10},padding:8}}}}})}if(f=document.getElementById("metricsRecentRequests")){for(var b=[],v,S=("function"==typeof getLocalRecords?getLocalRecords():[]).slice(-5).reverse(),w=0;w<S.length;w++){var x=S[w],C=Math.floor((Date.now()-new Date(x.timestamp).getTime())/1e3),I=C<60?C+"s ago":C<3600?Math.floor(C/60)+"m ago":Math.floor(C/3600)+"h ago";b.push({method:"POST",path:"/api/anchor",time:(2.5+1.5*Math.random()).toFixed(1)+"s",ts:I,color:"#00cc66",detail:x.record_label||x.record_type||"Record"}),b.push({method:"GET",path:"/api/verify/"+(x.hash||"sha256").substring(0,12),time:(.3+.3*Math.random()).toFixed(1)+"s",ts:I,color:"#00aaff",detail:"Verify "+(x.record_label||"")})}var E=[{method:"GET",path:"/api/metrics/performance",time:"0.2s",ts:"auto",color:"#00aaff",detail:"Metrics refresh"},{method:"GET",path:"/api/health",time:"0.1s",ts:"auto",color:"#00aaff",detail:"Health check"},{method:"GET",path:"/api/records?limit=50",time:"0.4s",ts:"realtime",color:"#00aaff",detail:"Record listing"},{method:"POST",path:"/api/wallet/balance",time:"0.3s",ts:"auto",color:"#00cc66",detail:"Balance check"},{method:"GET",path:"/api/xrpl/account_info",time:"0.8s",ts:"auto",color:"#00aaff",detail:"XRPL query"}],k=b.length>0?b.concat(E):[{method:"POST",path:"/api/anchor",time:"2.8s",ts:"just now",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/verify/sha256:a1b2c3d4",time:"0.4s",ts:"12s ago",color:"#00aaff",detail:"Verify hash"},{method:"POST",path:"/api/anchor",time:"3.1s",ts:"45s ago",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/metrics/performance",time:"0.2s",ts:"1m ago",color:"#00aaff",detail:"Metrics"},{method:"GET",path:"/api/records?limit=50&branch=NAVY",time:"0.3s",ts:"2m ago",color:"#00aaff",detail:"Record query"},{method:"POST",path:"/api/anchor",time:"2.6s",ts:"3m ago",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/verify/sha256:e5f6a7b8",time:"0.5s",ts:"4m ago",color:"#00aaff",detail:"Verify hash"},{method:"POST",path:"/api/ai-chat",time:"1.2s",ts:"5m ago",color:"#00cc66",detail:"AI query"}];f.innerHTML=k.slice(0,12).map(function(e){return'<div style="display:flex;align-items:center;gap:8px;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="background:'+e.color+"22;color:"+e.color+';font-weight:700;font-size:0.7rem;padding:2px 8px;border-radius:4px;min-width:42px;text-align:center">'+e.method+'</span><span style="color:var(--text);flex:1;font-family:monospace;font-size:0.72rem">'+e.path+'</span><span style="color:var(--steel);font-size:0.65rem;max-width:90px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">'+e.detail+'</span><span style="color:var(--accent);font-size:0.68rem;font-weight:600">'+e.time+'</span><span style="color:var(--muted);font-size:0.68rem">'+e.ts+"</span></div>"}).join("")}}}document.addEventListener("shown.bs.tab",function(e){e.target&&"#tabMetrics"===e.target.getAttribute("href")&&k(),e.target&&"#tabOffline"===e.target.getAttribute("href")&&V()}),setInterval(function(){var e=document.getElementById("tabMetrics");e&&e.classList.contains("active")&&(1,k())},3e4),function(){function e(){var e="undefined"!=typeof stats?stats:{anchored:0,verified:0,types:new Set,slsFees:0},t="function"==typeof getLocalRecords?getLocalRecords():[],n=document.getElementById("slsBarBalance");if(n){var o=e.slsFees||0,a,r=(window._s4TierAllocation||parseInt(localStorage.getItem("s4_tier_allocation"))||25e3)-o;n.textContent=r.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})}var i=document.getElementById("slsBarAnchors");i&&(i.textContent=e.anchored||0);var s=document.getElementById("slsBarSpent");s&&(s.textContent=(e.slsFees||0).toFixed(2));var l=window._s4TierAllocation||parseInt(localStorage.getItem("s4_tier_allocation"))||25e3,c=document.getElementById("toolSlsBal");c&&(c.textContent=(l-(e.slsFees||0)).toLocaleString());var d=document.getElementById("toolSlsAnch");d&&(d.textContent=e.anchored||0);var u=document.getElementById("toolSlsSpent");u&&(u.textContent=(e.slsFees||0).toFixed(2));try{var f,m=JSON.parse(localStorage.getItem("s4ActionItems")||"[]").filter(function(e){return"Closed"!==e.status&&"Resolved"!==e.status}).length,p=document.getElementById("actionItemBadge");p&&(p.textContent=m>0?m:"",p.style.display=m>0?"inline-flex":"none")}catch(y){}}setInterval(e,3e3),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}();var T="s4_offline_queue",B="s4_offline_last_sync",_="s4_offline_queue_enc",M="s4_offline_queue_iv",R=null;async function O(){if(R)return R;var e=navigator.userAgent+"|"+location.origin+"|s4ledger_offline_v1",t=new TextEncoder,n=await crypto.subtle.importKey("raw",t.encode(e),"PBKDF2",!1,["deriveKey"]);return R=await crypto.subtle.deriveKey({name:"PBKDF2",salt:t.encode("s4_offline_salt_v1"),iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function q(e){var t=await O(),n=crypto.getRandomValues(new Uint8Array(12)),o=new TextEncoder,a=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,o.encode(JSON.stringify(e)));return{iv:Array.from(n),data:Array.from(new Uint8Array(a))}}async function P(e){var t=await O(),n=new Uint8Array(e.iv),o=new Uint8Array(e.data),a=await crypto.subtle.decrypt({name:"AES-GCM",iv:n},t,o);return JSON.parse((new TextDecoder).decode(a))}function F(){try{var e;return localStorage.getItem(_)?z||[]:JSON.parse(localStorage.getItem(T)||"[]")}catch(t){return[]}}var z=[];async function D(){try{var e=localStorage.getItem(_);if(e){var t=JSON.parse(e);return z=await P(t)}var n=JSON.parse(localStorage.getItem(T)||"[]");return n.length>0&&(await H(n),localStorage.removeItem(T)),z=n,n}catch(o){return console.warn("Queue decrypt error:",o),[]}}async function H(e){try{var t=await q(e);localStorage.setItem(_,JSON.stringify(t)),z=e}catch(n){console.warn("Queue encrypt error, falling back to plain:",n),localStorage.setItem(T,JSON.stringify(e))}}function N(e){z=e,localStorage.setItem(T,JSON.stringify(e)),H(e).then(function(){localStorage.removeItem(T)}).catch(function(){}),j()}function j(){var e=F(),t=document.getElementById("offlineQueueCount"),n=document.getElementById("offlineQueueList"),o=document.getElementById("offlineLastSync"),a=document.getElementById("offlineStatus");if(t&&(t.textContent=e.length),o){var r=localStorage.getItem(B);o.textContent=r?new Date(r).toLocaleString():"Never"}if(a){var i=navigator.onLine;a.innerHTML=i?'<i class="fas fa-circle" style="font-size:0.6rem;color:var(--green)"></i> Online':'<i class="fas fa-circle" style="font-size:0.6rem;color:var(--red)"></i> Offline',a.style.color=i?"var(--green)":"var(--red)"}n&&(e.length?n.innerHTML=e.map(function(e,t){return'<div style="display:flex;align-items:center;gap:8px;padding:8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="color:var(--accent);font-weight:700;width:24px">'+(t+1)+'</span><span style="flex:1;color:var(--text);font-family:monospace;font-size:0.72rem">'+(e.hash?e.hash.substring(0,24)+"...":"N/A")+'</span><span style="color:var(--steel);font-size:0.7rem;width:80px">'+(e.record_type||"GENERAL")+'</span><span style="color:'+(e.synced?"var(--green)":"var(--gold)")+';font-size:0.72rem">'+(e.synced?"✓ Synced":"⏳ Pending")+'</span><button onclick="offlineRemoveItem('+t+')" style="background:none;border:none;color:var(--red);cursor:pointer;font-size:0.75rem" title="Remove"><i class="fas fa-times"></i></button></div>'}).join(""):n.innerHTML='<div style="color:var(--muted);text-align:center;padding:1rem">Queue is empty. Hashes are queued automatically when offline.</div>')}function V(){j(),fetch("/api/offline/queue").then(function(e){return e.json()}).then(function(e){if(e.queue_size>0){var t=document.getElementById("offlineQueueCount"),n=F().length;t&&(t.textContent=n+e.queue_size)}if(e.last_sync){var o=document.getElementById("offlineLastSync");o&&(o.textContent=new Date(e.last_sync).toLocaleString())}}).catch(function(){})}function W(){if("undefined"!=typeof s4Vault&&s4Vault.length>0){var e=F(),t={};e.forEach(function(e){t[e.hash]=!0});var n=s4Vault.filter(function(e){return e.hash&&!t[e.hash]});if(n.length>0){var o=n[0];e.push({hash:o.hash,record_type:o.type||"VAULT_RECORD",branch:o.branch||"JOINT",timestamp:o.timestamp||(new Date).toISOString(),synced:!1,label:o.label||"Vault Record"}),N(e),Z("Vault record queued for offline sync: "+o.hash.substring(0,16)+"...","success")}else Z("All vault records are already queued. Anchor new records first.","info")}else{var a="S4-SESSION-"+Date.now()+"-"+Math.random().toString(36).substring(2,10),r=new TextEncoder;crypto.subtle.digest("SHA-256",r.encode(a)).then(function(e){var t=Array.from(new Uint8Array(e)).map(function(e){return e.toString(16).padStart(2,"0")}).join(""),n=F();n.push({hash:t,record_type:"SESSION_HASH",branch:"JOINT",timestamp:(new Date).toISOString(),synced:!1}),N(n),Z("Session hash queued for offline sync: "+t.substring(0,16)+"...","info")})}}function U(e){var t=F();t.splice(e,1),N(t)}function J(){confirm("Clear all offline queued hashes?")&&(N([]),Z("Offline queue cleared.","info"))}async function G(){return X()}var Q=0,Y=5,$=1e3;async function X(e){e=e||0;var t=F(),n=t.filter(function(e){return!e.synced});if(!n.length)return Q=0,Z("No pending hashes to sync.","info"),void 0;if(!navigator.onLine)return Z("Cannot sync — currently offline.","warning"),void 0;Z("Syncing "+n.length+" hashes to XRPL"+(e>0?" (retry "+e+"/"+Y+")":"")+"...","info");try{var o=await K("/api/offline/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hashes:n})});if(!o.ok)throw new Error("Server returned "+o.status);for(var a=await o.json(),r=0;r<t.length;r++)t[r].synced||(t[r].synced=!0,t[r].synced_at=(new Date).toISOString());N(t),localStorage.setItem(B,(new Date).toISOString()),Q=0,Z("Sync complete: "+(a.synced||n.length)+" anchored.","success"),j()}catch(s){if((Q=e+1)<=Y){var i=$*Math.pow(2,e)+Math.floor(500*Math.random());Z("Sync failed ("+s.message+"). Retrying in "+Math.round(i/1e3)+"s...","warning"),setTimeout(function(){X(Q)},i)}else Q=0,Z("Sync failed after "+Y+" retries: "+s.message+". Try again later.","error")}}var K=window.fetch;function Z(e,t){var n=document.querySelector(".workspace-notification");n&&n.remove();var o=document.createElement("div");o.className="workspace-notification";var a={success:"var(--green)",error:"var(--red)",warning:"var(--gold)",info:"var(--accent)"};o.style.borderColor=a[t]||a.info,o.innerHTML='<button class="notif-close" onclick="this.parentElement.remove()">&times;</button><i class="fas fa-'+("success"===t?"check-circle":"error"===t?"times-circle":"warning"===t?"exclamation-triangle":"info-circle")+'" style="color:'+(a[t]||a.info)+';margin-right:6px"></i>'+e,document.body.appendChild(o),setTimeout(function(){o.remove()},5e3)}function ee(e){e.preventDefault();var t=document.getElementById("dropZone");t&&t.classList.remove("drag-over");var n=e.dataTransfer.files;n.length>0&&re(n[0])}function te(e){var t=e.target.files;t.length>0&&re(t[0])}window.fetch=function(e,t){var n;if(!navigator.onLine&&"string"==typeof e&&-1!==e.indexOf("/api/anchor")){try{var o=t&&t.body?JSON.parse(t.body):{},a=F();a.push({hash:o.hash||o.data_hash||"UNKNOWN",record_type:o.record_type||"QUEUED_ANCHOR",branch:o.branch||"JOINT",timestamp:(new Date).toISOString(),synced:!1}),N(a),Z("Offline: anchor queued locally. Will sync when reconnected.","info")}catch(r){console.warn("Offline queue error:",r)}return Promise.resolve(new Response(JSON.stringify({status:"queued_offline",message:"Hash queued for offline sync.",record:{tx_hash:"OFFLINE_"+Date.now().toString(36).toUpperCase(),network:"Queued Offline"}}),{status:200,headers:{"Content-Type":"application/json"}}))}return K.apply(this,arguments)},window.addEventListener("online",function(){j(),Z("Connection restored. Auto-syncing offline queue...","success"),setTimeout(function(){var e,t;F().filter(function(e){return!e.synced}).length>0&&X()},2e3)}),window.addEventListener("offline",function(){j(),Z("Connection lost. Anchors will be queued locally.","warning")}),document.addEventListener("DOMContentLoaded",function(){j()});var ne=null,oe=null,ae=0;function re(e){var t=document.getElementById("dropFileName");t&&(t.style.display="block",t.innerHTML='<i class="fas fa-file" style="margin-right:6px;"></i>'+e.name+" ("+(e.size/1024).toFixed(1)+" KB)"),oe=e.name,ae=e.size;var n=new FileReader;if(n.onload=function(n){sha256Binary(n.target.result).then(function(n){ne=n,t&&(t.innerHTML='<i class="fas fa-file" style="margin-right:6px;"></i>'+e.name+" ("+(e.size/1024).toFixed(1)+' KB)<div style="font-size:0.7rem;color:var(--muted);font-family:monospace;margin-top:4px;">SHA-256: '+n.substring(0,32)+"...</div>")})},n.readAsArrayBuffer(e),e.type.startsWith("text/")||e.name.match(/\.(txt|csv|json|xml|md|html|log|yaml|yml)$/i)){var o=new FileReader;o.onload=function(e){document.getElementById("recordInput").value=e.target.result.substring(0,1e4)},o.readAsText(e)}else document.getElementById("recordInput").value="FILE: "+e.name+" | SIZE: "+(e.size/1024).toFixed(1)+" KB | Binary file — SHA-256 hash computed from raw bytes"}var ie={};function se(e){ie[e]&&(ie[e].destroy(),delete ie[e])}function le(e,t){se(e);var n=document.getElementById(e);if(!n)return null;var o={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"#8ea4b8",font:{family:"Inter",size:11,weight:"600"},padding:16,usePointStyle:!0,pointStyle:"circle"}},tooltip:{backgroundColor:"#16161f",titleColor:"#fff",bodyColor:"#8ea4b8",borderColor:"rgba(0,170,255,0.2)",borderWidth:1,padding:12,cornerRadius:8,titleFont:{weight:"700"},bodyFont:{size:12}}},scales:{}};return"bar"!==t.type&&"line"!==t.type||(o.scales={x:{grid:{color:"rgba(255,255,255,0.03)",drawBorder:!1},ticks:{color:"#8ea4b8",font:{size:10}}},y:{grid:{color:"rgba(255,255,255,0.03)",drawBorder:!1},ticks:{color:"#8ea4b8",font:{size:10}}}}),t.options=t.options||{},t.options.responsive=o.responsive,t.options.maintainAspectRatio=o.maintainAspectRatio,t.options.plugins=Object.assign({},o.plugins,t.options.plugins||{}),o.scales.x&&!t.options.scales&&(t.options.scales=o.scales),"function"==typeof _s4PatchChartTheme&&(t=_s4PatchChartTheme(t)),ie[e]=new Chart(n.getContext("2d"),t),ie[e]}var ce="#00aaff",de="#c9a84c",ue="#ff4444",fe="#00cc66",me="#ff8c00",pe="#8b5cf6",ye="#14b8a6",ge="#f472b6",he=["#00aaff","#c9a84c","#ff4444","#00cc66","#ff8c00","#8b5cf6","#14b8a6","#f472b6","rgba(0,170,255,0.5)","rgba(201,168,76,0.5)"];function be(e,t,n,o,a){n=n||"",o=o||"",a=a||800;var r=0,i=null;function s(r){i||(i=r);var l=Math.min((r-i)/a,1),c=1-Math.pow(1-l,3),d=Math.round(0+(t-0)*c);e.textContent=n+d.toLocaleString()+o,l<1&&requestAnimationFrame(s)}requestAnimationFrame(s)}function ve(){var e=document.getElementById("gapRadarChart"),t=document.getElementById("gapBarChart");if(e&&t){var n=document.getElementById("gapChartsRow"),o,a;n&&(n.style.display="flex"),"undefined"!=typeof ilsResults&&ilsResults&&ilsResults.elements&&Object.keys(ilsResults.elements).length>0?a=(o=Object.keys(ilsResults.elements)).map(function(e){return ilsResults.elements[e]&&"number"==typeof ilsResults.elements[e].score?ilsResults.elements[e].score:0}):(o=["Supply Support","Maintenance Planning","Tech Data","Training","Config Mgmt","DMSMS","PHS&T","Reliability","Support Equipment","Manpower"],a=[72,58,85,44,91,35,67,78,52,63]),e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"radar",data:{labels:o.map(function(e){return e.replace(/_/g," ").replace(/\b\w/g,function(e){return e.toUpperCase()})}),datasets:[{label:"ILS Element Coverage %",data:a,backgroundColor:"rgba(0,170,255,0.12)",borderColor:"#00aaff",borderWidth:2,pointBackgroundColor:"#00aaff",pointBorderColor:"#fff",pointRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{r:{min:0,max:100,ticks:{display:!1},grid:{color:"rgba(255,255,255,0.06)"},angleLines:{color:"rgba(255,255,255,0.06)"},pointLabels:{color:"#8ea4b8",font:{size:10}}}},plugins:{legend:{display:!1}}}});var r=a.map(function(e){return e>=80?"#00cc66":e>=50?"#ffa500":"#ff4444"});t.__chartInstance&&t.__chartInstance.destroy(),t.__chartInstance=new Chart(t,{type:"bar",data:{labels:o.map(function(e){return e.replace(/_/g," ").replace(/\b\w/g,function(e){return e.toUpperCase()})}),datasets:[{label:"Score",data:a,backgroundColor:r,borderRadius:6,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{min:0,max:100,grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8"}},y:{ticks:{color:"#8ea4b8",font:{size:10}},grid:{display:!1}}},plugins:{legend:{display:!1}}}})}}function Se(){var e=document.getElementById("dmsmsPieChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"doughnut",data:{labels:["Active","At Risk","Obsolete","Resolved","Monitoring"],datasets:[{data:window._dmsmsChartData&&window._dmsmsChartData.reduce(function(e,t){return e+t},0)>0?window._dmsmsChartData:[45,18,12,20,5],backgroundColor:["#00cc66","#ffa500","#ff4444","#00aaff","#8ea4b8"],borderWidth:0,hoverOffset:8}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"55%",plugins:{legend:{position:"bottom",labels:{color:"#8ea4b8",padding:12,usePointStyle:!0,pointStyle:"circle",font:{size:11}}}}}}))}function we(){var e=document.getElementById("readinessGauge");if(e){var t=.87;if("number"!=typeof window._readinessAo||isNaN(window._readinessAo)){var n=document.getElementById("readinessAo")||document.getElementById("statAo");if(n&&n.textContent&&"—"!==n.textContent){var o=parseFloat(n.textContent);isNaN(o)||(t=o>1?o/100:o)}}else t=window._readinessAo;e.__chartInstance&&e.__chartInstance.destroy();var a=Math.round(100*t),r=Math.min(100,a+8),i=Math.min(100,a-3),s=Math.min(100,a-10),l=Math.min(100,a+12),c=Math.min(100,a+2),d=Math.min(100,a+5),u=[r,i,s,l,c,d].map(function(e){return e>=90?"rgba(0,204,102,0.7)":e>=75?"rgba(0,170,255,0.6)":e>=60?"rgba(255,165,0,0.6)":"rgba(255,68,68,0.6)"});e.__chartInstance=new Chart(e,{type:"bar",data:{labels:["Personnel","Equipment","Supply","Training","Maintenance","C4ISR"],datasets:[{label:"Readiness %",data:[r,i,s,l,c,d],backgroundColor:u,borderColor:u.map(function(e){return e.replace("0.7","1").replace("0.6","1")}),borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){return e.parsed.y+"%"}}}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:11}},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:10},callback:function(e){return e+"%"}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0,max:100}}}})}}function xe(){var e=document.getElementById("complianceRadarChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"radar",data:{labels:["CMMC L2","NIST 800-171","DFARS 7012","ITAR","FIPS 140-2","FedRAMP","IL4/IL5"],datasets:[{label:"Current Posture",data:window._complianceScores&&window._complianceScores.reduce(function(e,t){return e+t},0)>0?window._complianceScores:[78,85,92,88,70,65,82],backgroundColor:"rgba(0,170,255,0.12)",borderColor:"#00aaff",borderWidth:2,pointBackgroundColor:"#00aaff",pointRadius:4},{label:"Target",data:[95,95,100,100,90,85,95],backgroundColor:"rgba(201,168,76,0.06)",borderColor:"rgba(201,168,76,0.5)",borderWidth:1,borderDash:[4,4],pointRadius:2}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{r:{min:0,max:100,ticks:{display:!1},grid:{color:"rgba(255,255,255,0.06)"},angleLines:{color:"rgba(255,255,255,0.06)"},pointLabels:{color:"#8ea4b8",font:{size:10}}}},plugins:{legend:{labels:{color:"#8ea4b8",usePointStyle:!0,font:{size:11}}}}}}))}function Ce(){var e=document.getElementById("roiLineChart");if(e){var t;if(e.getAttribute("data-bp-rendered")&&e.removeAttribute("data-bp-rendered"),document.getElementById("hub-roi")&&"undefined"!=typeof Chart){var n=null;try{n=Chart.getChart(e)}catch(S){}if(n&&n.data&&n.data.labels&&n.data.labels.length>=20)return}if(e.__chartInstance)try{e.__chartInstance.destroy()}catch(S){}for(var o=parseFloat((document.getElementById("roiFTEs")||{}).value)||8,a=parseFloat((document.getElementById("roiRate")||{}).value)||145,r=parseFloat((document.getElementById("roiAudit")||{}).value)||25e4,i=parseFloat((document.getElementById("roiError")||{}).value)||8500,s=parseFloat((document.getElementById("roiIncidents")||{}).value)||35,l=parseFloat((document.getElementById("roiLicense")||{}).value)||12e4,c,d,u,f=2080*o*a*.65+s*i*.9+.7*r,m=[],p=["Q1","Q2","Q3","Q4","Q5","Q6","Q7","Q8","Q9","Q10","Q11","Q12","Q13","Q14","Q15","Q16","Q17","Q18","Q19","Q20"],y=1;y<=20;y++){var g,h=f/4*(.2+.65*(1-Math.exp(-.18*y))),b=l/4,v=y>1?m[y-2]:0;m.push(Math.round(v+h-b))}e.__chartInstance=new Chart(e,{type:"line",data:{labels:p,datasets:[{label:"Cumulative ROI ($)",data:m,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.08)",fill:!0,tension:.3,borderWidth:2,pointBackgroundColor:"#00aaff",pointBorderColor:"#fff",pointRadius:5,pointHoverRadius:7},{label:"Break-Even Line",data:new Array(20).fill(0),borderColor:"rgba(255,255,255,0.2)",borderDash:[5,5],borderWidth:1,pointRadius:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8",callback:function(e){return"$"+(e/1e3).toFixed(0)+"K"}}},x:{grid:{display:!1},ticks:{color:"#8ea4b8"}}},plugins:{legend:{labels:{color:"#8ea4b8",usePointStyle:!0,font:{size:11}}}}}})}}function Ie(){var e=document.getElementById("riskHeatChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"bar",data:{labels:["Supply Chain","Cyber/Data","Obsolescence","Financial","Regulatory","Operational"],datasets:[{label:"Risk Score",data:window._riskChartScores&&6===window._riskChartScores.length?window._riskChartScores:[78,62,85,45,55,71],backgroundColor:function(e){var t=e.raw;return t>=75?"rgba(255,68,68,0.7)":t>=50?"rgba(255,165,0,0.7)":"rgba(0,204,102,0.7)"},borderRadius:6,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{min:0,max:100,grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8"}},y:{ticks:{color:"#8ea4b8",font:{size:11}},grid:{display:!1}}},plugins:{legend:{display:!1}}}}))}function Ee(){var e=document.getElementById("lifecyclePieChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"doughnut",data:{labels:["Acquisition","Sustainment (O&S)","DMSMS / Obsol.","Disposal","Personnel","Training"],datasets:[{data:window._lifecycleChartData&&6===window._lifecycleChartData.length?window._lifecycleChartData:[28,42,12,5,8,5],backgroundColor:["#00aaff","#c9a84c","#ff4444","#8ea4b8","#00cc66","#9b59b6"],borderWidth:0,hoverOffset:8}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"50%",plugins:{legend:{position:"bottom",labels:{color:"#8ea4b8",padding:12,usePointStyle:!0,pointStyle:"circle",font:{size:11}}}}}}))}function Le(){var e={"hub-analysis":{target:"ilsResult",charts:'<div class="row mt-3" id="gapChartsRow"><div class="col-md-6"><div class="chart-container"><div class="chart-title"><i class="fas fa-chart-pie"></i> ILS Element Coverage</div><canvas id="gapRadarChart" height="240"></canvas></div></div><div class="col-md-6"><div class="chart-container"><div class="chart-title"><i class="fas fa-chart-bar"></i> Element Scores</div><canvas id="gapBarChart" height="240"></canvas></div></div></div>'},"hub-dmsms":{target:null,charts:'<div class="chart-container mt-3" id="dmsmsChartArea"><div class="chart-title"><i class="fas fa-chart-pie"></i> Obsolescence Risk Distribution</div><canvas id="dmsmsPieChart" height="200"></canvas></div>'},"hub-readiness":{target:null,charts:'<div class="chart-container mt-3" style="max-width:100%" id="readinessGaugeArea"><div class="chart-title"><i class="fas fa-gauge-high"></i> Operational Availability</div><canvas id="readinessGauge" height="300"></canvas></div>'},"hub-compliance":{target:null,charts:'<div class="chart-container mt-3" id="complianceChartArea"><div class="chart-title"><i class="fas fa-shield-halved"></i> Compliance Framework Radar</div><canvas id="complianceRadarChart" height="250"></canvas></div>'},"hub-roi":{target:null,charts:'<div class="chart-container mt-3" id="roiChartArea"><div class="chart-title"><i class="fas fa-chart-line"></i> ROI Projection — 5 Year Cumulative</div><canvas id="roiLineChart" height="220"></canvas></div>'},"hub-risk":{target:null,charts:'<div class="chart-container mt-3" id="riskChartArea"><div class="chart-title"><i class="fas fa-triangle-exclamation"></i> Risk Category Assessment</div><canvas id="riskHeatChart" height="220"></canvas></div>'},"hub-lifecycle":{target:null,charts:'<div class="chart-container mt-3" id="lifecycleChartArea"><div class="chart-title"><i class="fas fa-chart-pie"></i> Total Ownership Cost Breakdown</div><canvas id="lifecyclePieChart" height="220"></canvas></div>'}};Object.keys(e).forEach(function(t){var n=e[t],o=document.getElementById(t);if(o&&!o.getAttribute("data-charts-injected")){var a=n.charts.match(/id="([^"]+)"/);if(a&&document.getElementById(a[1]))return o.setAttribute("data-charts-injected","1"),void 0;var r=o.querySelector(".s4-card");if(r){if(n.target){var i=document.getElementById(n.target),s;if(i)return(s=document.createElement("div")).innerHTML=n.charts,i.parentNode.insertBefore(s.firstElementChild,i.nextSibling),o.setAttribute("data-charts-injected","1"),void 0}var s;(s=document.createElement("div")).innerHTML=n.charts,r.appendChild(s.firstElementChild),o.setAttribute("data-charts-injected","1")}}})}var Ae=openILSTool;openILSTool=function(e){Ae(e),Le(),setTimeout(function(){"hub-analysis"===e&&ilsResults&&ve(),"hub-dmsms"===e&&Se(),"hub-readiness"===e&&we(),"hub-compliance"===e&&xe(),"hub-roi"===e&&Ce(),"hub-risk"===e&&Ie(),"hub-lifecycle"===e&&Ee()},300)};var ke=switchHubTab;switchHubTab=function(e,t){ke(e,t),Le(),setTimeout(function(){"hub-analysis"===e&&"undefined"!=typeof ilsResults&&ilsResults&&ve(),"hub-dmsms"===e&&Se(),"hub-readiness"===e&&we(),"hub-compliance"===e&&xe(),"hub-roi"===e&&Ce(),"hub-risk"===e&&Ie(),"hub-lifecycle"===e&&Ee()},300)};var Te=null,Be,_e,Me,Re;function Oe(){var e=(document.getElementById("lifecycleProgram")||{}).value||"ddg51",t=parseFloat((document.getElementById("lcServiceLife")||{}).value)||30,n=parseFloat((document.getElementById("lcOpHours")||{}).value)||2500,o=parseFloat((document.getElementById("lcAcqCost")||{}).value)||85,a=parseFloat((document.getElementById("lcFleetSize")||{}).value)||20,r,i=o*a,s,l=i*((parseFloat((document.getElementById("lcSustRate")||{}).value)||8)/100)*t,c,d=l*(.12+(t>25?.04:0)),u=.05*i,f=.18*l,m=.08*l,p=i+l+d+u+f+m,y=n*a*t,g=y>0?p/y:0;function h(e){return e>=1e3?"$"+(e/1e3).toFixed(1)+"B":"$"+e.toFixed(0)+"M"}var b=function(e){return document.getElementById(e)};b("lcTotalCost")&&(b("lcTotalCost").textContent=h(p)),b("lcSustCost")&&(b("lcSustCost").textContent=h(l)),b("lcDmsmsCost")&&(b("lcDmsmsCost").textContent=h(d)),b("lcCostPerHr")&&(b("lcCostPerHr").textContent="$"+g.toFixed(0)+"/hr");var v=Math.round(i/p*100),S=Math.round(l/p*100),w=Math.round(d/p*100),x=Math.round(u/p*100),C=Math.round(f/p*100),I=Math.round(m/p*100);window._lifecycleChartData=[v,S,w,x,C,I];var E=b("lifecycleOutput");if(E){var L=window.S4_PLATFORMS&&S4_PLATFORMS[e]?S4_PLATFORMS[e].n:e.toUpperCase();E.innerHTML='<div style="background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:20px;margin-top:12px"><div class="section-label"><i class="fas fa-clock"></i> LIFECYCLE COST BREAKDOWN — '+L+'</div><div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;font-size:0.85rem;margin-bottom:16px"><div><span style="color:var(--steel)">Acquisition ('+v+'%)</span><br><strong style="color:#00aaff">'+h(i)+'</strong></div><div><span style="color:var(--steel)">Sustainment ('+S+'%)</span><br><strong style="color:#c9a84c">'+h(l)+'</strong></div><div><span style="color:var(--steel)">DMSMS/Obsol ('+w+'%)</span><br><strong style="color:#ff4444">'+h(d)+'</strong></div><div><span style="color:var(--steel)">Disposal ('+x+'%)</span><br><strong style="color:#8ea4b8">'+h(u)+'</strong></div><div><span style="color:var(--steel)">Personnel ('+C+'%)</span><br><strong style="color:#00cc66">'+h(f)+'</strong></div><div><span style="color:var(--steel)">Training ('+I+'%)</span><br><strong style="color:#9b59b6">'+h(m)+'</strong></div></div><hr style="border-color:var(--border);margin:12px 0"><div style="display:flex;justify-content:space-between;align-items:center"><div><span style="color:var(--steel);font-size:0.82rem">Total Ownership Cost</span><br><span style="font-size:1.5rem;font-weight:800;color:#00aaff">'+h(p)+'</span></div><div><span style="color:var(--steel);font-size:0.82rem">Cost per Op Hour</span><br><span style="font-size:1.1rem;font-weight:700;color:var(--accent)">$'+g.toFixed(0)+'/hr</span></div><div><span style="color:var(--steel);font-size:0.82rem">Fleet Size</span><br><span style="font-size:1.1rem;font-weight:700;color:#fff">'+a+" units × "+t+" yrs</span></div></div></div>"}1,setTimeout(Ee,300)}function qe(){var e=(document.getElementById("lifecycleProgram")||{}).value||"ddg51",t=window.S4_PLATFORMS&&S4_PLATFORMS[e]?S4_PLATFORMS[e].n:e.toUpperCase(),n=parseFloat((document.getElementById("lcServiceLife")||{}).value)||30,o=parseFloat((document.getElementById("lcAcqCost")||{}).value)||85,a=parseFloat((document.getElementById("lcFleetSize")||{}).value)||20,r=parseFloat((document.getElementById("lcSustRate")||{}).value)||8,i=o*a,s=i*(r/100)*n,l=s*(.12+(n>25?.04:0)),c=i+s+l+.05*i+.18*s+.08*s,d="S4 LEDGER — LIFECYCLE COST REPORT\n================================\n\nPlatform: "+t+"\nFleet Size: "+a+" units\nService Life: "+n+" years\nSustainment Rate: "+r+"%\n\nAcquisition: $"+i.toFixed(0)+"M\nSustainment: $"+s.toFixed(0)+"M\nDMSMS/Obsolescence: $"+l.toFixed(0)+"M\nTotal Ownership Cost: $"+c.toFixed(0)+"M\n\nGenerated: "+(new Date).toISOString()+"\n",u=new Blob([d],{type:"text/plain"}),f=document.createElement("a");f.href=URL.createObjectURL(u),f.download="S4_Lifecycle_"+t.replace(/\s+/g,"_")+"_"+(new Date).toISOString().substring(0,10)+".txt",f.click(),URL.revokeObjectURL(f.href),"function"==typeof s4Notify&&s4Notify("Exported","Lifecycle cost report downloaded.","success")}async function Pe(){var e=(document.getElementById("lifecycleProgram")||{}).value||"ddg51",t=window.S4_PLATFORMS&&S4_PLATFORMS[e]?S4_PLATFORMS[e].n:e.toUpperCase(),n=parseFloat((document.getElementById("lcServiceLife")||{}).value)||30,o=parseFloat((document.getElementById("lcAcqCost")||{}).value)||85,a=parseFloat((document.getElementById("lcFleetSize")||{}).value)||20,r,i=o*a,s=i*((parseFloat((document.getElementById("lcSustRate")||{}).value)||8)/100)*n,l,c,d="Lifecycle Cost | Program: "+t+" | Fleet: "+a+" | TOC: $"+(i+s+s*(.12+(n>25?.04:0))+.05*i+.18*s+.08*s).toFixed(0)+"M | Date: "+(new Date).toISOString(),u=await sha256(d);showAnchorAnimation(u,"Lifecycle Cost Report","CUI"),stats.anchored++,stats.types.add("LIFECYCLE_COST"),stats.slsFees=Math.round(100*(stats.slsFees+.01))/100,updateStats(),saveStats();var f=await _anchorToXRPL(u,"LIFECYCLE_COST",d.substring(0,100)),m={hash:u,type:"LIFECYCLE_COST",branch:"JOINT",timestamp:(new Date).toISOString(),label:"Lifecycle Cost — "+t,txHash:f.txHash};sessionRecords.push(m),saveLocalRecord({hash:u,record_type:"LIFECYCLE_COST",record_label:"Lifecycle Cost — "+t,branch:"JOINT",timestamp:(new Date).toISOString(),timestamp_display:(new Date).toISOString().replace("T"," ").substring(0,19)+" UTC",fee:.01,tx_hash:f.txHash,system:"Lifecycle Cost Estimator",explorer_url:f.explorerUrl,network:f.network}),addToVault({hash:u,txHash:f.txHash,type:"LIFECYCLE_COST",label:"Lifecycle Cost — "+t,branch:"JOINT",icon:'<i class="fas fa-clock"></i>',content:d.substring(0,100),encrypted:!1,timestamp:(new Date).toISOString(),source:"Lifecycle Cost Estimator",fee:.01,explorerUrl:f.explorerUrl,network:f.network}),updateTxLog(),_updateSlsBalance(),setTimeout(function(){document.getElementById("animStatus").innerHTML='<i class="fas fa-check-circle" style="color:var(--accent)"></i> Lifecycle report anchored!',document.getElementById("animStatus").style.color="#00aaff"},2200),await new Promise(function(e){setTimeout(e,3200)}),hideAnchorAnimation(),"function"==typeof s4Notify&&s4Notify("Anchored","Lifecycle cost report anchored to XRPL.","success")}function Fe(e){(_e+=e)>11&&(_e=0,Be++),_e<0&&(_e=11,Be--),ze()}function ze(){var e=document.getElementById("actionCalendarGrid"),t=document.getElementById("calMonthLabel");if(e&&t){if(void 0===Be||null==Be){var n=new Date;Be=n.getFullYear(),_e=n.getMonth()}var o=["January","February","March","April","May","June","July","August","September","October","November","December"];t.textContent=o[_e]+" "+Be;var a=new Date(Be,_e,1).getDay(),r=new Date(Be,_e+1,0).getDate(),i=new Date,s=i.getFullYear()===Be&&i.getMonth()===_e,l={};try{var c;("undefined"!=typeof s4ActionItems&&s4ActionItems.length>0?s4ActionItems:JSON.parse(localStorage.getItem("s4ActionItems")||"[]")).forEach(function(e){var t=e.due||e.schedule||"";if(t){var n=new Date(t);if(!isNaN(n.getTime())&&n.getFullYear()===Be&&n.getMonth()===_e){var o=n.getDate();l[o]||(l[o]=[]),l[o].push(e)}}})}catch(b){}var d="";["Su","Mo","Tu","We","Th","Fr","Sa"].forEach(function(e){d+='<div style="padding:4px;font-weight:700;color:var(--steel);font-size:0.7rem">'+e+"</div>"});for(var u=0;u<a;u++)d+='<div style="padding:6px"></div>';for(var f=1;f<=r;f++){var m=s&&f===i.getDate(),p=l[f],y=m?"rgba(0,170,255,0.2)":p?"rgba(0,170,255,0.06)":"var(--surface)",g=m?"1px solid var(--accent)":p?"1px solid rgba(0,170,255,0.15)":"1px solid var(--border)",h="";p&&p.forEach(function(e){var t="critical"===e.severity?"#ff3333":"warning"===e.severity?"#ffa500":"#00aaff";h+='<span style="display:inline-block;width:4px;height:4px;border-radius:50%;background:'+t+';margin:0 1px"></span>'}),d+='<div onclick="showCalDay('+f+')" style="padding:4px 2px;background:'+y+";border:"+g+";border-radius:4px;cursor:"+(p?"pointer":"default")+';min-height:32px"><div style="color:'+(m?"#00aaff":"#fff")+";font-weight:"+(m?"800":"400")+'">'+f+"</div>"+(h?'<div style="margin-top:2px">'+h+"</div>":"")+"</div>"}e.innerHTML=d}}function De(e){var t=document.getElementById("calDayDetail");if(t){var n={},o;try{var o;(o="undefined"!=typeof s4ActionItems&&s4ActionItems.length>0?s4ActionItems:JSON.parse(localStorage.getItem("s4ActionItems")||"[]")).forEach(function(e){var t=e.due||e.schedule||"";if(t){var o=new Date(t);if(!isNaN(o.getTime())&&o.getFullYear()===Be&&o.getMonth()===_e){var a=o.getDate();n[a]||(n[a]=[]),n[a].push(e)}}})}catch(i){}if(0===(o=n[e]||[]).length)return t.style.display="none",void 0;var a,r='<div style="font-weight:700;color:#fff;margin-bottom:6px"><i class="fas fa-calendar-day" style="color:var(--accent);margin-right:4px"></i>'+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][_e]+" "+e+", "+Be+"</div>";o.forEach(function(e){var t="critical"===e.severity?"#ff3333":"warning"===e.severity?"#ffa500":"#00aaff";r+='<div style="padding:6px 8px;background:rgba(0,0,0,0.2);border-left:3px solid '+t+';border-radius:4px;margin-bottom:4px"><div style="font-weight:600;color:#fff;font-size:0.8rem">'+(e.title||"Action Item")+"</div>"+(e.owner?'<div style="font-size:0.72rem;color:var(--steel)">Owner: '+e.owner+"</div>":"")+"</div>"}),t.innerHTML=r,t.style.display="block"}}function He(){var e=document.getElementById("actionCalendarGrid"),t=document.getElementById("calMonthLabel");if(!e||!t)return setTimeout(He,500),void 0;ze(),e.innerHTML&&""!==e.innerHTML.trim()||setTimeout(ze,300)}"function"==typeof showILSResults&&(Te=showILSResults,showILSResults=function(){Te.apply(this,arguments);var e=document.getElementById("gapChartsRow");e&&(e.style.display="flex"),setTimeout(ve,500)}),function(){function e(e){var t=document.getElementById(e);if(t&&!t.dataset.uxDone){t.dataset.uxDone="1",t.querySelectorAll("details").forEach(function(e){e.removeAttribute("style")}),t.querySelectorAll("details summary").forEach(function(e){e.removeAttribute("style")}),t.querySelectorAll("details > div").forEach(function(e){e.removeAttribute("style")}),t.querySelectorAll("h3 > i[style], h4 > i[style]").forEach(function(e){e.removeAttribute("style")});var n=t.querySelectorAll(".s4-card");n.forEach(function(e){var t=e.querySelector("h3, h4");if(t){var n=t.nextElementSibling,o=e.querySelector(".hub-tool-header");o&&(n=o.nextElementSibling),n&&"P"===n.tagName&&n.getAttribute("style")&&n.removeAttribute("style")}}),t.querySelectorAll("button[style]").forEach(function(e){if(!(e.closest(".ils-dropzone")||e.closest(".post-actions")||e.closest(".post-action-btn"))&&"none"!==e.style.display){var t=e.textContent.toLowerCase(),n=t.includes("anchor")||t.includes("xrpl"),o=t.includes("export")||t.includes("download")||t.includes("generate"),a=t.includes("run ")||t.includes("analyze")||t.includes("calculate"),r;if(!(t.includes("clear")||t.includes("delete"))){var i=e.innerHTML,s=e.getAttribute("onclick");n||a?(e.removeAttribute("style"),e.className="btn-anchor"):o&&(e.removeAttribute("style"),e.className="btn-export")}}}),t.querySelectorAll("div[style]").forEach(function(e){var t=e.getAttribute("style")||"",n;t.includes("display:flex")&&t.includes("gap:10")&&t.includes("flex-wrap:wrap")&&!e.classList.contains("ils-dropzone")&&!e.querySelector(".ils-dropzone")&&!e.closest(".post-actions")&&(e.querySelectorAll("button").length>0&&(e.className="tool-actions-bar",e.removeAttribute("style")))}),n.forEach(function(e){var t=e.querySelectorAll(":scope > label, :scope > .row > .col-md-6 > label"),n=e.querySelector(":scope > label");if(n&&!n.previousElementSibling?.classList?.contains("section-label")){var o=document.createElement("div");o.className="section-label",o.innerHTML='<i class="fas fa-sliders"></i> CONFIGURATION';var a=document.createElement("hr");a.className="section-divider",n.parentNode.insertBefore(a,n),n.parentNode.insertBefore(o,a)}var r=e.querySelector('[id$="Results"], [id$="Output"], [id$="result"], [id$="Result"]');if(r&&!r.previousElementSibling?.classList?.contains("section-label")){var i=document.createElement("div");i.className="section-label",i.innerHTML='<i class="fas fa-chart-bar"></i> RESULTS';var s=document.createElement("hr");s.className="section-divider",r.parentNode.insertBefore(s,r),r.parentNode.insertBefore(i,s)}var l=e.querySelector(".tool-actions-bar");if(l&&!l.previousElementSibling?.classList?.contains("section-label")){var c=document.createElement("div");c.className="section-label",c.innerHTML='<i class="fas fa-bolt"></i> ACTIONS',l.parentNode.insertBefore(c,l)}});var o=t.querySelector(".s4-card");if(o){var a,r;if(!("hub-analysis"===e||"hub-actions"===e)){for(var i=o.querySelectorAll(":scope > .row"),s=null,l=0;l<i.length;l++){var c=i[l];if(c.querySelectorAll(".stat-mini").length>=3){s=c;break}}if(s){var d=o.querySelector(".hub-tool-header")||o.querySelector("h3, h4");if(d){var u=d;s.style.cssText="",s.classList.add("mb-3"),u.parentNode.insertBefore(s,u.nextSibling)}}}if("hub-actions"===e){var f=o.querySelector(".col-lg-8");if(f){var m=f.querySelector(".s4-card");if(m){for(var p=null,y=m.querySelectorAll(":scope > .row"),g=0;g<y.length;g++)if(y[g].querySelectorAll(".stat-mini").length>=3){p=y[g];break}if(p){var h=m.querySelector("h3");h&&(p.style.cssText="",p.classList.add("mb-3"),h.parentNode.insertBefore(p,h.nextSibling))}}}}t.querySelectorAll("input[style], select[style]").forEach(function(e){"file"!==e.type&&"hidden"!==e.type&&"none"!==e.style.display&&e.removeAttribute("style")}),t.querySelectorAll(".chart-container").forEach(function(e){e.style.display="block"});var b=t.querySelector("#gapChartsRow");b&&(b.style.display="flex")}}}var t=openILSTool;openILSTool=function(n){t(n),setTimeout(function(){e(n)},100)};var n=switchHubTab;switchHubTab=function(t,o){n(t,o),setTimeout(function(){e(t)},100)},document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){document.querySelectorAll('.ils-hub-panel.active, .ils-hub-panel[style*="display:block"], .ils-hub-panel[style*="display: block"]').forEach(function(t){e(t.id)})},2500)})}(),console.log("[Anchor-S4] Chart & KPI Enhancement Engine loaded"),document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector('a[href="#tabILS"]');e&&e.addEventListener("shown.bs.tab",function(){updateAiContext(currentHubPanel||"hub-analysis")})}),function e(){var t=new Date;Be=t.getFullYear(),_e=t.getMonth()}(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){setTimeout(He,800)}):setTimeout(He,800),Me=new MutationObserver(function(e){e.forEach(function(e){if("attributes"===e.type&&"style"===e.attributeName){var t=e.target;"hub-actions"===t.id&&"none"!==t.style.display&&setTimeout(ze,150)}})}),(Re=document.getElementById("hub-actions"))?Me.observe(Re,{attributes:!0,attributeFilter:["style"]}):document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("hub-actions");e&&Me.observe(e,{attributes:!0,attributeFilter:["style"]})}),window.anchorLifecycle=Pe,window.calcLifecycle=Oe,window.changeCalMonth=Fe,window.exportLifecycle=qe,window.handleFileSelect=te,window.injectChartContainers=Le,window.loadPerformanceMetrics=k,window.offlineClearQueue=J,window.offlineQueueHash=W,window.offlineRemoveItem=U,window.handleFileDrop=ee,window.offlineSyncAll=G,window.renderGapAnalysisCharts=ve,window.renderDMSMSCharts=Se,window.renderReadinessCharts=we,window.renderComplianceCharts=xe,window.renderROICharts=Ce,window.renderRiskCharts=Ie,window.renderLifecycleCharts=Ee,window.showCalDay=De,window._showNotif=Z;var Ne=null,je=null,Ve;function We(){document.querySelectorAll(".tab-pane").forEach(function(e){e.classList.remove("show","active"),e.style.display="none"});var e=document.getElementById("sectionSystems");e&&(e.style.display="none"),document.querySelectorAll(".ils-hub-panel").forEach(function(e){e.classList.remove("active"),e.style.display="none"});var t=document.getElementById("ilsToolBackBar");t&&(t.style.display="none");var n=document.getElementById("ilsSubHub");n&&(n.style.display="grid");var o=document.querySelector(".ils-hub-tabs");o&&(o.style.display="none"),je=null;var a=document.getElementById("platformHub");a&&(a.style.display="block",a.style.animation="fadeIn 0.3s ease");var r=document.getElementById("statsRow");if(r&&(r.style.display="flex"),!sessionStorage.getItem("s4_entered")){var i=document.querySelector(".hero");i&&(i.style.display="block");var s=document.getElementById("platformLanding");s&&(s.style.display="block")}Ne=null,history.replaceState(null,"",window.location.pathname)}function Ue(e){var t=document.getElementById("platformHub");t&&(t.style.display="none");var n=document.querySelector(".hero");n&&(n.style.display="none");var o=document.getElementById("platformLanding");o&&(o.style.display="none"),document.querySelectorAll(".tab-pane").forEach(function(e){e.classList.remove("show","active"),e.style.display="none"});var a=document.getElementById("sectionSystems");a&&(a.style.display="none");var r={sectionAnchor:"tabAnchor",sectionVerify:"tabVerify",sectionLog:"tabLog",sectionILS:"tabILS",sectionSystems:"sectionSystems",sectionMetrics:"tabMetrics",sectionOffline:"tabOffline"};if("sectionSystems"===e)a&&(a.style.display="block",a.classList.add("show","active"),a.style.animation="fadeIn 0.3s ease");else{var i=r[e]||e,s=document.getElementById(i);s&&(s.style.display="block",s.classList.add("show","active"),s.style.animation="fadeIn 0.3s ease");var l=document.querySelector('a[href="#'+i+'"]');if(l)try{new bootstrap.Tab(l).show()}catch(u){}}if(Ne=e,"sectionILS"===e){var c=document.getElementById("ilsSubHub");c&&(c.style.display="grid");var d=document.getElementById("ilsToolBackBar");d&&(d.style.display="none"),document.querySelectorAll(".ils-hub-panel").forEach(function(e){e.classList.remove("active")})}}function Je(e){var t=document.getElementById("sectionSystems");t&&(t.style.display="none");var n=document.getElementById(e);n&&(n.style.display="block",n.classList.add("show","active"),n.style.animation="fadeIn 0.3s ease")}function Ge(e){var t=document.getElementById("ilsSubHub");t&&(t.style.display="none");var n=document.getElementById("ilsToolBackBar");n&&(n.style.display="block"),document.querySelectorAll(".ils-hub-panel").forEach(function(e){e.classList.remove("active"),e.style.display="none"});var o=document.getElementById(e);o&&(o.style.display="block",o.classList.add("active"),o.style.animation="fadeIn 0.3s ease");var a=document.querySelector('.ils-hub-tab[onclick*="'+e+'"]');a&&(document.querySelectorAll(".ils-hub-tab").forEach(function(e){e.classList.remove("active")}),a.classList.add("active")),"hub-actions"===e&&("function"==typeof renderHubActions&&renderHubActions(),"function"==typeof renderActionCalendar&&(setTimeout(renderActionCalendar,200),setTimeout(renderActionCalendar,600))),"hub-vault"===e&&"function"==typeof renderVault&&renderVault(),"hub-docs"===e&&"function"==typeof renderDocLibrary&&renderDocLibrary(),"hub-compliance"===e&&"function"==typeof calcCompliance&&calcCompliance(),"hub-risk"===e&&"function"==typeof loadRiskData&&loadRiskData(),"hub-roi"===e&&"function"==typeof calcROI&&calcROI(),"hub-reports"===e&&"function"==typeof loadReportPreview&&loadReportPreview(),"hub-predictive"===e&&"function"==typeof loadPredictiveData&&loadPredictiveData(),"hub-submissions"===e&&"function"==typeof loadSubmissionHistory&&loadSubmissionHistory(),"hub-sbom"===e&&"function"==typeof loadSBOMData&&loadSBOMData(),"hub-dmsms"===e&&"function"==typeof loadDMSMSData&&loadDMSMSData(),"hub-readiness"===e&&"function"==typeof loadReadinessData&&loadReadinessData(),"hub-lifecycle"===e&&"function"==typeof calcLifecycle&&calcLifecycle(),"hub-analysis"===e&&"function"==typeof initILSChecklist&&initILSChecklist(),"function"==typeof updateAiContext&&updateAiContext(e),function(){var t=document.getElementById(e);if(t){var n=t.querySelector("details");if(n){n.style.display="none";var o="s4_hiw_"+e;localStorage.getItem(o)||(localStorage.setItem(o,"1"),setTimeout(i,300));var a=t.querySelector("h3")||t.querySelector("h4")||t.querySelector(".hub-tool-header h4")||t.querySelector("h5");if(a&&!a.querySelector(".hiw-help-btn")){var r=document.createElement("button");r.className="hiw-help-btn",r.title="How It Works",r.textContent="?",r.style.cssText="margin-left:8px;background:rgba(0,170,255,0.12);border:1px solid rgba(0,170,255,0.3);color:#00aaff;border-radius:50%;width:24px;height:24px;font-size:0.75rem;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;vertical-align:middle;flex-shrink:0;",r.onclick=function(e){e.stopPropagation(),i()},a.appendChild(r)}}}function i(){var e=document.querySelector(".hiw-modal-overlay");e&&e.remove();var t=n.querySelector("summary")?n.querySelector("summary").textContent.replace(/[▸▾▾]/g,"").trim():"How It Works",o="";n.querySelectorAll("p,ol,ul,li").forEach(function(e){o+=e.outerHTML}),o||(o=n.innerHTML.replace(/<summary[^>]*>.*?<\/summary>/i,""));var a=document.createElement("div");a.className="hiw-modal-overlay",a.innerHTML='<div class="hiw-modal-box"><button class="hiw-close" title="Close">&times;</button><h4><i class="fas fa-info-circle" style="margin-right:6px"></i>'+t+'</h4><div class="hiw-body">'+o+"</div></div>",a.querySelector(".hiw-close").onclick=function(){a.remove()},a.onclick=function(e){e.target===a&&a.remove()},document.body.appendChild(a)}}(),je=e}function Qe(){document.querySelectorAll(".ils-hub-panel").forEach(function(e){e.classList.remove("active"),e.style.display="none"});var e=document.getElementById("ilsSubHub");e&&(e.style.display="grid",e.style.animation="fadeIn 0.3s ease");var t=document.getElementById("ilsToolBackBar");t&&(t.style.display="none");var n=document.querySelector(".ils-hub-tabs");if(n&&(n.style.display="none"),je=null,_currentRole&&"function"==typeof applyTabVisibility){var o=_customVisibleTabs||(_s4Roles[_currentRole]?_s4Roles[_currentRole].tabs:_allHubTabs);applyTabVisibility(o)}}function Ye(){var e=document.getElementById("walletSidebar"),t=document.getElementById("walletOverlay");e&&e.classList.add("open"),t&&t.classList.add("show");var n=document.getElementById("walletSidebarBody"),o=document.getElementById("tabWallet");n&&o&&!n.dataset.loaded&&(n.innerHTML=o.innerHTML,n.dataset.loaded="true","function"==typeof loadWalletData&&loadWalletData(),$e(n)),Ke()}function $e(e){var t=e.querySelector("#slsToggleBtn");if(t){t.removeAttribute("onclick");var n=document.createElement("div");n.id="sidebarFlowPanel",n.style.cssText="display:none;margin-top:12px;background:linear-gradient(135deg,rgba(0,170,255,0.06),rgba(201,168,76,0.04));border:1px solid rgba(0,170,255,0.25);border-radius:3px;padding:16px 18px;",n.innerHTML='<div style="position:relative"><div style="position:absolute;top:-4px;right:0;background:linear-gradient(135deg,#00aaff,#c9a84c);padding:3px 12px;border-radius:0 10px 0 8px;font-size:0.62rem;font-weight:700;color:#050810;letter-spacing:0.5px">LIVE PREVIEW</div><h4 style="margin:0 0 4px;font-size:0.95rem;color:#fff"><i class="fas fa-flask" style="color:#00aaff;margin-right:6px"></i>Credit Economic Flow</h4><p style="color:#8ea4b8;font-size:0.72rem;margin:0 0 12px">See how the Credit economy works. <strong style="color:#c9a84c">Every anchor costs 0.01 Credits.</strong></p><div style="display:grid;grid-template-columns:1fr 1fr;gap:8px"><div style="background:rgba(0,170,255,0.08);border:1px solid rgba(0,170,255,0.2);border-radius:3px;padding:10px;text-align:center"><div style="width:28px;height:28px;border-radius:50%;background:rgba(0,170,255,0.15);display:inline-flex;align-items:center;justify-content:center;margin-bottom:6px"><i class="fas fa-user-plus" style="color:#00aaff;font-size:0.75rem"></i></div><div style="font-size:0.68rem;font-weight:700;color:#fff">1. Account</div><div style="font-size:0.62rem;color:#8ea4b8">Created &amp; provisioned</div></div><div style="background:rgba(0,170,255,0.08);border:1px solid rgba(0,170,255,0.2);border-radius:3px;padding:10px;text-align:center"><div style="width:28px;height:28px;border-radius:50%;background:rgba(0,170,255,0.15);display:inline-flex;align-items:center;justify-content:center;margin-bottom:6px"><i class="fas fa-wallet" style="color:#00aaff;font-size:0.75rem"></i></div><div style="font-size:0.68rem;font-weight:700;color:#fff">2. Wallet Funded</div><div style="font-size:0.62rem;color:#8ea4b8">12 XRP reserve</div></div><div style="background:rgba(201,168,76,0.08);border:1px solid rgba(201,168,76,0.2);border-radius:3px;padding:10px;text-align:center"><div style="width:28px;height:28px;border-radius:50%;background:rgba(201,168,76,0.15);display:inline-flex;align-items:center;justify-content:center;margin-bottom:6px"><i class="fas fa-coins" style="color:#c9a84c;font-size:0.75rem"></i></div><div style="font-size:0.68rem;font-weight:700;color:#fff">3. Credits Allocated</div><div style="font-size:0.62rem;color:#8ea4b8">Based on plan tier</div></div><div style="background:rgba(0,170,255,0.08);border:1px solid rgba(0,170,255,0.2);border-radius:3px;padding:10px;text-align:center"><div style="width:28px;height:28px;border-radius:50%;background:rgba(0,170,255,0.15);display:inline-flex;align-items:center;justify-content:center;margin-bottom:6px"><i class="fas fa-arrow-right" style="color:#00aaff;font-size:0.75rem"></i></div><div style="font-size:0.68rem;font-weight:700;color:#fff">4. 0.01 Credits &rarr; Treasury</div><div style="font-size:0.62rem;color:#8ea4b8">Per anchor fee</div></div></div><div style="margin-top:10px;padding:8px 12px;background:rgba(0,0,0,0.25);border-radius:3px;font-size:0.7rem"><div style="display:flex;justify-content:space-between;flex-wrap:wrap;gap:6px"><div><span style="color:#8ea4b8">Wallet:</span> <span style="color:#00aaff;font-family:monospace" id="sidebarWalletAddr">rMLmk...f1KLqJ</span></div><div><span style="color:#8ea4b8">Balance:</span> <span style="color:#c9a84c;font-weight:700" id="sidebarSlsBal">'+(document.getElementById("slsBarBalance")?document.getElementById("slsBarBalance").textContent:"25,000")+" Credits</span></div></div></div></div>";var o=e.querySelector("#slsBalanceBar");o?o.parentNode.insertBefore(n,o.nextSibling):e.insertBefore(n,e.firstChild?e.firstChild.nextSibling:null);var a=!1;t.addEventListener("click",function(){a=!a,n.style.display=a?"block":"none",t.innerHTML=a?'<i class="fas fa-chevron-up" style="margin-right:4px"></i>Hide Flow Details':'<i class="fas fa-chart-simple" style="margin-right:4px"></i>Show Flow Details'})}}function Xe(){var e=document.getElementById("walletSidebar"),t=document.getElementById("walletOverlay");e&&e.classList.remove("open"),t&&t.classList.remove("show")}function Ke(){var e=document.getElementById("slsBarBalance"),t=document.getElementById("walletTriggerBal");e&&t&&(t.textContent=e.textContent||"--")}!function e(){var t="s4_tool_card_order";function n(){return document.getElementById("ilsSubHub")}function o(){var e=n();if(e){var o=localStorage.getItem(t);if(o)try{var a=JSON.parse(o),r=Array.from(e.querySelectorAll(".ils-tool-card")),i={};r.forEach(function(e){var t,n=((e.getAttribute("onclick")||"").match(/openILSTool\('([^']+)'\)/)||[])[1];n&&(i[n]=e)}),a.forEach(function(t){i[t]&&e.appendChild(i[t])})}catch(s){}}}function a(){var e=n();if(e){var o=e.querySelectorAll(".ils-tool-card"),a=[];o.forEach(function(e){var t,n=((e.getAttribute("onclick")||"").match(/openILSTool\('([^']+)'\)/)||[])[1];n&&a.push(n)}),localStorage.setItem(t,JSON.stringify(a))}}function r(){var e=n();if(e){var t=null;e.querySelectorAll(".ils-tool-card").forEach(function(n){n.setAttribute("draggable","true"),n.addEventListener("dragstart",function(e){t=this,this.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain","")}),n.addEventListener("dragend",function(){this.classList.remove("dragging"),e.querySelectorAll(".ils-tool-card").forEach(function(e){e.classList.remove("drag-over")})}),n.addEventListener("dragover",function(e){e.preventDefault(),e.dataTransfer.dropEffect="move",this!==t&&this.classList.add("drag-over")}),n.addEventListener("dragleave",function(){this.classList.remove("drag-over")}),n.addEventListener("drop",function(n){if(n.preventDefault(),this.classList.remove("drag-over"),t&&t!==this){var o=Array.from(e.querySelectorAll(".ils-tool-card")),i,s;o.indexOf(t)<o.indexOf(this)?e.insertBefore(t,this.nextSibling):e.insertBefore(t,this),a(),r()}t=null});var o=null,i=!1,s=null,l=null;n.addEventListener("touchstart",function(e){var t=this;o=setTimeout(function(){i=!0,l=t,t.classList.add("dragging"),(s=t.cloneNode(!0)).style.position="fixed",s.style.pointerEvents="none",s.style.opacity="0.85",s.style.zIndex="9999",s.style.width=t.offsetWidth+"px",s.style.transform="scale(1.05)",s.style.boxShadow="0 8px 32px rgba(0,170,255,0.3)",document.body.appendChild(s)},500)},{passive:!0}),n.addEventListener("touchmove",function(t){if(i&&s){t.preventDefault();var n=t.touches[0];s.style.left=n.clientX-s.offsetWidth/2+"px",s.style.top=n.clientY-s.offsetHeight/2+"px",e.querySelectorAll(".ils-tool-card").forEach(function(e){e.classList.remove("drag-over")});var o=document.elementFromPoint(n.clientX,n.clientY);if(o){var a=o.closest(".ils-tool-card");a&&a!==l&&a.classList.add("drag-over")}}},{passive:!1}),n.addEventListener("touchend",function(t){if(clearTimeout(o),i&&l){var n=t.changedTouches[0],c=document.elementFromPoint(n.clientX,n.clientY),d=c?c.closest(".ils-tool-card"):null;if(d&&d!==l){var u=Array.from(e.querySelectorAll(".ils-tool-card")),f,m;u.indexOf(l)<u.indexOf(d)?e.insertBefore(l,d.nextSibling):e.insertBefore(l,d),a(),r()}l.classList.remove("dragging"),e.querySelectorAll(".ils-tool-card").forEach(function(e){e.classList.remove("drag-over")})}s&&s.parentNode&&s.parentNode.removeChild(s),i=!1,s=null,l=null}),n.addEventListener("touchcancel",function(){clearTimeout(o),s&&s.parentNode&&s.parentNode.removeChild(s),l&&l.classList.remove("dragging"),e.querySelectorAll(".ils-tool-card").forEach(function(e){e.classList.remove("drag-over")}),i=!1,s=null,l=null})})}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){o(),r()}):(o(),r())}(),document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){var e=document.getElementById("platformHub");e&&(e.style.display="block"),document.querySelectorAll(".tab-pane").forEach(function(e){e.classList.remove("show","active"),e.style.display="none"})},100)}),document.addEventListener("shown.bs.tab",function(e){Ke()}),function(){function e(){var e=document.getElementById("actionItemBadge");if(e){var t=0;"undefined"!=typeof s4ActionItems&&Array.isArray(s4ActionItems)&&(t=s4ActionItems.filter(function(e){return!e.done}).length),t>0?(e.textContent=t,e.style.display="inline-flex"):e.style.display="none"}}setInterval(e,3e3),document.addEventListener("DOMContentLoaded",function(){setTimeout(e,2e3)});var t=Ue;Ue=function(n){t(n),setTimeout(e,500)}}(),function(){function e(){var e=document.getElementById("slsBarBalance"),t=document.getElementById("slsBarAnchors"),n=document.getElementById("slsBarSpent"),o=document.getElementById("toolSlsBal"),a=document.getElementById("toolSlsAnch"),r=document.getElementById("toolSlsSpent");o&&e&&(o.textContent=e.textContent.replace(" Credits","")),a&&t&&(a.textContent=t.textContent),r&&n&&(r.textContent=n.textContent.replace(" Credits",""))}setInterval(e,2e3);var t=Ge;Ge=function(n){t(n),setTimeout(e,200)}}(),Ve=hideAnchorAnimation,hideAnchorAnimation=function(){if(Ve(),je){var e=document.getElementById(je);if(!e)return;var t=e.querySelector(".anchor-confirm-banner");t&&t.remove();var n=s4Vault.length>0?s4Vault[0]:null;if(!n)return;var o=document.createElement("div");o.className="anchor-confirm-banner",o.style.cssText="background:linear-gradient(135deg,rgba(0,204,102,0.08),rgba(0,170,255,0.06));border:1px solid rgba(0,204,102,0.2);border-radius:3px;padding:16px 20px;margin-bottom:16px;animation:panelSlideIn 0.4s ease;position:relative",o.innerHTML='<button onclick="this.parentElement.remove()" style="position:absolute;top:8px;right:12px;background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.85rem">&times;</button><div style="display:flex;align-items:center;gap:8px;margin-bottom:8px"><i class="fas fa-check-circle" style="color:#00cc66;font-size:1.1rem"></i><strong style="color:#fff;font-size:0.9rem">Record Anchored Successfully</strong></div><div style="font-size:0.78rem;color:var(--steel);display:grid;grid-template-columns:80px 1fr;gap:4px 12px"><span style="color:var(--muted)">Type:</span><span>'+(n.label||n.type)+'</span><span style="color:var(--muted)">Hash:</span><span style="font-family:monospace;color:var(--accent);font-size:0.72rem;word-break:break-all">'+(n.hash||"").substring(0,32)+'...</span><span style="color:var(--muted)">TX:</span><span>'+(n.txHash?'<a href="'+(n.explorerUrl||"#")+'" target="_blank" style="color:var(--accent);text-decoration:none">'+n.txHash.substring(0,16)+'... <i class="fas fa-external-link-alt" style="font-size:0.6rem"></i></a>':"Pending")+'</span><span style="color:var(--muted)">Fee:</span><span style="color:#c9a84c">0.01 Credits</span><span style="color:var(--muted)">Time:</span><span>'+(new Date).toLocaleTimeString()+"</span></div>";var a=e.querySelector(".s4-card");a&&a.insertBefore(o,a.firstChild),setTimeout(function(){o.parentElement&&o.remove()},15e3)}},window.closeILSTool=Qe,window.closeWalletSidebar=Xe,window.openILSTool=Ge,window.openWalletSidebar=Ye,window.showHub=We,window.showSection=Ue,window.showSystemsSub=Je,function e(){function t(e){var t=document.getElementById(e);if(t){var n=t.querySelector("details");if(n){n.style.display="none";var o="s4_hiw_"+e,a=t.querySelector("h3")||t.querySelector("h4")||t.querySelector(".hub-tool-header h4")||t.querySelector("h5");if(a&&!a.querySelector(".hiw-help-btn")){var r=document.createElement("button");r.className="hiw-help-btn",r.title="How It Works",r.textContent="?",r.style.cssText="margin-left:8px;background:rgba(0,170,255,0.12);border:1px solid rgba(0,170,255,0.3);color:#00aaff;border-radius:50%;width:22px;height:22px;font-size:0.72rem;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;vertical-align:middle;",r.onclick=function(e){e.stopPropagation(),i()},a.appendChild(r)}}}function i(){var e=document.querySelector(".hiw-modal-overlay");e&&e.remove();var t=n.querySelector("summary")?n.querySelector("summary").textContent.replace(/[▸▾]/g,"").trim():"How It Works",o="";n.querySelectorAll("p,ol,ul,li").forEach(function(e){o+=e.outerHTML}),o||(o=n.innerHTML.replace(/<summary[^>]*>.*?<\/summary>/i,""));var a=document.createElement("div");a.className="hiw-modal-overlay",a.innerHTML='<div class="hiw-modal-box"><button class="hiw-close" title="Close">&times;</button><h4><i class="fas fa-info-circle" style="margin-right:6px"></i>'+t+'</h4><div class="hiw-body">'+o+"</div></div>",a.querySelector(".hiw-close").onclick=function(){a.remove()},a.onclick=function(e){e.target===a&&a.remove()},document.body.appendChild(a)}}function n(){t("tabAnchor"),t("tabVerify")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n()}(),function e(){function t(){document.querySelectorAll(".hub-card[data-section]").forEach(function(e){e._s4bound||(e._s4bound=!0,e.addEventListener("click",function(e){var t=this.getAttribute("data-section");t&&"function"==typeof Ue&&Ue(t)}))})}t(),"loading"===document.readyState&&document.addEventListener("DOMContentLoaded",t)}();var Ze={ils_manager:{label:"ILS Manager",icon:"fa-clipboard-list",desc:"Full ILS tool suite access",tabs:["hub-analysis","hub-dmsms","hub-readiness","hub-compliance","hub-risk","hub-actions","hub-predictive","hub-lifecycle","hub-roi","hub-vault","hub-docs","hub-reports","hub-submissions","hub-sbom","hub-gfp","hub-cdrl","hub-contract","hub-provenance","hub-analytics","hub-team"]},dmsms_analyst:{label:"DMSMS Analyst",icon:"fa-microchip",desc:"DMSMS tracking and obsolescence management",tabs:["hub-dmsms","hub-risk","hub-lifecycle","hub-actions","hub-vault","hub-docs","hub-reports"]},auditor:{label:"Auditor / Compliance",icon:"fa-shield-halved",desc:"Compliance scorecard and audit vault",tabs:["hub-compliance","hub-vault","hub-actions","hub-docs","hub-reports","hub-submissions"]},contracts:{label:"Contract Specialist",icon:"fa-file-contract",desc:"ROI, submissions, and document management",tabs:["hub-roi","hub-vault","hub-docs","hub-reports","hub-submissions","hub-actions","hub-cdrl","hub-contract"]},supply_chain:{label:"Supply Chain / Provisioning",icon:"fa-truck",desc:"Supply, readiness, and provisioning tools",tabs:["hub-readiness","hub-risk","hub-lifecycle","hub-actions","hub-vault","hub-docs","hub-submissions"]},admin:{label:"Full Access Admin",icon:"fa-user-shield",desc:"All tools visible — unrestricted access",tabs:["hub-analysis","hub-dmsms","hub-readiness","hub-compliance","hub-risk","hub-actions","hub-predictive","hub-lifecycle","hub-roi","hub-vault","hub-docs","hub-reports","hub-submissions","hub-sbom","hub-gfp","hub-cdrl","hub-contract","hub-provenance","hub-analytics","hub-team"]}},et=["hub-analysis","hub-dmsms","hub-readiness","hub-compliance","hub-risk","hub-actions","hub-predictive","hub-lifecycle","hub-roi","hub-vault","hub-docs","hub-reports","hub-submissions","hub-sbom","hub-gfp","hub-cdrl","hub-contract","hub-provenance","hub-analytics","hub-team"],tt={"hub-analysis":"Gap Analysis","hub-dmsms":"DMSMS Tracker","hub-readiness":"Readiness Calc","hub-compliance":"Compliance","hub-risk":"Supply Chain Risk","hub-actions":"Action Items","hub-predictive":"Predictive Maint","hub-lifecycle":"Lifecycle Cost","hub-roi":"ROI Calculator","hub-vault":"Audit Vault","hub-docs":"Document Library","hub-reports":"Report Gen","hub-submissions":"Submissions & PTD","hub-sbom":"SBOM Viewer","hub-gfp":"GFP Tracker","hub-cdrl":"CDRL Validator","hub-contract":"Contract Extractor","hub-provenance":"Provenance Chain","hub-analytics":"Cross-Program Analytics","hub-team":"Team Management"},nt=sessionStorage.getItem("s4_user_role")||"",ot=sessionStorage.getItem("s4_user_title")||"",at=JSON.parse(sessionStorage.getItem("s4_visible_tabs")||"null");function rt(){var e=document.getElementById("roleModal");e&&e.remove();var t=document.createElement("div");t.id="roleModal",t.style.cssText="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);z-index:10000;display:flex;align-items:center;justify-content:center;animation:fadeIn 0.3s ease";var n=document.createElement("div");n.style.cssText="background:#0d1117;border:1px solid rgba(255,255,255,0.12);border-radius:3px;padding:32px;max-width:620px;width:95%;max-height:85vh;overflow-y:auto",n.innerHTML='<h3 style="color:#fff;margin:0 0 4px"><i class="fas fa-user-cog" style="color:#00aaff;margin-right:8px"></i>Configure Your Role</h3><p style="color:#8b949e;font-size:0.85rem;margin-bottom:20px">Select your role to see relevant tools. You can customize visible tools and your displayed title.</p><div style="margin-bottom:16px"><label style="color:#8b949e;font-size:0.8rem;font-weight:600">Your Display Title</label><input id="roleTitle" value="'+(ot||"")+'" style="background:#0a0e1a;color:#fff;border:1px solid rgba(255,255,255,0.15);border-radius:3px;padding:10px;width:100%;margin-top:4px;box-sizing:border-box" placeholder="e.g., ILS Analyst, Logistics Specialist, Contract Manager"></div>';var o=document.createElement("div");o.style.cssText="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px";for(var a=Object.keys(Ze),r=0;r<a.length;r++)(function(e){var t=Ze[e],n=nt===e,a=document.createElement("div");a.className="role-card",a.setAttribute("data-role",e),a.style.cssText="border:2px solid "+(n?"#00aaff":"rgba(255,255,255,0.12)")+";border-radius:3px;padding:14px;cursor:pointer;transition:all 0.2s;user-select:none;"+(n?"background:rgba(0,170,255,0.15);box-shadow:0 0 12px rgba(0,170,255,0.2)":""),a.innerHTML='<div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;pointer-events:none"><i class="fas '+t.icon+'" style="color:#00aaff;font-size:1.1rem"></i><strong style="color:#fff;font-size:0.9rem">'+t.label+'</strong></div><div style="color:#8b949e;font-size:0.78rem;pointer-events:none">'+t.desc+'</div><div style="color:#6e7681;font-size:0.72rem;margin-top:4px;pointer-events:none">'+t.tabs.length+" tools</div>",a.addEventListener("click",function(t){t.stopPropagation(),it(e)}),o.appendChild(a)})(a[r]);n.appendChild(o);for(var i='<details style="margin-bottom:20px;background:rgba(0,170,255,0.03);border:1px solid rgba(0,170,255,0.12);border-radius:3px;padding:0 16px"><summary style="cursor:pointer;color:#00aaff;font-weight:600;font-size:0.85rem;padding:12px 0;list-style:none;display:flex;align-items:center;gap:8px"><i class="fas fa-sliders-h"></i> Customize Visible Tools <i class="fas fa-chevron-down" style="font-size:0.7rem;margin-left:auto;opacity:0.5"></i></summary><div id="roleToolChecks" style="display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:0 0 16px">',s=0;s<et.length;s++){var l=et[s],c;i+='<label style="display:flex;align-items:center;gap:8px;font-size:0.82rem;color:#8b949e;cursor:pointer;padding:6px 10px;border-radius:3px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);transition:all 0.2s"><input type="checkbox" data-tab="'+l+'" '+((at?at.indexOf(l)>=0:!nt||(Ze[nt]?.tabs||[]).indexOf(l)>=0)?"checked":"")+' style="accent-color:#00aaff;width:16px;height:16px;flex-shrink:0"> <span>'+(tt[l]||l)+"</span></label>"}i+="</div></details>";var d=document.createElement("div");d.innerHTML=i,n.appendChild(d.firstElementChild);var u=document.createElement("div");u.style.cssText="display:flex;gap:10px;justify-content:flex-end";var f=document.createElement("button");f.textContent="Cancel",f.style.cssText="background:rgba(255,255,255,0.06);color:#8b949e;border:1px solid rgba(255,255,255,0.12);border-radius:3px;padding:8px 20px;cursor:pointer",f.addEventListener("click",function(e){e.stopPropagation(),t.remove()});var m=document.createElement("button");m.textContent="Apply Role",m.style.cssText="background:#00aaff;color:#fff;border:none;border-radius:3px;padding:8px 24px;cursor:pointer;font-weight:600",m.addEventListener("click",function(e){e.stopPropagation(),lt()}),u.appendChild(f),u.appendChild(m),n.appendChild(u),t.appendChild(n),t.addEventListener("change",function(e){e.target&&e.target.matches&&e.target.matches('#roleToolChecks input[type="checkbox"]')&&st()}),document.body.appendChild(t)}function it(e){nt=e;for(var t=document.querySelectorAll("#roleModal .role-card"),n=0;n<t.length;n++)t[n].style.borderColor="rgba(255,255,255,0.12)",t[n].style.background="",t[n].style.boxShadow="";var o=document.querySelector('#roleModal .role-card[data-role="'+e+'"]');o&&(o.style.borderColor="#00aaff",o.style.background="rgba(0,170,255,0.15)",o.style.boxShadow="0 0 12px rgba(0,170,255,0.2)");for(var a=Ze[e].tabs,r=document.querySelectorAll('#roleToolChecks input[type="checkbox"]'),i=0;i<r.length;i++)r[i].checked=a.indexOf(r[i].dataset.tab)>=0;var s=document.getElementById("roleTitle");s&&!s.value&&(s.value=Ze[e].label)}function st(){at=[],document.querySelectorAll('#roleToolChecks input[type="checkbox"]').forEach(function(e){e.checked&&at.push(e.dataset.tab)})}function lt(){var e=document.getElementById("roleTitle")?.value?.trim()||"",t;ot=e,sessionStorage.setItem("s4_user_role",nt),sessionStorage.setItem("s4_user_title",ot),at?(t=at,sessionStorage.setItem("s4_visible_tabs",JSON.stringify(at))):nt&&Ze[nt]?(t=Ze[nt].tabs,sessionStorage.removeItem("s4_visible_tabs")):t=et,ct(t),dt(),"function"==typeof reloadVaultForRole&&reloadVaultForRole(),document.getElementById("roleModal")?.remove(),"function"==typeof s4Notify&&s4Notify("Role Applied",(e||Ze[nt]?.label||"Custom")+" — "+t.length+" tools active","success")}function ct(e){document.querySelectorAll(".ils-hub-tab").forEach(function(t){var n,o=(t.getAttribute("onclick")||"").match(/switchHubTab\('([^']+)'/);if(o){var a=o[1];t.style.display=e.indexOf(a)>=0?"":"none"}}),document.querySelectorAll(".ils-tool-card[onclick]").forEach(function(t){var n,o=(t.getAttribute("onclick")||"").match(/openILSTool\('([^']+)'/);o&&(t.style.display=e.indexOf(o[1])>=0?"":"none")})}function dt(){var e=document.getElementById("roleBadge");if(!e){var t=document.querySelector(".ils-hub-tabs")?.previousElementSibling;if(!t)return;var n=t.querySelector("div:last-child");if(!n)return;(e=document.createElement("span")).id="roleBadge",e.style.cssText="display:inline-flex;align-items:center;gap:6px;padding:5px 12px;border-radius:3px;font-size:0.75rem;font-weight:600;background:rgba(0,170,255,0.1);border:1px solid rgba(0,170,255,0.25);color:#00aaff;cursor:pointer;transition:all 0.2s;hover:background:rgba(0,170,255,0.2)",e.title="Click to change your role",e.onclick=rt,n.appendChild(e)}var o=nt?Ze[nt]?.icon||"fa-user":"fa-user-cog",a=ot||(nt?Ze[nt]?.label:"Set Role");e.innerHTML='<i class="fas '+o+'"></i> '+a+' <i class="fas fa-gear" style="font-size:0.6rem;opacity:0.6"></i>'}function ut(){var e;nt&&(ct(at||(Ze[nt]?Ze[nt].tabs:et)),"function"==typeof reloadVaultForRole&&reloadVaultForRole());dt(),nt||setTimeout(function(){var e=document.getElementById("platformWorkspace");e&&"block"===e.style.display&&sessionStorage.getItem("s4_onboard_done")&&rt()},2500)}!function(){function e(e){return Math.round(e).toString().replace(/\B(?=(?:\d{3})+(?!\d))/g,",")}function t(){try{var t=function(e){var t=document.getElementById(e);return t&&parseFloat(t.value)||0},n=t("roiPrograms"),o=t("roiRecords"),a=t("roiFTEs"),r=t("roiRate"),i=t("roiAudit"),s=t("roiError"),l=t("roiIncidents"),c=t("roiLicense"),d=n*o,u=1+Math.sqrt(Math.max(0,d))/50,f,m,p=.65*(2080*a*r)*u,y=l*s*.9,g=.7*i*Math.max(1,n/5),h=d>0?p/12/d:0,b=p+y+g,v=b-c,S=c>0?v/c*100:0,w=b>0?Math.ceil(c/b*12):0,x=5*b-5*c,C=function(e,t,n){var o=document.getElementById(e);o&&(o.textContent=t,n&&(o.style.color=n))};C("roiSavings","$"+e(v),v>0?"#00cc66":"#ff4444"),C("roiPercent",S.toFixed(0)+"%",S>0?"#00cc66":"#ff4444"),C("roiPayback",w+" mo",null),C("roi5Year","$"+e(x),x>0?"#00cc66":"#ff4444");var I=document.getElementById("roiOutput");I&&(I.innerHTML='<div style="background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:20px;margin-top:12px"><div class="section-label"><i class="fas fa-chart-line"></i> ROI BREAKDOWN</div><div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;font-size:0.85rem;margin-bottom:16px"><div><span style="color:var(--steel)">Labor Automation (65%)</span><br><strong style="color:#00cc66">$'+e(p)+'</strong></div><div><span style="color:var(--steel)">Error Reduction (90%)</span><br><strong style="color:#00cc66">$'+e(y)+'</strong></div><div><span style="color:var(--steel)">Audit Cost Reduction (70%)</span><br><strong style="color:#00cc66">$'+e(g)+'</strong></div><div><span style="color:var(--steel)">S4 Ledger License</span><br><strong style="color:#ff6b6b">-$'+e(c)+'</strong></div></div><hr style="border-color:var(--border);margin:12px 0"><div style="display:flex;justify-content:space-between;align-items:center"><div><span style="color:var(--steel);font-size:0.82rem">Net Annual Savings</span><br><span style="font-size:1.5rem;font-weight:800;color:'+(v>0?"#00cc66":"#ff4444")+'">$'+e(v)+'</span></div><div><span style="color:var(--steel);font-size:0.82rem">Per-Record Savings</span><br><span style="font-size:1.1rem;font-weight:700;color:var(--accent)">$'+h.toFixed(2)+'/record</span></div><div><span style="color:var(--steel);font-size:0.82rem">Volume Multiplier</span><br><span style="font-size:1.1rem;font-weight:700;color:var(--accent)">'+u.toFixed(2)+"x</span></div></div></div>");try{"function"==typeof renderROICharts&&renderROICharts()}catch(E){}}catch(L){console.error("[S4-BP-ROI] Error:",L)}}function n(){var e,n=0;return["roiPrograms","roiRecords","roiFTEs","roiRate","roiAudit","roiError","roiIncidents","roiLicense"].forEach(function(e){var o=document.getElementById(e);o&&(o.removeAttribute("oninput"),o.addEventListener("input",t),n++)}),n>0&&t(),n}function o(){var e={};try{var t=document.querySelectorAll('#ilsCoverage input[type="checkbox"], .ils-checklist input[type="checkbox"]'),n=0,o=t.length||1;t.forEach(function(e){e.checked&&n++}),e.ilsPct=Math.round(n/o*100)}catch(i){e.ilsPct=0}var a=["pctCMMC","pctNIST","pctDFARS","pctFAR","pctILS","pctDMSMSmgmt"];e.comp=a.map(function(e){var t=document.getElementById(e);return t&&parseInt(t.textContent)||0}),e.vault="undefined"!=typeof s4Vault?s4Vault.length:"function"==typeof getLocalRecords?getLocalRecords().length:0,e.actions="undefined"!=typeof s4ActionItems?s4ActionItems.length:0,e.actionsDone=0,"undefined"!=typeof s4ActionItems&&s4ActionItems.forEach(function(t){"done"===t.status&&e.actionsDone++});var r=function(e){var t=document.getElementById(e);return t&&parseFloat(t.value)||0};return e.roiPrograms=r("roiPrograms"),e.roiRecords=r("roiRecords"),e.roiFTEs=r("roiFTEs"),e.roiRate=r("roiRate"),e.roiLicense=r("roiLicense"),e.roiAudit=r("roiAudit"),e.stats="undefined"!=typeof stats?stats:{anchored:0,slsFees:0},e.dmsmsItems="undefined"!=typeof dmsmsItems?dmsmsItems:[],e.riskItems="undefined"!=typeof riskItems?riskItems:[],e}window._s4PatchChartTheme=function e(t){var n;if(!document.body.classList.contains("light-mode"))return t;var o="rgba(0,0,0,0.08)",a="#3a4a5c",r="#2c3e50",i="#2c3e50",s="#2c3e50",l="rgba(0,0,0,0.08)",c="#3a4a5c",d="rgba(255,255,255,0.96)",u="#111",f="#333";if(t.options&&t.options.plugins){var m=t.options.plugins;m.legend&&m.legend.labels&&(m.legend.labels.color=s),m.title&&(m.title.color=i),m.tooltip&&(m.tooltip.backgroundColor&&(m.tooltip.backgroundColor=d),m.tooltip.titleColor&&(m.tooltip.titleColor=u),m.tooltip.bodyColor&&(m.tooltip.bodyColor=f))}if(t.options&&t.options.scales){var p=t.options.scales;Object.keys(p).forEach(function(e){var t=p[e];t.ticks&&(t.ticks.color=a),t.grid&&(t.grid.color=o),t.angleLines&&(t.angleLines.color=l),t.pointLabels&&(t.pointLabels.color=c),t.title&&t.title.display&&(t.title.color=i)})}return t.data&&t.data.datasets&&t.data.datasets.forEach(function(e){"rgba(255,255,255,0.2)"===e.borderColor&&(e.borderColor="rgba(0,0,0,0.2)")}),t},function(){function e(){"undefined"!=typeof Chart&&Chart.register({id:"s4ThemePatch",beforeInit:function(e){if(document.body.classList.contains("light-mode")){var t="rgba(0,0,0,0.08)",n="#3a4a5c",o="#2c3e50";if(e.options&&e.options.scales&&Object.keys(e.options.scales).forEach(function(a){var r=e.options.scales[a];r.ticks&&r.ticks.color&&("#8ea4b8"===r.ticks.color||"#6b7d93"===r.ticks.color)&&(r.ticks.color=n),r.grid&&r.grid.color&&"string"==typeof r.grid.color&&r.grid.color.indexOf("255,255,255")>=0&&(r.grid.color=t),r.angleLines&&r.angleLines.color&&r.angleLines.color.indexOf("255,255,255")>=0&&(r.angleLines.color=t),r.pointLabels&&r.pointLabels.color&&("#8ea4b8"===r.pointLabels.color||"#6b7d93"===r.pointLabels.color)&&(r.pointLabels.color=n),r.title&&r.title.color&&"#8ea4b8"===r.title.color&&(r.title.color=o)}),e.options&&e.options.plugins){var a=e.options.plugins;a.legend&&a.legend.labels&&a.legend.labels.color&&("#8ea4b8"===a.legend.labels.color||"#6b7d93"===a.legend.labels.color)&&(a.legend.labels.color=o),a.title&&"#8ea4b8"===a.title.color&&(a.title.color=o)}}}})}"undefined"!=typeof Chart?e():document.addEventListener("DOMContentLoaded",function(){setTimeout(e,500)})}();var a={gapRadarChart:function(){var e=o(),t=Math.min(100,20+3*e.vault),n=Math.min(100,15+4*e.vault),a=Math.min(100,e.comp[0]||10),r=Math.min(100,10+8*(e.dmsmsItems.length||0)),i=Math.min(100,15+5*(e.riskItems.length||0)),s=Math.min(100,20+.6*e.ilsPct),l=[t,n,a,r,i,s].map(function(e){return Math.min(100,e+30+5*Math.random()|0)});return{type:"radar",data:{labels:["Tracking","Audit","Compliance","Obsolescence","Risk","Budget"],datasets:[{label:"Current (Manual)",data:[t,n,a,r,i,s],borderColor:"#ff6b6b",backgroundColor:"rgba(255,107,107,0.1)",pointBackgroundColor:"#ff6b6b"},{label:"With S4 Ledger",data:l,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",pointBackgroundColor:"#00aaff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"#8ea4b8",font:{size:10}}}},scales:{r:{grid:{color:"rgba(255,255,255,0.06)"},angleLines:{color:"rgba(255,255,255,0.06)"},pointLabels:{color:"#8ea4b8",font:{size:9}},ticks:{display:!1}}}}}},gapBarChart:function(){var e=o(),t,n,a,r,i,s;return{type:"bar",data:{labels:["Tracking","Audit","Compliance","Obsolescence","Risk","Budget"],datasets:[{label:"Gap %",data:[Math.max(0,100-(20+3*e.vault)),Math.max(0,100-(15+4*e.vault)),Math.max(0,100-(e.comp[0]||10)),Math.max(0,100-(10+8*(e.dmsmsItems.length||0))),Math.max(0,100-(15+5*(e.riskItems.length||0))),Math.max(0,100-(20+.6*e.ilsPct))],backgroundColor:["#ff6b6b","#fb923c","#c9a84c","#00aaff","#38bdf8","#06b6d4"],borderWidth:0,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},max:100},y:{ticks:{color:"#8ea4b8",font:{size:9}},grid:{display:!1}}}}}},dmsmsPieChart:function(){var e,t=o().dmsmsItems,n=0,a=0,r=0,i=0,s=0;return t.length>0?t.forEach(function(e){var t=(e.status||"").toLowerCase();t.indexOf("obsolete")>=0?r++:t.indexOf("risk")>=0||t.indexOf("diminish")>=0?a++:t.indexOf("discontin")>=0?i++:t.indexOf("eol")>=0||t.indexOf("last")>=0?s++:n++}):(n=45,a=20,r=15,i=10,s=10),{type:"doughnut",data:{labels:["Active","At Risk","Obsolete","Discontinued","EOL Planned"],datasets:[{data:[n,a,r,i,s],backgroundColor:["#00aaff","#c9a84c","#ff6b6b","#00aaff","#6b7d93"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:9},padding:6}}}}}},readinessGauge:function(){var e=o(),t=Math.max(30,e.ilsPct),n,a,r,i,s,l;return{type:"bar",data:{labels:["Personnel","Equipment","Supply","Training","Maintenance","C4ISR"],datasets:[{label:"Readiness %",data:[Math.min(100,t+15+(e.vault>5?10:0)),Math.min(100,t+(e.dmsmsItems.length>0?-5:8)),Math.min(100,t-12+2*e.vault),Math.min(100,t+20),Math.min(100,t+6+3*e.actionsDone),Math.min(100,t+12)],backgroundColor:"rgba(0,170,255,0.6)",borderColor:"#00aaff",borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:9}},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0,max:100}}}}},complianceRadarChart:function(){var e=o(),t,n,a,r,i,s;return{type:"polarArea",data:{labels:["DFARS","ITAR","NIST 800-171","CMMC","ISO 27001","SOX"],datasets:[{data:[e.comp[2]||30,Math.min(100,40+4*e.vault),e.comp[1]||25,e.comp[0]||20,Math.min(100,30+.5*e.ilsPct),Math.min(100,35+3*e.vault)],backgroundColor:["rgba(0,170,255,0.5)","rgba(201,168,76,0.5)","rgba(56,189,248,0.5)","rgba(255,107,107,0.5)","rgba(0,170,255,0.5)","rgba(6,182,212,0.5)"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:9},padding:6}}},scales:{r:{grid:{color:"rgba(255,255,255,0.06)"},ticks:{display:!1}}}}}},roiLineChart:function(){var e=o(),t=e.roiPrograms*e.roiRecords,n=1+Math.sqrt(Math.max(0,t))/50,a,r,i,s=.65*(2080*e.roiFTEs*e.roiRate)*n+.7*e.roiAudit*Math.max(1,e.roiPrograms/5),l=e.roiLicense||1,c=[],d=[],u=e.roiPrograms>0||e.roiFTEs>0||e.roiLicense>0;if(u)for(var f=0,m=1;m<=5;m++)for(var p=1;p<=4;p++){c.push("Y"+m+"-Q"+p);var y=4*(m-1)+p,g,h,b;f+=s/4*(.2+.65*(1-Math.exp(-.18*y)))-l/4;var v=l>0?f/l*100:0;d.push(Math.round(v))}if(!u||0===d.length||d.every(function(e){return 0===e})){c=[],d=[];for(var S=1;S<=5;S++)for(var w=1;w<=4;w++){c.push("Y"+S+"-Q"+w);var y=4*(S-1)+w;d.push(Math.round(3.5*y-15+.8*Math.pow(y,1.45)))}}return{type:"line",data:{labels:c,datasets:[{label:"Cumulative ROI %",data:d,borderColor:"#00cc66",backgroundColor:"rgba(0,204,102,0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"#00cc66"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"5-Year Cumulative ROI",color:"#8ea4b8",font:{size:11}}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:8},maxRotation:45},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:9},callback:function(e){return e+"%"}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}}},riskHeatChart:function(){var e=o(),t=[];if(e.riskItems.length>0)e.riskItems.forEach(function(e){t.push({x:e.likelihood||Math.ceil(9*Math.random()),y:e.impact||Math.ceil(9*Math.random())})});else for(var n=Math.max(3,Math.min(12,3+e.vault+e.actions)),a=0;a<n;a++)t.push({x:1+Math.floor(9*Math.random()),y:1+Math.floor(9*Math.random())});var r=t.map(function(e){var t=e.x*e.y;return t>=50?"rgba(255,70,70,0.8)":t>=25?"rgba(255,165,0,0.7)":t>=10?"rgba(201,168,76,0.6)":"rgba(0,170,255,0.5)"});return{type:"scatter",data:{datasets:[{label:"Risk Items",data:t,backgroundColor:r,borderColor:r,pointRadius:7}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:t.length+" Risk Items Mapped",color:"#8ea4b8",font:{size:11}}},scales:{x:{title:{display:!0,text:"Likelihood →",color:"#8ea4b8",font:{size:9}},ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},min:0,max:10},y:{title:{display:!0,text:"Impact →",color:"#8ea4b8",font:{size:9}},ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},min:0,max:10}}}}},lifecyclePieChart:function(){var e=o(),t=Math.min(30,5*(e.dmsmsItems.length||0)),n=Math.min(15,.15*e.ilsPct);return{type:"line",data:{labels:["Intro","Growth","Maturity","Sustain","Phase Out","Disposal"],datasets:[{label:"Availability %",data:[95-.1*t,92-.2*t+n,88-.4*t+n,75-.6*t+2*n,50-.3*t+n,20+.5*n].map(function(e){return Math.round(Math.max(5,Math.min(100,e)))}),borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",fill:!0,tension:.3},{label:"Cost Index",data:[30,25+.3*t,35+.5*t,55+.8*t-n,70+t-2*n,90+.5*t-n].map(function(e){return Math.round(Math.max(5,Math.min(100,e)))}),borderColor:"#ff6b6b",backgroundColor:"rgba(255,107,107,0.05)",fill:!0,tension:.3}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"#8ea4b8",font:{size:10}}}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:9}},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}}}};function r(e){if("undefined"==typeof Chart)return console.warn("[S4-BP-Charts] Chart.js not loaded"),void 0;if("function"==typeof injectChartContainers)try{injectChartContainers()}catch(n){console.error("[S4-BP-Charts] injectChartContainers error:",n)}var t=e.querySelectorAll("canvas");if(0===t.length)return console.log("[S4-BP-Charts] No canvases found in panel "+e.id),void 0;t.forEach(function(e){if(!e.getAttribute("data-bp-rendered")){var t=a[e.id];if(!t)return console.log("[S4-BP-Charts] No config for canvas: "+e.id),void 0;try{var n=Chart.getChart(e);n&&n.destroy(),e.style.height||e.getAttribute("height")||(e.style.height="220px"),e.style.width="100%",e.style.display="block";var o=e.closest(".chart-container");o&&(o.style.display="block",o.style.visibility="visible"),new Chart(e,_s4PatchChartTheme(t())),e.setAttribute("data-bp-rendered","1"),e.setAttribute("data-bp-ts",Date.now()),console.log("[S4-BP-Charts] Rendered: "+e.id)}catch(r){console.error("[S4-BP-Charts] Failed "+e.id+":",r)}}})}function i(){if(console.log("[S4-Bulletproof-v5] Initializing..."),0===n()&&(setTimeout(n,2e3),setTimeout(n,5e3)),window.calcROI=t,"function"==typeof window.openILSTool){var e=window.openILSTool;window.openILSTool=function(t){e(t),setTimeout(function(){var e=document.getElementById(t);e&&r(e)},300),setTimeout(function(){var e=document.getElementById(t);e&&r(e)},800),setTimeout(function(){var e=document.getElementById(t);e&&r(e)},2e3)},console.log("[S4-Bulletproof-v5] Hooked openILSTool")}if("function"==typeof window.switchHubTab){var o=window.switchHubTab;window.switchHubTab=function(e,t){o(e,t),setTimeout(function(){var t=document.getElementById(e);t&&r(t)},400)}}document.querySelectorAll(".ils-hub-panel").forEach(function(e){var t;new MutationObserver(function(e){e.forEach(function(e){e.target.classList&&e.target.classList.contains("active")&&setTimeout(function(){r(e.target)},400)})}).observe(e,{attributes:!0,attributeFilter:["class","style"]})}),setTimeout(function(){document.querySelectorAll(".ils-hub-panel.active").forEach(function(e){r(e)})},2e3),setTimeout(function(){if("function"==typeof loadPerformanceMetrics)try{loadPerformanceMetrics()}catch(e){}},1500),setTimeout(n,3e3),1,ut(),console.log("[S4-Bulletproof-v5] Init complete")}window._bpRenderInPanel=r,window._s4RefreshCharts=function(){document.querySelectorAll("canvas[data-bp-rendered]").forEach(function(e){e.removeAttribute("data-bp-rendered")});var e=document.querySelector(".ils-hub-panel.active");e&&r(e)},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):i()}(),window.showRoleSelector=rt,window.applyRole=lt,window.onRoleToolToggle=st,window.selectRolePreset=it;
//# sourceMappingURL=index-BCzaCH3i.js.map
