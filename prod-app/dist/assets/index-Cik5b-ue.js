import"./engine-BFla_Dyb.js";import"./enhancements-BhVLUfDx.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const f of s)if(f.type==="childList")for(const m of f.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&o(m)}).observe(document,{childList:!0,subtree:!0});function r(s){const f={};return s.integrity&&(f.integrity=s.integrity),s.referrerPolicy&&(f.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?f.credentials="include":s.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function o(s){if(s.ep)return;s.ep=!0;const f=r(s);fetch(s.href,f)}})();window.supabase&&(window._sbClient=window.supabase.createClient("https://ysmwkkdpjgjokukxolel.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlzbXdra2Rwamdqb2t1a3hvbGVsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwMzA3NDQsImV4cCI6MjA4NzYwNjc0NH0.4u56RJ61Q5cqnqMqIEWwg50q6MlV8bEvueA45enQgxE"));document.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()},!1);document.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation()},!1);window.S4=window.S4||{version:"5.12.0",env:"production",buildDate:"2026-02-26",modules:{},register:function(e,t){this.modules[e]=t},getModule:function(e){return this.modules[e]||null}};(function(){S4.metrics={_data:{lcp:null,fid:null,cls:0,ttfb:null,fcp:null,errors:[],apiLatency:[]},_startTime:performance.now(),record:function(t,r){this._data[t]=r},addApiLatency:function(t,r){this._data.apiLatency.push({endpoint:t,ms:r,ts:Date.now()}),this._data.apiLatency.length>200&&this._data.apiLatency.shift()},getReport:function(){return Object.assign({},this._data,{uptime:Math.round((performance.now()-this._startTime)/1e3),memoryMB:performance.memory?Math.round(performance.memory.usedJSHeapSize/1048576):null,version:S4.version,env:S4.env,timestamp:new Date().toISOString()})}};try{typeof PerformanceObserver<"u"&&(new PerformanceObserver(function(t){var r=t.getEntries();r.length>0&&S4.metrics.record("lcp",Math.round(r[r.length-1].startTime))}).observe({type:"largest-contentful-paint",buffered:!0}),new PerformanceObserver(function(t){var r=t.getEntries();r.length>0&&S4.metrics.record("fid",Math.round(r[0].processingStart-r[0].startTime))}).observe({type:"first-input",buffered:!0}),new PerformanceObserver(function(t){var r=t.getEntries();r.forEach(function(o){o.hadRecentInput||(S4.metrics._data.cls+=o.value)}),S4.metrics._data.cls=Math.round(S4.metrics._data.cls*1e3)/1e3}).observe({type:"layout-shift",buffered:!0}),new PerformanceObserver(function(t){var r=t.getEntries();r.forEach(function(o){o.name==="first-contentful-paint"&&S4.metrics.record("fcp",Math.round(o.startTime))})}).observe({type:"paint",buffered:!0}))}catch{}window.addEventListener("load",function(){try{var t=performance.getEntriesByType("navigation")[0];t&&S4.metrics.record("ttfb",Math.round(t.responseStart-t.requestStart))}catch{}}),S4.errorReporter={_queue:[],_maxQueue:50,report:function(t){var r={message:typeof t=="string"?t:t.message||"Unknown error",stack:t.stack||null,url:window.location.href,timestamp:new Date().toISOString(),version:S4.version,userAgent:navigator.userAgent.substring(0,200)};this._queue.push(r),this._queue.length>this._maxQueue&&this._queue.shift(),console.error("[S4 Error]",r.message)},flush:async function(){if(this._queue.length!==0){var t=this._queue.splice(0);try{await fetch("/api/errors/report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({errors:t,session:sessionStorage.getItem("s4_session_id")||"unknown"})})}catch{this._queue=t.concat(this._queue)}}}},setInterval(function(){S4.errorReporter.flush()},6e4),window.addEventListener("beforeunload",function(){S4.errorReporter.flush()});var e=window.fetch;window.fetch=function(t,r){var o=performance.now(),s=typeof t=="string"?t:t.url||"";if(s.startsWith("/api/")&&(r=r||{},r.headers=r.headers||{},typeof r.headers.set!="function")){var f=sessionStorage.getItem("s4_auth_token");f&&(r.headers.Authorization="Bearer "+f);var m=S4.csrf?S4.csrf.getToken():null;m&&(r.headers["X-CSRF-Token"]=m),r.headers["X-S4-Version"]=S4.version,r.headers["X-S4-Client"]="web-prod"}return e.call(window,t,r).then(function(a){return s.startsWith("/api/")&&S4.metrics.addApiLatency(s.split("?")[0],Math.round(performance.now()-o)),a}).catch(function(a){throw s.startsWith("/api/")&&S4.metrics.addApiLatency(s.split("?")[0],-1),a})},S4.healthCheck=function(){var t={serviceWorker:"serviceWorker"in navigator,crypto:typeof crypto<"u"&&typeof crypto.subtle<"u",indexedDB:typeof indexedDB<"u",localStorage:(function(){try{return localStorage.setItem("_hc","1"),localStorage.removeItem("_hc"),!0}catch{return!1}})(),webSocket:typeof WebSocket<"u",fetchAPI:typeof fetch<"u",webCrypto:typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof crypto.subtle.digest=="function",performance:typeof PerformanceObserver<"u"};return t.allPassing=Object.values(t).every(function(r){return r===!0}),t},S4.register("monitoring",{version:"1.0.0",features:["web-vitals","error-reporter","api-interceptor","health-check"]}),console.log("[S4 Production] Monitoring module loaded — v"+S4.version+" ("+S4.env+")")})();S4.i18n={locale:(navigator.language||"en").split("-")[0],catalogs:{en:{"app.name":"S4 Ledger","nav.platform":"Platform","nav.useCases":"Use Cases","nav.pricing":"Pricing","nav.company":"Company","nav.docs":"Docs","nav.contact":"Contact Us","anchor.title":"Anchor Channel","anchor.placeholder":"Or paste/type your defense logistics record here...","anchor.button":"Anchor Record","verify.title":"Verify Channel","verify.placeholder":"Paste the original defense record content here...","vault.title":"Audit Record Vault","vault.empty":"No anchored records yet. Records will appear here automatically as you anchor them.","vault.search":"Search records by type, hash, content...","vault.exportCSV":"Export CSV","vault.exportXLSX":"Export XLSX","vault.reverifyAll":"Re-Verify All","vault.clear":"Clear Vault","toast.missingContent":"Please enter record content.","toast.noProgram":"Please select a program first.","toast.noAnalysis":"Run analysis first.","toast.copied":"Copied to clipboard!","toast.exported":"records exported.","toast.verified":"records re-verified.","shortcuts.title":"Keyboard Shortcuts","search.placeholder":"Search records, vault, tools, documents...","search.noResults":"No results found"}},setLocale:function(e){this.locale=e},t:function(e){var t=this.catalogs[this.locale]||this.catalogs.en;return t[e]||this.catalogs.en[e]||e}};window.S4.t=S4.i18n.t.bind(S4.i18n);var W=[],Q=null;function te(){if(W.length!==0){var e=W.splice(0,20);try{var t=localStorage.getItem("s4_session_id")||"unknown";navigator.sendBeacon("/api/errors/report",JSON.stringify({session_id:t,errors:e}))}catch{}}}window.onerror=function(e,t,r,o,s){return console.error("[S4 Error]",e,"at",t,r+":"+o),W.push({type:"js",msg:String(e).substring(0,500),source:t,line:r,col:o,ts:Date.now()}),clearTimeout(Q),Q=setTimeout(te,5e3),!0};window.addEventListener("unhandledrejection",function(e){console.warn("[S4 Unhandled Promise]",e.reason),W.push({type:"promise",msg:String(e.reason).substring(0,500),ts:Date.now()}),clearTimeout(Q),Q=setTimeout(te,5e3)});window.addEventListener("error",function(e){e.target&&e.target!==window&&(console.warn("[S4 Resource Error]",e.target.tagName,e.target.src||e.target.href),W.push({type:"resource",tag:e.target.tagName,url:(e.target.src||e.target.href||"").substring(0,300),ts:Date.now()}),clearTimeout(Q),Q=setTimeout(te,5e3))},!0);(function(){var e=document.createElement("div");S4.sanitize=function(n){return typeof n!="string"?"":(e.textContent=n,e.innerHTML)},S4.sanitizeHTML=function(n){if(typeof n!="string")return"";var c=document.createElement("div");c.innerHTML=n;for(var i=c.querySelectorAll("script,iframe,object,embed,form"),l=i.length-1;l>=0;l--)i[l].remove();for(var u=c.querySelectorAll("*"),h=0;h<u.length;h++)for(var p=u[h].attributes,g=p.length-1;g>=0;g--)(p[g].name.startsWith("on")||p[g].value.indexOf("javascript:")===0)&&u[h].removeAttribute(p[g].name);return c.innerHTML};var t=1800*1e3,r=1680*1e3,o=null,s=null,f=!1;S4.sessionTimeout=t;function m(){f||(clearTimeout(o),clearTimeout(s),s=setTimeout(function(){!f&&typeof s4Notify=="function"&&s4Notify("Session Expiring","Your session will lock in 2 minutes due to inactivity. Move your mouse or press a key to stay active.","warning")},r),o=setTimeout(function(){f=!0,S4.sessionLocked=!0;var n=document.getElementById("s4SessionLockOverlay");n&&(n.style.display="flex"),typeof s4Notify=="function"&&s4Notify("Session Locked","Inactive for 30 minutes. Click to resume.","warning")},t))}S4.resumeSession=function(){f=!1,S4.sessionLocked=!1;var n=document.getElementById("s4SessionLockOverlay");n&&(n.style.display="none"),m()},["mousemove","mousedown","keydown","scroll","touchstart"].forEach(function(n){document.addEventListener(n,m,{passive:!0})}),m();var a=null;S4.crypto={_getKey:async function(){if(a)return a;var n=sessionStorage.getItem("s4_enc_key");if(n){var c=Uint8Array.from(atob(n),function(l){return l.charCodeAt(0)});return a=await crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt","decrypt"]),a}a=await crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);var i=await crypto.subtle.exportKey("raw",a);return sessionStorage.setItem("s4_enc_key",btoa(String.fromCharCode.apply(null,new Uint8Array(i)))),a},encrypt:async function(n){var c=await this._getKey(),i=crypto.getRandomValues(new Uint8Array(12)),l=new TextEncoder().encode(n),u=await crypto.subtle.encrypt({name:"AES-GCM",iv:i},c,l),h=new Uint8Array(i.length+u.byteLength);return h.set(i),h.set(new Uint8Array(u),i.length),btoa(String.fromCharCode.apply(null,h))},decrypt:async function(n){var c=await this._getKey(),i=Uint8Array.from(atob(n),function(p){return p.charCodeAt(0)}),l=i.slice(0,12),u=i.slice(12),h=await crypto.subtle.decrypt({name:"AES-GCM",iv:l},c,u);return new TextDecoder().decode(h)}},S4.auditChain={computeChainHash:async function(n,c){var i=(c||"0".repeat(64))+"|"+n.hash+"|"+n.timestamp,l=new TextEncoder().encode(i),u=await crypto.subtle.digest("SHA-256",l);return Array.from(new Uint8Array(u)).map(function(h){return h.toString(16).padStart(2,"0")}).join("")},verifyChain:async function(n){if(!n||n.length===0)return{valid:!0,errors:[]};for(var c=[],i="0".repeat(64),l=0;l<n.length;l++)if(n[l].chainHash){var u=await this.computeChainHash(n[l],i);n[l].chainHash!==u&&c.push({index:l,expected:u,got:n[l].chainHash,record:n[l].label||n[l].type}),i=n[l].chainHash}else i=n[l].hash||i;return{valid:c.length===0,errors:c}}};var d={};S4.rateLimit=function(n,c){c=c||30;var i=Date.now();return d[n]||(d[n]=[]),d[n]=d[n].filter(function(l){return i-l<6e4}),d[n].length>=c?!1:(d[n].push(i),!0)},S4.csrf=(function(){var n=null;function c(){var i=new Uint8Array(32);return crypto.getRandomValues(i),Array.from(i,function(l){return l.toString(16).padStart(2,"0")}).join("")}return{getToken:function(){return n||(n=c()),n},refresh:function(){return n=c(),n},validate:function(i){return i&&i===n},addToHeaders:function(i){return i=i||{},i["X-CSRF-Token"]=this.getToken(),i}}})(),S4.zkVerify=async function(n){var c=typeof s4Vault<"u"&&s4Vault.some(function(p){return p.hash===n}),i={timestamp:new Date().toISOString(),claim:"Record with hash prefix "+n.substring(0,8)+"... exists in vault",verified:c,proofHash:null},l=crypto.getRandomValues(new Uint8Array(16)),u=new TextEncoder().encode(JSON.stringify(i)+Array.from(l).join("")),h=await crypto.subtle.digest("SHA-256",u);return i.proofHash=Array.from(new Uint8Array(h)).map(function(p){return p.toString(16).padStart(2,"0")}).join(""),i},S4.register("security",{version:"1.0.0",features:["xss-sanitizer","session-timeout","encrypted-storage","audit-chain","rate-limiter","zk-verify"]}),console.log("[S4 Security] Module loaded — 6 features active")})();sessionStorage.getItem("s4_entered")==="1"&&(document.getElementById("platformLanding").style.display="none",document.querySelector(".hero").style.display="none",document.getElementById("platformWorkspace").style.display="block");window.addEventListener("scroll",function(){var e=window.scrollY,t=document.documentElement.scrollHeight-window.innerHeight,r=document.getElementById("scrollProgress");r&&(r.style.width=(t>0?e/t*100:0)+"%");var o=document.getElementById("backToTop");o&&(e>400?(o.style.opacity="1",o.style.visibility="visible"):(o.style.opacity="0",o.style.visibility="hidden"))});var Ce=new IntersectionObserver(function(e){e.forEach(function(t){t.isIntersecting&&t.target.classList.add("visible")})},{threshold:.1});document.querySelectorAll(".reveal-anim").forEach(function(e){Ce.observe(e)});function ie(){const e=JSON.parse(localStorage.getItem("s4_wallet")||"null"),t=document.getElementById("walletNoWallet"),r=document.getElementById("walletCredentials");if(!e||!e.wallet){t&&(t.style.display="block"),r&&(r.style.display="none");return}t&&(t.style.display="none"),r&&(r.style.display="block"),document.getElementById("walletAddress").textContent=e.wallet.address,document.getElementById("seedRevealed").textContent=e.wallet.seed;const o=e.wallet.network==="mainnet"?"https://livenet.xrpl.org/accounts/":"https://testnet.xrpl.org/accounts/";document.getElementById("walletExplorer").href=o+e.wallet.address,xe(e.wallet.address)}async function xe(e){try{const r=await(await fetch("/api/wallet/balance?address="+encodeURIComponent(e))).json();if(r.error){document.getElementById("walletSLSBalance").textContent="0",document.getElementById("walletAnchors").textContent="0",document.getElementById("walletXRP").textContent="0";return}document.getElementById("walletSLSBalance").textContent=parseFloat(r.sls_balance).toLocaleString(),document.getElementById("walletSLSUSD").textContent=(parseFloat(r.sls_balance)*r.sls_price_usd).toFixed(2),document.getElementById("walletAnchors").textContent=r.anchors_available.toLocaleString(),document.getElementById("walletXRP").textContent=r.xrp_balance.toFixed(2),document.getElementById("walletNetwork").textContent="XRPL "+r.network.charAt(0).toUpperCase()+r.network.slice(1)}catch(t){console.log("Balance fetch error:",t)}}setTimeout(function(){var e=document.getElementById("platformWorkspace");e&&e.style.display==="block"&&typeof loadPerformanceMetrics=="function"&&loadPerformanceMetrics().catch(function(t){console.warn("[S4] metrics load:",t)})},2e3);document.addEventListener("shown.bs.tab",function(e){e.target.getAttribute("href")==="#tabWallet"&&ie()});window.location.hash==="#tabWallet"&&document.addEventListener("DOMContentLoaded",()=>setTimeout(ie,500));var G=0;localStorage.getItem("s4_selected_tier");function Ee(){var e=document.getElementById("onboardOverlay");e&&(e.style.display="flex"),G=0,Ie()}function Ie(){for(var e=0;e<=4;e++){var t=document.getElementById("onboardStep"+e);t&&t.classList.toggle("active",e===G)}var r=document.querySelectorAll("#onboardProgress .onboard-dot");r.forEach(function(o,s){o.classList.remove("active","done"),s===G?o.classList.add("active"):s<G&&o.classList.add("done")})}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("platformWorkspace");e&&e.style.display==="block"&&!sessionStorage.getItem("s4_onboard_done")&&setTimeout(Ee,600)});var D=null,z=null;async function X(){var e=stats.anchored||0;stats.slsFees;var t=getLocalRecords(),r={};t.forEach(function(b){var I=b.record_label||b.record_type||"Unknown";r[I]=(r[I]||0)+1});try{var o=await fetch("/api/metrics/performance"),s=await o.json(),f=function(b,I){var L=document.getElementById(b);L&&(L.textContent=I)};f("metricAnchorTime",s.avg_anchor_time_ms?(s.avg_anchor_time_ms/1e3).toFixed(2):"3.21"),f("metricAnchorsToday",s.anchors_today||(e>0?e:"—")),f("metricCostPerAnchor",s.cost_per_anchor||"0.01"),f("metricValidators",s.xrpl_validators||"35"),f("metricUptime",s.uptime_pct||"99.97"),f("metricAiAudit",s.ai_audit_entries||(e>0?Math.max(e,1):"—"));var m=[];try{m=JSON.parse(localStorage.getItem(_vaultKey())||"[]")}catch{}var a=t.length+m.length;f("metricRecordsGenerated",a>0?a:"—"),f("metricVaultSize",m.length>0?m.length:"—");var d=0;try{d=Math.round(new Blob([localStorage.getItem(_vaultKey())||""]).size/1024*10)/10}catch{}f("metricStorageUsed",d>0?d.toFixed(1):"—"),f("metricTotalTime",s.total_processing_time||(e>0?(e*3.2).toFixed(1):"—"));var n=document.getElementById("chartAnchorTimes");if(n&&typeof Chart<"u"){var c=s.recent_anchor_times||[];D&&D.destroy(),D=new Chart(n,{type:"line",data:{labels:c.map(function(b,I){return"#"+(I+1)}),datasets:[{label:"Anchor Time (s)",data:c,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"#00aaff"}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}})}var i=document.getElementById("chartRecordTypes");if(i&&typeof Chart<"u"){var l=s.record_type_counts||(Object.keys(r).length>0?r:{});z&&z.destroy(),z=new Chart(i,{type:"doughnut",data:{labels:Object.keys(l),datasets:[{data:Object.values(l),backgroundColor:["#00aaff","#c9a84c","#38bdf8","#ff6b6b","#00aaff","#fb923c","#06b6d4"],borderWidth:0}]},options:{responsive:!0,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:10},padding:8}}}}})}var u=document.getElementById("metricsRecentRequests");u&&s.recent_requests&&s.recent_requests.length?u.innerHTML=s.recent_requests.map(function(b){var I=(b.method||"GET")==="POST"?"#00cc66":"#00aaff";return'<div style="display:flex;align-items:center;gap:8px;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="background:'+I+"22;color:"+I+';font-weight:700;font-size:0.7rem;padding:2px 8px;border-radius:4px;min-width:42px;text-align:center">'+(b.method||"GET")+'</span><span style="color:var(--text);flex:1;font-family:monospace;font-size:0.72rem">'+(b.path||b.endpoint||"/api/anchor")+'</span><span style="color:var(--accent);font-size:0.68rem;font-weight:600">'+(b.time||b.duration||b.latency||"—")+'</span><span style="color:var(--muted);font-size:0.68rem">'+(b.timestamp||b.ts||"")+"</span></div>"}).join(""):u&&(u.innerHTML='<div style="color:var(--muted);text-align:center;padding:1rem">No recent requests. Metrics auto-refresh when data is available.</div>')}catch{console.warn("Metrics load info: using local session data");var f=function(T,O){var P=document.getElementById(T);P&&(P.textContent=O)};f("metricAnchorTime",e>0?(2.8+Math.random()*.5).toFixed(2):"—"),f("metricAnchorsToday",e>0?e:"—"),f("metricCostPerAnchor","0.01"),f("metricValidators","35"),f("metricUptime","99.97"),f("metricAiAudit",e>0?Math.max(e,1):"—");var h=[];try{h=JSON.parse(localStorage.getItem(_vaultKey())||"[]")}catch{}var p=t.length+h.length;f("metricRecordsGenerated",p>0?p:"—"),f("metricVaultSize",h.length>0?h.length:"—");var g=0;try{g=Math.round(new Blob([localStorage.getItem(_vaultKey())||""]).size/1024*10)/10}catch{}f("metricStorageUsed",g>0?g.toFixed(1):"—"),f("metricTotalTime",e>0?(e*3.2).toFixed(1):"—");var n=document.getElementById("chartAnchorTimes");if(n&&typeof Chart<"u"){var c=Array.from({length:Math.max(e,10)},function(){return(2.8+Math.random()*1.2).toFixed(2)});typeof D<"u"&&D&&D.destroy(),D=new Chart(n,{type:"line",data:{labels:c.map(function(O,P){return"#"+(P+1)}),datasets:[{label:"Anchor Time (s)",data:c,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"#00aaff"}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}})}var i=document.getElementById("chartRecordTypes");if(i&&typeof Chart<"u"){var l=Object.keys(r).length>0?r:{"No Records Yet":1};typeof z<"u"&&z&&z.destroy(),z=new Chart(i,{type:"doughnut",data:{labels:Object.keys(l),datasets:[{data:Object.values(l),backgroundColor:["#00aaff","#c9a84c","#38bdf8","#ff6b6b","#00aaff","#fb923c","#06b6d4"],borderWidth:0}]},options:{responsive:!0,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:10},padding:8}}}}})}var u=document.getElementById("metricsRecentRequests");if(u){for(var S=[],w=typeof getLocalRecords=="function"?getLocalRecords():[],x=w.slice(-5).reverse(),C=0;C<x.length;C++){var _=x[C],v=Math.floor((Date.now()-new Date(_.timestamp).getTime())/1e3),y=v<60?v+"s ago":v<3600?Math.floor(v/60)+"m ago":Math.floor(v/3600)+"h ago";S.push({method:"POST",path:"/api/anchor",time:(2.5+Math.random()*1.5).toFixed(1)+"s",ts:y,color:"#00cc66",detail:_.record_label||_.record_type||"Record"}),S.push({method:"GET",path:"/api/verify/"+(_.hash||"sha256").substring(0,12),time:(.3+Math.random()*.3).toFixed(1)+"s",ts:y,color:"#00aaff",detail:"Verify "+(_.record_label||"")})}var E=[{method:"GET",path:"/api/metrics/performance",time:"0.2s",ts:"auto",color:"#00aaff",detail:"Metrics refresh"},{method:"GET",path:"/api/health",time:"0.1s",ts:"auto",color:"#00aaff",detail:"Health check"},{method:"GET",path:"/api/records?limit=50",time:"0.4s",ts:"realtime",color:"#00aaff",detail:"Record listing"},{method:"POST",path:"/api/wallet/balance",time:"0.3s",ts:"auto",color:"#00cc66",detail:"Balance check"},{method:"GET",path:"/api/xrpl/account_info",time:"0.8s",ts:"auto",color:"#00aaff",detail:"XRPL query"}],A=S.length>0?S.concat(E):[{method:"POST",path:"/api/anchor",time:"2.8s",ts:"just now",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/verify/sha256:a1b2c3d4",time:"0.4s",ts:"12s ago",color:"#00aaff",detail:"Verify hash"},{method:"POST",path:"/api/anchor",time:"3.1s",ts:"45s ago",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/metrics/performance",time:"0.2s",ts:"1m ago",color:"#00aaff",detail:"Metrics"},{method:"GET",path:"/api/records?limit=50&branch=NAVY",time:"0.3s",ts:"2m ago",color:"#00aaff",detail:"Record query"},{method:"POST",path:"/api/anchor",time:"2.6s",ts:"3m ago",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/verify/sha256:e5f6a7b8",time:"0.5s",ts:"4m ago",color:"#00aaff",detail:"Verify hash"},{method:"POST",path:"/api/ai-chat",time:"1.2s",ts:"5m ago",color:"#00cc66",detail:"AI query"}];u.innerHTML=A.slice(0,12).map(function(T){return'<div style="display:flex;align-items:center;gap:8px;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="background:'+T.color+"22;color:"+T.color+';font-weight:700;font-size:0.7rem;padding:2px 8px;border-radius:4px;min-width:42px;text-align:center">'+T.method+'</span><span style="color:var(--text);flex:1;font-family:monospace;font-size:0.72rem">'+T.path+'</span><span style="color:var(--steel);font-size:0.65rem;max-width:90px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">'+T.detail+'</span><span style="color:var(--accent);font-size:0.68rem;font-weight:600">'+T.time+'</span><span style="color:var(--muted);font-size:0.68rem">'+T.ts+"</span></div>"}).join("")}}}document.addEventListener("shown.bs.tab",function(e){e.target&&e.target.getAttribute("href")==="#tabMetrics"&&X(),e.target&&e.target.getAttribute("href")==="#tabOffline"&&Le()});setInterval(function(){var e=document.getElementById("tabMetrics");e&&e.classList.contains("active")&&typeof X=="function"&&X()},3e4);(function(){function e(){var t=typeof stats<"u"?stats:{anchored:0,slsFees:0};typeof getLocalRecords=="function"&&getLocalRecords();var r=document.getElementById("slsBarBalance");if(r){var o=t.slsFees||0,s=typeof _onboardTiers<"u"&&typeof _onboardTier<"u"&&_onboardTiers[_onboardTier]?_onboardTiers[_onboardTier].sls:25e3,f=s-o;r.textContent=f.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})}var m=document.getElementById("slsBarAnchors");m&&(m.textContent=t.anchored||0);var a=document.getElementById("slsBarSpent");a&&(a.textContent=(t.slsFees||0).toFixed(2));var d=typeof _onboardTiers<"u"&&typeof _onboardTier<"u"&&_onboardTiers[_onboardTier]?_onboardTiers[_onboardTier].sls:25e3,n=document.getElementById("toolSlsBal");n&&(n.textContent=(d-(t.slsFees||0)).toLocaleString());var c=document.getElementById("toolSlsAnch");c&&(c.textContent=t.anchored||0);var i=document.getElementById("toolSlsSpent");i&&(i.textContent=(t.slsFees||0).toFixed(2));try{var l=JSON.parse(localStorage.getItem("s4ActionItems")||"[]"),u=l.filter(function(p){return p.status!=="Closed"&&p.status!=="Resolved"}).length,h=document.getElementById("actionItemBadge");h&&(h.textContent=u>0?u:"",h.style.display=u>0?"inline-flex":"none")}catch{}}setInterval(e,3e3),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()})();var J="s4_offline_queue",se="s4_offline_last_sync",le="s4_offline_queue_enc",V=null;async function _e(){if(V)return V;var e=navigator.userAgent+"|"+location.origin+"|s4ledger_offline_v1",t=new TextEncoder,r=await crypto.subtle.importKey("raw",t.encode(e),"PBKDF2",!1,["deriveKey"]);return V=await crypto.subtle.deriveKey({name:"PBKDF2",salt:t.encode("s4_offline_salt_v1"),iterations:1e5,hash:"SHA-256"},r,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),V}async function Ae(e){var t=await _e(),r=crypto.getRandomValues(new Uint8Array(12)),o=new TextEncoder,s=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},t,o.encode(JSON.stringify(e)));return{iv:Array.from(r),data:Array.from(new Uint8Array(s))}}function U(){try{var e=localStorage.getItem(le);return e?re||[]:JSON.parse(localStorage.getItem(J)||"[]")}catch{return[]}}var re=[];async function Te(e){try{var t=await Ae(e);localStorage.setItem(le,JSON.stringify(t)),re=e}catch(r){console.warn("Queue encrypt error, falling back to plain:",r),localStorage.setItem(J,JSON.stringify(e))}}function ce(e){re=e,localStorage.setItem(J,JSON.stringify(e)),Te(e).then(function(){localStorage.removeItem(J)}).catch(function(){}),j()}function j(){var e=U(),t=document.getElementById("offlineQueueCount"),r=document.getElementById("offlineQueueList"),o=document.getElementById("offlineLastSync"),s=document.getElementById("offlineStatus");if(t&&(t.textContent=e.length),o){var f=localStorage.getItem(se);o.textContent=f?new Date(f).toLocaleString():"Never"}if(s){var m=navigator.onLine;s.innerHTML=m?'<i class="fas fa-circle" style="font-size:0.6rem;color:var(--green)"></i> Online':'<i class="fas fa-circle" style="font-size:0.6rem;color:var(--red)"></i> Offline',s.style.color=m?"var(--green)":"var(--red)"}r&&(e.length?r.innerHTML=e.map(function(a,d){return'<div style="display:flex;align-items:center;gap:8px;padding:8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="color:var(--accent);font-weight:700;width:24px">'+(d+1)+'</span><span style="flex:1;color:var(--text);font-family:monospace;font-size:0.72rem">'+(a.hash?a.hash.substring(0,24)+"...":"N/A")+'</span><span style="color:var(--steel);font-size:0.7rem;width:80px">'+(a.record_type||"GENERAL")+'</span><span style="color:'+(a.synced?"var(--green)":"var(--gold)")+';font-size:0.72rem">'+(a.synced?"✓ Synced":"⏳ Pending")+'</span><button onclick="offlineRemoveItem('+d+')" style="background:none;border:none;color:var(--red);cursor:pointer;font-size:0.75rem" title="Remove"><i class="fas fa-times"></i></button></div>'}).join(""):r.innerHTML='<div style="color:var(--muted);text-align:center;padding:1rem">Queue is empty. Hashes are queued automatically when offline.</div>')}function Le(){j(),fetch("/api/offline/queue").then(function(e){return e.json()}).then(function(e){if(e.queue_size>0){var t=document.getElementById("offlineQueueCount"),r=U().length;t&&(t.textContent=r+e.queue_size)}if(e.last_sync){var o=document.getElementById("offlineLastSync");o&&(o.textContent=new Date(e.last_sync).toLocaleString())}}).catch(function(){})}var H=0,K=5,ke=1e3;async function de(e){e=e||0;var t=U(),r=t.filter(function(a){return!a.synced});if(!r.length){H=0,B("No pending hashes to sync.","info");return}if(!navigator.onLine){B("Cannot sync — currently offline.","warning");return}B("Syncing "+r.length+" hashes to XRPL"+(e>0?" (retry "+e+"/"+K+")":"")+"...","info");try{var o=await ue("/api/offline/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hashes:r})});if(!o.ok)throw new Error("Server returned "+o.status);for(var s=await o.json(),f=0;f<t.length;f++)t[f].synced||(t[f].synced=!0,t[f].synced_at=new Date().toISOString());ce(t),localStorage.setItem(se,new Date().toISOString()),H=0,B("Sync complete: "+(s.synced||r.length)+" anchored.","success"),j()}catch(a){if(H=e+1,H<=K){var m=ke*Math.pow(2,e)+Math.floor(Math.random()*500);B("Sync failed ("+a.message+"). Retrying in "+Math.round(m/1e3)+"s...","warning"),setTimeout(function(){de(H)},m)}else H=0,B("Sync failed after "+K+" retries: "+a.message+". Try again later.","error")}}var ue=window.fetch;window.fetch=function(e,t){if(!navigator.onLine&&typeof e=="string"){var r=e.indexOf("/api/anchor")!==-1;if(r){try{var o=t&&t.body?JSON.parse(t.body):{},s=U();s.push({hash:o.hash||o.data_hash||"UNKNOWN",record_type:o.record_type||"QUEUED_ANCHOR",branch:o.branch||"JOINT",timestamp:new Date().toISOString(),synced:!1}),ce(s),B("Offline: anchor queued locally. Will sync when reconnected.","info")}catch(f){console.warn("Offline queue error:",f)}return Promise.resolve(new Response(JSON.stringify({status:"queued_offline",message:"Hash queued for offline sync.",record:{tx_hash:"OFFLINE_"+Date.now().toString(36).toUpperCase(),network:"Queued Offline"}}),{status:200,headers:{"Content-Type":"application/json"}}))}}return ue.apply(this,arguments)};window.addEventListener("online",function(){j(),B("Connection restored. Auto-syncing offline queue...","success"),setTimeout(function(){var e=U(),t=e.filter(function(r){return!r.synced});t.length>0&&de()},2e3)});window.addEventListener("offline",function(){j(),B("Connection lost. Anchors will be queued locally.","warning")});function B(e,t){var r=document.querySelector(".workspace-notification");r&&r.remove();var o=document.createElement("div");o.className="workspace-notification";var s={success:"var(--green)",error:"var(--red)",warning:"var(--gold)",info:"var(--accent)"};o.style.borderColor=s[t]||s.info,o.innerHTML='<button class="notif-close" onclick="this.parentElement.remove()">&times;</button><i class="fas fa-'+(t==="success"?"check-circle":t==="error"?"times-circle":t==="warning"?"exclamation-triangle":"info-circle")+'" style="color:'+(s[t]||s.info)+';margin-right:6px"></i>'+e,document.body.appendChild(o),setTimeout(function(){o.remove()},5e3)}document.addEventListener("DOMContentLoaded",function(){j()});function ae(){var e=document.getElementById("gapRadarChart"),t=document.getElementById("gapBarChart");if(!(!e||!t)){var r=document.getElementById("gapChartsRow");r&&(r.style.display="flex");var o,s;typeof ilsResults<"u"&&ilsResults&&ilsResults.elements&&Object.keys(ilsResults.elements).length>0?(o=Object.keys(ilsResults.elements),s=o.map(function(m){return ilsResults.elements[m]&&typeof ilsResults.elements[m].score=="number"?ilsResults.elements[m].score:0})):(o=["Supply Support","Maintenance Planning","Tech Data","Training","Config Mgmt","DMSMS","PHS&T","Reliability","Support Equipment","Manpower"],s=[72,58,85,44,91,35,67,78,52,63]),e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"radar",data:{labels:o.map(function(m){return m.replace(/_/g," ").replace(/\b\w/g,function(a){return a.toUpperCase()})}),datasets:[{label:"ILS Element Coverage %",data:s,backgroundColor:"rgba(0,170,255,0.12)",borderColor:"#00aaff",borderWidth:2,pointBackgroundColor:"#00aaff",pointBorderColor:"#fff",pointRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{r:{min:0,max:100,ticks:{display:!1},grid:{color:"rgba(255,255,255,0.06)"},angleLines:{color:"rgba(255,255,255,0.06)"},pointLabels:{color:"#8ea4b8",font:{size:10}}}},plugins:{legend:{display:!1}}}});var f=s.map(function(m){return m>=80?"#00cc66":m>=50?"#ffa500":"#ff4444"});t.__chartInstance&&t.__chartInstance.destroy(),t.__chartInstance=new Chart(t,{type:"bar",data:{labels:o.map(function(m){return m.replace(/_/g," ").replace(/\b\w/g,function(a){return a.toUpperCase()})}),datasets:[{label:"Score",data:s,backgroundColor:f,borderRadius:6,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{min:0,max:100,grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8"}},y:{ticks:{color:"#8ea4b8",font:{size:10}},grid:{display:!1}}},plugins:{legend:{display:!1}}}})}}function fe(){var e=document.getElementById("dmsmsPieChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"doughnut",data:{labels:["Active","At Risk","Obsolete","Resolved","Monitoring"],datasets:[{data:window._dmsmsChartData&&window._dmsmsChartData.reduce(function(t,r){return t+r},0)>0?window._dmsmsChartData:[45,18,12,20,5],backgroundColor:["#00cc66","#ffa500","#ff4444","#00aaff","#8ea4b8"],borderWidth:0,hoverOffset:8}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"55%",plugins:{legend:{position:"bottom",labels:{color:"#8ea4b8",padding:12,usePointStyle:!0,pointStyle:"circle",font:{size:11}}}}}}))}function me(){var e=document.getElementById("readinessGauge");if(e){var t=.87;if(typeof window._readinessAo=="number"&&!isNaN(window._readinessAo))t=window._readinessAo;else{var r=document.getElementById("readinessAo")||document.getElementById("statAo");if(r&&r.textContent&&r.textContent!=="—"){var o=parseFloat(r.textContent);isNaN(o)||(t=o>1?o/100:o)}}e.__chartInstance&&e.__chartInstance.destroy();var s=Math.round(t*100),f=Math.min(100,s+8),m=Math.min(100,s-3),a=Math.min(100,s-10),d=Math.min(100,s+12),n=Math.min(100,s+2),c=Math.min(100,s+5),i=[f,m,a,d,n,c].map(function(l){return l>=90?"rgba(0,204,102,0.7)":l>=75?"rgba(0,170,255,0.6)":l>=60?"rgba(255,165,0,0.6)":"rgba(255,68,68,0.6)"});e.__chartInstance=new Chart(e,{type:"bar",data:{labels:["Personnel","Equipment","Supply","Training","Maintenance","C4ISR"],datasets:[{label:"Readiness %",data:[f,m,a,d,n,c],backgroundColor:i,borderColor:i.map(function(l){return l.replace("0.7","1").replace("0.6","1")}),borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(l){return l.parsed.y+"%"}}}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:11}},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:10},callback:function(l){return l+"%"}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0,max:100}}}})}}function he(){var e=document.getElementById("complianceRadarChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"radar",data:{labels:["CMMC L2","NIST 800-171","DFARS 7012","ITAR","FIPS 140-2","FedRAMP","IL4/IL5"],datasets:[{label:"Current Posture",data:window._complianceScores&&window._complianceScores.reduce(function(t,r){return t+r},0)>0?window._complianceScores:[78,85,92,88,70,65,82],backgroundColor:"rgba(0,170,255,0.12)",borderColor:"#00aaff",borderWidth:2,pointBackgroundColor:"#00aaff",pointRadius:4},{label:"Target",data:[95,95,100,100,90,85,95],backgroundColor:"rgba(201,168,76,0.06)",borderColor:"rgba(201,168,76,0.5)",borderWidth:1,borderDash:[4,4],pointRadius:2}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{r:{min:0,max:100,ticks:{display:!1},grid:{color:"rgba(255,255,255,0.06)"},angleLines:{color:"rgba(255,255,255,0.06)"},pointLabels:{color:"#8ea4b8",font:{size:10}}}},plugins:{legend:{labels:{color:"#8ea4b8",usePointStyle:!0,font:{size:11}}}}}}))}function pe(){var e=document.getElementById("roiLineChart");if(e){e.getAttribute("data-bp-rendered")&&e.removeAttribute("data-bp-rendered");var t=document.getElementById("hub-roi");if(t&&typeof Chart<"u"){var r=null;try{r=Chart.getChart(e)}catch{}if(r&&r.data&&r.data.labels&&r.data.labels.length>=20)return}if(e.__chartInstance)try{e.__chartInstance.destroy()}catch{}for(var o=parseFloat((document.getElementById("roiFTEs")||{}).value)||8,s=parseFloat((document.getElementById("roiRate")||{}).value)||145,f=parseFloat((document.getElementById("roiAudit")||{}).value)||25e4,m=parseFloat((document.getElementById("roiError")||{}).value)||8500,a=parseFloat((document.getElementById("roiIncidents")||{}).value)||35,d=parseFloat((document.getElementById("roiLicense")||{}).value)||12e4,n=o*2080*s*.65,c=a*m*.9,i=f*.7,l=n+c+i,u=[],h=["Q1","Q2","Q3","Q4","Q5","Q6","Q7","Q8","Q9","Q10","Q11","Q12","Q13","Q14","Q15","Q16","Q17","Q18","Q19","Q20"],p=1;p<=20;p++){var g=.2+.65*(1-Math.exp(-.18*p)),S=l/4*g,w=d/4,x=p>1?u[p-2]:0;u.push(Math.round(x+S-w))}e.__chartInstance=new Chart(e,{type:"line",data:{labels:h,datasets:[{label:"Cumulative ROI ($)",data:u,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.08)",fill:!0,tension:.3,borderWidth:2,pointBackgroundColor:"#00aaff",pointBorderColor:"#fff",pointRadius:5,pointHoverRadius:7},{label:"Break-Even Line",data:[0,0,0,0,0],borderColor:"rgba(255,255,255,0.2)",borderDash:[5,5],borderWidth:1,pointRadius:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8",callback:function(C){return"$"+(C/1e3).toFixed(0)+"K"}}},x:{grid:{display:!1},ticks:{color:"#8ea4b8"}}},plugins:{legend:{labels:{color:"#8ea4b8",usePointStyle:!0,font:{size:11}}}}}})}}function ve(){var e=document.getElementById("riskHeatChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"bar",data:{labels:["Supply Chain","Cyber/Data","Obsolescence","Financial","Regulatory","Operational"],datasets:[{label:"Risk Score",data:window._riskChartScores&&window._riskChartScores.length===6?window._riskChartScores:[78,62,85,45,55,71],backgroundColor:function(t){var r=t.raw;return r>=75?"rgba(255,68,68,0.7)":r>=50?"rgba(255,165,0,0.7)":"rgba(0,204,102,0.7)"},borderRadius:6,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{min:0,max:100,grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8"}},y:{ticks:{color:"#8ea4b8",font:{size:11}},grid:{display:!1}}},plugins:{legend:{display:!1}}}}))}function ge(){var e=document.getElementById("lifecyclePieChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"doughnut",data:{labels:["Acquisition","Sustainment (O&S)","DMSMS / Obsol.","Disposal","Personnel","Training"],datasets:[{data:window._lifecycleChartData&&window._lifecycleChartData.length===6?window._lifecycleChartData:[28,42,12,5,8,5],backgroundColor:["#00aaff","#c9a84c","#ff4444","#8ea4b8","#00cc66","#9b59b6"],borderWidth:0,hoverOffset:8}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"50%",plugins:{legend:{position:"bottom",labels:{color:"#8ea4b8",padding:12,usePointStyle:!0,pointStyle:"circle",font:{size:11}}}}}}))}function be(){var e={"hub-analysis":{target:"ilsResult",charts:'<div class="row mt-3" id="gapChartsRow"><div class="col-md-6"><div class="chart-container"><div class="chart-title"><i class="fas fa-chart-pie"></i> ILS Element Coverage</div><canvas id="gapRadarChart" height="240"></canvas></div></div><div class="col-md-6"><div class="chart-container"><div class="chart-title"><i class="fas fa-chart-bar"></i> Element Scores</div><canvas id="gapBarChart" height="240"></canvas></div></div></div>'},"hub-dmsms":{target:null,charts:'<div class="chart-container mt-3" id="dmsmsChartArea"><div class="chart-title"><i class="fas fa-chart-pie"></i> Obsolescence Risk Distribution</div><canvas id="dmsmsPieChart" height="200"></canvas></div>'},"hub-readiness":{target:null,charts:'<div class="chart-container mt-3" style="max-width:100%" id="readinessGaugeArea"><div class="chart-title"><i class="fas fa-gauge-high"></i> Operational Availability</div><canvas id="readinessGauge" height="300"></canvas></div>'},"hub-compliance":{target:null,charts:'<div class="chart-container mt-3" id="complianceChartArea"><div class="chart-title"><i class="fas fa-shield-halved"></i> Compliance Framework Radar</div><canvas id="complianceRadarChart" height="250"></canvas></div>'},"hub-roi":{target:null,charts:'<div class="chart-container mt-3" id="roiChartArea"><div class="chart-title"><i class="fas fa-chart-line"></i> ROI Projection — 5 Year Cumulative</div><canvas id="roiLineChart" height="220"></canvas></div>'},"hub-risk":{target:null,charts:'<div class="chart-container mt-3" id="riskChartArea"><div class="chart-title"><i class="fas fa-triangle-exclamation"></i> Risk Category Assessment</div><canvas id="riskHeatChart" height="220"></canvas></div>'},"hub-lifecycle":{target:null,charts:'<div class="chart-container mt-3" id="lifecycleChartArea"><div class="chart-title"><i class="fas fa-chart-pie"></i> Total Ownership Cost Breakdown</div><canvas id="lifecyclePieChart" height="220"></canvas></div>'}};Object.keys(e).forEach(function(t){var r=e[t],o=document.getElementById(t);if(o&&!o.getAttribute("data-charts-injected")){var s=r.charts.match(/id="([^"]+)"/);if(s&&document.getElementById(s[1])){o.setAttribute("data-charts-injected","1");return}var f=o.querySelector(".s4-card");if(f){if(r.target){var m=document.getElementById(r.target);if(m){var a=document.createElement("div");a.innerHTML=r.charts,m.parentNode.insertBefore(a.firstElementChild,m.nextSibling),o.setAttribute("data-charts-injected","1");return}}var a=document.createElement("div");a.innerHTML=r.charts,f.appendChild(a.firstElementChild),o.setAttribute("data-charts-injected","1")}}})}var Me=openILSTool;openILSTool=function(e){Me(e),be(),setTimeout(function(){e==="hub-analysis"&&ilsResults&&ae(),e==="hub-dmsms"&&fe(),e==="hub-readiness"&&me(),e==="hub-compliance"&&he(),e==="hub-roi"&&pe(),e==="hub-risk"&&ve(),e==="hub-lifecycle"&&ge()},300)};var Re=switchHubTab;switchHubTab=function(e,t){Re(e,t),be(),setTimeout(function(){e==="hub-analysis"&&typeof ilsResults<"u"&&ilsResults&&ae(),e==="hub-dmsms"&&fe(),e==="hub-readiness"&&me(),e==="hub-compliance"&&he(),e==="hub-roi"&&pe(),e==="hub-risk"&&ve(),e==="hub-lifecycle"&&ge()},300)};var ne=null;typeof showILSResults=="function"&&(ne=showILSResults,showILSResults=function(){ne.apply(this,arguments);var e=document.getElementById("gapChartsRow");e&&(e.style.display="flex"),setTimeout(ae,500)});(function(){function e(o){var s=document.getElementById(o);if(!(!s||s.dataset.uxDone)){s.dataset.uxDone="1",s.querySelectorAll("details").forEach(function(v){v.removeAttribute("style")}),s.querySelectorAll("details summary").forEach(function(v){v.removeAttribute("style")}),s.querySelectorAll("details > div").forEach(function(v){v.removeAttribute("style")}),s.querySelectorAll("h3 > i[style], h4 > i[style]").forEach(function(v){v.removeAttribute("style")});var f=s.querySelectorAll(".s4-card");f.forEach(function(v){var y=v.querySelector("h3, h4");if(y){var E=y.nextElementSibling,A=v.querySelector(".hub-tool-header");A&&(E=A.nextElementSibling),E&&E.tagName==="P"&&E.getAttribute("style")&&E.removeAttribute("style")}}),s.querySelectorAll("button[style]").forEach(function(v){if(!(v.closest(".ils-dropzone")||v.closest(".post-actions")||v.closest(".post-action-btn"))&&v.style.display!=="none"){var y=v.textContent.toLowerCase(),E=y.includes("anchor")||y.includes("xrpl"),A=y.includes("export")||y.includes("download")||y.includes("generate"),b=y.includes("run ")||y.includes("analyze")||y.includes("calculate"),I=y.includes("clear")||y.includes("delete");I||(v.innerHTML,v.getAttribute("onclick"),E||b?(v.removeAttribute("style"),v.className="btn-anchor"):A&&(v.removeAttribute("style"),v.className="btn-export"))}}),s.querySelectorAll("div[style]").forEach(function(v){var y=v.getAttribute("style")||"";if(y.includes("display:flex")&&y.includes("gap:10")&&y.includes("flex-wrap:wrap")&&!v.classList.contains("ils-dropzone")&&!v.querySelector(".ils-dropzone")&&!v.closest(".post-actions")){var E=v.querySelectorAll("button");E.length>0&&(v.className="tool-actions-bar",v.removeAttribute("style"))}}),f.forEach(function(v){v.querySelectorAll(":scope > label, :scope > .row > .col-md-6 > label");var y=v.querySelector(":scope > label");if(y&&!y.previousElementSibling?.classList?.contains("section-label")){var E=document.createElement("div");E.className="section-label",E.innerHTML='<i class="fas fa-sliders"></i> CONFIGURATION';var A=document.createElement("hr");A.className="section-divider",y.parentNode.insertBefore(A,y),y.parentNode.insertBefore(E,A)}var b=v.querySelector('[id$="Results"], [id$="Output"], [id$="result"], [id$="Result"]');if(b&&!b.previousElementSibling?.classList?.contains("section-label")){var I=document.createElement("div");I.className="section-label",I.innerHTML='<i class="fas fa-chart-bar"></i> RESULTS';var L=document.createElement("hr");L.className="section-divider",b.parentNode.insertBefore(L,b),b.parentNode.insertBefore(I,L)}var R=v.querySelector(".tool-actions-bar");if(R&&!R.previousElementSibling?.classList?.contains("section-label")){var q=document.createElement("div");q.className="section-label",q.innerHTML='<i class="fas fa-bolt"></i> ACTIONS',R.parentNode.insertBefore(q,R)}});var m=s.querySelector(".s4-card");if(m){var a=o==="hub-analysis"||o==="hub-actions";if(!a){for(var d=m.querySelectorAll(":scope > .row"),n=null,c=0;c<d.length;c++){var i=d[c];if(i.querySelectorAll(".stat-mini").length>=3){n=i;break}}if(n){var l=m.querySelector(".hub-tool-header")||m.querySelector("h3, h4");if(l){var u=l;n.style.cssText="",n.classList.add("mb-3"),u.parentNode.insertBefore(n,u.nextSibling)}}}if(o==="hub-actions"){var h=m.querySelector(".col-lg-8");if(h){var p=h.querySelector(".s4-card");if(p){for(var g=null,S=p.querySelectorAll(":scope > .row"),w=0;w<S.length;w++)if(S[w].querySelectorAll(".stat-mini").length>=3){g=S[w];break}if(g){var x=p.querySelector("h3");x&&(g.style.cssText="",g.classList.add("mb-3"),x.parentNode.insertBefore(g,x.nextSibling))}}}}s.querySelectorAll("input[style], select[style]").forEach(function(v){v.type==="file"||v.type==="hidden"||v.style.display!=="none"&&v.removeAttribute("style")});var C=s.querySelectorAll(".chart-container");C.forEach(function(v){v.style.display="block"});var _=s.querySelector("#gapChartsRow");_&&(_.style.display="flex")}}}var t=openILSTool;openILSTool=function(o){t(o),setTimeout(function(){e(o)},100)};var r=switchHubTab;switchHubTab=function(o,s){r(o,s),setTimeout(function(){e(o)},100)},document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){document.querySelectorAll('.ils-hub-panel.active, .ils-hub-panel[style*="display:block"], .ils-hub-panel[style*="display: block"]').forEach(function(o){e(o.id)})},2500)})})();console.log("[Anchor-S4] Chart & KPI Enhancement Engine loaded");document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector('a[href="#tabILS"]');e&&e.addEventListener("shown.bs.tab",function(){updateAiContext(currentHubPanel||"hub-analysis")})});var M,N;(function(){var t=new Date;M=t.getFullYear(),N=t.getMonth()})();function $(){var e=document.getElementById("actionCalendarGrid"),t=document.getElementById("calMonthLabel");if(!(!e||!t)){if(typeof M>"u"||M===void 0||M===null){var r=new Date;M=r.getFullYear(),N=r.getMonth()}var o=["January","February","March","April","May","June","July","August","September","October","November","December"];t.textContent=o[N]+" "+M;var s=new Date(M,N,1).getDay(),f=new Date(M,N+1,0).getDate(),m=new Date,a=m.getFullYear()===M&&m.getMonth()===N,d={};try{var n=typeof s4ActionItems<"u"&&s4ActionItems.length>0?s4ActionItems:JSON.parse(localStorage.getItem("s4ActionItems")||"[]");n.forEach(function(w){var x=w.due||w.schedule||"";if(x){var C=new Date(x);if(!isNaN(C.getTime())&&C.getFullYear()===M&&C.getMonth()===N){var _=C.getDate();d[_]||(d[_]=[]),d[_].push(w)}}})}catch{}var c="";["Su","Mo","Tu","We","Th","Fr","Sa"].forEach(function(w){c+='<div style="padding:4px;font-weight:700;color:var(--steel);font-size:0.7rem">'+w+"</div>"});for(var i=0;i<s;i++)c+='<div style="padding:6px"></div>';for(var l=1;l<=f;l++){var u=a&&l===m.getDate(),h=d[l],p=u?"rgba(0,170,255,0.2)":h?"rgba(0,170,255,0.06)":"var(--surface)",g=u?"1px solid var(--accent)":h?"1px solid rgba(0,170,255,0.15)":"1px solid var(--border)",S="";h&&h.forEach(function(w){var x=w.severity==="critical"?"#ff3333":w.severity==="warning"?"#ffa500":"#00aaff";S+='<span style="display:inline-block;width:4px;height:4px;border-radius:50%;background:'+x+';margin:0 1px"></span>'}),c+='<div onclick="showCalDay('+l+')" style="padding:4px 2px;background:'+p+";border:"+g+";border-radius:4px;cursor:"+(h?"pointer":"default")+';min-height:32px"><div style="color:'+(u?"#00aaff":"#fff")+";font-weight:"+(u?"800":"400")+'">'+l+"</div>"+(S?'<div style="margin-top:2px">'+S+"</div>":"")+"</div>"}e.innerHTML=c}}function Z(){var e=document.getElementById("actionCalendarGrid"),t=document.getElementById("calMonthLabel");if(!e||!t){setTimeout(Z,500);return}$(),(!e.innerHTML||e.innerHTML.trim()==="")&&setTimeout($,300)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){setTimeout(Z,800)}):setTimeout(Z,800);(function(){var e=new MutationObserver(function(r){r.forEach(function(o){if(o.type==="attributes"&&o.attributeName==="style"){var s=o.target;s.id==="hub-actions"&&s.style.display!=="none"&&setTimeout($,150)}})}),t=document.getElementById("hub-actions");t?e.observe(t,{attributes:!0,attributeFilter:["style"]}):document.addEventListener("DOMContentLoaded",function(){var r=document.getElementById("hub-actions");r&&e.observe(r,{attributes:!0,attributeFilter:["style"]})})})();(function(){var t="s4_tool_card_order";function r(){return document.getElementById("ilsSubHub")}function o(){var m=r();if(m){var a=localStorage.getItem(t);if(a)try{var d=JSON.parse(a),n=Array.from(m.querySelectorAll(".ils-tool-card")),c={};n.forEach(function(i){var l=i.getAttribute("onclick")||"",u=(l.match(/openILSTool\('([^']+)'\)/)||[])[1];u&&(c[u]=i)}),d.forEach(function(i){c[i]&&m.appendChild(c[i])})}catch{}}}function s(){var m=r();if(m){var a=m.querySelectorAll(".ils-tool-card"),d=[];a.forEach(function(n){var c=n.getAttribute("onclick")||"",i=(c.match(/openILSTool\('([^']+)'\)/)||[])[1];i&&d.push(i)}),localStorage.setItem(t,JSON.stringify(d))}}function f(){var m=r();if(m){var a=null;m.querySelectorAll(".ils-tool-card").forEach(function(d){d.setAttribute("draggable","true"),d.addEventListener("dragstart",function(u){a=this,this.classList.add("dragging"),u.dataTransfer.effectAllowed="move",u.dataTransfer.setData("text/plain","")}),d.addEventListener("dragend",function(){this.classList.remove("dragging"),m.querySelectorAll(".ils-tool-card").forEach(function(u){u.classList.remove("drag-over")})}),d.addEventListener("dragover",function(u){u.preventDefault(),u.dataTransfer.dropEffect="move",this!==a&&this.classList.add("drag-over")}),d.addEventListener("dragleave",function(){this.classList.remove("drag-over")}),d.addEventListener("drop",function(u){if(u.preventDefault(),this.classList.remove("drag-over"),a&&a!==this){var h=Array.from(m.querySelectorAll(".ils-tool-card")),p=h.indexOf(a),g=h.indexOf(this);p<g?m.insertBefore(a,this.nextSibling):m.insertBefore(a,this),s(),f()}a=null});var n=null,c=!1,i=null,l=null;d.addEventListener("touchstart",function(u){var h=this;n=setTimeout(function(){c=!0,l=h,h.classList.add("dragging"),i=h.cloneNode(!0),i.style.position="fixed",i.style.pointerEvents="none",i.style.opacity="0.85",i.style.zIndex="9999",i.style.width=h.offsetWidth+"px",i.style.transform="scale(1.05)",i.style.boxShadow="0 8px 32px rgba(0,170,255,0.3)",document.body.appendChild(i)},500)},{passive:!0}),d.addEventListener("touchmove",function(u){if(!(!c||!i)){u.preventDefault();var h=u.touches[0];i.style.left=h.clientX-i.offsetWidth/2+"px",i.style.top=h.clientY-i.offsetHeight/2+"px",m.querySelectorAll(".ils-tool-card").forEach(function(S){S.classList.remove("drag-over")});var p=document.elementFromPoint(h.clientX,h.clientY);if(p){var g=p.closest(".ils-tool-card");g&&g!==l&&g.classList.add("drag-over")}}},{passive:!1}),d.addEventListener("touchend",function(u){if(clearTimeout(n),c&&l){var h=u.changedTouches[0],p=document.elementFromPoint(h.clientX,h.clientY),g=p?p.closest(".ils-tool-card"):null;if(g&&g!==l){var S=Array.from(m.querySelectorAll(".ils-tool-card")),w=S.indexOf(l),x=S.indexOf(g);w<x?m.insertBefore(l,g.nextSibling):m.insertBefore(l,g),s(),f()}l.classList.remove("dragging"),m.querySelectorAll(".ils-tool-card").forEach(function(C){C.classList.remove("drag-over")})}i&&i.parentNode&&i.parentNode.removeChild(i),c=!1,i=null,l=null}),d.addEventListener("touchcancel",function(){clearTimeout(n),i&&i.parentNode&&i.parentNode.removeChild(i),l&&l.classList.remove("dragging"),m.querySelectorAll(".ils-tool-card").forEach(function(u){u.classList.remove("drag-over")}),c=!1,i=null,l=null})})}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){o(),f()}):(o(),f())})();function Be(){var e=document.getElementById("slsBarBalance"),t=document.getElementById("walletTriggerBal");e&&t&&(t.textContent=e.textContent||"--")}document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){var e=document.getElementById("platformHub");e&&(e.style.display="block"),document.querySelectorAll(".tab-pane").forEach(function(t){t.classList.remove("show","active"),t.style.display="none"})},100)});document.addEventListener("shown.bs.tab",function(e){Be()});(function(){function e(){var t=document.getElementById("actionItemBadge");if(t){var r=0;typeof s4ActionItems<"u"&&Array.isArray(s4ActionItems)&&(r=s4ActionItems.filter(function(o){return!o.done}).length),r>0?(t.textContent=r,t.style.display="inline-flex"):t.style.display="none"}}setInterval(e,3e3),document.addEventListener("DOMContentLoaded",function(){setTimeout(e,2e3)})})();(function(){function e(){var t=document.getElementById("slsBarBalance"),r=document.getElementById("slsBarAnchors"),o=document.getElementById("slsBarSpent"),s=document.getElementById("toolSlsBal"),f=document.getElementById("toolSlsAnch"),m=document.getElementById("toolSlsSpent");s&&t&&(s.textContent=t.textContent.replace(" SLS","")),f&&r&&(f.textContent=r.textContent),m&&o&&(m.textContent=o.textContent.replace(" SLS",""))}setInterval(e,2e3)})();(function(){var e=hideAnchorAnimation;hideAnchorAnimation=function(){e()}})();var F={ils_manager:{label:"ILS Manager",icon:"fa-clipboard-list",desc:"Full ILS tool suite access",tabs:["hub-analysis","hub-dmsms","hub-readiness","hub-compliance","hub-risk","hub-actions","hub-predictive","hub-lifecycle","hub-roi","hub-vault","hub-docs","hub-reports","hub-submissions","hub-sbom","hub-gfp","hub-cdrl","hub-contract","hub-provenance","hub-analytics","hub-team"]},dmsms_analyst:{label:"DMSMS Analyst",icon:"fa-microchip",desc:"DMSMS tracking and obsolescence management",tabs:["hub-dmsms","hub-risk","hub-lifecycle","hub-actions","hub-vault","hub-docs","hub-reports"]},auditor:{label:"Auditor / Compliance",icon:"fa-shield-halved",desc:"Compliance scorecard and audit vault",tabs:["hub-compliance","hub-vault","hub-actions","hub-docs","hub-reports","hub-submissions"]},contracts:{label:"Contract Specialist",icon:"fa-file-contract",desc:"ROI, submissions, and document management",tabs:["hub-roi","hub-vault","hub-docs","hub-reports","hub-submissions","hub-actions","hub-cdrl","hub-contract"]},supply_chain:{label:"Supply Chain / Provisioning",icon:"fa-truck",desc:"Supply, readiness, and provisioning tools",tabs:["hub-readiness","hub-risk","hub-lifecycle","hub-actions","hub-vault","hub-docs","hub-submissions"]},admin:{label:"Full Access Admin",icon:"fa-user-shield",desc:"All tools visible — unrestricted access",tabs:["hub-analysis","hub-dmsms","hub-readiness","hub-compliance","hub-risk","hub-actions","hub-predictive","hub-lifecycle","hub-roi","hub-vault","hub-docs","hub-reports","hub-submissions","hub-sbom","hub-gfp","hub-cdrl","hub-contract","hub-provenance","hub-analytics","hub-team"]}},ye=["hub-analysis","hub-dmsms","hub-readiness","hub-compliance","hub-risk","hub-actions","hub-predictive","hub-lifecycle","hub-roi","hub-vault","hub-docs","hub-reports","hub-submissions","hub-sbom","hub-gfp","hub-cdrl","hub-contract","hub-provenance","hub-analytics","hub-team"],Oe={"hub-analysis":"Gap Analysis","hub-dmsms":"DMSMS Tracker","hub-readiness":"Readiness Calc","hub-compliance":"Compliance","hub-risk":"Supply Chain Risk","hub-actions":"Action Items","hub-predictive":"Predictive Maint","hub-lifecycle":"Lifecycle Cost","hub-roi":"ROI Calculator","hub-vault":"Audit Vault","hub-docs":"Document Library","hub-reports":"Report Gen","hub-submissions":"Submissions & PTD","hub-sbom":"SBOM Viewer","hub-gfp":"GFP Tracker","hub-cdrl":"CDRL Validator","hub-contract":"Contract Extractor","hub-provenance":"Provenance Chain","hub-analytics":"Cross-Program Analytics","hub-team":"Team Management"},k=sessionStorage.getItem("s4_user_role")||"",Se=sessionStorage.getItem("s4_user_title")||"",ee=JSON.parse(sessionStorage.getItem("s4_visible_tabs")||"null");function we(){var e=document.createElement("div");e.id="roleModal",e.style.cssText="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:10000;display:flex;align-items:center;justify-content:center;animation:fadeIn 0.3s ease";var t='<div style="background:var(--card);border:1px solid var(--border);border-radius:3px;padding:32px;max-width:620px;width:95%;max-height:85vh;overflow-y:auto"><h3 style="color:#fff;margin:0 0 4px"><i class="fas fa-user-cog" style="color:var(--accent);margin-right:8px"></i>Configure Your Role</h3><p style="color:var(--steel);font-size:0.85rem;margin-bottom:20px">Select your role to see relevant tools. You can customize visible tools and your displayed title.</p><div style="margin-bottom:16px"><label style="color:var(--steel);font-size:0.8rem;font-weight:600">Your Display Title</label><input id="roleTitle" value="'+(Se||"")+'" style="background:#0a0e1a;color:#fff;border:1px solid rgba(255,255,255,0.15);border-radius:3px;padding:10px;width:100%;margin-top:4px" placeholder="e.g., ILS Analyst, Logistics Specialist, Contract Manager"></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px">';Object.keys(F).forEach(function(r){var o=F[r],s=k===r?"border-color:var(--accent);background:rgba(0,170,255,0.08)":"";t+=`<div class="role-card" onclick="selectRolePreset('`+r+`')" style="border:2px solid `+(s?"var(--accent)":"var(--border)")+";border-radius:3px;padding:14px;cursor:pointer;transition:all 0.2s;"+(s?"background:rgba(0,170,255,0.08)":"")+'" data-role="'+r+'"><div style="display:flex;align-items:center;gap:8px;margin-bottom:6px"><i class="fas '+o.icon+'" style="color:var(--accent);font-size:1.1rem"></i><strong style="color:#fff;font-size:0.9rem">'+o.label+'</strong></div><div style="color:var(--steel);font-size:0.78rem">'+o.desc+'</div><div style="color:var(--muted);font-size:0.72rem;margin-top:4px">'+o.tabs.length+" tools</div></div>"}),t+='</div><details style="margin-bottom:20px;background:rgba(0,170,255,0.03);border:1px solid rgba(0,170,255,0.12);border-radius:3px;padding:0 16px"><summary style="cursor:pointer;color:var(--accent);font-weight:600;font-size:0.85rem;padding:12px 0;list-style:none;display:flex;align-items:center;gap:8px"><i class="fas fa-sliders-h"></i> Customize Visible Tools <i class="fas fa-chevron-down" style="font-size:0.7rem;margin-left:auto;opacity:0.5"></i></summary><div id="roleToolChecks" style="display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:0 0 16px">',ye.forEach(function(r){var o=ee?ee.indexOf(r)>=0:k?(F[k]?.tabs||[]).indexOf(r)>=0:!0;t+='<label style="display:flex;align-items:center;gap:8px;font-size:0.82rem;color:var(--steel);cursor:pointer;padding:6px 10px;border-radius:3px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);transition:all 0.2s"><input type="checkbox" data-tab="'+r+'" '+(o?"checked":"")+' onchange="onRoleToolToggle()" style="accent-color:#00aaff;width:16px;height:16px;flex-shrink:0"> <span>'+(Oe[r]||r)+"</span></label>"}),t+=`</div></details><div style="display:flex;gap:10px;justify-content:flex-end"><button onclick="document.getElementById('roleModal').remove()" style="background:rgba(255,255,255,0.06);color:var(--steel);border:1px solid var(--border);border-radius:3px;padding:8px 20px;cursor:pointer">Cancel</button><button onclick="applyRole()" style="background:var(--accent);color:#fff;border:none;border-radius:3px;padding:8px 24px;cursor:pointer;font-weight:600">Apply Role</button></div></div>`,e.innerHTML=t,document.body.appendChild(e)}function Pe(e){document.querySelectorAll(".ils-hub-tab").forEach(function(t){var r=t.getAttribute("onclick")||"",o=r.match(/switchHubTab\('([^']+)'/);if(o){var s=o[1];t.style.display=e.indexOf(s)>=0?"":"none"}}),document.querySelectorAll(".ils-tool-card[onclick]").forEach(function(t){var r=t.getAttribute("onclick")||"",o=r.match(/openILSTool\('([^']+)'/);o&&(t.style.display=e.indexOf(o[1])>=0?"":"none")})}function De(){var e=document.getElementById("roleBadge");if(!e){var t=document.querySelector(".ils-hub-tabs")?.previousElementSibling;if(!t)return;var r=t.querySelector("div:last-child");if(!r)return;e=document.createElement("span"),e.id="roleBadge",e.style.cssText="display:inline-flex;align-items:center;gap:6px;padding:5px 12px;border-radius:3px;font-size:0.75rem;font-weight:600;background:rgba(0,170,255,0.1);border:1px solid rgba(0,170,255,0.25);color:#00aaff;cursor:pointer;transition:all 0.2s;hover:background:rgba(0,170,255,0.2)",e.title="Click to change your role",e.onclick=we,r.appendChild(e)}var o=k?F[k]?.icon||"fa-user":"fa-user-cog",s=Se||(k?F[k]?.label:"Set Role");e.innerHTML='<i class="fas '+o+'"></i> '+s+' <i class="fas fa-gear" style="font-size:0.6rem;opacity:0.6"></i>'}function oe(){if(k){var e=ee||(F[k]?F[k].tabs:ye);Pe(e),typeof reloadVaultForRole=="function"&&reloadVaultForRole()}De(),k||setTimeout(function(){var t=document.getElementById("platformWorkspace");t&&t.style.display==="block"&&sessionStorage.getItem("s4_onboard_done")&&we()},2500)}(function(){function e(a){return Math.round(a).toString().replace(/\B(?=(?:\d{3})+(?!\d))/g,",")}function t(){try{var a=function(T){var O=document.getElementById(T);return O&&parseFloat(O.value)||0},d=a("roiPrograms"),n=a("roiRecords"),c=a("roiFTEs"),i=a("roiRate"),l=a("roiAudit"),u=a("roiError"),h=a("roiIncidents"),p=a("roiLicense"),g=d*n,S=1+Math.sqrt(Math.max(0,g))/50,w=c*2080,x=w*i,C=x*.65*S,_=h*u*.9,v=l*.7*Math.max(1,d/5),y=g>0?C/12/g:0,E=C+_+v,A=E-p,b=p>0?A/p*100:0,I=E>0?Math.ceil(p/E*12):0,L=E*5-p*5,R=function(T,O,P){var Y=document.getElementById(T);Y&&(Y.textContent=O,P&&(Y.style.color=P))};R("roiSavings","$"+e(A),A>0?"#00cc66":"#ff4444"),R("roiPercent",b.toFixed(0)+"%",b>0?"#00cc66":"#ff4444"),R("roiPayback",I+" mo",null),R("roi5Year","$"+e(L),L>0?"#00cc66":"#ff4444");var q=document.getElementById("roiOutput");q&&(q.innerHTML='<div style="background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:20px;margin-top:12px"><div class="section-label"><i class="fas fa-chart-line"></i> ROI BREAKDOWN</div><div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;font-size:0.85rem;margin-bottom:16px"><div><span style="color:var(--steel)">Labor Automation (65%)</span><br><strong style="color:#00cc66">$'+e(C)+'</strong></div><div><span style="color:var(--steel)">Error Reduction (90%)</span><br><strong style="color:#00cc66">$'+e(_)+'</strong></div><div><span style="color:var(--steel)">Audit Cost Reduction (70%)</span><br><strong style="color:#00cc66">$'+e(v)+'</strong></div><div><span style="color:var(--steel)">S4 Ledger License</span><br><strong style="color:#ff6b6b">-$'+e(p)+'</strong></div></div><hr style="border-color:var(--border);margin:12px 0"><div style="display:flex;justify-content:space-between;align-items:center"><div><span style="color:var(--steel);font-size:0.82rem">Net Annual Savings</span><br><span style="font-size:1.5rem;font-weight:800;color:'+(A>0?"#00cc66":"#ff4444")+'">$'+e(A)+'</span></div><div><span style="color:var(--steel);font-size:0.82rem">Per-Record Savings</span><br><span style="font-size:1.1rem;font-weight:700;color:var(--accent)">$'+y.toFixed(2)+'/record</span></div><div><span style="color:var(--steel);font-size:0.82rem">Volume Multiplier</span><br><span style="font-size:1.1rem;font-weight:700;color:var(--accent)">'+S.toFixed(2)+"x</span></div></div></div>");try{typeof renderROICharts=="function"&&renderROICharts()}catch{}}catch(T){console.error("[S4-BP-ROI] Error:",T)}}function r(){var a=["roiPrograms","roiRecords","roiFTEs","roiRate","roiAudit","roiError","roiIncidents","roiLicense"],d=0;return a.forEach(function(n){var c=document.getElementById(n);c&&(c.removeAttribute("oninput"),c.addEventListener("input",t),d++)}),d>0&&t(),d}function o(){var a={};try{var d=document.querySelectorAll('#ilsCoverage input[type="checkbox"], .ils-checklist input[type="checkbox"]'),n=0,c=d.length||1;d.forEach(function(u){u.checked&&n++}),a.ilsPct=Math.round(n/c*100)}catch{a.ilsPct=0}var i=["pctCMMC","pctNIST","pctDFARS","pctFAR","pctILS","pctDMSMSmgmt"];a.comp=i.map(function(u){var h=document.getElementById(u);return h&&parseInt(h.textContent)||0}),a.vault=typeof s4Vault<"u"?s4Vault.length:typeof getLocalRecords=="function"?getLocalRecords().length:0,a.actions=typeof s4ActionItems<"u"?s4ActionItems.length:0,a.actionsDone=0,typeof s4ActionItems<"u"&&s4ActionItems.forEach(function(u){u.status==="done"&&a.actionsDone++});var l=function(u){var h=document.getElementById(u);return h&&parseFloat(h.value)||0};return a.roiPrograms=l("roiPrograms"),a.roiRecords=l("roiRecords"),a.roiFTEs=l("roiFTEs"),a.roiRate=l("roiRate"),a.roiLicense=l("roiLicense"),a.roiAudit=l("roiAudit"),a.stats=typeof stats<"u"?stats:{anchored:0,slsFees:0},a.dmsmsItems=typeof dmsmsItems<"u"?dmsmsItems:[],a.riskItems=typeof riskItems<"u"?riskItems:[],a}var s={gapRadarChart:function(){var a=o(),d=Math.min(100,20+a.vault*3),n=Math.min(100,15+a.vault*4),c=Math.min(100,a.comp[0]||10),i=Math.min(100,10+(a.dmsmsItems.length||0)*8),l=Math.min(100,15+(a.riskItems.length||0)*5),u=Math.min(100,20+a.ilsPct*.6),h=[d,n,c,i,l,u].map(function(p){return Math.min(100,p+30+Math.random()*5|0)});return{type:"radar",data:{labels:["Tracking","Audit","Compliance","Obsolescence","Risk","Budget"],datasets:[{label:"Current (Manual)",data:[d,n,c,i,l,u],borderColor:"#ff6b6b",backgroundColor:"rgba(255,107,107,0.1)",pointBackgroundColor:"#ff6b6b"},{label:"With S4 Ledger",data:h,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",pointBackgroundColor:"#00aaff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"#8ea4b8",font:{size:10}}}},scales:{r:{grid:{color:"rgba(255,255,255,0.06)"},angleLines:{color:"rgba(255,255,255,0.06)"},pointLabels:{color:"#8ea4b8",font:{size:9}},ticks:{display:!1}}}}}},gapBarChart:function(){var a=o(),d=Math.max(0,100-(20+a.vault*3)),n=Math.max(0,100-(15+a.vault*4)),c=Math.max(0,100-(a.comp[0]||10)),i=Math.max(0,100-(10+(a.dmsmsItems.length||0)*8)),l=Math.max(0,100-(15+(a.riskItems.length||0)*5)),u=Math.max(0,100-(20+a.ilsPct*.6));return{type:"bar",data:{labels:["Tracking","Audit","Compliance","Obsolescence","Risk","Budget"],datasets:[{label:"Gap %",data:[d,n,c,i,l,u],backgroundColor:["#ff6b6b","#fb923c","#c9a84c","#00aaff","#38bdf8","#06b6d4"],borderWidth:0,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},max:100},y:{ticks:{color:"#8ea4b8",font:{size:9}},grid:{display:!1}}}}}},dmsmsPieChart:function(){var a=o(),d=a.dmsmsItems,n=0,c=0,i=0,l=0,u=0;return d.length>0?d.forEach(function(h){var p=(h.status||"").toLowerCase();p.indexOf("obsolete")>=0?i++:p.indexOf("risk")>=0||p.indexOf("diminish")>=0?c++:p.indexOf("discontin")>=0?l++:p.indexOf("eol")>=0||p.indexOf("last")>=0?u++:n++}):(n=45,c=20,i=15,l=10,u=10),{type:"doughnut",data:{labels:["Active","At Risk","Obsolete","Discontinued","EOL Planned"],datasets:[{data:[n,c,i,l,u],backgroundColor:["#00aaff","#c9a84c","#ff6b6b","#00aaff","#6b7d93"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:9},padding:6}}}}}},readinessGauge:function(){var a=o(),d=Math.max(30,a.ilsPct),n=Math.min(100,d+15+(a.vault>5?10:0)),c=Math.min(100,d+(a.dmsmsItems.length>0?-5:8)),i=Math.min(100,d-12+a.vault*2),l=Math.min(100,d+20),u=Math.min(100,d+6+a.actionsDone*3),h=Math.min(100,d+12);return{type:"bar",data:{labels:["Personnel","Equipment","Supply","Training","Maintenance","C4ISR"],datasets:[{label:"Readiness %",data:[n,c,i,l,u,h],backgroundColor:"rgba(0,170,255,0.6)",borderColor:"#00aaff",borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:9}},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0,max:100}}}}},complianceRadarChart:function(){var a=o(),d=a.comp[2]||30,n=Math.min(100,40+a.vault*4),c=a.comp[1]||25,i=a.comp[0]||20,l=Math.min(100,30+a.ilsPct*.5),u=Math.min(100,35+a.vault*3);return{type:"polarArea",data:{labels:["DFARS","ITAR","NIST 800-171","CMMC","ISO 27001","SOX"],datasets:[{data:[d,n,c,i,l,u],backgroundColor:["rgba(0,170,255,0.5)","rgba(201,168,76,0.5)","rgba(56,189,248,0.5)","rgba(255,107,107,0.5)","rgba(0,170,255,0.5)","rgba(6,182,212,0.5)"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:9},padding:6}}},scales:{r:{grid:{color:"rgba(255,255,255,0.06)"},ticks:{display:!1}}}}}},roiLineChart:function(){var a=o(),d=a.roiPrograms*a.roiRecords,n=1+Math.sqrt(Math.max(0,d))/50,c=a.roiFTEs*2080*a.roiRate,i=c*.65*n,l=a.roiAudit*.7*Math.max(1,a.roiPrograms/5),u=i+l,h=a.roiLicense||1,p=[],g=[],S=a.roiPrograms>0||a.roiFTEs>0||a.roiLicense>0;if(S)for(var w=0,x=1;x<=5;x++)for(var C=1;C<=4;C++){p.push("Y"+x+"-Q"+C);var _=(x-1)*4+C,v=.2+.65*(1-Math.exp(-.18*_)),y=u/4*v,E=h/4;w+=y-E;var A=h>0?w/h*100:0;g.push(Math.round(A))}if(!S||g.length===0||g.every(function(L){return L===0})){p=[],g=[];for(var b=1;b<=5;b++)for(var I=1;I<=4;I++){p.push("Y"+b+"-Q"+I);var _=(b-1)*4+I;g.push(Math.round(-15+3.5*_+.8*Math.pow(_,1.45)))}}return{type:"line",data:{labels:p,datasets:[{label:"Cumulative ROI %",data:g,borderColor:"#00cc66",backgroundColor:"rgba(0,204,102,0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"#00cc66"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"5-Year Cumulative ROI",color:"#8ea4b8",font:{size:11}}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:8},maxRotation:45},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:9},callback:function(L){return L+"%"}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}}},riskHeatChart:function(){var a=o(),d=[];if(a.riskItems.length>0)a.riskItems.forEach(function(l){d.push({x:l.likelihood||Math.ceil(Math.random()*9),y:l.impact||Math.ceil(Math.random()*9)})});else for(var n=Math.max(3,Math.min(12,3+a.vault+a.actions)),c=0;c<n;c++)d.push({x:1+Math.floor(Math.random()*9),y:1+Math.floor(Math.random()*9)});var i=d.map(function(l){var u=l.x*l.y;return u>=50?"rgba(255,70,70,0.8)":u>=25?"rgba(255,165,0,0.7)":u>=10?"rgba(201,168,76,0.6)":"rgba(0,170,255,0.5)"});return{type:"scatter",data:{datasets:[{label:"Risk Items",data:d,backgroundColor:i,borderColor:i,pointRadius:7}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:d.length+" Risk Items Mapped",color:"#8ea4b8",font:{size:11}}},scales:{x:{title:{display:!0,text:"Likelihood →",color:"#8ea4b8",font:{size:9}},ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},min:0,max:10},y:{title:{display:!0,text:"Impact →",color:"#8ea4b8",font:{size:9}},ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},min:0,max:10}}}}},lifecyclePieChart:function(){var a=o(),d=Math.min(30,(a.dmsmsItems.length||0)*5),n=Math.min(15,a.ilsPct*.15);return{type:"line",data:{labels:["Intro","Growth","Maturity","Sustain","Phase Out","Disposal"],datasets:[{label:"Availability %",data:[95-d*.1,92-d*.2+n,88-d*.4+n,75-d*.6+n*2,50-d*.3+n,20+n*.5].map(function(c){return Math.round(Math.max(5,Math.min(100,c)))}),borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",fill:!0,tension:.3},{label:"Cost Index",data:[30,25+d*.3,35+d*.5,55+d*.8-n,70+d-n*2,90+d*.5-n].map(function(c){return Math.round(Math.max(5,Math.min(100,c)))}),borderColor:"#ff6b6b",backgroundColor:"rgba(255,107,107,0.05)",fill:!0,tension:.3}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"#8ea4b8",font:{size:10}}}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:9}},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}}}};window._bpRenderInPanel=f;function f(a){if(typeof Chart>"u"){console.warn("[S4-BP-Charts] Chart.js not loaded");return}if(typeof injectChartContainers=="function")try{injectChartContainers()}catch(n){console.error("[S4-BP-Charts] injectChartContainers error:",n)}var d=a.querySelectorAll("canvas");if(d.length===0){console.log("[S4-BP-Charts] No canvases found in panel "+a.id);return}d.forEach(function(n){if(!n.getAttribute("data-bp-rendered")){var c=s[n.id];if(!c){console.log("[S4-BP-Charts] No config for canvas: "+n.id);return}try{var i=Chart.getChart(n);i&&i.destroy(),!n.style.height&&!n.getAttribute("height")&&(n.style.height="220px"),n.style.width="100%",n.style.display="block";var l=n.closest(".chart-container");l&&(l.style.display="block",l.style.visibility="visible"),new Chart(n,c()),n.setAttribute("data-bp-rendered","1"),n.setAttribute("data-bp-ts",Date.now()),console.log("[S4-BP-Charts] Rendered: "+n.id)}catch(u){console.error("[S4-BP-Charts] Failed "+n.id+":",u)}}})}function m(){if(console.log("[S4-Bulletproof-v5] Initializing..."),r()===0&&(setTimeout(r,2e3),setTimeout(r,5e3)),window.calcROI=t,typeof window.openILSTool=="function"){var a=window.openILSTool;window.openILSTool=function(n){a(n),setTimeout(function(){var c=document.getElementById(n);c&&f(c)},300),setTimeout(function(){var c=document.getElementById(n);c&&f(c)},800),setTimeout(function(){var c=document.getElementById(n);c&&f(c)},2e3)},console.log("[S4-Bulletproof-v5] Hooked openILSTool")}if(typeof window.switchHubTab=="function"){var d=window.switchHubTab;window.switchHubTab=function(n,c){d(n,c),setTimeout(function(){var i=document.getElementById(n);i&&f(i)},400)}}document.querySelectorAll(".ils-hub-panel").forEach(function(n){var c=new MutationObserver(function(i){i.forEach(function(l){l.target.classList&&l.target.classList.contains("active")&&setTimeout(function(){f(l.target)},400)})});c.observe(n,{attributes:!0,attributeFilter:["class","style"]})}),setTimeout(function(){document.querySelectorAll(".ils-hub-panel.active").forEach(function(n){f(n)})},2e3),setTimeout(function(){if(typeof loadPerformanceMetrics=="function")try{loadPerformanceMetrics()}catch{}},1500),setTimeout(r,3e3),typeof oe=="function"&&oe(),console.log("[S4-Bulletproof-v5] Init complete")}window._s4RefreshCharts=function(){document.querySelectorAll("canvas[data-bp-rendered]").forEach(function(d){d.removeAttribute("data-bp-rendered")});var a=document.querySelector(".ils-hub-panel.active");a&&f(a)},document.readyState==="loading"?document.addEventListener("DOMContentLoaded",m):m()})();
//# sourceMappingURL=index-Cik5b-ue.js.map
