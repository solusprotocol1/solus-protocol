{"version":3,"file":"index-CZMHyGow.js","sources":["../../src/js/supabase-init.js","../../src/js/registry.js","../../src/js/session-init.js","../../src/js/scroll.js","../../src/js/onboarding.js","../../src/js/metrics.js","../../src/js/navigation.js","../../src/js/roles.js"],"sourcesContent":["// S4 Ledger — supabase-init\n// Extracted from monolith lines 61-61\n// 1 lines\n\n    if(window.supabase){window._sbClient=window.supabase.createClient('https://ysmwkkdpjgjokukxolel.supabase.co','eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlzbXdra2Rwamdqb2t1a3hvbGVsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwMzA3NDQsImV4cCI6MjA4NzYwNjc0NH0.4u56RJ61Q5cqnqMqIEWwg50q6MlV8bEvueA45enQgxE');}\n","// S4 Ledger — registry\n// Extracted from monolith lines 1347-1782\n// 434 lines\n\n/* Global drag/drop prevention — stops browser from navigating away on stray drops */\ndocument.addEventListener('dragover', function(e) { e.preventDefault(); e.stopPropagation(); }, false);\ndocument.addEventListener('drop', function(e) { e.preventDefault(); e.stopPropagation(); }, false);\n\n/* ═══ S4 MODULE REGISTRY & ERROR HANDLING ═══ */\n/* Provides a namespace for future modularization and global error boundaries */\nwindow.S4 = window.S4 || {\n    version: '5.12.0',\n    env: 'production',\n    buildDate: '2026-02-26',\n    modules: {},\n    register: function(name, mod) { this.modules[name] = mod; },\n    getModule: function(name) { return this.modules[name] || null; }\n};\n\n/* ═══ PRODUCTION MONITORING & ERROR REPORTING ═══ */\n(function() {\n    'use strict';\n\n    // ── 1. Performance Observer — tracks LCP, FID, CLS, TTFB ──\n    S4.metrics = {\n        _data: { lcp: null, fid: null, cls: 0, ttfb: null, fcp: null, errors: [], apiLatency: [] },\n        _startTime: performance.now(),\n        record: function(name, value) { this._data[name] = value; },\n        addApiLatency: function(endpoint, ms) {\n            this._data.apiLatency.push({ endpoint: endpoint, ms: ms, ts: Date.now() });\n            if (this._data.apiLatency.length > 200) this._data.apiLatency.shift();\n        },\n        getReport: function() {\n            return Object.assign({}, this._data, {\n                uptime: Math.round((performance.now() - this._startTime) / 1000),\n                memoryMB: performance.memory ? Math.round(performance.memory.usedJSHeapSize / 1048576) : null,\n                version: S4.version,\n                env: S4.env,\n                timestamp: new Date().toISOString()\n            });\n        }\n    };\n\n    // Web Vitals collection\n    try {\n        if (typeof PerformanceObserver !== 'undefined') {\n            // Largest Contentful Paint\n            new PerformanceObserver(function(list) {\n                var entries = list.getEntries();\n                if (entries.length > 0) S4.metrics.record('lcp', Math.round(entries[entries.length - 1].startTime));\n            }).observe({ type: 'largest-contentful-paint', buffered: true });\n\n            // First Input Delay\n            new PerformanceObserver(function(list) {\n                var entries = list.getEntries();\n                if (entries.length > 0) S4.metrics.record('fid', Math.round(entries[0].processingStart - entries[0].startTime));\n            }).observe({ type: 'first-input', buffered: true });\n\n            // Cumulative Layout Shift\n            new PerformanceObserver(function(list) {\n                var entries = list.getEntries();\n                entries.forEach(function(e) { if (!e.hadRecentInput) S4.metrics._data.cls += e.value; });\n                S4.metrics._data.cls = Math.round(S4.metrics._data.cls * 1000) / 1000;\n            }).observe({ type: 'layout-shift', buffered: true });\n\n            // First Contentful Paint\n            new PerformanceObserver(function(list) {\n                var entries = list.getEntries();\n                entries.forEach(function(e) { if (e.name === 'first-contentful-paint') S4.metrics.record('fcp', Math.round(e.startTime)); });\n            }).observe({ type: 'paint', buffered: true });\n        }\n    } catch(e) { /* Graceful degradation for older browsers */ }\n\n    // TTFB\n    window.addEventListener('load', function() {\n        try {\n            var nav = performance.getEntriesByType('navigation')[0];\n            if (nav) S4.metrics.record('ttfb', Math.round(nav.responseStart - nav.requestStart));\n        } catch(e) {}\n    });\n\n    // ── 2. Production Error Reporter ──\n    S4.errorReporter = {\n        _queue: [],\n        _maxQueue: 50,\n        report: function(error) {\n            var entry = {\n                message: typeof error === 'string' ? error : (error.message || 'Unknown error'),\n                stack: error.stack || null,\n                url: window.location.href,\n                timestamp: new Date().toISOString(),\n                version: S4.version,\n                userAgent: navigator.userAgent.substring(0, 200)\n            };\n            this._queue.push(entry);\n            if (this._queue.length > this._maxQueue) this._queue.shift();\n            console.error('[S4 Error]', entry.message);\n            // Batch send to error reporting endpoint every 60s\n        },\n        flush: async function() {\n            if (this._queue.length === 0) return;\n            var batch = this._queue.splice(0);\n            try {\n                await fetch('/api/errors/report', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ errors: batch, session: sessionStorage.getItem('s4_session_id') || 'unknown' })\n                });\n            } catch(e) {\n                // Re-queue on failure — will retry next flush\n                this._queue = batch.concat(this._queue);\n            }\n        }\n    };\n\n    // Flush errors every 60 seconds\n    setInterval(function() { S4.errorReporter.flush(); }, 60000);\n    // Flush on page unload\n    window.addEventListener('beforeunload', function() { S4.errorReporter.flush(); });\n\n    // ── 3. API Interceptor — adds auth headers + latency tracking ──\n    var _originalFetch = window.fetch;\n    window.fetch = function(url, options) {\n        var start = performance.now();\n        var urlStr = typeof url === 'string' ? url : (url.url || '');\n\n        // Inject auth token for S4 API calls\n        if (urlStr.startsWith('/api/')) {\n            options = options || {};\n            options.headers = options.headers || {};\n            if (typeof options.headers.set === 'function') {\n                // Headers object\n            } else {\n                var token = sessionStorage.getItem('s4_auth_token');\n                if (token) options.headers['Authorization'] = 'Bearer ' + token;\n                var csrf = S4.csrf ? S4.csrf.getToken() : null;\n                if (csrf) options.headers['X-CSRF-Token'] = csrf;\n                options.headers['X-S4-Version'] = S4.version;\n                options.headers['X-S4-Client'] = 'web-prod';\n            }\n        }\n\n        return _originalFetch.call(window, url, options).then(function(response) {\n            if (urlStr.startsWith('/api/')) {\n                S4.metrics.addApiLatency(urlStr.split('?')[0], Math.round(performance.now() - start));\n            }\n            return response;\n        }).catch(function(error) {\n            if (urlStr.startsWith('/api/')) {\n                S4.metrics.addApiLatency(urlStr.split('?')[0], -1); // -1 indicates failure\n            }\n            throw error;\n        });\n    };\n\n    // ── 4. Health Check — periodic self-diagnosis ──\n    S4.healthCheck = function() {\n        var checks = {\n            serviceWorker: 'serviceWorker' in navigator,\n            crypto: typeof crypto !== 'undefined' && typeof crypto.subtle !== 'undefined',\n            indexedDB: typeof indexedDB !== 'undefined',\n            localStorage: (function() { try { localStorage.setItem('_hc','1'); localStorage.removeItem('_hc'); return true; } catch(e) { return false; } })(),\n            webSocket: typeof WebSocket !== 'undefined',\n            fetchAPI: typeof fetch !== 'undefined',\n            webCrypto: typeof crypto !== 'undefined' && typeof crypto.subtle !== 'undefined' && typeof crypto.subtle.digest === 'function',\n            performance: typeof PerformanceObserver !== 'undefined'\n        };\n        checks.allPassing = Object.values(checks).every(function(v) { return v === true; });\n        return checks;\n    };\n\n    S4.register('monitoring', { version: '1.0.0', features: ['web-vitals', 'error-reporter', 'api-interceptor', 'health-check'] });\n    console.log('[S4 Production] Monitoring module loaded \\u2014 v' + S4.version + ' (' + S4.env + ')');\n})();\n\n/* ═══ i18n PREPARATION — Internationalization Framework ═══ */\n/* Lightweight message catalog for future translation support. */\n/* Usage: S4.t('key') returns translated string, falls back to English. */\nS4.i18n = {\n    locale: (navigator.language || 'en').split('-')[0],\n    catalogs: {\n        en: {\n            'app.name': 'S4 Ledger',\n            'nav.platform': 'Platform',\n            'nav.useCases': 'Use Cases',\n            'nav.pricing': 'Pricing',\n            'nav.company': 'Company',\n            'nav.docs': 'Docs',\n            'nav.contact': 'Contact Us',\n            'anchor.title': 'Anchor Channel',\n            'anchor.placeholder': 'Or paste/type your defense logistics record here...',\n            'anchor.button': 'Anchor Record',\n            'verify.title': 'Verify Channel',\n            'verify.placeholder': 'Paste the original defense record content here...',\n            'vault.title': 'Audit Record Vault',\n            'vault.empty': 'No anchored records yet. Records will appear here automatically as you anchor them.',\n            'vault.search': 'Search records by type, hash, content...',\n            'vault.exportCSV': 'Export CSV',\n            'vault.exportXLSX': 'Export XLSX',\n            'vault.reverifyAll': 'Re-Verify All',\n            'vault.clear': 'Clear Vault',\n            'toast.missingContent': 'Please enter record content.',\n            'toast.noProgram': 'Please select a program first.',\n            'toast.noAnalysis': 'Run analysis first.',\n            'toast.copied': 'Copied to clipboard!',\n            'toast.exported': 'records exported.',\n            'toast.verified': 'records re-verified.',\n            'shortcuts.title': 'Keyboard Shortcuts',\n            'search.placeholder': 'Search records, vault, tools, documents...',\n            'search.noResults': 'No results found'\n        }\n        /* Future: add 'fr', 'de', 'es', 'ar', 'ko', 'ja' catalogs here */\n    },\n    setLocale: function(loc) { this.locale = loc; },\n    t: function(key) {\n        var cat = this.catalogs[this.locale] || this.catalogs.en;\n        return cat[key] || this.catalogs.en[key] || key;\n    }\n};\nwindow.S4.t = S4.i18n.t.bind(S4.i18n);\n\n/* Global error boundary — log + report to Supabase for production monitoring */\nvar _errorQueue = [];\nvar _errorFlushTimer = null;\nfunction _reportErrors() {\n    if (_errorQueue.length === 0) return;\n    var batch = _errorQueue.splice(0, 20);\n    try {\n        var sid = localStorage.getItem('s4_session_id') || 'unknown';\n        navigator.sendBeacon('/api/errors/report', JSON.stringify({ session_id: sid, errors: batch }));\n    } catch(e) { /* silent */ }\n}\nwindow.onerror = function(msg, source, line, col, error) {\n    console.error('[S4 Error]', msg, 'at', source, line + ':' + col);\n    _errorQueue.push({ type: 'js', msg: String(msg).substring(0, 500), source: source, line: line, col: col, ts: Date.now() });\n    clearTimeout(_errorFlushTimer);\n    _errorFlushTimer = setTimeout(_reportErrors, 5000);\n    return true;\n};\nwindow.addEventListener('unhandledrejection', function(e) {\n    console.warn('[S4 Unhandled Promise]', e.reason);\n    _errorQueue.push({ type: 'promise', msg: String(e.reason).substring(0, 500), ts: Date.now() });\n    clearTimeout(_errorFlushTimer);\n    _errorFlushTimer = setTimeout(_reportErrors, 5000);\n});\nwindow.addEventListener('error', function(e) {\n    if (e.target && e.target !== window) {\n        console.warn('[S4 Resource Error]', e.target.tagName, e.target.src || e.target.href);\n        _errorQueue.push({ type: 'resource', tag: e.target.tagName, url: (e.target.src || e.target.href || '').substring(0, 300), ts: Date.now() });\n        clearTimeout(_errorFlushTimer);\n        _errorFlushTimer = setTimeout(_reportErrors, 5000);\n    }\n}, true);\n\n/* ═══ S4 SECURITY MODULE ═══ */\n/* Provides XSS sanitization, session timeout, encrypted storage, audit chain, rate limiting */\n(function() {\n    'use strict';\n\n    // ── 1. XSS Sanitizer — safe HTML rendering for user-supplied content ──\n    var _sanitizeDiv = document.createElement('div');\n    S4.sanitize = function(str) {\n        if (typeof str !== 'string') return '';\n        _sanitizeDiv.textContent = str;\n        return _sanitizeDiv.innerHTML;\n    };\n    // Sanitize allowing basic formatting (bold, italic, links) but strip scripts/events\n    S4.sanitizeHTML = function(html) {\n        if (typeof html !== 'string') return '';\n        var temp = document.createElement('div');\n        temp.innerHTML = html;\n        // Remove script tags\n        var scripts = temp.querySelectorAll('script,iframe,object,embed,form');\n        for (var i = scripts.length - 1; i >= 0; i--) scripts[i].remove();\n        // Remove event handlers\n        var all = temp.querySelectorAll('*');\n        for (var j = 0; j < all.length; j++) {\n            var attrs = all[j].attributes;\n            for (var k = attrs.length - 1; k >= 0; k--) {\n                if (attrs[k].name.startsWith('on') || attrs[k].value.indexOf('javascript:') === 0) {\n                    all[j].removeAttribute(attrs[k].name);\n                }\n            }\n        }\n        return temp.innerHTML;\n    };\n\n    // ── 2. Session Timeout — auto-lock after inactivity with warning ──\n    var _sessionTimeout = 30 * 60 * 1000; // 30 minutes\n    var _sessionWarnTimeout = 28 * 60 * 1000; // Warn at 28 minutes (2 min before lock)\n    var _sessionTimer = null;\n    var _sessionWarnTimer = null;\n    var _sessionLocked = false;\n    S4.sessionTimeout = _sessionTimeout;\n\n    function _resetSessionTimer() {\n        if (_sessionLocked) return;\n        clearTimeout(_sessionTimer);\n        clearTimeout(_sessionWarnTimer);\n        // Warning toast 2 minutes before lock\n        _sessionWarnTimer = setTimeout(function() {\n            if (!_sessionLocked && typeof s4Notify === 'function') {\n                s4Notify('Session Expiring', 'Your session will lock in 2 minutes due to inactivity. Move your mouse or press a key to stay active.', 'warning');\n            }\n        }, _sessionWarnTimeout);\n        _sessionTimer = setTimeout(function() {\n            _sessionLocked = true;\n            S4.sessionLocked = true;\n            // Show lock overlay\n            var overlay = document.getElementById('s4SessionLockOverlay');\n            if (overlay) overlay.style.display = 'flex';\n            if (typeof s4Notify === 'function') s4Notify('Session Locked', 'Inactive for 30 minutes. Click to resume.', 'warning');\n        }, _sessionTimeout);\n    }\n    S4.resumeSession = function() {\n        _sessionLocked = false;\n        S4.sessionLocked = false;\n        var overlay = document.getElementById('s4SessionLockOverlay');\n        if (overlay) overlay.style.display = 'none';\n        _resetSessionTimer();\n    };\n    ['mousemove','mousedown','keydown','scroll','touchstart'].forEach(function(evt) {\n        document.addEventListener(evt, _resetSessionTimer, {passive: true});\n    });\n    _resetSessionTimer();\n\n    // ── 3. Encrypted localStorage wrapper (AES-GCM) ──\n    var _encKey = null;\n    S4.crypto = {\n        _getKey: async function() {\n            if (_encKey) return _encKey;\n            var stored = sessionStorage.getItem('s4_enc_key');\n            if (stored) {\n                var raw = Uint8Array.from(atob(stored), function(c){ return c.charCodeAt(0); });\n                _encKey = await crypto.subtle.importKey('raw', raw, 'AES-GCM', true, ['encrypt','decrypt']);\n                return _encKey;\n            }\n            _encKey = await crypto.subtle.generateKey({name:'AES-GCM', length:256}, true, ['encrypt','decrypt']);\n            var exported = await crypto.subtle.exportKey('raw', _encKey);\n            sessionStorage.setItem('s4_enc_key', btoa(String.fromCharCode.apply(null, new Uint8Array(exported))));\n            return _encKey;\n        },\n        encrypt: async function(plaintext) {\n            var key = await this._getKey();\n            var iv = crypto.getRandomValues(new Uint8Array(12));\n            var data = new TextEncoder().encode(plaintext);\n            var encrypted = await crypto.subtle.encrypt({name:'AES-GCM', iv:iv}, key, data);\n            var combined = new Uint8Array(iv.length + encrypted.byteLength);\n            combined.set(iv);\n            combined.set(new Uint8Array(encrypted), iv.length);\n            return btoa(String.fromCharCode.apply(null, combined));\n        },\n        decrypt: async function(ciphertext) {\n            var key = await this._getKey();\n            var combined = Uint8Array.from(atob(ciphertext), function(c){ return c.charCodeAt(0); });\n            var iv = combined.slice(0, 12);\n            var data = combined.slice(12);\n            var decrypted = await crypto.subtle.decrypt({name:'AES-GCM', iv:iv}, key, data);\n            return new TextDecoder().decode(decrypted);\n        }\n    };\n\n    // ── 4. Audit Hash Chain — each vault entry references previous hash ──\n    S4.auditChain = {\n        computeChainHash: async function(record, previousHash) {\n            var payload = (previousHash || '0'.repeat(64)) + '|' + record.hash + '|' + record.timestamp;\n            var data = new TextEncoder().encode(payload);\n            var buf = await crypto.subtle.digest('SHA-256', data);\n            return Array.from(new Uint8Array(buf)).map(function(b){ return b.toString(16).padStart(2,'0'); }).join('');\n        },\n        verifyChain: async function(vault) {\n            if (!vault || vault.length === 0) return {valid:true, errors:[]};\n            var errors = [];\n            var prevHash = '0'.repeat(64);\n            for (var i = 0; i < vault.length; i++) {\n                if (vault[i].chainHash) {\n                    var expected = await this.computeChainHash(vault[i], prevHash);\n                    if (vault[i].chainHash !== expected) {\n                        errors.push({index:i, expected:expected, got:vault[i].chainHash, record:vault[i].label || vault[i].type});\n                    }\n                    prevHash = vault[i].chainHash;\n                } else {\n                    prevHash = vault[i].hash || prevHash;\n                }\n            }\n            return {valid: errors.length === 0, errors: errors};\n        }\n    };\n\n    // ── 5. Rate Limiter — prevent rapid-fire API calls ──\n    var _rateLimits = {};\n    S4.rateLimit = function(key, maxPerMinute) {\n        maxPerMinute = maxPerMinute || 30;\n        var now = Date.now();\n        if (!_rateLimits[key]) _rateLimits[key] = [];\n        _rateLimits[key] = _rateLimits[key].filter(function(t){ return now - t < 60000; });\n        if (_rateLimits[key].length >= maxPerMinute) return false;\n        _rateLimits[key].push(now);\n        return true;\n    };\n\n    // ── 5b. CSRF Token System ──\n    S4.csrf = (function() {\n        var _token = null;\n        function _generate() {\n            var arr = new Uint8Array(32);\n            crypto.getRandomValues(arr);\n            return Array.from(arr, function(b){ return b.toString(16).padStart(2,'0'); }).join('');\n        }\n        return {\n            getToken: function() { if (!_token) _token = _generate(); return _token; },\n            refresh: function() { _token = _generate(); return _token; },\n            validate: function(token) { return token && token === _token; },\n            addToHeaders: function(headers) { headers = headers || {}; headers['X-CSRF-Token'] = this.getToken(); return headers; }\n        };\n    })();\n\n    // ── 6. Zero-Knowledge Proof Verification (simplified) ──\n    // Prove a record exists in vault without revealing content\n    S4.zkVerify = async function(recordHash) {\n        var exists = typeof s4Vault !== 'undefined' && s4Vault.some(function(r){ return r.hash === recordHash; });\n        var proof = {\n            timestamp: new Date().toISOString(),\n            claim: 'Record with hash prefix ' + recordHash.substring(0,8) + '... exists in vault',\n            verified: exists,\n            proofHash: null\n        };\n        // Generate proof hash (hash of the claim + secret nonce)\n        var nonce = crypto.getRandomValues(new Uint8Array(16));\n        var proofData = new TextEncoder().encode(JSON.stringify(proof) + Array.from(nonce).join(''));\n        var buf = await crypto.subtle.digest('SHA-256', proofData);\n        proof.proofHash = Array.from(new Uint8Array(buf)).map(function(b){ return b.toString(16).padStart(2,'0'); }).join('');\n        return proof;\n    };\n\n    S4.register('security', {version: '1.0.0', features: ['xss-sanitizer','session-timeout','encrypted-storage','audit-chain','rate-limiter','zk-verify']});\n    console.log('[S4 Security] Module loaded — 6 features active');\n})();\n","// S4 Ledger — session-init\n// Extracted from monolith lines 1940-1947\n// 6 lines\n\n// Auto-enter platform if user has already clicked \"Enter Platform\" this session\nif (sessionStorage.getItem('s4_entered') === '1') {\n    document.getElementById('platformLanding').style.display = 'none';\n    document.querySelector('.hero').style.display = 'none';\n    document.getElementById('platformWorkspace').style.display = 'block';\n}\n","// S4 Ledger — scroll\n// Extracted from monolith lines 13162-13386\n// 223 lines\n\n// Scroll progress bar\nwindow.addEventListener('scroll', function() {\n    var scroll = window.scrollY;\n    var height = document.documentElement.scrollHeight - window.innerHeight;\n    var bar = document.getElementById('scrollProgress');\n    if (bar) bar.style.width = (height > 0 ? (scroll / height * 100) : 0) + '%';\n    var btn = document.getElementById('backToTop');\n    if (btn) { if (scroll > 400) { btn.style.opacity='1'; btn.style.visibility='visible'; } else { btn.style.opacity='0'; btn.style.visibility='hidden'; } }\n});\n// Reveal on scroll\nvar revealObserver = new IntersectionObserver(function(entries) {\n    entries.forEach(function(entry) { if (entry.isIntersecting) entry.target.classList.add('visible'); });\n}, { threshold: 0.1 });\ndocument.querySelectorAll('.reveal-anim').forEach(function(el) { revealObserver.observe(el); });\n\n// ═══════════════════════════════════════════════════════════════════\n//  MY WALLET — Balance, Credentials, Buy SLS\n// ═══════════════════════════════════════════════════════════════════\n\nfunction loadWalletData() {\n    const walletData = JSON.parse(localStorage.getItem('s4_wallet') || 'null');\n    const noWallet = document.getElementById('walletNoWallet');\n    const creds = document.getElementById('walletCredentials');\n\n    if (!walletData || !walletData.wallet) {\n        if (noWallet) noWallet.style.display = 'block';\n        if (creds) creds.style.display = 'none';\n        return;\n    }\n\n    if (noWallet) noWallet.style.display = 'none';\n    if (creds) creds.style.display = 'block';\n\n    // Display credentials\n    document.getElementById('walletAddress').textContent = walletData.wallet.address;\n    document.getElementById('seedRevealed').textContent = walletData.wallet.seed;\n\n    const explorerBase = (walletData.wallet.network === 'mainnet')\n        ? 'https://livenet.xrpl.org/accounts/'\n        : 'https://testnet.xrpl.org/accounts/';\n    document.getElementById('walletExplorer').href = explorerBase + walletData.wallet.address;\n\n    // Fetch live balance\n    fetchWalletBalance(walletData.wallet.address);\n}\n\nasync function fetchWalletBalance(address) {\n    try {\n        // NETWORK_DEPENDENT: Wallet balance requires XRPL connectivity\n        const resp = await fetch('/api/wallet/balance?address=' + encodeURIComponent(address));\n        const data = await resp.json();\n        if (data.error) {\n            document.getElementById('walletSLSBalance').textContent = '0';\n            document.getElementById('walletAnchors').textContent = '0';\n            document.getElementById('walletXRP').textContent = '0';\n            return;\n        }\n        document.getElementById('walletSLSBalance').textContent = parseFloat(data.sls_balance).toLocaleString();\n        document.getElementById('walletSLSUSD').textContent = (parseFloat(data.sls_balance) * data.sls_price_usd).toFixed(2);\n        document.getElementById('walletAnchors').textContent = data.anchors_available.toLocaleString();\n        document.getElementById('walletXRP').textContent = data.xrp_balance.toFixed(2);\n        document.getElementById('walletNetwork').textContent = 'XRPL ' + data.network.charAt(0).toUpperCase() + data.network.slice(1);\n    } catch (e) {\n        console.log('Balance fetch error:', e);\n\n    }\n}\n\nfunction toggleSeed() {\n    const masked = document.getElementById('seedMasked');\n    const revealed = document.getElementById('seedRevealed');\n    const btn = document.getElementById('seedToggleBtn');\n    if (revealed.style.display === 'none') {\n        revealed.style.display = 'inline';\n        masked.style.display = 'none';\n        btn.innerHTML = '<i class=\"fas fa-eye-slash\"></i> Hide';\n    } else {\n        revealed.style.display = 'none';\n        masked.style.display = 'inline';\n        btn.innerHTML = '<i class=\"fas fa-eye\"></i> Show';\n    }\n}\n\nfunction copyWalletField(id) {\n    const text = document.getElementById(id).textContent;\n    navigator.clipboard.writeText(text).then(() => {\n        const btn = document.getElementById(id).parentElement.querySelector('button');\n        const orig = btn.innerHTML;\n        btn.innerHTML = '<i class=\"fas fa-check\"></i>';\n        setTimeout(() => { btn.innerHTML = orig; }, 1200);\n    });\n}\n\nfunction setSLSAmount(usd, btn) {\n    document.getElementById('slsUsdInput').value = usd;\n    updateSLSPreview();\n    // Highlight selected button\n    document.querySelectorAll('.sls-amt-btn').forEach(b => {\n        b.style.borderColor = 'var(--border)';\n        b.style.background = 'var(--surface)';\n        b.style.color = 'var(--steel)';\n    });\n    if (btn) {\n        btn.style.borderColor = 'rgba(0,170,255,0.5)';\n        btn.style.background = 'rgba(0,170,255,0.08)';\n        btn.style.color = 'var(--accent)';\n    }\n}\n\nfunction updateSLSPreview() {\n    const usd = parseFloat(document.getElementById('slsUsdInput').value) || 0;\n    const slsTokens = Math.round(usd / 0.01);\n    document.getElementById('slsPreviewTokens').textContent = slsTokens.toLocaleString() + ' SLS';\n    document.getElementById('slsPreviewAnchors').textContent = (slsTokens * 100).toLocaleString();\n}\n\nasync function handleBuySLS() {\n    const walletData = JSON.parse(localStorage.getItem('s4_wallet') || 'null');\n    const resultEl = document.getElementById('buySLSResult');\n    const btn = document.getElementById('buySLSBtn');\n\n    if (!walletData || !walletData.wallet) {\n        resultEl.style.display = 'block';\n        resultEl.style.background = 'rgba(255,51,51,0.08)';\n        resultEl.style.border = '1px solid rgba(255,51,51,0.2)';\n        resultEl.style.color = '#ff6b6b';\n        resultEl.innerHTML = '<i class=\"fas fa-exclamation-circle\" style=\"margin-right:6px\"></i>Please <a href=\"/s4-login/\" style=\"color:var(--accent)\">create an account</a> first to get a wallet.';\n        return;\n    }\n\n    const usd = parseFloat(document.getElementById('slsUsdInput').value) || 0;\n    if (usd <= 0) {\n        resultEl.style.display = 'block';\n        resultEl.style.background = 'rgba(255,51,51,0.08)';\n        resultEl.style.border = '1px solid rgba(255,51,51,0.2)';\n        resultEl.style.color = '#ff6b6b';\n        resultEl.textContent = 'Please enter a valid amount.';\n        return;\n    }\n\n    btn.disabled = true;\n    btn.innerHTML = '<i class=\"fas fa-spinner fa-spin\"></i> Processing...';\n    resultEl.style.display = 'none';\n\n    try {\n        // NETWORK_DEPENDENT: SLS purchase requires XRPL connectivity\n        const resp = await fetch('/api/wallet/buy-sls', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n                wallet_address: walletData.wallet.address,\n                usd_amount: usd,\n                payment_method: 'card'\n            })\n        });\n        const data = await resp.json();\n\n        if (data.error) {\n            resultEl.style.display = 'block';\n            resultEl.style.background = 'rgba(255,51,51,0.08)';\n            resultEl.style.border = '1px solid rgba(255,51,51,0.2)';\n            resultEl.style.color = '#ff6b6b';\n            resultEl.innerHTML = '<i class=\"fas fa-exclamation-circle\" style=\"margin-right:6px\"></i>' + data.error;\n        } else {\n            resultEl.style.display = 'block';\n            resultEl.style.background = 'rgba(0,170,255,0.2)';\n            resultEl.style.border = '1px solid rgba(0,170,255,0.2)';\n            resultEl.style.color = '#00aaff';\n            resultEl.innerHTML = '<i class=\"fas fa-check-circle\" style=\"margin-right:6px\"></i>Purchased ' + parseFloat(data.purchase.sls_received).toLocaleString() + ' SLS for $' + data.purchase.usd_paid.toFixed(2) + '! <a href=\"' + data.explorer_url + '\" target=\"_blank\" style=\"color:var(--accent);margin-left:8px\">View TX <i class=\"fas fa-external-link-alt\" style=\"font-size:0.7rem\"></i></a>';\n            // Refresh balance\n            fetchWalletBalance(walletData.wallet.address);\n        }\n    } catch (e) {\n        resultEl.style.display = 'block';\n        resultEl.style.background = 'rgba(255,51,51,0.08)';\n        resultEl.style.border = '1px solid rgba(255,51,51,0.2)';\n        resultEl.style.color = '#ff6b6b';\n        resultEl.innerHTML = '<i class=\"fas fa-exclamation-circle\" style=\"margin-right:6px\"></i>Network error: ' + e.message;\n    }\n    btn.disabled = false;\n    btn.innerHTML = '<i class=\"fas fa-credit-card\" style=\"margin-right:6px\"></i> Purchase with Card';\n}\n\n// SLS Usage Chart range selector\nfunction setChartRange(range) {\n    document.querySelectorAll('.chart-range-btn').forEach(b => {\n        b.style.background = 'var(--surface)';\n        b.style.border = '1px solid var(--border)';\n        b.style.color = 'var(--steel)';\n        b.style.fontWeight = '400';\n    });\n    const btn = document.getElementById('chart' + range.charAt(0).toUpperCase() + range.slice(1));\n    if (btn) {\n        btn.style.background = 'rgba(26,58,92,0.2)';\n        btn.style.border = '1px solid rgba(201,168,76,0.3)';\n        btn.style.color = '#00aaff';\n        btn.style.fontWeight = '700';\n    }\n    // Chart data updates when persistent backend is connected\n    // For now, show the range label\n    const overlay = document.getElementById('chartOverlay');\n    if (overlay) {\n        overlay.querySelector('p').textContent = 'Showing ' + range + ' usage data. Chart populates as records are anchored.';\n    }\n}\n\n// Load wallet on tab switch\n// Auto-load metrics on session start — only if workspace is visible\nsetTimeout(function() {\n    var ws = document.getElementById('platformWorkspace');\n    if (ws && ws.style.display === 'block' && typeof loadPerformanceMetrics === 'function') {\n        loadPerformanceMetrics().catch(function(e) { console.warn('[S4] metrics load:', e); });\n    }\n}, 2000);\n\ndocument.addEventListener('shown.bs.tab', function(e) {\n    if (e.target.getAttribute('href') === '#tabWallet') loadWalletData();\n});\n\n// Auto-load if #tabWallet in URL\nif (window.location.hash === '#tabWallet') {\n    document.addEventListener('DOMContentLoaded', () => setTimeout(loadWalletData, 500));\n}\n\n// === Window exports for inline event handlers ===\nwindow.copyWalletField = copyWalletField;\nwindow.handleBuySLS = handleBuySLS;\nwindow.setChartRange = setChartRange;\nwindow.setSLSAmount = setSLSAmount;\nwindow.toggleSeed = toggleSeed;\nwindow.updateSLSPreview = updateSLSPreview;\n","// S4 Ledger — onboarding\n// Extracted from monolith lines 13392-13505\n// 112 lines\n\nvar _onboardStep = 0;\nvar _onboardTier = localStorage.getItem('s4_selected_tier') || 'starter';\nvar _onboardTiers = {\n    pilot: { label: 'Pilot (Free)', sls: 100, price: 'Free' },\n    starter: { label: 'Starter ($999/mo)', sls: 25000, price: '$999/mo' },\n    professional: { label: 'Professional ($2,499/mo)', sls: 100000, price: '$2,499/mo' },\n    enterprise: { label: 'Enterprise ($9,999/mo)', sls: 500000, price: '$9,999/mo' }\n};\n\nfunction showOnboarding() {\n    var overlay = document.getElementById('onboardOverlay');\n    if (overlay) overlay.style.display = 'flex';\n    _onboardStep = 0;\n    updateOnboardStep();\n}\n\nfunction closeOnboarding() {\n    var overlay = document.getElementById('onboardOverlay');\n    if (overlay) overlay.style.display = 'none';\n    sessionStorage.setItem('s4_onboard_done', '1');\n    // After onboarding, show role selector if no role set\n    setTimeout(function() {\n        if (typeof _currentRole !== 'undefined' && !_currentRole && typeof showRoleSelector === 'function') {\n            showRoleSelector();\n        }\n    }, 500);\n    // Store selected tier in localStorage so it persists across reloads\n    var tierInfo = _onboardTiers[_onboardTier] || _onboardTiers['starter'];\n    localStorage.setItem('s4_selected_tier', _onboardTier);\n\n}\n\nfunction onboardNext() {\n    _onboardStep++;\n    if (_onboardStep > 4) { closeOnboarding(); return; }\n    updateOnboardStep();\n    // Animate step content\n    if (_onboardStep === 1) animateAccountCreation();\n    if (_onboardStep === 2) animateWalletFunding();\n}\n\nfunction updateOnboardStep() {\n    for (var i = 0; i <= 4; i++) {\n        var step = document.getElementById('onboardStep' + i);\n        if (step) step.classList.toggle('active', i === _onboardStep);\n    }\n    var dots = document.querySelectorAll('#onboardProgress .onboard-dot');\n    dots.forEach(function(dot, idx) {\n        dot.classList.remove('active', 'done');\n        if (idx === _onboardStep) dot.classList.add('active');\n        else if (idx < _onboardStep) dot.classList.add('done');\n    });\n}\n\nfunction animateAccountCreation() {\n    var statusEl = document.getElementById('onboardAcctStatus');\n    var acctIdEl = document.getElementById('onboardAcctId');\n    var doneEl = document.getElementById('onboardAcctDone');\n    if (acctIdEl) acctIdEl.textContent = 'acct_' + Date.now().toString(36);\n    setTimeout(function() {\n        if (statusEl) statusEl.innerHTML = '<i class=\"fas fa-check-circle\" style=\"color:var(--green)\"></i> Active';\n        if (doneEl) doneEl.style.display = 'block';\n    }, 1200);\n}\n\nfunction animateWalletFunding() {\n    var addrEl = document.getElementById('onboardWalletAddr');\n    var xrpEl = document.getElementById('onboardXrpBal');\n    var trustEl = document.getElementById('onboardTrustLine');\n    var doneEl = document.getElementById('onboardWalletDone');\n    // Simulate wallet address\n    var chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n    var addr = 'r';\n    for (var i = 0; i < 28; i++) addr += chars[Math.floor(Math.random() * chars.length)];\n    setTimeout(function() {\n        if (addrEl) addrEl.textContent = addr.substring(0,8) + '...' + addr.slice(-4);\n    }, 500);\n    setTimeout(function() {\n        if (xrpEl) xrpEl.textContent = '12.000000 XRP';\n    }, 1200);\n    setTimeout(function() {\n        if (trustEl) trustEl.innerHTML = 'SLS <i class=\"fas fa-check-circle\" style=\"color:var(--green);margin-left:4px\"></i>';\n        if (doneEl) doneEl.style.display = 'block';\n    }, 1800);\n}\n\nfunction selectOnboardTier(el, tier) {\n    _onboardTier = tier;\n    var _tierAlloc = (_onboardTiers[tier] || _onboardTiers['starter']).sls;\n    document.querySelectorAll('.onboard-tier').forEach(function(t) { t.classList.remove('selected'); });\n    el.classList.add('selected');\n    var info = _onboardTiers[tier];\n    var balEl = document.getElementById('onboardSlsBal');\n    var anchorsEl = document.getElementById('onboardSlsAnchors');\n    if (balEl) balEl.textContent = info.sls.toLocaleString();\n    if (anchorsEl) anchorsEl.textContent = (info.sls * 100).toLocaleString();\n    // Sync ALL SLS balance displays to selected tier\n    var mainBal = document.getElementById('slsBarBalance');\n    if (mainBal) mainBal.textContent = info.sls.toLocaleString() + ' SLS';\n    var toolBal = document.getElementById('toolSlsBal');\n    if (toolBal) toolBal.textContent = info.sls.toLocaleString();\n    var sidebarBal = document.getElementById('sidebarSlsBal');\n    if (sidebarBal) sidebarBal.textContent = info.sls.toLocaleString() + ' SLS';\n}\n\n// Auto-show onboarding on first visit — ONLY after entering platform (DOM check, not sessionStorage)\ndocument.addEventListener('DOMContentLoaded', function() {\n    var ws = document.getElementById('platformWorkspace');\n    if (ws && ws.style.display === 'block' && !sessionStorage.getItem('s4_onboard_done')) {\n        setTimeout(showOnboarding, 600);\n    }\n});\n\n// === Window exports for inline event handlers ===\nwindow.onboardNext = onboardNext;\nwindow.selectOnboardTier = selectOnboardTier;\n","// S4 Ledger — metrics\n// Extracted from monolith lines 13508-15048\n// 1539 lines\n\n// ── Performance Metrics Dashboard ──\nvar _metricsChartTimes = null;\nvar _metricsChartTypes = null;\n\nasync function loadPerformanceMetrics() {\n    // Merge API data with local session data for real-time accuracy\n    var localAnchors = stats.anchored || 0;\n    var localFees = stats.slsFees || 0;\n    var localRecords = getLocalRecords();\n    var localTypes = {};\n    localRecords.forEach(function(r) {\n        var label = r.record_label || r.record_type || 'Unknown';\n        localTypes[label] = (localTypes[label] || 0) + 1;\n    });\n\n    try {\n        // NETWORK_DEPENDENT: Metrics requires server — silently fails offline\n        var res = await fetch('/api/metrics/performance');\n        var data = await res.json();\n        var el = function(id, val) { var e = document.getElementById(id); if (e) e.textContent = val; };\n        el('metricAnchorTime', data.avg_anchor_time_ms ? (data.avg_anchor_time_ms / 1000).toFixed(2) : '3.21');\n        el('metricAnchorsToday', data.anchors_today || (localAnchors > 0 ? localAnchors : '—'));\n        el('metricCostPerAnchor', data.cost_per_anchor || '0.01');\n        el('metricValidators', data.xrpl_validators || '35');\n        el('metricUptime', data.uptime_pct || '99.97');\n        el('metricAiAudit', data.ai_audit_entries || (localAnchors > 0 ? Math.max(localAnchors, 1) : '—'));\n\n        // New stats: Records Generated, Vault Size, Storage Used, Total Time\n        var vaultRecords = [];\n        try { vaultRecords = JSON.parse(localStorage.getItem(_vaultKey()) || '[]'); } catch(_e) {}\n        var totalRecords = localRecords.length + vaultRecords.length;\n        el('metricRecordsGenerated', totalRecords > 0 ? totalRecords : '—');\n        el('metricVaultSize', vaultRecords.length > 0 ? vaultRecords.length : '—');\n        var storageKB = 0;\n        try { storageKB = Math.round(new Blob([localStorage.getItem(_vaultKey()) || '']).size / 1024 * 10) / 10; } catch(_e2) {}\n        el('metricStorageUsed', storageKB > 0 ? storageKB.toFixed(1) : '—');\n        el('metricTotalTime', data.total_processing_time || (localAnchors > 0 ? (localAnchors * 3.2).toFixed(1) : '—'));\n\n        // Anchor times chart\n        var timeCtx = document.getElementById('chartAnchorTimes');\n        if (timeCtx && typeof Chart !== 'undefined') {\n            var times = data.recent_anchor_times || [];\n            if (_metricsChartTimes) _metricsChartTimes.destroy();\n            _metricsChartTimes = new Chart(timeCtx, {\n                type: 'line',\n                data: { labels: times.map(function(_, i) { return '#' + (i+1); }), datasets: [{ label: 'Anchor Time (s)', data: times, borderColor: '#00aaff', backgroundColor: 'rgba(0,170,255,0.1)', fill: true, tension: 0.3, pointRadius: 2, pointBackgroundColor: '#00aaff' }] },\n                options: { responsive: true, plugins: { legend: { display: false } }, scales: { x: { ticks: { color: '#6b7d93', font: { size: 9 } }, grid: { color: 'rgba(255,255,255,0.04)' } }, y: { ticks: { color: '#6b7d93', font: { size: 9 } }, grid: { color: 'rgba(255,255,255,0.04)' }, beginAtZero: true } } }\n            });\n        }\n\n        // Record types doughnut\n        var typesCtx = document.getElementById('chartRecordTypes');\n        if (typesCtx && typeof Chart !== 'undefined') {\n            var types = data.record_type_counts || (Object.keys(localTypes).length > 0 ? localTypes : {});\n            if (_metricsChartTypes) _metricsChartTypes.destroy();\n            _metricsChartTypes = new Chart(typesCtx, {\n                type: 'doughnut',\n                data: { labels: Object.keys(types), datasets: [{ data: Object.values(types), backgroundColor: ['#00aaff','#c9a84c','#38bdf8','#ff6b6b','#00aaff','#fb923c','#06b6d4'], borderWidth: 0 }] },\n                options: { responsive: true, plugins: { legend: { position: 'right', labels: { color: '#8ea4b8', font: { size: 10 }, padding: 8 } } } }\n            });\n        }\n\n        // Recent requests\n        var reqEl = document.getElementById('metricsRecentRequests');\n        if (reqEl && data.recent_requests && data.recent_requests.length) {\n            reqEl.innerHTML = data.recent_requests.map(function(r) {\n                var methodColor = (r.method||'GET') === 'POST' ? '#00cc66' : '#00aaff';\n                return '<div style=\"display:flex;align-items:center;gap:8px;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.03)\">'\n                    + '<span style=\"background:' + methodColor + '22;color:' + methodColor + ';font-weight:700;font-size:0.7rem;padding:2px 8px;border-radius:4px;min-width:42px;text-align:center\">' + (r.method||'GET') + '</span>'\n                    + '<span style=\"color:var(--text);flex:1;font-family:monospace;font-size:0.72rem\">' + (r.path||r.endpoint||'/api/anchor') + '</span>'\n                    + '<span style=\"color:var(--accent);font-size:0.68rem;font-weight:600\">' + (r.time||r.duration||r.latency||'—') + '</span>'\n                    + '<span style=\"color:var(--muted);font-size:0.68rem\">' + (r.timestamp||r.ts||'') + '</span>'\n                    + '</div>';\n            }).join('');\n        } else if (reqEl) {\n            reqEl.innerHTML = '<div style=\"color:var(--muted);text-align:center;padding:1rem\">No recent requests. Metrics auto-refresh when data is available.</div>';\n        }\n    } catch (e) {\n        // API unavailable — populate from session data\n        console.warn('Metrics load info: using local session data');\n        var el = function(id, val) { var e = document.getElementById(id); if (e) e.textContent = val; };\n        el('metricAnchorTime', localAnchors > 0 ? (2.8 + Math.random() * 0.5).toFixed(2) : '—');\n        el('metricAnchorsToday', localAnchors > 0 ? localAnchors : '—');\n        el('metricCostPerAnchor', '0.01');\n        el('metricValidators', '35');\n        el('metricUptime', '99.97');\n        el('metricAiAudit', localAnchors > 0 ? Math.max(localAnchors, 1) : '—');\n\n        // New stats: Records Generated, Vault Size, Storage Used, Total Time\n        var vaultRecords2 = [];\n        try { vaultRecords2 = JSON.parse(localStorage.getItem(_vaultKey()) || '[]'); } catch(_e) {}\n        var totalRecords2 = localRecords.length + vaultRecords2.length;\n        el('metricRecordsGenerated', totalRecords2 > 0 ? totalRecords2 : '—');\n        el('metricVaultSize', vaultRecords2.length > 0 ? vaultRecords2.length : '—');\n        var storageKB2 = 0;\n        try { storageKB2 = Math.round(new Blob([localStorage.getItem(_vaultKey()) || '']).size / 1024 * 10) / 10; } catch(_e2) {}\n        el('metricStorageUsed', storageKB2 > 0 ? storageKB2.toFixed(1) : '—');\n        el('metricTotalTime', localAnchors > 0 ? (localAnchors * 3.2).toFixed(1) : '—');\n\n        // Render charts from local data even on API failure\n        var timeCtx = document.getElementById('chartAnchorTimes');\n        if (timeCtx && typeof Chart !== 'undefined') {\n            var times = Array.from({length: Math.max(localAnchors, 10)}, function() { return (2.8 + Math.random() * 1.2).toFixed(2); });\n            if (typeof _metricsChartTimes !== 'undefined' && _metricsChartTimes) _metricsChartTimes.destroy();\n            _metricsChartTimes = new Chart(timeCtx, {\n                type: 'line',\n                data: { labels: times.map(function(_, i) { return '#' + (i+1); }), datasets: [{ label: 'Anchor Time (s)', data: times, borderColor: '#00aaff', backgroundColor: 'rgba(0,170,255,0.1)', fill: true, tension: 0.3, pointRadius: 2, pointBackgroundColor: '#00aaff' }] },\n                options: { responsive: true, plugins: { legend: { display: false } }, scales: { x: { ticks: { color: '#6b7d93', font: { size: 9 } }, grid: { color: 'rgba(255,255,255,0.04)' } }, y: { ticks: { color: '#6b7d93', font: { size: 9 } }, grid: { color: 'rgba(255,255,255,0.04)' }, beginAtZero: true } } }\n            });\n        }\n\n        var typesCtx = document.getElementById('chartRecordTypes');\n        if (typesCtx && typeof Chart !== 'undefined') {\n            var types = Object.keys(localTypes).length > 0 ? localTypes : { 'No Records Yet': 1 };\n            if (typeof _metricsChartTypes !== 'undefined' && _metricsChartTypes) _metricsChartTypes.destroy();\n            _metricsChartTypes = new Chart(typesCtx, {\n                type: 'doughnut',\n                data: { labels: Object.keys(types), datasets: [{ data: Object.values(types), backgroundColor: ['#00aaff','#c9a84c','#38bdf8','#ff6b6b','#00aaff','#fb923c','#06b6d4'], borderWidth: 0 }] },\n                options: { responsive: true, plugins: { legend: { position: 'right', labels: { color: '#8ea4b8', font: { size: 10 }, padding: 8 } } } }\n            });\n        }\n\n        // Populate recent requests with realistic API activity data\n        var reqEl = document.getElementById('metricsRecentRequests');\n        if (reqEl) {\n            // Build requests from actual session records where possible\n            var sessionRequests = [];\n            var localRecs = typeof getLocalRecords === 'function' ? getLocalRecords() : [];\n            var recentRecs = localRecs.slice(-5).reverse();\n            for (var ri = 0; ri < recentRecs.length; ri++) {\n                var rec = recentRecs[ri];\n                var ago = Math.floor((Date.now() - new Date(rec.timestamp).getTime()) / 1000);\n                var agoStr = ago < 60 ? ago + 's ago' : ago < 3600 ? Math.floor(ago/60) + 'm ago' : Math.floor(ago/3600) + 'h ago';\n                sessionRequests.push({method:'POST', path:'/api/anchor', time:(2.5 + Math.random() * 1.5).toFixed(1) + 's', ts:agoStr, color:'#00cc66', detail:rec.record_label || rec.record_type || 'Record'});\n                sessionRequests.push({method:'GET', path:'/api/verify/' + (rec.hash || 'sha256').substring(0,12), time:(0.3 + Math.random() * 0.3).toFixed(1) + 's', ts:agoStr, color:'#00aaff', detail:'Verify ' + (rec.record_label || '')});\n            }\n            // Add baseline API activity\n            var baselineRequests = [\n                {method:'GET', path:'/api/metrics/performance', time:'0.2s', ts:'auto', color:'#00aaff', detail:'Metrics refresh'},\n                {method:'GET', path:'/api/health', time:'0.1s', ts:'auto', color:'#00aaff', detail:'Health check'},\n                {method:'GET', path:'/api/records?limit=50', time:'0.4s', ts:'realtime', color:'#00aaff', detail:'Record listing'},\n                {method:'POST', path:'/api/wallet/balance', time:'0.3s', ts:'auto', color:'#00cc66', detail:'Balance check'},\n                {method:'GET', path:'/api/xrpl/account_info', time:'0.8s', ts:'auto', color:'#00aaff', detail:'XRPL query'}\n            ];\n            var allRequests = sessionRequests.length > 0 ? sessionRequests.concat(baselineRequests) : [\n                {method:'POST', path:'/api/anchor', time:'2.8s', ts:'just now', color:'#00cc66', detail:'Anchor record'},\n                {method:'GET', path:'/api/verify/sha256:a1b2c3d4', time:'0.4s', ts:'12s ago', color:'#00aaff', detail:'Verify hash'},\n                {method:'POST', path:'/api/anchor', time:'3.1s', ts:'45s ago', color:'#00cc66', detail:'Anchor record'},\n                {method:'GET', path:'/api/metrics/performance', time:'0.2s', ts:'1m ago', color:'#00aaff', detail:'Metrics'},\n                {method:'GET', path:'/api/records?limit=50&branch=NAVY', time:'0.3s', ts:'2m ago', color:'#00aaff', detail:'Record query'},\n                {method:'POST', path:'/api/anchor', time:'2.6s', ts:'3m ago', color:'#00cc66', detail:'Anchor record'},\n                {method:'GET', path:'/api/verify/sha256:e5f6a7b8', time:'0.5s', ts:'4m ago', color:'#00aaff', detail:'Verify hash'},\n                {method:'POST', path:'/api/ai-chat', time:'1.2s', ts:'5m ago', color:'#00cc66', detail:'AI query'}\n            ];\n            reqEl.innerHTML = allRequests.slice(0, 12).map(function(r) {\n                return '<div style=\"display:flex;align-items:center;gap:8px;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.03)\">'\n                    + '<span style=\"background:' + r.color + '22;color:' + r.color + ';font-weight:700;font-size:0.7rem;padding:2px 8px;border-radius:4px;min-width:42px;text-align:center\">' + r.method + '</span>'\n                    + '<span style=\"color:var(--text);flex:1;font-family:monospace;font-size:0.72rem\">' + r.path + '</span>'\n                    + '<span style=\"color:var(--steel);font-size:0.65rem;max-width:90px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap\">' + r.detail + '</span>'\n                    + '<span style=\"color:var(--accent);font-size:0.68rem;font-weight:600\">' + r.time + '</span>'\n                    + '<span style=\"color:var(--muted);font-size:0.68rem\">' + r.ts + '</span>'\n                    + '</div>';\n            }).join('');\n        }\n    }\n}\n\n// Auto-load metrics when tab shown\ndocument.addEventListener('shown.bs.tab', function(e) {\n    if (e.target && e.target.getAttribute('href') === '#tabMetrics') loadPerformanceMetrics();\n    if (e.target && e.target.getAttribute('href') === '#tabOffline') refreshOfflineQueue();\n});\n\n// Auto-refresh metrics every 30 seconds when metrics tab is visible\nsetInterval(function() {\n    var metricsTab = document.getElementById('tabMetrics');\n    if (metricsTab && metricsTab.classList.contains('active')) {\n        if (typeof loadPerformanceMetrics === 'function') loadPerformanceMetrics();\n    }\n}, 30000);\n\n\n// ═══ DYNAMIC SESSION DATA ENGINE ═══\n// Keeps all tool displays in sync with real user activity\n(function() {\n    function syncSessionToTools() {\n        var s = typeof stats !== 'undefined' ? stats : {anchored:0, verified:0, types:new Set(), slsFees:0};\n        var records = typeof getLocalRecords === 'function' ? getLocalRecords() : [];\n        \n        // Sync SLS balance bar — use actual tier allocation\n        var balEl = document.getElementById('slsBarBalance');\n        if (balEl) {\n            var spent = s.slsFees || 0;\n            var tierAlloc = (typeof _onboardTiers !== 'undefined' && typeof _onboardTier !== 'undefined' && _onboardTiers[_onboardTier]) ? _onboardTiers[_onboardTier].sls : 25000;\n            var bal = tierAlloc - spent;\n            balEl.textContent = bal.toLocaleString(undefined, {minimumFractionDigits:0, maximumFractionDigits:0});\n        }\n        var anchEl = document.getElementById('slsBarAnchors');\n        if (anchEl) anchEl.textContent = s.anchored || 0;\n        var spentEl = document.getElementById('slsBarSpent');\n        if (spentEl) spentEl.textContent = (s.slsFees || 0).toFixed(2);\n        \n        // Sync tool SLS strip — use actual tier allocation\n        var tierAllocTool = (typeof _onboardTiers !== 'undefined' && typeof _onboardTier !== 'undefined' && _onboardTiers[_onboardTier]) ? _onboardTiers[_onboardTier].sls : 25000;\n        var toolBal = document.getElementById('toolSlsBal');\n        if (toolBal) toolBal.textContent = (tierAllocTool - (s.slsFees||0)).toLocaleString();\n        var toolAnch = document.getElementById('toolSlsAnch');\n        if (toolAnch) toolAnch.textContent = s.anchored || 0;\n        var toolSpent = document.getElementById('toolSlsSpent');\n        if (toolSpent) toolSpent.textContent = (s.slsFees || 0).toFixed(2);\n        \n        // Sync DMSMS chart data from session if available\n        // (charts auto-update next time the tool is opened)\n        \n        // Sync Action Items badge\n        try {\n            var items = JSON.parse(localStorage.getItem('s4ActionItems') || '[]');\n            var open = items.filter(function(i){ return i.status !== 'Closed' && i.status !== 'Resolved'; }).length;\n            var badge = document.getElementById('actionItemBadge');\n            if (badge) {\n                badge.textContent = open > 0 ? open : '';\n                badge.style.display = open > 0 ? 'inline-flex' : 'none';\n            }\n        } catch(e) {}\n    }\n\n    // Run every 3 seconds\n    setInterval(syncSessionToTools, 3000);\n    // Run immediately on load\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', syncSessionToTools);\n    } else {\n        syncSessionToTools();\n    }\n})();\n\n\n// ── Offline Queue Client-Side ──\nvar OFFLINE_QUEUE_KEY = 's4_offline_queue';\nvar OFFLINE_SYNC_KEY = 's4_offline_last_sync';\nvar OFFLINE_QUEUE_ENCRYPTED_KEY = 's4_offline_queue_enc';\nvar OFFLINE_QUEUE_IV_KEY = 's4_offline_queue_iv';\nvar _offlineCryptoKey = null;\n\n// ── Offline Queue Encryption (AES-256-GCM via Web Crypto) ──\nasync function _getOfflineCryptoKey() {\n    if (_offlineCryptoKey) return _offlineCryptoKey;\n    // Derive key from a device fingerprint (user agent + origin) via PBKDF2\n    var seed = navigator.userAgent + '|' + location.origin + '|s4ledger_offline_v1';\n    var enc = new TextEncoder();\n    var keyMaterial = await crypto.subtle.importKey('raw', enc.encode(seed), 'PBKDF2', false, ['deriveKey']);\n    _offlineCryptoKey = await crypto.subtle.deriveKey(\n        { name: 'PBKDF2', salt: enc.encode('s4_offline_salt_v1'), iterations: 100000, hash: 'SHA-256' },\n        keyMaterial, { name: 'AES-GCM', length: 256 }, false, ['encrypt', 'decrypt']\n    );\n    return _offlineCryptoKey;\n}\n\nasync function _encryptQueue(data) {\n    var key = await _getOfflineCryptoKey();\n    var iv = crypto.getRandomValues(new Uint8Array(12));\n    var enc = new TextEncoder();\n    var ciphertext = await crypto.subtle.encrypt({ name: 'AES-GCM', iv: iv }, key, enc.encode(JSON.stringify(data)));\n    return { iv: Array.from(iv), data: Array.from(new Uint8Array(ciphertext)) };\n}\n\nasync function _decryptQueue(encrypted) {\n    var key = await _getOfflineCryptoKey();\n    var iv = new Uint8Array(encrypted.iv);\n    var ciphertext = new Uint8Array(encrypted.data);\n    var decrypted = await crypto.subtle.decrypt({ name: 'AES-GCM', iv: iv }, key, ciphertext);\n    return JSON.parse(new TextDecoder().decode(decrypted));\n}\n\n// Read queue — tries encrypted first, falls back to plain localStorage\nfunction getOfflineQueue() {\n    try {\n        var encStr = localStorage.getItem(OFFLINE_QUEUE_ENCRYPTED_KEY);\n        if (encStr) {\n            // Return empty synchronously, then decrypt async\n            // For sync callers, we cache the last known queue\n            return _offlineQueueCache || [];\n        }\n        return JSON.parse(localStorage.getItem(OFFLINE_QUEUE_KEY) || '[]');\n    } catch(e) { return []; }\n}\n\n// Async read — use this when you need the actual encrypted data\nvar _offlineQueueCache = [];\nasync function getOfflineQueueAsync() {\n    try {\n        var encStr = localStorage.getItem(OFFLINE_QUEUE_ENCRYPTED_KEY);\n        if (encStr) {\n            var encrypted = JSON.parse(encStr);\n            _offlineQueueCache = await _decryptQueue(encrypted);\n            return _offlineQueueCache;\n        }\n        // Migrate plain queue to encrypted\n        var plain = JSON.parse(localStorage.getItem(OFFLINE_QUEUE_KEY) || '[]');\n        if (plain.length > 0) {\n            await _saveEncryptedQueue(plain);\n            localStorage.removeItem(OFFLINE_QUEUE_KEY); // Remove plain after migration\n        }\n        _offlineQueueCache = plain;\n        return plain;\n    } catch(e) { console.warn('Queue decrypt error:', e); return []; }\n}\n\nasync function _saveEncryptedQueue(queue) {\n    try {\n        var encrypted = await _encryptQueue(queue);\n        localStorage.setItem(OFFLINE_QUEUE_ENCRYPTED_KEY, JSON.stringify(encrypted));\n        _offlineQueueCache = queue;\n    } catch(e) {\n        console.warn('Queue encrypt error, falling back to plain:', e);\n        localStorage.setItem(OFFLINE_QUEUE_KEY, JSON.stringify(queue));\n    }\n}\n\nfunction saveOfflineQueue(queue) {\n    // Save plain for immediate sync reads, then encrypt async\n    _offlineQueueCache = queue;\n    localStorage.setItem(OFFLINE_QUEUE_KEY, JSON.stringify(queue));\n    _saveEncryptedQueue(queue).then(function() {\n        localStorage.removeItem(OFFLINE_QUEUE_KEY); // Remove plain after encrypted save\n    }).catch(function() {});\n    refreshOfflineQueueUI();\n}\n\nfunction refreshOfflineQueueUI() {\n    var queue = getOfflineQueue();\n    var countEl = document.getElementById('offlineQueueCount');\n    var listEl = document.getElementById('offlineQueueList');\n    var syncEl = document.getElementById('offlineLastSync');\n    var statusEl = document.getElementById('offlineStatus');\n    if (countEl) countEl.textContent = queue.length;\n    if (syncEl) { var ls = localStorage.getItem(OFFLINE_SYNC_KEY); syncEl.textContent = ls ? new Date(ls).toLocaleString() : 'Never'; }\n    if (statusEl) { var on = navigator.onLine; statusEl.innerHTML = on ? '<i class=\"fas fa-circle\" style=\"font-size:0.6rem;color:var(--green)\"></i> Online' : '<i class=\"fas fa-circle\" style=\"font-size:0.6rem;color:var(--red)\"></i> Offline'; statusEl.style.color = on ? 'var(--green)' : 'var(--red)'; }\n    if (listEl) {\n        if (!queue.length) { listEl.innerHTML = '<div style=\"color:var(--muted);text-align:center;padding:1rem\">Queue is empty. Hashes are queued automatically when offline.</div>'; }\n        else { listEl.innerHTML = queue.map(function(item, i) { return '<div style=\"display:flex;align-items:center;gap:8px;padding:8px;border-bottom:1px solid rgba(255,255,255,0.03)\"><span style=\"color:var(--accent);font-weight:700;width:24px\">' + (i+1) + '</span><span style=\"flex:1;color:var(--text);font-family:monospace;font-size:0.72rem\">' + (item.hash ? item.hash.substring(0,24)+'...' : 'N/A') + '</span><span style=\"color:var(--steel);font-size:0.7rem;width:80px\">' + (item.record_type||'GENERAL') + '</span><span style=\"color:' + (item.synced ? 'var(--green)' : 'var(--gold)') + ';font-size:0.72rem\">' + (item.synced ? '✓ Synced' : '⏳ Pending') + '</span><button onclick=\"offlineRemoveItem(' + i + ')\" style=\"background:none;border:none;color:var(--red);cursor:pointer;font-size:0.75rem\" title=\"Remove\"><i class=\"fas fa-times\"></i></button></div>'; }).join(''); }\n    }\n}\n\nfunction refreshOfflineQueue() {\n    refreshOfflineQueueUI();\n    // NETWORK_DEPENDENT: Server-side queue status — gracefully fails offline\n    fetch('/api/offline/queue').then(function(r){return r.json();}).then(function(data) {\n        if (data.queue_size > 0) { var c = document.getElementById('offlineQueueCount'); var lc = getOfflineQueue().length; if (c) c.textContent = lc + data.queue_size; }\n        if (data.last_sync) { var s = document.getElementById('offlineLastSync'); if (s) s.textContent = new Date(data.last_sync).toLocaleString(); }\n    }).catch(function(){});\n}\n\nfunction offlineQueueHash() {\n    // R12: Pull from real vault records instead of generating test hashes\n    if (typeof s4Vault !== 'undefined' && s4Vault.length > 0) {\n        // Find vault records not already in offline queue\n        var queue = getOfflineQueue();\n        var existingHashes = {};\n        queue.forEach(function(q) { existingHashes[q.hash] = true; });\n        var unqueued = s4Vault.filter(function(v) { return v.hash && !existingHashes[v.hash]; });\n        if (unqueued.length > 0) {\n            var rec = unqueued[0]; // Queue the most recent unqueued record\n            queue.push({ hash: rec.hash, record_type: rec.type || 'VAULT_RECORD', branch: rec.branch || 'JOINT', timestamp: rec.timestamp || new Date().toISOString(), synced: false, label: rec.label || 'Vault Record' });\n            saveOfflineQueue(queue);\n            _showNotif('Vault record queued for offline sync: ' + rec.hash.substring(0,16) + '...', 'success');\n        } else {\n            _showNotif('All vault records are already queued. Anchor new records first.', 'info');\n        }\n    } else {\n        // Fallback: generate hash from current session data\n        var testData = 'S4-SESSION-' + Date.now() + '-' + Math.random().toString(36).substring(2,10);\n        var encoder = new TextEncoder();\n        crypto.subtle.digest('SHA-256', encoder.encode(testData)).then(function(buf) {\n            var hash = Array.from(new Uint8Array(buf)).map(function(b){return b.toString(16).padStart(2,'0');}).join('');\n            var queue = getOfflineQueue();\n            queue.push({ hash: hash, record_type: 'SESSION_HASH', branch: 'JOINT', timestamp: new Date().toISOString(), synced: false });\n            saveOfflineQueue(queue);\n            _showNotif('Session hash queued for offline sync: ' + hash.substring(0,16) + '...', 'info');\n        });\n    }\n}\n\nfunction offlineRemoveItem(index) { var q = getOfflineQueue(); q.splice(index,1); saveOfflineQueue(q); }\nfunction offlineClearQueue() { if (confirm('Clear all offline queued hashes?')) { saveOfflineQueue([]); _showNotif('Offline queue cleared.', 'info'); } }\n\nasync function offlineSyncAll() { return offlineSyncWithBackoff(); }\n\n// Exponential backoff sync with configurable retries\nvar _syncRetryCount = 0;\nvar _syncMaxRetries = 5;\nvar _syncBaseDelay = 1000; // 1 second base\n\nasync function offlineSyncWithBackoff(attempt) {\n    attempt = attempt || 0;\n    var queue = getOfflineQueue();\n    var pending = queue.filter(function(i){return !i.synced;});\n    if (!pending.length) { _syncRetryCount = 0; _showNotif('No pending hashes to sync.', 'info'); return; }\n    if (!navigator.onLine) { _showNotif('Cannot sync — currently offline.', 'warning'); return; }\n    _showNotif('Syncing ' + pending.length + ' hashes to XRPL' + (attempt > 0 ? ' (retry ' + attempt + '/' + _syncMaxRetries + ')' : '') + '...', 'info');\n    try {\n        // NETWORK_DEPENDENT: Sync endpoint — requires connectivity\n        var res = await _origFetch('/api/offline/sync', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ hashes: pending }) });\n        if (!res.ok) throw new Error('Server returned ' + res.status);\n        var data = await res.json();\n        for (var i = 0; i < queue.length; i++) { if (!queue[i].synced) { queue[i].synced = true; queue[i].synced_at = new Date().toISOString(); } }\n        saveOfflineQueue(queue);\n        localStorage.setItem(OFFLINE_SYNC_KEY, new Date().toISOString());\n        _syncRetryCount = 0;\n        _showNotif('Sync complete: ' + (data.synced||pending.length) + ' anchored.', 'success');\n        refreshOfflineQueueUI();\n    } catch (e) {\n        _syncRetryCount = attempt + 1;\n        if (_syncRetryCount <= _syncMaxRetries) {\n            // Exponential backoff: 1s, 2s, 4s, 8s, 16s + jitter\n            var delay = _syncBaseDelay * Math.pow(2, attempt) + Math.floor(Math.random() * 500);\n            _showNotif('Sync failed (' + e.message + '). Retrying in ' + Math.round(delay / 1000) + 's...', 'warning');\n            setTimeout(function() { offlineSyncWithBackoff(_syncRetryCount); }, delay);\n        } else {\n            _syncRetryCount = 0;\n            _showNotif('Sync failed after ' + _syncMaxRetries + ' retries: ' + e.message + '. Try again later.', 'error');\n        }\n    }\n}\n\n// Auto-queue anchors when offline — NETWORK_DEPENDENT\nvar _origFetch = window.fetch;\nwindow.fetch = function(url, opts) {\n    if (!navigator.onLine && typeof url === 'string') {\n        // NETWORK_DEPENDENT: All anchor-related endpoints must be queued offline\n        var isAnchorRoute = url.indexOf('/api/anchor') !== -1\n;\n\n        if (isAnchorRoute) {\n            try {\n                var body = opts && opts.body ? JSON.parse(opts.body) : {};\n                var queue = getOfflineQueue();\n                queue.push({ hash: body.hash || body.data_hash || 'UNKNOWN', record_type: body.record_type || 'QUEUED_ANCHOR', branch: body.branch || 'JOINT', timestamp: new Date().toISOString(), synced: false });\n                saveOfflineQueue(queue);\n                _showNotif('Offline: anchor queued locally. Will sync when reconnected.', 'info');\n            } catch(e) { console.warn('Offline queue error:', e); }\n            return Promise.resolve(new Response(JSON.stringify({ status: 'queued_offline', message: 'Hash queued for offline sync.', record: { tx_hash: 'OFFLINE_' + Date.now().toString(36).toUpperCase(), network: 'Queued Offline' } }), { status: 200, headers: { 'Content-Type': 'application/json' } }));\n        }\n    }\n    return _origFetch.apply(this, arguments);\n};\n\nwindow.addEventListener('online', function() {\n    refreshOfflineQueueUI();\n    _showNotif('Connection restored. Auto-syncing offline queue...', 'success');\n    // Auto-sync after a 2-second delay to allow network stabilization\n    setTimeout(function() {\n        var q = getOfflineQueue();\n        var pending = q.filter(function(i){ return !i.synced; });\n        if (pending.length > 0) { offlineSyncWithBackoff(); }\n    }, 2000);\n});\nwindow.addEventListener('offline', function() { refreshOfflineQueueUI(); _showNotif('Connection lost. Anchors will be queued locally.', 'warning'); });\n\nfunction _showNotif(msg, type) {\n    var old = document.querySelector('.workspace-notification'); if (old) old.remove();\n    var d = document.createElement('div'); d.className = 'workspace-notification';\n    var colors = { success: 'var(--green)', error: 'var(--red)', warning: 'var(--gold)', info: 'var(--accent)' };\n    d.style.borderColor = colors[type] || colors.info;\n    d.innerHTML = '<button class=\"notif-close\" onclick=\"this.parentElement.remove()\">&times;</button><i class=\"fas fa-' + (type==='success'?'check-circle':type==='error'?'times-circle':type==='warning'?'exclamation-triangle':'info-circle') + '\" style=\"color:' + (colors[type]||colors.info) + ';margin-right:6px\"></i>' + msg;\n    document.body.appendChild(d);\n    setTimeout(function(){d.remove();}, 5000);\n}\n\ndocument.addEventListener('DOMContentLoaded', function() { refreshOfflineQueueUI(); });\n\n// ═══ FILE DRAG-DROP & UPLOAD ═══\nfunction handleFileDrop(e) {\n    e.preventDefault();\n    var dropZone = document.getElementById('dropZone');\n    if (dropZone) dropZone.classList.remove('drag-over');\n    var files = e.dataTransfer.files;\n    if (files.length > 0) processUploadedFile(files[0]);\n}\n\nfunction handleFileSelect(e) {\n    var files = e.target.files;\n    if (files.length > 0) processUploadedFile(files[0]);\n}\n\n// Track the last uploaded file's binary hash for anchoring\nvar _lastUploadedFileHash = null;\nvar _lastUploadedFileName = null;\nvar _lastUploadedFileSize = 0;\n\nfunction processUploadedFile(file) {\n    var nameEl = document.getElementById('dropFileName');\n    if (nameEl) {\n        nameEl.style.display = 'block';\n        nameEl.innerHTML = '<i class=\"fas fa-file\" style=\"margin-right:6px;\"></i>' + file.name + ' (' + (file.size / 1024).toFixed(1) + ' KB)';\n    }\n    _lastUploadedFileName = file.name;\n    _lastUploadedFileSize = file.size;\n\n    // Always read binary for hashing (this gives us the true file hash)\n    var binaryReader = new FileReader();\n    binaryReader.onload = function(ev) {\n        sha256Binary(ev.target.result).then(function(hash) {\n            _lastUploadedFileHash = hash;\n            if (nameEl) {\n                nameEl.innerHTML = '<i class=\"fas fa-file\" style=\"margin-right:6px;\"></i>' + file.name + ' (' + (file.size / 1024).toFixed(1) + ' KB)'\n                    + '<div style=\"font-size:0.7rem;color:var(--muted);font-family:monospace;margin-top:4px;\">SHA-256: ' + hash.substring(0,32) + '...</div>';\n            }\n        });\n    };\n    binaryReader.readAsArrayBuffer(file);\n\n    // Also read text content for the textarea preview (text files only)\n    if (file.type.startsWith('text/') || file.name.match(/\\.(txt|csv|json|xml|md|html|log|yaml|yml)$/i)) {\n        var textReader = new FileReader();\n        textReader.onload = function(ev) {\n            document.getElementById('recordInput').value = ev.target.result.substring(0, 10000);\n        };\n        textReader.readAsText(file);\n    } else {\n        document.getElementById('recordInput').value = 'FILE: ' + file.name + ' | SIZE: ' + (file.size / 1024).toFixed(1) + ' KB | Binary file \\u2014 SHA-256 hash computed from raw bytes';\n    }\n}\n\n\n// ═══ ANCHOR-S4 — Chart.js & KPI Enhancement Engine ═══\nvar _s4Charts = {};\n\nfunction destroyS4Chart(id) {\n    if (_s4Charts[id]) { _s4Charts[id].destroy(); delete _s4Charts[id]; }\n}\n\nfunction createS4Chart(canvasId, config) {\n    destroyS4Chart(canvasId);\n    var ctx = document.getElementById(canvasId);\n    if (!ctx) return null;\n    // Apply Anchor-S4 theme defaults\n    var defaults = {\n        responsive: true,\n        maintainAspectRatio: false,\n        plugins: {\n            legend: { labels: { color: '#8ea4b8', font: { family: 'Inter', size: 11, weight: '600' }, padding: 16, usePointStyle: true, pointStyle: 'circle' } },\n            tooltip: { backgroundColor: '#16161f', titleColor: '#fff', bodyColor: '#8ea4b8', borderColor: 'rgba(0,170,255,0.2)', borderWidth: 1, padding: 12, cornerRadius: 8, titleFont: { weight: '700' }, bodyFont: { size: 12 } }\n        },\n        scales: {}\n    };\n    if (config.type === 'bar' || config.type === 'line') {\n        defaults.scales = {\n            x: { grid: { color: 'rgba(255,255,255,0.03)', drawBorder: false }, ticks: { color: '#8ea4b8', font: { size: 10 } } },\n            y: { grid: { color: 'rgba(255,255,255,0.03)', drawBorder: false }, ticks: { color: '#8ea4b8', font: { size: 10 } } }\n        };\n    }\n    // Merge defaults\n    config.options = config.options || {};\n    config.options.responsive = defaults.responsive;\n    config.options.maintainAspectRatio = defaults.maintainAspectRatio;\n    config.options.plugins = Object.assign({}, defaults.plugins, config.options.plugins || {});\n    if (defaults.scales.x && !config.options.scales) config.options.scales = defaults.scales;\n    _s4Charts[canvasId] = new Chart(ctx.getContext('2d'), config);\n    return _s4Charts[canvasId];\n}\n\n// Color palette for Anchor-S4 charts\nvar S4_CHART_COLORS = {\n    accent: '#00aaff',\n    gold: '#c9a84c',\n    red: '#ff4444',\n    green: '#00cc66',\n    orange: '#ff8c00',\n    purple: '#8b5cf6',\n    teal: '#14b8a6',\n    pink: '#f472b6',\n    series: ['#00aaff','#c9a84c','#ff4444','#00cc66','#ff8c00','#8b5cf6','#14b8a6','#f472b6','rgba(0,170,255,0.5)','rgba(201,168,76,0.5)']\n};\n\n// KPI animation counter\nfunction animateKPI(el, target, prefix, suffix, duration) {\n    prefix = prefix || '';\n    suffix = suffix || '';\n    duration = duration || 800;\n    var start = 0;\n    var startTime = null;\n    function step(timestamp) {\n        if (!startTime) startTime = timestamp;\n        var progress = Math.min((timestamp - startTime) / duration, 1);\n        var eased = 1 - Math.pow(1 - progress, 3); // ease-out cubic\n        var current = Math.round(start + (target - start) * eased);\n        el.textContent = prefix + current.toLocaleString() + suffix;\n        if (progress < 1) requestAnimationFrame(step);\n    }\n    requestAnimationFrame(step);\n}\n\n// ═══ Chart rendering for Gap Analysis ═══\nfunction renderGapAnalysisCharts() {\n    // Show sample data if no real analysis has been run\n    var radarCanvas = document.getElementById('gapRadarChart');\n    var barCanvas = document.getElementById('gapBarChart');\n    if (!radarCanvas || !barCanvas) return;\n    \n    var chartsRow = document.getElementById('gapChartsRow');\n    if (chartsRow) chartsRow.style.display = 'flex';\n    \n    // Use real data if available, otherwise use sample baseline\n    var labels, scores;\n    if (typeof ilsResults !== 'undefined' && ilsResults && ilsResults.elements && Object.keys(ilsResults.elements).length > 0) {\n        labels = Object.keys(ilsResults.elements);\n        scores = labels.map(function(k){ return (ilsResults.elements[k] && typeof ilsResults.elements[k].score === 'number') ? ilsResults.elements[k].score : 0; });\n    } else {\n        labels = ['Supply Support','Maintenance Planning','Tech Data','Training','Config Mgmt','DMSMS','PHS&T','Reliability','Support Equipment','Manpower'];\n        scores = [72, 58, 85, 44, 91, 35, 67, 78, 52, 63];\n    }\n    \n    // Radar Chart\n    if (radarCanvas.__chartInstance) radarCanvas.__chartInstance.destroy();\n    radarCanvas.__chartInstance = new Chart(radarCanvas, {\n        type: 'radar',\n        data: {\n            labels: labels.map(function(l){ return l.replace(/_/g,' ').replace(/\\b\\w/g,function(c){return c.toUpperCase()}); }),\n            datasets: [{\n                label: 'ILS Element Coverage %',\n                data: scores,\n                backgroundColor: 'rgba(0,170,255,0.12)',\n                borderColor: '#00aaff',\n                borderWidth: 2,\n                pointBackgroundColor: '#00aaff',\n                pointBorderColor: '#fff',\n                pointRadius: 4\n            }]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            scales: { r: { min: 0, max: 100, ticks: { display: false }, grid: { color: 'rgba(255,255,255,0.06)' }, angleLines: { color: 'rgba(255,255,255,0.06)' }, pointLabels: { color: '#8ea4b8', font: { size: 10 } } } },\n            plugins: { legend: { display: false } }\n        }\n    });\n    \n    // Bar Chart\n    var barColors = scores.map(function(s){ return s >= 80 ? '#00cc66' : s >= 50 ? '#ffa500' : '#ff4444'; });\n    if (barCanvas.__chartInstance) barCanvas.__chartInstance.destroy();\n    barCanvas.__chartInstance = new Chart(barCanvas, {\n        type: 'bar',\n        data: {\n            labels: labels.map(function(l){ return l.replace(/_/g,' ').replace(/\\b\\w/g,function(c){return c.toUpperCase()}); }),\n            datasets: [{\n                label: 'Score',\n                data: scores,\n                backgroundColor: barColors,\n                borderRadius: 6,\n                borderSkipped: false\n            }]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            indexAxis: 'y',\n            scales: { x: { min: 0, max: 100, grid: { color: 'rgba(255,255,255,0.04)' }, ticks: { color: '#8ea4b8' } }, y: { ticks: { color: '#8ea4b8', font: { size: 10 } }, grid: { display: false } } },\n            plugins: { legend: { display: false } }\n        }\n    });\n    return; // Skip original logic since we handled everything\n}\n\n\n// ═══ Chart rendering for DMSMS ═══\nfunction renderDMSMSCharts() {\n    var canvas = document.getElementById('dmsmsPieChart');\n    if (!canvas) return;\n    if (canvas.__chartInstance) canvas.__chartInstance.destroy();\n    canvas.__chartInstance = new Chart(canvas, {\n        type: 'doughnut',\n        data: {\n            labels: ['Active', 'At Risk', 'Obsolete', 'Resolved', 'Monitoring'],\n            datasets: [{\n                data: (window._dmsmsChartData && window._dmsmsChartData.reduce(function(a,b){return a+b;},0) > 0) ? window._dmsmsChartData : [45, 18, 12, 20, 5],\n                backgroundColor: ['#00cc66','#ffa500','#ff4444','#00aaff','#8ea4b8'],\n                borderWidth: 0,\n                hoverOffset: 8\n            }]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            cutout: '55%',\n            plugins: {\n                legend: { position: 'bottom', labels: { color: '#8ea4b8', padding: 12, usePointStyle: true, pointStyle: 'circle', font: { size: 11 } } }\n            }\n        }\n    });\n}\n\n\n// ═══ Chart rendering for Readiness ═══\nfunction renderReadinessCharts() {\n    var canvas = document.getElementById('readinessGauge');\n    if (!canvas) return;\n    var ao = 0.87;\n    if (typeof window._readinessAo === 'number' && !isNaN(window._readinessAo)) {\n        ao = window._readinessAo;\n    } else {\n        var el = document.getElementById('readinessAo') || document.getElementById('statAo');\n        if (el && el.textContent && el.textContent !== '\\u2014') {\n            var parsed = parseFloat(el.textContent);\n            if (!isNaN(parsed)) ao = parsed > 1 ? parsed / 100 : parsed;\n        }\n    }\n    if (canvas.__chartInstance) canvas.__chartInstance.destroy();\n    // Derive category readiness from Ao baseline\n    var base = Math.round(ao * 100);\n    var personnel = Math.min(100, base + 8);\n    var equipment = Math.min(100, base - 3);\n    var supply = Math.min(100, base - 10);\n    var training = Math.min(100, base + 12);\n    var maintenance = Math.min(100, base + 2);\n    var c4isr = Math.min(100, base + 5);\n    var barColors = [personnel, equipment, supply, training, maintenance, c4isr].map(function(v) {\n        return v >= 90 ? 'rgba(0,204,102,0.7)' : v >= 75 ? 'rgba(0,170,255,0.6)' : v >= 60 ? 'rgba(255,165,0,0.6)' : 'rgba(255,68,68,0.6)';\n    });\n    canvas.__chartInstance = new Chart(canvas, {\n        type: 'bar',\n        data: {\n            labels: ['Personnel', 'Equipment', 'Supply', 'Training', 'Maintenance', 'C4ISR'],\n            datasets: [{\n                label: 'Readiness %',\n                data: [personnel, equipment, supply, training, maintenance, c4isr],\n                backgroundColor: barColors,\n                borderColor: barColors.map(function(c) { return c.replace('0.7','1').replace('0.6','1'); }),\n                borderWidth: 1,\n                borderRadius: 4\n            }]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            plugins: {\n                legend: { display: false },\n                tooltip: { callbacks: { label: function(ctx) { return ctx.parsed.y + '%'; } } }\n            },\n            scales: {\n                x: { ticks: { color: '#8ea4b8', font: { size: 11 } }, grid: { display: false } },\n                y: { ticks: { color: '#6b7d93', font: { size: 10 }, callback: function(v) { return v + '%'; } }, grid: { color: 'rgba(255,255,255,0.04)' }, beginAtZero: true, max: 100 }\n            }\n        }\n    });\n}\n\n\n// ═══ Chart rendering for Compliance ═══\nfunction renderComplianceCharts() {\n    var canvas = document.getElementById('complianceRadarChart');\n    if (!canvas) return;\n    if (canvas.__chartInstance) canvas.__chartInstance.destroy();\n    canvas.__chartInstance = new Chart(canvas, {\n        type: 'radar',\n        data: {\n            labels: ['CMMC L2','NIST 800-171','DFARS 7012','ITAR','FIPS 140-2','FedRAMP','IL4/IL5'],\n            datasets: [{\n                label: 'Current Posture',\n                data: (window._complianceScores && window._complianceScores.reduce(function(a,b){return a+b;},0) > 0) ? window._complianceScores : [78, 85, 92, 88, 70, 65, 82],\n                backgroundColor: 'rgba(0,170,255,0.12)',\n                borderColor: '#00aaff',\n                borderWidth: 2,\n                pointBackgroundColor: '#00aaff',\n                pointRadius: 4\n            },{\n                label: 'Target',\n                data: [95, 95, 100, 100, 90, 85, 95],\n                backgroundColor: 'rgba(201,168,76,0.06)',\n                borderColor: 'rgba(201,168,76,0.5)',\n                borderWidth: 1,\n                borderDash: [4,4],\n                pointRadius: 2\n            }]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            scales: { r: { min: 0, max: 100, ticks: { display: false }, grid: { color: 'rgba(255,255,255,0.06)' }, angleLines: { color: 'rgba(255,255,255,0.06)' }, pointLabels: { color: '#8ea4b8', font: { size: 10 } } } },\n            plugins: { legend: { labels: { color: '#8ea4b8', usePointStyle: true, font: { size: 11 } } } }\n        }\n    });\n}\n\n\n// ═══ Chart rendering for ROI ═══\n// Delegated to bulletproof chart system (block 5) to prevent dual-render conflict\nfunction renderROICharts() {\n    var canvas = document.getElementById('roiLineChart');\n    if (!canvas) return;\n    // Clear stale bp-rendered flag so bulletproof system re-renders fresh\n    if (canvas.getAttribute('data-bp-rendered')) canvas.removeAttribute('data-bp-rendered');\n    // If bulletproof system is available, delegate to it\n    var panel = document.getElementById('hub-roi');\n    if (panel && typeof Chart !== 'undefined') {\n        // Let existing chart remain if it looks correct\n        var existing = null;\n        try { existing = Chart.getChart(canvas); } catch(e) {}\n        if (existing && existing.data && existing.data.labels && existing.data.labels.length >= 20) return;\n        // Otherwise destroy and let bulletproof re-render on next hook\n    }\n    // Fallback: render directly if bulletproof not yet loaded\n    if (canvas.__chartInstance) try { canvas.__chartInstance.destroy(); } catch(e) {}\n    // Pull live values from ROI inputs instead of hardcoded\n    var ftes = parseFloat((document.getElementById('roiFTEs')||{}).value) || 8;\n    var rate = parseFloat((document.getElementById('roiRate')||{}).value) || 145;\n    var auditCost = parseFloat((document.getElementById('roiAudit')||{}).value) || 250000;\n    var errorCost = parseFloat((document.getElementById('roiError')||{}).value) || 8500;\n    var incidents = parseFloat((document.getElementById('roiIncidents')||{}).value) || 35;\n    var license = parseFloat((document.getElementById('roiLicense')||{}).value) || 120000;\n    var laborSavings = ftes * 2080 * rate * 0.65;\n    var errorSavings = incidents * errorCost * 0.90;\n    var auditSavings = auditCost * 0.70;\n    var baseSavings = laborSavings + errorSavings + auditSavings;\n    var cumulative = [];\n    var years = ['Q1','Q2','Q3','Q4','Q5','Q6','Q7','Q8','Q9','Q10','Q11','Q12','Q13','Q14','Q15','Q16','Q17','Q18','Q19','Q20'];\n    for (var q = 1; q <= 20; q++) {\n        // Realistic adoption curve: savings ramp from 20% to 85% over 20 quarters\n        var adoptionRate = 0.20 + 0.65 * (1 - Math.exp(-0.18 * q));\n        var qtrlySavings = (baseSavings / 4) * adoptionRate;\n        var qtrlyLicense = license / 4;\n        var prev = q > 1 ? cumulative[q - 2] : 0;\n        cumulative.push(Math.round(prev + qtrlySavings - qtrlyLicense));\n    }\n    canvas.__chartInstance = new Chart(canvas, {\n        type: 'line',\n        data: {\n            labels: years,\n            datasets: [{\n                label: 'Cumulative ROI ($)',\n                data: cumulative,\n                borderColor: '#00aaff',\n                backgroundColor: 'rgba(0,170,255,0.08)',\n                fill: true,\n                tension: 0.3,\n                borderWidth: 2,\n                pointBackgroundColor: '#00aaff',\n                pointBorderColor: '#fff',\n                pointRadius: 5,\n                pointHoverRadius: 7\n            },{\n                label: 'Break-Even Line',\n                data: [0, 0, 0, 0, 0],\n                borderColor: 'rgba(255,255,255,0.2)',\n                borderDash: [5, 5],\n                borderWidth: 1,\n                pointRadius: 0,\n                fill: false\n            }]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            scales: {\n                y: { grid: { color: 'rgba(255,255,255,0.04)' }, ticks: { color: '#8ea4b8', callback: function(v) { return '$' + (v/1000).toFixed(0) + 'K'; } } },\n                x: { grid: { display: false }, ticks: { color: '#8ea4b8' } }\n            },\n            plugins: { legend: { labels: { color: '#8ea4b8', usePointStyle: true, font: { size: 11 } } } }\n        }\n    });\n}\n\n\n// ═══ Chart rendering for Risk Engine ═══\nfunction renderRiskCharts() {\n    var canvas = document.getElementById('riskHeatChart');\n    if (!canvas) return;\n    if (canvas.__chartInstance) canvas.__chartInstance.destroy();\n    canvas.__chartInstance = new Chart(canvas, {\n        type: 'bar',\n        data: {\n            labels: ['Supply Chain','Cyber/Data','Obsolescence','Financial','Regulatory','Operational'],\n            datasets: [{\n                label: 'Risk Score',\n                data: (window._riskChartScores && window._riskChartScores.length === 6) ? window._riskChartScores : [78, 62, 85, 45, 55, 71],\n                backgroundColor: function(ctx) {\n                    var v = ctx.raw;\n                    return v >= 75 ? 'rgba(255,68,68,0.7)' : v >= 50 ? 'rgba(255,165,0,0.7)' : 'rgba(0,204,102,0.7)';\n                },\n                borderRadius: 6,\n                borderSkipped: false\n            }]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            indexAxis: 'y',\n            scales: {\n                x: { min: 0, max: 100, grid: { color: 'rgba(255,255,255,0.04)' }, ticks: { color: '#8ea4b8' } },\n                y: { ticks: { color: '#8ea4b8', font: { size: 11 } }, grid: { display: false } }\n            },\n            plugins: { legend: { display: false } }\n        }\n    });\n}\n\n\n// ═══ Chart rendering for Lifecycle Cost ═══\nfunction renderLifecycleCharts() {\n    var canvas = document.getElementById('lifecyclePieChart');\n    if (!canvas) return;\n    if (canvas.__chartInstance) canvas.__chartInstance.destroy();\n    canvas.__chartInstance = new Chart(canvas, {\n        type: 'doughnut',\n        data: {\n            labels: ['Acquisition','Sustainment (O&S)','DMSMS / Obsol.','Disposal','Personnel','Training'],\n            datasets: [{\n                data: (window._lifecycleChartData && window._lifecycleChartData.length === 6) ? window._lifecycleChartData : [28, 42, 12, 5, 8, 5],\n                backgroundColor: ['#00aaff','#c9a84c','#ff4444','#8ea4b8','#00cc66','#9b59b6'],\n                borderWidth: 0,\n                hoverOffset: 8\n            }]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            cutout: '50%',\n            plugins: {\n                legend: { position: 'bottom', labels: { color: '#8ea4b8', padding: 12, usePointStyle: true, pointStyle: 'circle', font: { size: 11 } } }\n            }\n        }\n    });\n}\n\n\n// ═══ Inject Chart Canvases into Panels ═══\nfunction injectChartContainers() {\n    // Inject chart containers into panels — VISIBLE by default\n    var panels = {\n        'hub-analysis': {target:'ilsResult', charts:'<div class=\"row mt-3\" id=\"gapChartsRow\"><div class=\"col-md-6\"><div class=\"chart-container\"><div class=\"chart-title\"><i class=\"fas fa-chart-pie\"></i> ILS Element Coverage</div><canvas id=\"gapRadarChart\" height=\"240\"></canvas></div></div><div class=\"col-md-6\"><div class=\"chart-container\"><div class=\"chart-title\"><i class=\"fas fa-chart-bar\"></i> Element Scores</div><canvas id=\"gapBarChart\" height=\"240\"></canvas></div></div></div>'},\n        'hub-dmsms': {target:null, charts:'<div class=\"chart-container mt-3\" id=\"dmsmsChartArea\"><div class=\"chart-title\"><i class=\"fas fa-chart-pie\"></i> Obsolescence Risk Distribution</div><canvas id=\"dmsmsPieChart\" height=\"200\"></canvas></div>'},\n        'hub-readiness': {target:null, charts:'<div class=\"chart-container mt-3\" style=\"max-width:100%\" id=\"readinessGaugeArea\"><div class=\"chart-title\"><i class=\"fas fa-gauge-high\"></i> Operational Availability</div><canvas id=\"readinessGauge\" height=\"300\"></canvas></div>'},\n        'hub-compliance': {target:null, charts:'<div class=\"chart-container mt-3\" id=\"complianceChartArea\"><div class=\"chart-title\"><i class=\"fas fa-shield-halved\"></i> Compliance Framework Radar</div><canvas id=\"complianceRadarChart\" height=\"250\"></canvas></div>'},\n        'hub-roi': {target:null, charts:'<div class=\"chart-container mt-3\" id=\"roiChartArea\"><div class=\"chart-title\"><i class=\"fas fa-chart-line\"></i> ROI Projection — 5 Year Cumulative</div><canvas id=\"roiLineChart\" height=\"220\"></canvas></div>'},\n        'hub-risk': {target:null, charts:'<div class=\"chart-container mt-3\" id=\"riskChartArea\"><div class=\"chart-title\"><i class=\"fas fa-triangle-exclamation\"></i> Risk Category Assessment</div><canvas id=\"riskHeatChart\" height=\"220\"></canvas></div>'},\n        'hub-lifecycle': {target:null, charts:'<div class=\"chart-container mt-3\" id=\"lifecycleChartArea\"><div class=\"chart-title\"><i class=\"fas fa-chart-pie\"></i> Total Ownership Cost Breakdown</div><canvas id=\"lifecyclePieChart\" height=\"220\"></canvas></div>'}\n    };\n    \n    Object.keys(panels).forEach(function(panelId) {\n        var conf = panels[panelId];\n        var panel = document.getElementById(panelId);\n        if (!panel) return;\n        \n        // ROBUST guard: check if charts already injected\n        if (panel.getAttribute('data-charts-injected')) return;\n        var firstCanvasId = conf.charts.match(/id=\"([^\"]+)\"/);\n        if (firstCanvasId && document.getElementById(firstCanvasId[1])) { panel.setAttribute('data-charts-injected','1'); return; }\n        \n        var card = panel.querySelector('.s4-card');\n        if (!card) return;\n        \n        // For gap analysis, insert after the result panel\n        if (conf.target) {\n            var target = document.getElementById(conf.target);\n            if (target) {\n                var wrapper = document.createElement('div');\n                wrapper.innerHTML = conf.charts;\n                target.parentNode.insertBefore(wrapper.firstElementChild, target.nextSibling);\n                panel.setAttribute('data-charts-injected','1');\n                return;\n            }\n        }\n        \n        // For others, append to the first s4-card\n        var wrapper = document.createElement('div');\n        wrapper.innerHTML = conf.charts;\n        card.appendChild(wrapper.firstElementChild);\n        panel.setAttribute('data-charts-injected','1');\n    });\n}\n\n\n// ═══ Hook into tool opening to render charts ═══\nvar _origOpenILSTool = openILSTool;\nopenILSTool = function(toolId) {\n    _origOpenILSTool(toolId);\n    injectChartContainers();\n    setTimeout(function() {\n        if (toolId === 'hub-analysis' && ilsResults) renderGapAnalysisCharts();\n        if (toolId === 'hub-dmsms') renderDMSMSCharts();\n        if (toolId === 'hub-readiness') renderReadinessCharts();\n        if (toolId === 'hub-compliance') renderComplianceCharts();\n        if (toolId === 'hub-roi') renderROICharts();\n        if (toolId === 'hub-risk') renderRiskCharts();\n        if (toolId === 'hub-lifecycle') renderLifecycleCharts();\n    }, 300);\n};\n\n// Also hook switchHubTab\nvar _origSwitchHubTab = switchHubTab;\nswitchHubTab = function(panelId, btn) {\n    _origSwitchHubTab(panelId, btn);\n    injectChartContainers();\n    setTimeout(function() {\n        if (panelId === 'hub-analysis' && typeof ilsResults !== 'undefined' && ilsResults) renderGapAnalysisCharts();\n        if (panelId === 'hub-dmsms') renderDMSMSCharts();\n        if (panelId === 'hub-readiness') renderReadinessCharts();\n        if (panelId === 'hub-compliance') renderComplianceCharts();\n        if (panelId === 'hub-roi') renderROICharts();\n        if (panelId === 'hub-risk') renderRiskCharts();\n        if (panelId === 'hub-lifecycle') renderLifecycleCharts();\n    }, 300);\n};\n\n// Hook analysis completion to show charts\nvar _origShowILSResults = null;\nif (typeof showILSResults === 'function') {\n    _origShowILSResults = showILSResults;\n    showILSResults = function() {\n        _origShowILSResults.apply(this, arguments);\n        var chartsRow = document.getElementById('gapChartsRow');\n        if (chartsRow) chartsRow.style.display = 'flex';\n        setTimeout(renderGapAnalysisCharts, 500);\n    };\n}\n\n// ═══ R12: LIFECYCLE COST CALCULATOR (was missing!) ═══\nfunction calcLifecycle() {\n    var progKey = (document.getElementById('lifecycleProgram') || {}).value || 'ddg51';\n    var serviceLife = parseFloat((document.getElementById('lcServiceLife') || {}).value) || 30;\n    var opHours = parseFloat((document.getElementById('lcOpHours') || {}).value) || 2500;\n    var acqCostM = parseFloat((document.getElementById('lcAcqCost') || {}).value) || 85;\n    var fleetSize = parseFloat((document.getElementById('lcFleetSize') || {}).value) || 20;\n    var sustRate = parseFloat((document.getElementById('lcSustRate') || {}).value) || 8;\n\n    var acqTotal = acqCostM * fleetSize;\n    var annualSust = acqTotal * (sustRate / 100);\n    var sustTotal = annualSust * serviceLife;\n    var dmsmsFactor = 0.12 + (serviceLife > 25 ? 0.04 : 0);\n    var dmsmsCost = sustTotal * dmsmsFactor;\n    var disposalCost = acqTotal * 0.05;\n    var personnelCost = sustTotal * 0.18;\n    var trainingCost = sustTotal * 0.08;\n    var totalCost = acqTotal + sustTotal + dmsmsCost + disposalCost + personnelCost + trainingCost;\n    var totalOpHours = opHours * fleetSize * serviceLife;\n    var costPerHour = totalOpHours > 0 ? totalCost / totalOpHours : 0;\n\n    function fmtM(v) { return v >= 1000 ? '$' + (v/1000).toFixed(1) + 'B' : '$' + v.toFixed(0) + 'M'; }\n\n    var e = function(id) { return document.getElementById(id); };\n    if (e('lcTotalCost')) e('lcTotalCost').textContent = fmtM(totalCost);\n    if (e('lcSustCost')) e('lcSustCost').textContent = fmtM(sustTotal);\n    if (e('lcDmsmsCost')) e('lcDmsmsCost').textContent = fmtM(dmsmsCost);\n    if (e('lcCostPerHr')) e('lcCostPerHr').textContent = '$' + costPerHour.toFixed(0) + '/hr';\n\n    var acqPct = Math.round((acqTotal / totalCost) * 100);\n    var sustPct = Math.round((sustTotal / totalCost) * 100);\n    var dmsmsPct = Math.round((dmsmsCost / totalCost) * 100);\n    var disposalPct = Math.round((disposalCost / totalCost) * 100);\n    var personnelPct = Math.round((personnelCost / totalCost) * 100);\n    var trainingPct = Math.round((trainingCost / totalCost) * 100);\n\n    // Store globally for chart reactivity\n    window._lifecycleChartData = [acqPct, sustPct, dmsmsPct, disposalPct, personnelPct, trainingPct];\n\n    var output = e('lifecycleOutput');\n    if (output) {\n        var platName = (window.S4_PLATFORMS && S4_PLATFORMS[progKey]) ? S4_PLATFORMS[progKey].n : progKey.toUpperCase();\n        output.innerHTML = '<div style=\"background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:20px;margin-top:12px\">'\n            + '<div class=\"section-label\"><i class=\"fas fa-clock\"></i> LIFECYCLE COST BREAKDOWN \\u2014 ' + platName + '</div>'\n            + '<div style=\"display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;font-size:0.85rem;margin-bottom:16px\">'\n            + '<div><span style=\"color:var(--steel)\">Acquisition (' + acqPct + '%)</span><br><strong style=\"color:#00aaff\">' + fmtM(acqTotal) + '</strong></div>'\n            + '<div><span style=\"color:var(--steel)\">Sustainment (' + sustPct + '%)</span><br><strong style=\"color:#c9a84c\">' + fmtM(sustTotal) + '</strong></div>'\n            + '<div><span style=\"color:var(--steel)\">DMSMS/Obsol (' + dmsmsPct + '%)</span><br><strong style=\"color:#ff4444\">' + fmtM(dmsmsCost) + '</strong></div>'\n            + '<div><span style=\"color:var(--steel)\">Disposal (' + disposalPct + '%)</span><br><strong style=\"color:#8ea4b8\">' + fmtM(disposalCost) + '</strong></div>'\n            + '<div><span style=\"color:var(--steel)\">Personnel (' + personnelPct + '%)</span><br><strong style=\"color:#00cc66\">' + fmtM(personnelCost) + '</strong></div>'\n            + '<div><span style=\"color:var(--steel)\">Training (' + trainingPct + '%)</span><br><strong style=\"color:#9b59b6\">' + fmtM(trainingCost) + '</strong></div>'\n            + '</div>'\n            + '<hr style=\"border-color:var(--border);margin:12px 0\">'\n            + '<div style=\"display:flex;justify-content:space-between;align-items:center\">'\n            + '<div><span style=\"color:var(--steel);font-size:0.82rem\">Total Ownership Cost</span><br><span style=\"font-size:1.5rem;font-weight:800;color:#00aaff\">' + fmtM(totalCost) + '</span></div>'\n            + '<div><span style=\"color:var(--steel);font-size:0.82rem\">Cost per Op Hour</span><br><span style=\"font-size:1.1rem;font-weight:700;color:var(--accent)\">$' + costPerHour.toFixed(0) + '/hr</span></div>'\n            + '<div><span style=\"color:var(--steel);font-size:0.82rem\">Fleet Size</span><br><span style=\"font-size:1.1rem;font-weight:700;color:#fff\">' + fleetSize + ' units \\u00d7 ' + serviceLife + ' yrs</span></div>'\n            + '</div>'\n            + '</div>';\n    }\n    // Trigger chart update\n    if (typeof renderLifecycleCharts === 'function') setTimeout(renderLifecycleCharts, 300);\n    // Action items disabled for prod — simulated data should not generate alerts\n    // if (typeof generateLifecycleActions === 'function') generateLifecycleActions(progKey, totalCost, dmsmsCost, sustTotal);\n}\n\nfunction exportLifecycle() {\n    var progKey = (document.getElementById('lifecycleProgram') || {}).value || 'ddg51';\n    var platName = (window.S4_PLATFORMS && S4_PLATFORMS[progKey]) ? S4_PLATFORMS[progKey].n : progKey.toUpperCase();\n    var serviceLife = parseFloat((document.getElementById('lcServiceLife') || {}).value) || 30;\n    var acqCostM = parseFloat((document.getElementById('lcAcqCost') || {}).value) || 85;\n    var fleetSize = parseFloat((document.getElementById('lcFleetSize') || {}).value) || 20;\n    var sustRate = parseFloat((document.getElementById('lcSustRate') || {}).value) || 8;\n    var acqTotal = acqCostM * fleetSize;\n    var sustTotal = acqTotal * (sustRate / 100) * serviceLife;\n    var dmsmsCost = sustTotal * (0.12 + (serviceLife > 25 ? 0.04 : 0));\n    var totalCost = acqTotal + sustTotal + dmsmsCost + (acqTotal * 0.05) + (sustTotal * 0.18) + (sustTotal * 0.08);\n    var report = 'S4 LEDGER — LIFECYCLE COST REPORT\\n' +\n        '================================\\n\\n' +\n        'Platform: ' + platName + '\\n' +\n        'Fleet Size: ' + fleetSize + ' units\\n' +\n        'Service Life: ' + serviceLife + ' years\\n' +\n        'Sustainment Rate: ' + sustRate + '%\\n\\n' +\n        'Acquisition: $' + acqTotal.toFixed(0) + 'M\\n' +\n        'Sustainment: $' + sustTotal.toFixed(0) + 'M\\n' +\n        'DMSMS/Obsolescence: $' + dmsmsCost.toFixed(0) + 'M\\n' +\n        'Total Ownership Cost: $' + totalCost.toFixed(0) + 'M\\n\\n' +\n        'Generated: ' + new Date().toISOString() + '\\n';\n    var blob = new Blob([report], {type: 'text/plain'});\n    var a = document.createElement('a');\n    a.href = URL.createObjectURL(blob);\n    a.download = 'S4_Lifecycle_' + platName.replace(/\\s+/g,'_') + '_' + new Date().toISOString().substring(0,10) + '.txt';\n    a.click();\n    URL.revokeObjectURL(a.href);\n    if (typeof s4Notify === 'function') s4Notify('Exported', 'Lifecycle cost report downloaded.', 'success');\n}\n\nasync function anchorLifecycle() {\n    var progKey = (document.getElementById('lifecycleProgram') || {}).value || 'ddg51';\n    var platName = (window.S4_PLATFORMS && S4_PLATFORMS[progKey]) ? S4_PLATFORMS[progKey].n : progKey.toUpperCase();\n    var serviceLife = parseFloat((document.getElementById('lcServiceLife') || {}).value) || 30;\n    var acqCostM = parseFloat((document.getElementById('lcAcqCost') || {}).value) || 85;\n    var fleetSize = parseFloat((document.getElementById('lcFleetSize') || {}).value) || 20;\n    var sustRate = parseFloat((document.getElementById('lcSustRate') || {}).value) || 8;\n    var acqTotal = acqCostM * fleetSize;\n    var sustTotal = acqTotal * (sustRate / 100) * serviceLife;\n    var dmsmsCost = sustTotal * (0.12 + (serviceLife > 25 ? 0.04 : 0));\n    var totalCost = acqTotal + sustTotal + dmsmsCost + (acqTotal * 0.05) + (sustTotal * 0.18) + (sustTotal * 0.08);\n    var text = 'Lifecycle Cost | Program: ' + platName + ' | Fleet: ' + fleetSize + ' | TOC: $' + totalCost.toFixed(0) + 'M | Date: ' + new Date().toISOString();\n    var hash = await sha256(text);\n    showAnchorAnimation(hash, 'Lifecycle Cost Report', 'CUI');\n    stats.anchored++; stats.types.add('LIFECYCLE_COST'); stats.slsFees = Math.round((stats.slsFees + 0.01) * 100) / 100; updateStats(); saveStats();\n    var result = await _anchorToXRPL(hash, 'LIFECYCLE_COST', text.substring(0,100));\n    var rec = {hash:hash, type:'LIFECYCLE_COST', branch:'JOINT', timestamp:new Date().toISOString(), label:'Lifecycle Cost — '+platName, txHash:result.txHash};\n    sessionRecords.push(rec);\n    saveLocalRecord({hash:hash, record_type:'LIFECYCLE_COST', record_label:'Lifecycle Cost — '+platName, branch:'JOINT', timestamp:new Date().toISOString(), timestamp_display:new Date().toISOString().replace('T',' ').substring(0,19)+' UTC', fee:0.01, tx_hash:result.txHash, system:'Lifecycle Cost Estimator', explorer_url:result.explorerUrl, network:result.network});\n    addToVault({hash:hash, txHash:result.txHash, type:'LIFECYCLE_COST', label:'Lifecycle Cost — '+platName, branch:'JOINT', icon:'<i class=\"fas fa-clock\"></i>', content:text.substring(0,100), encrypted:false, timestamp:new Date().toISOString(), source:'Lifecycle Cost Estimator', fee:0.01, explorerUrl:result.explorerUrl, network:result.network});\n    updateTxLog();\n    _updateSlsBalance();\n    setTimeout(function(){ document.getElementById('animStatus').innerHTML = '<i class=\"fas fa-check-circle\" style=\"color:var(--accent)\"></i> Lifecycle report anchored!'; document.getElementById('animStatus').style.color = '#00aaff'; }, 2200);\n    await new Promise(function(r){ setTimeout(r, 3200); });\n    hideAnchorAnimation();\n    if (typeof s4Notify === 'function') s4Notify('Anchored', 'Lifecycle cost report anchored to XRPL.', 'success');\n}\n\n// (Hook removed — calcLifecycle is now defined directly above with built-in chart call)\n\n// Chart containers injected on demand by bulletproof renderer\n\n// ═══════════════════════════════════════════════════════════════\n// ═══ ANCHOR-S4 DOM TRANSFORMATION ENGINE ═══\n// Restructures tool panels for professional dashboard appearance\n// ═══════════════════════════════════════════════════════════════\n(function() {\n    'use strict';\n    \n    function transformPanel(panelId) {\n        var panel = document.getElementById(panelId);\n        if (!panel || panel.dataset.uxDone) return;\n        panel.dataset.uxDone = '1';\n        \n        // ── Phase 1: Strip inline styles to let CSS take over ──\n        panel.querySelectorAll('details').forEach(function(el) {\n            el.removeAttribute('style');\n        });\n        panel.querySelectorAll('details summary').forEach(function(el) {\n            el.removeAttribute('style');\n        });\n        panel.querySelectorAll('details > div').forEach(function(el) {\n            el.removeAttribute('style');\n        });\n        // Strip inline color from h3/h4 icons (let CSS handle accent color)\n        panel.querySelectorAll('h3 > i[style], h4 > i[style]').forEach(function(el) {\n            el.removeAttribute('style');\n        });\n        // Strip inline style from first description paragraph\n        var cards = panel.querySelectorAll('.s4-card');\n        cards.forEach(function(card) {\n            var h = card.querySelector('h3, h4');\n            if (h) {\n                var sib = h.nextElementSibling;\n                // Check for hub-tool-header wrapper\n                var header = card.querySelector('.hub-tool-header');\n                if (header) sib = header.nextElementSibling;\n                if (sib && sib.tagName === 'P' && sib.getAttribute('style')) {\n                    sib.removeAttribute('style');\n                }\n            }\n        });\n        \n        // ── Phase 2: Upgrade buttons ──\n        panel.querySelectorAll('button[style]').forEach(function(btn) {\n            // Skip dropzone buttons, post-action buttons, file inputs\n            if (btn.closest('.ils-dropzone') || btn.closest('.post-actions') || btn.closest('.post-action-btn')) return;\n            if (btn.style.display === 'none') return;\n            \n            var text = btn.textContent.toLowerCase();\n            var isAnchor = text.includes('anchor') || text.includes('xrpl');\n            var isExport = text.includes('export') || text.includes('download') || text.includes('generate');\n            var isRunAction = text.includes('run ') || text.includes('analyze') || text.includes('calculate');\n            var isDanger = text.includes('clear') || text.includes('delete');\n            \n            if (isDanger) return; // Keep danger buttons as-is\n            var innerHtml = btn.innerHTML;\n            var onclick = btn.getAttribute('onclick');\n            if (isAnchor) {\n                btn.removeAttribute('style');\n                btn.className = 'btn-anchor';\n            } else if (isRunAction) {\n                btn.removeAttribute('style');\n                btn.className = 'btn-anchor';\n            } else if (isExport) {\n                btn.removeAttribute('style');\n                btn.className = 'btn-export';\n            }\n        });\n        \n        // ── Phase 3: Upgrade button containers to action bars ──\n        panel.querySelectorAll('div[style]').forEach(function(div) {\n            var s = div.getAttribute('style') || '';\n            if (s.includes('display:flex') && s.includes('gap:10') && s.includes('flex-wrap:wrap') && !div.classList.contains('ils-dropzone') && !div.querySelector('.ils-dropzone') && !div.closest('.post-actions')) {\n                // Check if it contains action buttons\n                var btns = div.querySelectorAll('button');\n                if (btns.length > 0) {\n                    div.className = 'tool-actions-bar';\n                    div.removeAttribute('style');\n                }\n            }\n        });\n        \n        // ── Phase 4: Add section dividers ──\n        cards.forEach(function(card) {\n            // Find the first <label> element (start of configuration)\n            var labels = card.querySelectorAll(':scope > label, :scope > .row > .col-md-6 > label');\n            var firstLabel = card.querySelector(':scope > label');\n            if (firstLabel && !firstLabel.previousElementSibling?.classList?.contains('section-label')) {\n                var divider = document.createElement('div');\n                divider.className = 'section-label';\n                divider.innerHTML = '<i class=\"fas fa-sliders\"></i> CONFIGURATION';\n                var hr = document.createElement('hr');\n                hr.className = 'section-divider';\n                firstLabel.parentNode.insertBefore(hr, firstLabel);\n                firstLabel.parentNode.insertBefore(divider, hr);\n            }\n            \n            // Find results container and add results section label\n            var resultDiv = card.querySelector('[id$=\"Results\"], [id$=\"Output\"], [id$=\"result\"], [id$=\"Result\"]');\n            if (resultDiv && !resultDiv.previousElementSibling?.classList?.contains('section-label')) {\n                var divider2 = document.createElement('div');\n                divider2.className = 'section-label';\n                divider2.innerHTML = '<i class=\"fas fa-chart-bar\"></i> RESULTS';\n                var hr2 = document.createElement('hr');\n                hr2.className = 'section-divider';\n                resultDiv.parentNode.insertBefore(hr2, resultDiv);\n                resultDiv.parentNode.insertBefore(divider2, hr2);\n            }\n            \n            // Add actions section label before action bars\n            var actionBar = card.querySelector('.tool-actions-bar');\n            if (actionBar && !actionBar.previousElementSibling?.classList?.contains('section-label')) {\n                var divider3 = document.createElement('div');\n                divider3.className = 'section-label';\n                divider3.innerHTML = '<i class=\"fas fa-bolt\"></i> ACTIONS';\n                actionBar.parentNode.insertBefore(divider3, actionBar);\n            }\n        });\n        \n        // ── Phase 5: Move stat-mini rows to top (dashboard KPI strip) ──\n        var firstCard = panel.querySelector('.s4-card');\n        if (!firstCard) return;\n        \n        // For panels with a two-column layout (hub-analysis, hub-actions), \n        // skip moving stats as they're in different columns.\n        var twoCol = panelId === 'hub-analysis' || panelId === 'hub-actions';\n        \n        if (!twoCol) {\n            // Find stat rows that contain 3+ stat-mini cards\n            var allDirectRows = firstCard.querySelectorAll(':scope > .row');\n            var statRow = null;\n            for (var i = 0; i < allDirectRows.length; i++) {\n                var row = allDirectRows[i];\n                if (row.querySelectorAll('.stat-mini').length >= 3) {\n                    statRow = row;\n                    break;\n                }\n            }\n            \n            if (statRow) {\n                // Get the h3/h4 or hub-tool-header\n                var header = firstCard.querySelector('.hub-tool-header') || firstCard.querySelector('h3, h4');\n                if (header) {\n                    var insertAfter = header;\n                    // Wrap stat row in KPI strip styling\n                    statRow.style.cssText = '';\n                    statRow.classList.add('mb-3');\n                    // Move to right after the header\n                    insertAfter.parentNode.insertBefore(statRow, insertAfter.nextSibling);\n                }\n            }\n        }\n        \n        // For hub-actions, find stats in the left column\n        if (panelId === 'hub-actions') {\n            var leftCol = firstCard.querySelector('.col-lg-8');\n            if (leftCol) {\n                var innerCard = leftCol.querySelector('.s4-card');\n                if (innerCard) {\n                    var statsInActions = null;\n                    var rows = innerCard.querySelectorAll(':scope > .row');\n                    for (var j = 0; j < rows.length; j++) {\n                        if (rows[j].querySelectorAll('.stat-mini').length >= 3) {\n                            statsInActions = rows[j];\n                            break;\n                        }\n                    }\n                    if (statsInActions) {\n                        var h3a = innerCard.querySelector('h3');\n                        if (h3a) {\n                            statsInActions.style.cssText = '';\n                            statsInActions.classList.add('mb-3');\n                            h3a.parentNode.insertBefore(statsInActions, h3a.nextSibling);\n                        }\n                    }\n                }\n            }\n        }\n        \n        // ── Phase 6: Strip inline styles from form inputs ──\n        panel.querySelectorAll('input[style], select[style]').forEach(function(el) {\n            // Keep hidden inputs and file inputs\n            if (el.type === 'file' || el.type === 'hidden') return;\n            if (el.style.display === 'none') return;\n            // Remove inline background/color/border styles\n            el.removeAttribute('style');\n        });\n        \n        // ── Phase 7: Show chart containers immediately with placeholder ──\n        var chartAreas = panel.querySelectorAll('.chart-container');\n        chartAreas.forEach(function(c) {\n            c.style.display = 'block';\n        });\n        var gapChartsRow = panel.querySelector('#gapChartsRow');\n        if (gapChartsRow) gapChartsRow.style.display = 'flex';\n    }\n    \n    // ═══ Hook into panel opening ═══\n    var _prevOpen2 = openILSTool;\n    openILSTool = function(toolId) {\n        _prevOpen2(toolId);\n        setTimeout(function() { transformPanel(toolId); }, 100);\n    };\n    \n    var _prevSwitch2 = switchHubTab;\n    switchHubTab = function(panelId, btn) {\n        _prevSwitch2(panelId, btn);\n        setTimeout(function() { transformPanel(panelId); }, 100);\n    };\n    \n    // Transform any currently visible panel on page load\n    document.addEventListener('DOMContentLoaded', function() {\n        setTimeout(function() {\n            document.querySelectorAll('.ils-hub-panel.active, .ils-hub-panel[style*=\"display:block\"], .ils-hub-panel[style*=\"display: block\"]').forEach(function(p) {\n                transformPanel(p.id);\n            });\n        }, 2500);\n    });\n})();\n\n\nconsole.log('[Anchor-S4] Chart & KPI Enhancement Engine loaded');\n\n// AI agent context update when entering Anchor-S4 tab (no auto-open — user clicks to open)\ndocument.addEventListener('DOMContentLoaded', function() {\n    var ilsTabLink = document.querySelector('a[href=\"#tabILS\"]');\n    if (ilsTabLink) {\n        ilsTabLink.addEventListener('shown.bs.tab', function() {\n            updateAiContext(currentHubPanel || 'hub-analysis');\n        });\n    }\n});\n\n\n// ═══ ACTION ITEMS CALENDAR ═══\nvar _calYear, _calMonth;\n(function initCal() {\n    var now = new Date();\n    _calYear = now.getFullYear();\n    _calMonth = now.getMonth();\n})();\n\nfunction changeCalMonth(delta) {\n    _calMonth += delta;\n    if (_calMonth > 11) { _calMonth = 0; _calYear++; }\n    if (_calMonth < 0) { _calMonth = 11; _calYear--; }\n    renderActionCalendar();\n}\n\nfunction renderActionCalendar() {\n    var grid = document.getElementById('actionCalendarGrid');\n    var label = document.getElementById('calMonthLabel');\n    if (!grid || !label) return;\n    // Safety: ensure calendar vars are initialized\n    if (typeof _calYear === 'undefined' || _calYear === undefined || _calYear === null) {\n        var _now = new Date(); _calYear = _now.getFullYear(); _calMonth = _now.getMonth();\n    }\n    var months = ['January','February','March','April','May','June','July','August','September','October','November','December'];\n    label.textContent = months[_calMonth] + ' ' + _calYear;\n\n    var firstDay = new Date(_calYear, _calMonth, 1).getDay();\n    var daysInMonth = new Date(_calYear, _calMonth + 1, 0).getDate();\n    var today = new Date();\n    var isCurrentMonth = (today.getFullYear() === _calYear && today.getMonth() === _calMonth);\n\n    // Collect action item due dates from in-memory array and localStorage\n    var actionDates = {};\n    try {\n        var items = (typeof s4ActionItems !== 'undefined' && s4ActionItems.length > 0)\n            ? s4ActionItems\n            : JSON.parse(localStorage.getItem('s4ActionItems') || '[]');\n        items.forEach(function(item) {\n            var dueStr = item.due || item.schedule || '';\n            if (dueStr) {\n                var d = new Date(dueStr);\n                if (!isNaN(d.getTime()) && d.getFullYear() === _calYear && d.getMonth() === _calMonth) {\n                    var day = d.getDate();\n                    if (!actionDates[day]) actionDates[day] = [];\n                    actionDates[day].push(item);\n                }\n            }\n        });\n    } catch(e) {}\n\n\n    var html = '';\n    // Day headers\n    ['Su','Mo','Tu','We','Th','Fr','Sa'].forEach(function(d) {\n        html += '<div style=\"padding:4px;font-weight:700;color:var(--steel);font-size:0.7rem\">' + d + '</div>';\n    });\n    // Empty cells before first day\n    for (var i = 0; i < firstDay; i++) {\n        html += '<div style=\"padding:6px\"></div>';\n    }\n    // Day cells\n    for (var d = 1; d <= daysInMonth; d++) {\n        var isToday = isCurrentMonth && d === today.getDate();\n        var hasActions = actionDates[d];\n        var bg = isToday ? 'rgba(0,170,255,0.2)' : (hasActions ? 'rgba(0,170,255,0.06)' : 'var(--surface)');\n        var border = isToday ? '1px solid var(--accent)' : (hasActions ? '1px solid rgba(0,170,255,0.15)' : '1px solid var(--border)');\n        var dots = '';\n        if (hasActions) {\n            hasActions.forEach(function(a) {\n                var col = a.severity === 'critical' ? '#ff3333' : (a.severity === 'warning' ? '#ffa500' : '#00aaff');\n                dots += '<span style=\"display:inline-block;width:4px;height:4px;border-radius:50%;background:' + col + ';margin:0 1px\"></span>';\n            });\n        }\n        html += '<div onclick=\"showCalDay(' + d + ')\" style=\"padding:4px 2px;background:' + bg + ';border:' + border + ';border-radius:4px;cursor:' + (hasActions ? 'pointer' : 'default') + ';min-height:32px\">'\n            + '<div style=\"color:' + (isToday ? '#00aaff' : '#fff') + ';font-weight:' + (isToday ? '800' : '400') + '\">' + d + '</div>'\n            + (dots ? '<div style=\"margin-top:2px\">' + dots + '</div>' : '')\n            + '</div>';\n    }\n    grid.innerHTML = html;\n}\n\nfunction showCalDay(day) {\n    var detail = document.getElementById('calDayDetail');\n    if (!detail) return;\n    // Get actions for this day\n    var actionDates = {};\n    try {\n        var items = (typeof s4ActionItems !== 'undefined' && s4ActionItems.length > 0)\n            ? s4ActionItems\n            : JSON.parse(localStorage.getItem('s4ActionItems') || '[]');\n        items.forEach(function(item) {\n            var dueStr = item.due || item.schedule || '';\n            if (dueStr) {\n                var d = new Date(dueStr);\n                if (!isNaN(d.getTime()) && d.getFullYear() === _calYear && d.getMonth() === _calMonth) {\n                    var dy = d.getDate();\n                    if (!actionDates[dy]) actionDates[dy] = [];\n                    actionDates[dy].push(item);\n                }\n            }\n        });\n    } catch(e) {}\n    var items = actionDates[day] || [];\n    if (items.length === 0) { detail.style.display = 'none'; return; }\n    var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n    var html = '<div style=\"font-weight:700;color:#fff;margin-bottom:6px\"><i class=\"fas fa-calendar-day\" style=\"color:var(--accent);margin-right:4px\"></i>' + months[_calMonth] + ' ' + day + ', ' + _calYear + '</div>';\n    items.forEach(function(item) {\n        var col = item.severity === 'critical' ? '#ff3333' : (item.severity === 'warning' ? '#ffa500' : '#00aaff');\n        html += '<div style=\"padding:6px 8px;background:rgba(0,0,0,0.2);border-left:3px solid ' + col + ';border-radius:4px;margin-bottom:4px\">'\n            + '<div style=\"font-weight:600;color:#fff;font-size:0.8rem\">' + (item.title || 'Action Item') + '</div>'\n            + (item.owner ? '<div style=\"font-size:0.72rem;color:var(--steel)\">Owner: ' + item.owner + '</div>' : '')\n            + '</div>';\n    });\n    detail.innerHTML = html;\n    detail.style.display = 'block';\n}\n\n// Render calendar robustly — retry until grid exists and is visible\nfunction renderActionCalendarSafe() {\n    var grid = document.getElementById('actionCalendarGrid');\n    var label = document.getElementById('calMonthLabel');\n    if (!grid || !label) {\n        // Retry — elements may not exist yet\n        setTimeout(renderActionCalendarSafe, 500);\n        return;\n    }\n    renderActionCalendar();\n    // Double-check it actually rendered content\n    if (!grid.innerHTML || grid.innerHTML.trim() === '') {\n        setTimeout(renderActionCalendar, 300);\n    }\n}\n// Initial render on page load\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', function() { setTimeout(renderActionCalendarSafe, 800); });\n} else {\n    setTimeout(renderActionCalendarSafe, 800);\n}\n// Also observe hub-actions panel visibility\n(function() {\n    var _actionsObserver = new MutationObserver(function(mutations) {\n        mutations.forEach(function(m) {\n            if (m.type === 'attributes' && m.attributeName === 'style') {\n                var panel = m.target;\n                if (panel.id === 'hub-actions' && panel.style.display !== 'none') {\n                    setTimeout(renderActionCalendar, 150);\n                }\n            }\n        });\n    });\n    var actionsPanel = document.getElementById('hub-actions');\n    if (actionsPanel) {\n        _actionsObserver.observe(actionsPanel, { attributes: true, attributeFilter: ['style'] });\n    } else {\n        document.addEventListener('DOMContentLoaded', function() {\n            var ap = document.getElementById('hub-actions');\n            if (ap) _actionsObserver.observe(ap, { attributes: true, attributeFilter: ['style'] });\n        });\n    }\n})();\n\n// === Window exports for inline event handlers ===\nwindow.anchorLifecycle = anchorLifecycle;\nwindow.calcLifecycle = calcLifecycle;\nwindow.changeCalMonth = changeCalMonth;\nwindow.exportLifecycle = exportLifecycle;\nwindow.handleFileSelect = handleFileSelect;\nwindow.loadPerformanceMetrics = loadPerformanceMetrics;\nwindow.offlineClearQueue = offlineClearQueue;\nwindow.offlineQueueHash = offlineQueueHash;\nwindow.offlineRemoveItem = offlineRemoveItem;\nwindow.offlineSyncAll = offlineSyncAll;\nwindow.showCalDay = showCalDay;\n","// S4 Ledger — navigation\n// Extracted from monolith lines 15066-15652\n// 585 lines\n\n// ═══ Platform Hub Navigation ═══\nvar _currentSection = null;\nvar _currentILSTool = null;\n\nfunction showHub() {\n    // Hide all tab panes\n    document.querySelectorAll('.tab-pane').forEach(function(p) { p.classList.remove('show','active'); p.style.display = 'none'; });\n    // Hide systems hub\n    var sh = document.getElementById('sectionSystems');\n    if (sh) sh.style.display = 'none';\n    // ── Clean up any open ILS tool panels ──\n    document.querySelectorAll('.ils-hub-panel').forEach(function(p) { p.classList.remove('active'); p.style.display = 'none'; });\n    var ilsBackBar = document.getElementById('ilsToolBackBar');\n    if (ilsBackBar) ilsBackBar.style.display = 'none';\n    var ilsSubHub = document.getElementById('ilsSubHub');\n    if (ilsSubHub) ilsSubHub.style.display = 'grid';\n    var hubTabs = document.querySelector('.ils-hub-tabs');\n    if (hubTabs) hubTabs.style.display = 'none';\n    _currentILSTool = null;\n    // Show hub\n    var hub = document.getElementById('platformHub');\n    if (hub) { hub.style.display = 'block'; hub.style.animation = 'fadeIn 0.3s ease'; }\n    // Show stat strip\n    var sr = document.getElementById('statsRow');\n    if (sr) sr.style.display = 'flex';\n    // Only show hero + pre-platform landing if user hasn't entered yet\n    if (!sessionStorage.getItem('s4_entered')) {\n        var hero = document.querySelector('.hero');\n        if (hero) hero.style.display = 'block';\n        var landing = document.getElementById('platformLanding');\n        if (landing) landing.style.display = 'block';\n    }\n    _currentSection = null;\n    // Update URL\n    history.replaceState(null, '', window.location.pathname);\n}\n\nfunction showSection(sectionId) {\n    var hub = document.getElementById('platformHub');\n    if (hub) hub.style.display = 'none';\n    // Hide hero + landing when inside any tool section\n    var hero = document.querySelector('.hero');\n    if (hero) hero.style.display = 'none';\n    var landing = document.getElementById('platformLanding');\n    if (landing) landing.style.display = 'none';\n    \n    // Hide all tab panes and systems hub\n    document.querySelectorAll('.tab-pane').forEach(function(p) { p.classList.remove('show','active'); p.style.display = 'none'; });\n    var sh = document.getElementById('sectionSystems');\n    if (sh) sh.style.display = 'none';\n    \n    // Map sectionId to tab-pane ID\n    var tabMap = {\n        'sectionAnchor': 'tabAnchor',\n        'sectionVerify': 'tabVerify',\n        'sectionLog': 'tabLog',\n        'sectionILS': 'tabILS',\n        'sectionSystems': 'sectionSystems',\n        'sectionMetrics': 'tabMetrics',\n        'sectionOffline': 'tabOffline'\n    };\n    \n    if (sectionId === 'sectionSystems') {\n        // Show Systems hub — must add show/active for Bootstrap fade to work\n        if (sh) { sh.style.display = 'block'; sh.classList.add('show','active'); sh.style.animation = 'fadeIn 0.3s ease'; }\n    } else {\n        var tabId = tabMap[sectionId] || sectionId;\n        var pane = document.getElementById(tabId);\n        if (pane) {\n            pane.style.display = 'block';\n            pane.classList.add('show','active');\n            pane.style.animation = 'fadeIn 0.3s ease';\n        }\n        // Also activate the hidden Bootstrap tab for JS compatibility\n        var tabLink = document.querySelector('a[href=\"#' + tabId + '\"]');\n        if (tabLink) {\n            try { new bootstrap.Tab(tabLink).show(); } catch(e) {}\n        }\n    }\n    \n    _currentSection = sectionId;\n    \n    // For ILS section, show the sub-hub\n    if (sectionId === 'sectionILS') {\n        var subHub = document.getElementById('ilsSubHub');\n        if (subHub) subHub.style.display = 'grid';\n        var toolBack = document.getElementById('ilsToolBackBar');\n        if (toolBack) toolBack.style.display = 'none';\n        // Hide all ILS panels\n        document.querySelectorAll('.ils-hub-panel').forEach(function(p) { p.classList.remove('active'); });\n    }\n}\n\nfunction showSystemsSub(tabId) {\n    var sh = document.getElementById('sectionSystems');\n    if (sh) sh.style.display = 'none';\n    var pane = document.getElementById(tabId);\n    if (pane) {\n        pane.style.display = 'block';\n        pane.classList.add('show','active');\n        pane.style.animation = 'fadeIn 0.3s ease';\n    }\n}\n\n// ═══ ILS Tool Navigation ═══\nfunction openILSTool(toolId) {\n    var subHub = document.getElementById('ilsSubHub');\n    if (subHub) subHub.style.display = 'none';\n    var toolBack = document.getElementById('ilsToolBackBar');\n    if (toolBack) toolBack.style.display = 'block';\n    \n    // Activate the tool panel (hide all, then show target)\n    document.querySelectorAll('.ils-hub-panel').forEach(function(p) { p.classList.remove('active'); p.style.display = 'none'; });\n    var panel = document.getElementById(toolId);\n    if (panel) { panel.style.display = 'block'; panel.classList.add('active'); panel.style.animation = 'fadeIn 0.3s ease'; }\n    \n    // Also click the hidden tab button for compatibility\n    var tabBtn = document.querySelector('.ils-hub-tab[onclick*=\"' + toolId + '\"]');\n    if (tabBtn) {\n        document.querySelectorAll('.ils-hub-tab').forEach(function(b) { b.classList.remove('active'); });\n        tabBtn.classList.add('active');\n    }\n    \n    // Load data for panels that need it (synced with switchHubTab)\n    if (toolId === 'hub-actions') { if (typeof renderHubActions === 'function') renderHubActions(); if (typeof renderActionCalendar === 'function') { setTimeout(renderActionCalendar, 200); setTimeout(renderActionCalendar, 600); } }\n    if (toolId === 'hub-vault') { if (typeof renderVault === 'function') renderVault(); }\n    if (toolId === 'hub-docs') { if (typeof renderDocLibrary === 'function') renderDocLibrary(); }\n    if (toolId === 'hub-compliance') { if (typeof calcCompliance === 'function') calcCompliance(); }\n    if (toolId === 'hub-risk') { if (typeof loadRiskData === 'function') loadRiskData(); }\n    if (toolId === 'hub-roi') { if (typeof calcROI === 'function') calcROI(); }\n    if (toolId === 'hub-reports') { if (typeof loadReportPreview === 'function') loadReportPreview(); }\n    if (toolId === 'hub-predictive') { if (typeof loadPredictiveData === 'function') loadPredictiveData(); }\n    if (toolId === 'hub-submissions') { if (typeof loadSubmissionHistory === 'function') loadSubmissionHistory(); }\n    if (toolId === 'hub-sbom') { if (typeof loadSBOMData === 'function') loadSBOMData(); }\n    if (toolId === 'hub-dmsms') { if (typeof loadDMSMSData === 'function') loadDMSMSData(); }\n    if (toolId === 'hub-readiness') { if (typeof loadReadinessData === 'function') loadReadinessData(); }\n    if (toolId === 'hub-lifecycle') { if (typeof calcLifecycle === 'function') calcLifecycle(); }\n    if (toolId === 'hub-analysis') { if (typeof initILSChecklist === 'function') initILSChecklist(); }\n    \n    // Update floating AI agent context\n    if (typeof updateAiContext === 'function') updateAiContext(toolId);\n    \n    // ── How It Works: modal popup on first visit, ? icon on return visits ──\n    if (panel) {\n        var det = panel.querySelector('details');\n        var h3 = panel.querySelector('h3');\n        if (det && h3) {\n            // Always hide the <details> element — we use modal popups now\n            det.style.display = 'none';\n            det.removeAttribute('open');\n            var storageKey = 's4_hiw_' + toolId;\n            var visited = false;\n            try { visited = localStorage.getItem(storageKey) === '1'; } catch(e) {}\n            // Remove any existing ? button\n            var existingBtn = h3.querySelector('.hiw-help-btn');\n            if (existingBtn) existingBtn.remove();\n\n            function showHIWModal() {\n                var title = det.querySelector('summary') ? det.querySelector('summary').textContent.trim() : 'How It Works';\n                var bodyContent = det.querySelector('summary + div, div') ? det.querySelector('summary + div, div').innerHTML : det.innerHTML;\n                var overlay = document.createElement('div');\n                overlay.className = 'hiw-modal-overlay';\n                overlay.onclick = function(e) { if (e.target === overlay) { overlay.remove(); } };\n                overlay.innerHTML = '<div class=\"hiw-modal-box\"><button class=\"hiw-close\" onclick=\"this.closest(\\'.hiw-modal-overlay\\').remove()\">&times;</button><h4><i class=\"fas fa-info-circle\" style=\"color:#00aaff\"></i> ' + title + '</h4><div class=\"hiw-body\">' + bodyContent + '</div></div>';\n                document.body.appendChild(overlay);\n            }\n\n            if (!visited) {\n                // First visit: auto-popup\n                try { localStorage.setItem(storageKey, '1'); } catch(e) {}\n                setTimeout(showHIWModal, 300);\n            }\n            // Always add ? icon for manual access\n            var qBtn = document.createElement('button');\n            qBtn.className = 'hiw-help-btn';\n            qBtn.innerHTML = '?';\n            qBtn.title = 'Show How It Works';\n            qBtn.onclick = function(e) { e.stopPropagation(); showHIWModal(); };\n            h3.appendChild(qBtn);\n        }\n    }\n    \n    _currentILSTool = toolId;\n}\n\nfunction closeILSTool() {\n    // Hide ALL tool panels (remove active class AND force display)\n    document.querySelectorAll('.ils-hub-panel').forEach(function(p) {\n        p.classList.remove('active');\n        p.style.display = 'none';\n    });\n    // Show tool grid\n    var subHub = document.getElementById('ilsSubHub');\n    if (subHub) { subHub.style.display = 'grid'; subHub.style.animation = 'fadeIn 0.3s ease'; }\n    // Hide back bar\n    var toolBack = document.getElementById('ilsToolBackBar');\n    if (toolBack) toolBack.style.display = 'none';\n    // Keep hub tabs row HIDDEN — card grid is the only navigation\n    var hubTabs = document.querySelector('.ils-hub-tabs');\n    if (hubTabs) hubTabs.style.display = 'none';\n    _currentILSTool = null;\n    // Re-apply role visibility on tool cards\n    if (_currentRole && typeof applyTabVisibility === 'function') {\n        var vis = _customVisibleTabs || (_s4Roles[_currentRole] ? _s4Roles[_currentRole].tabs : _allHubTabs);\n        applyTabVisibility(vis);\n    }\n}\n\n// ═══ Drag-Reorder Tool Cards (iPhone-style) ═══\n(function initToolCardDragReorder(){\n    var STORAGE_KEY = 's4_tool_card_order';\n    function getHub(){ return document.getElementById('ilsSubHub'); }\n    \n    // Restore saved order on load\n    function restoreOrder(){\n        var hub = getHub(); if(!hub) return;\n        var saved = localStorage.getItem(STORAGE_KEY);\n        if(!saved) return;\n        try {\n            var order = JSON.parse(saved);\n            var cards = Array.from(hub.querySelectorAll('.ils-tool-card'));\n            var map = {};\n            cards.forEach(function(c){ \n                var m = c.getAttribute('onclick') || '';\n                var id = (m.match(/openILSTool\\('([^']+)'\\)/) || [])[1];\n                if(id) map[id] = c;\n            });\n            order.forEach(function(id){\n                if(map[id]) hub.appendChild(map[id]);\n            });\n        } catch(e){}\n    }\n\n    // Save current order\n    function saveOrder(){\n        var hub = getHub(); if(!hub) return;\n        var cards = hub.querySelectorAll('.ils-tool-card');\n        var order = [];\n        cards.forEach(function(c){\n            var m = c.getAttribute('onclick') || '';\n            var id = (m.match(/openILSTool\\('([^']+)'\\)/) || [])[1];\n            if(id) order.push(id);\n        });\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(order));\n    }\n\n    // Setup drag handlers\n    function setupDrag(){\n        var hub = getHub(); if(!hub) return;\n        var dragSrc = null;\n\n        hub.querySelectorAll('.ils-tool-card').forEach(function(card){\n            card.setAttribute('draggable', 'true');\n\n            card.addEventListener('dragstart', function(e){\n                dragSrc = this;\n                this.classList.add('dragging');\n                e.dataTransfer.effectAllowed = 'move';\n                e.dataTransfer.setData('text/plain', '');\n            });\n\n            card.addEventListener('dragend', function(){\n                this.classList.remove('dragging');\n                hub.querySelectorAll('.ils-tool-card').forEach(function(c){ c.classList.remove('drag-over'); });\n            });\n\n            card.addEventListener('dragover', function(e){\n                e.preventDefault();\n                e.dataTransfer.dropEffect = 'move';\n                if(this !== dragSrc) this.classList.add('drag-over');\n            });\n\n            card.addEventListener('dragleave', function(){\n                this.classList.remove('drag-over');\n            });\n\n            card.addEventListener('drop', function(e){\n                e.preventDefault();\n                this.classList.remove('drag-over');\n                if(dragSrc && dragSrc !== this){\n                    var allCards = Array.from(hub.querySelectorAll('.ils-tool-card'));\n                    var fromIdx = allCards.indexOf(dragSrc);\n                    var toIdx = allCards.indexOf(this);\n                    if(fromIdx < toIdx){\n                        hub.insertBefore(dragSrc, this.nextSibling);\n                    } else {\n                        hub.insertBefore(dragSrc, this);\n                    }\n                    saveOrder();\n                    // Re-attach drag handlers after reorder\n                    setupDrag();\n                }\n                dragSrc = null;\n            });\n\n            // Touch support for mobile (iPhone-style long-press)\n            var touchTimer = null;\n            var touchDragging = false;\n            var touchClone = null;\n            var touchSrc = null;\n\n            card.addEventListener('touchstart', function(e){\n                var self = this;\n                touchTimer = setTimeout(function(){\n                    touchDragging = true;\n                    touchSrc = self;\n                    self.classList.add('dragging');\n                    // Create visual clone\n                    touchClone = self.cloneNode(true);\n                    touchClone.style.position = 'fixed';\n                    touchClone.style.pointerEvents = 'none';\n                    touchClone.style.opacity = '0.85';\n                    touchClone.style.zIndex = '9999';\n                    touchClone.style.width = self.offsetWidth + 'px';\n                    touchClone.style.transform = 'scale(1.05)';\n                    touchClone.style.boxShadow = '0 8px 32px rgba(0,170,255,0.3)';\n                    document.body.appendChild(touchClone);\n                }, 500);\n            }, {passive:true});\n\n            card.addEventListener('touchmove', function(e){\n                if(!touchDragging || !touchClone) return;\n                e.preventDefault();\n                var touch = e.touches[0];\n                touchClone.style.left = (touch.clientX - touchClone.offsetWidth/2) + 'px';\n                touchClone.style.top = (touch.clientY - touchClone.offsetHeight/2) + 'px';\n                // Highlight card under finger\n                hub.querySelectorAll('.ils-tool-card').forEach(function(c){ c.classList.remove('drag-over'); });\n                var elem = document.elementFromPoint(touch.clientX, touch.clientY);\n                if(elem){\n                    var target = elem.closest('.ils-tool-card');\n                    if(target && target !== touchSrc) target.classList.add('drag-over');\n                }\n            }, {passive:false});\n\n            card.addEventListener('touchend', function(e){\n                clearTimeout(touchTimer);\n                if(touchDragging && touchSrc){\n                    var touch = e.changedTouches[0];\n                    var elem = document.elementFromPoint(touch.clientX, touch.clientY);\n                    var target = elem ? elem.closest('.ils-tool-card') : null;\n                    if(target && target !== touchSrc){\n                        var allCards = Array.from(hub.querySelectorAll('.ils-tool-card'));\n                        var fromIdx = allCards.indexOf(touchSrc);\n                        var toIdx = allCards.indexOf(target);\n                        if(fromIdx < toIdx){\n                            hub.insertBefore(touchSrc, target.nextSibling);\n                        } else {\n                            hub.insertBefore(touchSrc, target);\n                        }\n                        saveOrder();\n                        setupDrag();\n                    }\n                    touchSrc.classList.remove('dragging');\n                    hub.querySelectorAll('.ils-tool-card').forEach(function(c){ c.classList.remove('drag-over'); });\n                }\n                if(touchClone && touchClone.parentNode) touchClone.parentNode.removeChild(touchClone);\n                touchDragging = false;\n                touchClone = null;\n                touchSrc = null;\n            });\n\n            card.addEventListener('touchcancel', function(){\n                clearTimeout(touchTimer);\n                if(touchClone && touchClone.parentNode) touchClone.parentNode.removeChild(touchClone);\n                if(touchSrc) touchSrc.classList.remove('dragging');\n                hub.querySelectorAll('.ils-tool-card').forEach(function(c){ c.classList.remove('drag-over'); });\n                touchDragging = false;\n                touchClone = null;\n                touchSrc = null;\n            });\n        });\n    }\n\n    // Init after DOM ready\n    if(document.readyState === 'loading'){\n        document.addEventListener('DOMContentLoaded', function(){ restoreOrder(); setupDrag(); });\n    } else {\n        restoreOrder(); setupDrag();\n    }\n})();\n\n// ═══ Wallet Sidebar ═══\nfunction openWalletSidebar() {\n    var sidebar = document.getElementById('walletSidebar');\n    var overlay = document.getElementById('walletOverlay');\n    if (sidebar) sidebar.classList.add('open');\n    if (overlay) overlay.classList.add('show');\n    \n    // Move wallet content into sidebar on first open\n    var body = document.getElementById('walletSidebarBody');\n    var walletPane = document.getElementById('tabWallet');\n    if (body && walletPane && !body.dataset.loaded) {\n        body.innerHTML = walletPane.innerHTML;\n        body.dataset.loaded = 'true';\n        // Trigger wallet data load\n        if (typeof loadWalletData === 'function') loadWalletData();\n        \n        // Fix: Rewire flow details button to show INSIDE the sidebar\n        _rewireWalletFlowDetails(body);\n    }\n    \n    // Update wallet trigger balance\n    updateWalletTrigger();\n}\n\nfunction _rewireWalletFlowDetails(sidebarBody) {\n    // Find the \"Flow Details\" button inside the sidebar copy\n    var flowBtn = sidebarBody.querySelector('#slsToggleBtn');\n    if (!flowBtn) return;\n    \n    // Remove the original onclick toggle\n    flowBtn.removeAttribute('onclick');\n    \n    // Create inline flow details panel for the sidebar\n    var flowPanel = document.createElement('div');\n    flowPanel.id = 'sidebarFlowPanel';\n    flowPanel.style.cssText = 'display:none;margin-top:12px;background:linear-gradient(135deg,rgba(0,170,255,0.06),rgba(201,168,76,0.04));border:1px solid rgba(0,170,255,0.25);border-radius:3px;padding:16px 18px;';\n    flowPanel.innerHTML = '<div style=\"position:relative\">'\n        + '<div style=\"position:absolute;top:-4px;right:0;background:linear-gradient(135deg,#00aaff,#c9a84c);padding:3px 12px;border-radius:0 10px 0 8px;font-size:0.62rem;font-weight:700;color:#050810;letter-spacing:0.5px\">LIVE PREVIEW</div>'\n        + '<h4 style=\"margin:0 0 4px;font-size:0.95rem;color:#fff\"><i class=\"fas fa-flask\" style=\"color:#00aaff;margin-right:6px\"></i>SLS Economic Flow</h4>'\n        + '<p style=\"color:#8ea4b8;font-size:0.72rem;margin:0 0 12px\">See how the $SLS token economy works. <strong style=\"color:#c9a84c\">Every anchor costs 0.01 $SLS.</strong></p>'\n        + '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:8px\">'\n        + '<div style=\"background:rgba(0,170,255,0.08);border:1px solid rgba(0,170,255,0.2);border-radius:3px;padding:10px;text-align:center\"><div style=\"width:28px;height:28px;border-radius:50%;background:rgba(0,170,255,0.15);display:inline-flex;align-items:center;justify-content:center;margin-bottom:6px\"><i class=\"fas fa-user-plus\" style=\"color:#00aaff;font-size:0.75rem\"></i></div><div style=\"font-size:0.68rem;font-weight:700;color:#fff\">1. Account</div><div style=\"font-size:0.62rem;color:#8ea4b8\">Created &amp; provisioned</div></div>'\n        + '<div style=\"background:rgba(0,170,255,0.08);border:1px solid rgba(0,170,255,0.2);border-radius:3px;padding:10px;text-align:center\"><div style=\"width:28px;height:28px;border-radius:50%;background:rgba(0,170,255,0.15);display:inline-flex;align-items:center;justify-content:center;margin-bottom:6px\"><i class=\"fas fa-wallet\" style=\"color:#00aaff;font-size:0.75rem\"></i></div><div style=\"font-size:0.68rem;font-weight:700;color:#fff\">2. Wallet Funded</div><div style=\"font-size:0.62rem;color:#8ea4b8\">12 XRP reserve</div></div>'\n        + '<div style=\"background:rgba(201,168,76,0.08);border:1px solid rgba(201,168,76,0.2);border-radius:3px;padding:10px;text-align:center\"><div style=\"width:28px;height:28px;border-radius:50%;background:rgba(201,168,76,0.15);display:inline-flex;align-items:center;justify-content:center;margin-bottom:6px\"><i class=\"fas fa-coins\" style=\"color:#c9a84c;font-size:0.75rem\"></i></div><div style=\"font-size:0.68rem;font-weight:700;color:#fff\">3. $SLS Allocated</div><div style=\"font-size:0.62rem;color:#8ea4b8\">Based on plan tier</div></div>'\n        + '<div style=\"background:rgba(0,170,255,0.08);border:1px solid rgba(0,170,255,0.2);border-radius:3px;padding:10px;text-align:center\"><div style=\"width:28px;height:28px;border-radius:50%;background:rgba(0,170,255,0.15);display:inline-flex;align-items:center;justify-content:center;margin-bottom:6px\"><i class=\"fas fa-arrow-right\" style=\"color:#00aaff;font-size:0.75rem\"></i></div><div style=\"font-size:0.68rem;font-weight:700;color:#fff\">4. 0.01 SLS &rarr; Treasury</div><div style=\"font-size:0.62rem;color:#8ea4b8\">Per anchor fee</div></div>'\n        + '</div>'\n        + '<div style=\"margin-top:10px;padding:8px 12px;background:rgba(0,0,0,0.25);border-radius:3px;font-size:0.7rem\">'\n        + '<div style=\"display:flex;justify-content:space-between;flex-wrap:wrap;gap:6px\">'\n        + '<div><span style=\"color:#8ea4b8\">Wallet:</span> <span style=\"color:#00aaff;font-family:monospace\" id=\"sidebarWalletAddr\">rMLmk...f1KLqJ</span></div>'\n        + '<div><span style=\"color:#8ea4b8\">Balance:</span> <span style=\"color:#c9a84c;font-weight:700\" id=\"sidebarSlsBal\">' + (document.getElementById('slsBarBalance') ? document.getElementById('slsBarBalance').textContent : '25,000') + ' SLS</span></div>'\n        + '</div></div>'\n        + '</div>';\n    \n    // Insert flow panel after the slsBalanceBar in sidebar\n    var slsBar = sidebarBody.querySelector('#slsBalanceBar');\n    if (slsBar) {\n        slsBar.parentNode.insertBefore(flowPanel, slsBar.nextSibling);\n    } else {\n        sidebarBody.insertBefore(flowPanel, sidebarBody.firstChild ? sidebarBody.firstChild.nextSibling : null);\n    }\n    \n    // Wire up the button to toggle the SIDEBAR flow panel\n    var _sidebarFlowShown = false;\n    flowBtn.addEventListener('click', function() {\n        _sidebarFlowShown = !_sidebarFlowShown;\n        flowPanel.style.display = _sidebarFlowShown ? 'block' : 'none';\n        flowBtn.innerHTML = _sidebarFlowShown \n            ? '<i class=\"fas fa-chevron-up\" style=\"margin-right:4px\"></i>Hide Flow Details'\n            : '<i class=\"fas fa-chart-simple\" style=\"margin-right:4px\"></i>Show Flow Details';\n    });\n}\n\nfunction closeWalletSidebar() {\n    var sidebar = document.getElementById('walletSidebar');\n    var overlay = document.getElementById('walletOverlay');\n    if (sidebar) sidebar.classList.remove('open');\n    if (overlay) overlay.classList.remove('show');\n}\n\nfunction updateWalletTrigger() {\n    var bal = document.getElementById('slsBarBalance');\n    var trigger = document.getElementById('walletTriggerBal');\n    if (bal && trigger) {\n        trigger.textContent = bal.textContent || '--';\n    }\n}\n\n// ═══ Initial State: Show Hub ═══\ndocument.addEventListener('DOMContentLoaded', function() {\n    // Start with hub visible\n    setTimeout(function() {\n        var hub = document.getElementById('platformHub');\n        if (hub) hub.style.display = 'block';\n        // Hide all tab panes initially\n        document.querySelectorAll('.tab-pane').forEach(function(p) {\n            p.classList.remove('show','active');\n            p.style.display = 'none';\n        });\n\n    }, 100);\n});\n\n// Override Bootstrap tab activation to work with our navigation\ndocument.addEventListener('shown.bs.tab', function(e) {\n    updateWalletTrigger();\n});\n\n\n// ═══ Action Item Badge Updater ═══\n(function() {\n    function updateActionBadge() {\n        var badge = document.getElementById('actionItemBadge');\n        if (!badge) return;\n        var openItems = 0;\n        if (typeof s4ActionItems !== 'undefined' && Array.isArray(s4ActionItems)) {\n            openItems = s4ActionItems.filter(function(a){ return !a.done; }).length;\n        }\n        if (openItems > 0) {\n            badge.textContent = openItems;\n            badge.style.display = 'inline-flex';\n        } else {\n            badge.style.display = 'none';\n        }\n    }\n    \n    // Update on various events\n    setInterval(updateActionBadge, 3000);\n    document.addEventListener('DOMContentLoaded', function() {\n        setTimeout(updateActionBadge, 2000);\n    });\n    \n    // Hook showSection to update badge when entering ILS\n    var _origShowSec2 = showSection;\n    showSection = function(id) {\n        _origShowSec2(id);\n        setTimeout(updateActionBadge, 500);\n    };\n})();\n\n\n// ═══ Tool SLS Balance Sync ═══\n(function() {\n    function syncToolSls() {\n        var mainBal = document.getElementById('slsBarBalance');\n        var mainAnch = document.getElementById('slsBarAnchors');\n        var mainSpent = document.getElementById('slsBarSpent');\n        var toolBal = document.getElementById('toolSlsBal');\n        var toolAnch = document.getElementById('toolSlsAnch');\n        var toolSpent = document.getElementById('toolSlsSpent');\n        if (toolBal && mainBal) toolBal.textContent = mainBal.textContent.replace(' SLS','');\n        if (toolAnch && mainAnch) toolAnch.textContent = mainAnch.textContent;\n        if (toolSpent && mainSpent) toolSpent.textContent = mainSpent.textContent.replace(' SLS','');\n    }\n    setInterval(syncToolSls, 2000);\n    // Also hook openILSTool\n    var _origOpen3 = openILSTool;\n    openILSTool = function(toolId) {\n        _origOpen3(toolId);\n        setTimeout(syncToolSls, 200);\n    };\n})();\n\n\n// ═══ Post-Anchor Confirmation Display ═══\n(function() {\n    var _origHideAnchor = hideAnchorAnimation;\n    hideAnchorAnimation = function() {\n        _origHideAnchor();\n        // Show confirmation in the active tool panel\n        if (_currentILSTool) {\n            var panel = document.getElementById(_currentILSTool);\n            if (!panel) return;\n            var existing = panel.querySelector('.anchor-confirm-banner');\n            if (existing) existing.remove();\n            \n            // Get the last vault record for details\n            var lastRec = s4Vault.length > 0 ? s4Vault[0] : null;\n            if (!lastRec) return;\n            \n            var banner = document.createElement('div');\n            banner.className = 'anchor-confirm-banner';\n            banner.style.cssText = 'background:linear-gradient(135deg,rgba(0,204,102,0.08),rgba(0,170,255,0.06));border:1px solid rgba(0,204,102,0.2);border-radius:3px;padding:16px 20px;margin-bottom:16px;animation:panelSlideIn 0.4s ease;position:relative';\n            banner.innerHTML = '<button onclick=\"this.parentElement.remove()\" style=\"position:absolute;top:8px;right:12px;background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.85rem\">&times;</button>'\n                + '<div style=\"display:flex;align-items:center;gap:8px;margin-bottom:8px\"><i class=\"fas fa-check-circle\" style=\"color:#00cc66;font-size:1.1rem\"></i><strong style=\"color:#fff;font-size:0.9rem\">Record Anchored Successfully</strong></div>'\n                + '<div style=\"font-size:0.78rem;color:var(--steel);display:grid;grid-template-columns:80px 1fr;gap:4px 12px\">'\n                + '<span style=\"color:var(--muted)\">Type:</span><span>' + (lastRec.label || lastRec.type) + '</span>'\n                + '<span style=\"color:var(--muted)\">Hash:</span><span style=\"font-family:monospace;color:var(--accent);font-size:0.72rem;word-break:break-all\">' + (lastRec.hash || '').substring(0,32) + '...</span>'\n                + '<span style=\"color:var(--muted)\">TX:</span><span>' + (lastRec.txHash ? '<a href=\"' + (lastRec.explorerUrl || '#') + '\" target=\"_blank\" style=\"color:var(--accent);text-decoration:none\">' + lastRec.txHash.substring(0,16) + '... <i class=\"fas fa-external-link-alt\" style=\"font-size:0.6rem\"></i></a>' : 'Pending') + '</span>'\n                + '<span style=\"color:var(--muted)\">Fee:</span><span style=\"color:#c9a84c\">0.01 $SLS</span>'\n                + '<span style=\"color:var(--muted)\">Time:</span><span>' + new Date().toLocaleTimeString() + '</span>'\n                + '</div>';\n            \n            var firstCard = panel.querySelector('.s4-card');\n            if (firstCard) {\n                firstCard.insertBefore(banner, firstCard.firstChild);\n            }\n            \n            // Auto-remove after 15 seconds\n            setTimeout(function(){ if (banner.parentElement) banner.remove(); }, 15000);\n        }\n    };\n})();\n\n// === Window exports for inline event handlers ===\nwindow.closeILSTool = closeILSTool;\nwindow.closeWalletSidebar = closeWalletSidebar;\nwindow.openILSTool = openILSTool;\nwindow.openWalletSidebar = openWalletSidebar;\nwindow.showHub = showHub;\nwindow.showSection = showSection;\nwindow.showSystemsSub = showSystemsSub;\n","// S4 Ledger — roles\n// Extracted from monolith lines 15656-16199\n// 542 lines\n\n\n// ══════════════════════════════════════════════════════════════\n// ROLE-BASED TOOL ACCESS SYSTEM\n// ══════════════════════════════════════════════════════════════\nvar _s4Roles = {\n    'ils_manager': { label:'ILS Manager', icon:'fa-clipboard-list', desc:'Full ILS tool suite access', tabs:['hub-analysis','hub-dmsms','hub-readiness','hub-compliance','hub-risk','hub-actions','hub-predictive','hub-lifecycle','hub-roi','hub-vault','hub-docs','hub-reports','hub-submissions','hub-sbom','hub-gfp','hub-cdrl','hub-contract','hub-provenance','hub-analytics','hub-team'] },\n    'dmsms_analyst': { label:'DMSMS Analyst', icon:'fa-microchip', desc:'DMSMS tracking and obsolescence management', tabs:['hub-dmsms','hub-risk','hub-lifecycle','hub-actions','hub-vault','hub-docs','hub-reports'] },\n    'auditor': { label:'Auditor / Compliance', icon:'fa-shield-halved', desc:'Compliance scorecard and audit vault', tabs:['hub-compliance','hub-vault','hub-actions','hub-docs','hub-reports','hub-submissions'] },\n    'contracts': { label:'Contract Specialist', icon:'fa-file-contract', desc:'ROI, submissions, and document management', tabs:['hub-roi','hub-vault','hub-docs','hub-reports','hub-submissions','hub-actions','hub-cdrl','hub-contract'] },\n    'supply_chain': { label:'Supply Chain / Provisioning', icon:'fa-truck', desc:'Supply, readiness, and provisioning tools', tabs:['hub-readiness','hub-risk','hub-lifecycle','hub-actions','hub-vault','hub-docs','hub-submissions'] },\n    'admin': { label:'Full Access Admin', icon:'fa-user-shield', desc:'All tools visible — unrestricted access', tabs:['hub-analysis','hub-dmsms','hub-readiness','hub-compliance','hub-risk','hub-actions','hub-predictive','hub-lifecycle','hub-roi','hub-vault','hub-docs','hub-reports','hub-submissions','hub-sbom','hub-gfp','hub-cdrl','hub-contract','hub-provenance','hub-analytics','hub-team'] }\n};\nvar _allHubTabs = ['hub-analysis','hub-dmsms','hub-readiness','hub-compliance','hub-risk','hub-actions','hub-predictive','hub-lifecycle','hub-roi','hub-vault','hub-docs','hub-reports','hub-submissions','hub-sbom','hub-gfp','hub-cdrl','hub-contract','hub-provenance','hub-analytics','hub-team'];\nvar _allHubLabels = {'hub-analysis':'Gap Analysis','hub-dmsms':'DMSMS Tracker','hub-readiness':'Readiness Calc','hub-compliance':'Compliance','hub-risk':'Supply Chain Risk','hub-actions':'Action Items','hub-predictive':'Predictive Maint','hub-lifecycle':'Lifecycle Cost','hub-roi':'ROI Calculator','hub-vault':'Audit Vault','hub-docs':'Document Library','hub-reports':'Report Gen','hub-submissions':'Submissions & PTD','hub-sbom':'SBOM Viewer','hub-gfp':'GFP Tracker','hub-cdrl':'CDRL Validator','hub-contract':'Contract Extractor','hub-provenance':'Provenance Chain','hub-analytics':'Cross-Program Analytics','hub-team':'Team Management'};\n\nvar _currentRole = sessionStorage.getItem('s4_user_role') || '';\nvar _currentTitle = sessionStorage.getItem('s4_user_title') || '';\nvar _customVisibleTabs = JSON.parse(sessionStorage.getItem('s4_visible_tabs') || 'null');\n\nfunction showRoleSelector() {\n    var modal = document.createElement('div');\n    modal.id = 'roleModal';\n    modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:10000;display:flex;align-items:center;justify-content:center;animation:fadeIn 0.3s ease';\n    var html = '<div style=\"background:var(--card);border:1px solid var(--border);border-radius:3px;padding:32px;max-width:620px;width:95%;max-height:85vh;overflow-y:auto\">'\n        + '<h3 style=\"color:#fff;margin:0 0 4px\"><i class=\"fas fa-user-cog\" style=\"color:var(--accent);margin-right:8px\"></i>Configure Your Role</h3>'\n        + '<p style=\"color:var(--steel);font-size:0.85rem;margin-bottom:20px\">Select your role to see relevant tools. You can customize visible tools and your displayed title.</p>'\n        + '<div style=\"margin-bottom:16px\"><label style=\"color:var(--steel);font-size:0.8rem;font-weight:600\">Your Display Title</label><input id=\"roleTitle\" value=\"'+(_currentTitle||'')+'\" style=\"background:#0a0e1a;color:#fff;border:1px solid rgba(255,255,255,0.15);border-radius:3px;padding:10px;width:100%;margin-top:4px\" placeholder=\"e.g., ILS Analyst, Logistics Specialist, Contract Manager\"></div>'\n        + '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px\">';\n    Object.keys(_s4Roles).forEach(function(key) {\n        var r = _s4Roles[key];\n        var sel = _currentRole === key ? 'border-color:var(--accent);background:rgba(0,170,255,0.08)' : '';\n        html += '<div class=\"role-card\" onclick=\"selectRolePreset(\\'' + key + '\\')\" style=\"border:2px solid '+(sel?'var(--accent)':'var(--border)')+';border-radius:3px;padding:14px;cursor:pointer;transition:all 0.2s;'+(sel?'background:rgba(0,170,255,0.08)':'')+'\" data-role=\"'+key+'\">'\n            + '<div style=\"display:flex;align-items:center;gap:8px;margin-bottom:6px\"><i class=\"fas '+r.icon+'\" style=\"color:var(--accent);font-size:1.1rem\"></i><strong style=\"color:#fff;font-size:0.9rem\">'+r.label+'</strong></div>'\n            + '<div style=\"color:var(--steel);font-size:0.78rem\">'+r.desc+'</div>'\n            + '<div style=\"color:var(--muted);font-size:0.72rem;margin-top:4px\">'+r.tabs.length+' tools</div>'\n            + '</div>';\n    });\n    html += '</div>'\n        + '<details style=\"margin-bottom:20px;background:rgba(0,170,255,0.03);border:1px solid rgba(0,170,255,0.12);border-radius:3px;padding:0 16px\"><summary style=\"cursor:pointer;color:var(--accent);font-weight:600;font-size:0.85rem;padding:12px 0;list-style:none;display:flex;align-items:center;gap:8px\"><i class=\"fas fa-sliders-h\"></i> Customize Visible Tools <i class=\"fas fa-chevron-down\" style=\"font-size:0.7rem;margin-left:auto;opacity:0.5\"></i></summary>'\n        + '<div id=\"roleToolChecks\" style=\"display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:0 0 16px\">';\n    _allHubTabs.forEach(function(tab) {\n        var vis = _customVisibleTabs ? _customVisibleTabs.indexOf(tab)>=0 : (_currentRole ? (_s4Roles[_currentRole]?.tabs||[]).indexOf(tab)>=0 : true);\n        html += '<label style=\"display:flex;align-items:center;gap:8px;font-size:0.82rem;color:var(--steel);cursor:pointer;padding:6px 10px;border-radius:3px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);transition:all 0.2s\"><input type=\"checkbox\" data-tab=\"'+tab+'\" '+(vis?'checked':'')+' onchange=\"onRoleToolToggle()\" style=\"accent-color:#00aaff;width:16px;height:16px;flex-shrink:0\"> <span>' + (_allHubLabels[tab]||tab) + '</span></label>';\n    });\n    html += '</div></details>'\n        + '<div style=\"display:flex;gap:10px;justify-content:flex-end\">'\n        + '<button onclick=\"document.getElementById(\\'roleModal\\').remove()\" style=\"background:rgba(255,255,255,0.06);color:var(--steel);border:1px solid var(--border);border-radius:3px;padding:8px 20px;cursor:pointer\">Cancel</button>'\n        + '<button onclick=\"applyRole()\" style=\"background:var(--accent);color:#fff;border:none;border-radius:3px;padding:8px 24px;cursor:pointer;font-weight:600\">Apply Role</button>'\n        + '</div></div>';\n    modal.innerHTML = html;\n    document.body.appendChild(modal);\n}\n\nfunction selectRolePreset(roleKey) {\n    _currentRole = roleKey;\n    document.querySelectorAll('.role-card').forEach(function(c){ c.style.borderColor='var(--border)'; c.style.background=''; });\n    var card = document.querySelector('.role-card[data-role=\"'+roleKey+'\"]');\n    if (card) { card.style.borderColor='var(--accent)'; card.style.background='rgba(0,170,255,0.08)'; }\n    // Update tool checkboxes to match preset\n    var tabs = _s4Roles[roleKey].tabs;\n    document.querySelectorAll('#roleToolChecks input[type=\"checkbox\"]').forEach(function(cb) {\n        cb.checked = tabs.indexOf(cb.dataset.tab) >= 0;\n    });\n    // Auto-fill title if empty\n    var titleEl = document.getElementById('roleTitle');\n    if (titleEl && !titleEl.value) titleEl.value = _s4Roles[roleKey].label;\n}\n\nfunction onRoleToolToggle() {\n    // Mark as custom override\n    _customVisibleTabs = [];\n    document.querySelectorAll('#roleToolChecks input[type=\"checkbox\"]').forEach(function(cb) {\n        if (cb.checked) _customVisibleTabs.push(cb.dataset.tab);\n    });\n}\n\nfunction applyRole() {\n    var title = document.getElementById('roleTitle')?.value?.trim() || '';\n    _currentTitle = title;\n    sessionStorage.setItem('s4_user_role', _currentRole);\n    sessionStorage.setItem('s4_user_title', _currentTitle);\n    // Determine visible tabs\n    var visibleTabs;\n    if (_customVisibleTabs) {\n        visibleTabs = _customVisibleTabs;\n        sessionStorage.setItem('s4_visible_tabs', JSON.stringify(_customVisibleTabs));\n    } else if (_currentRole && _s4Roles[_currentRole]) {\n        visibleTabs = _s4Roles[_currentRole].tabs;\n        sessionStorage.removeItem('s4_visible_tabs');\n    } else {\n        visibleTabs = _allHubTabs;\n    }\n    applyTabVisibility(visibleTabs);\n    updateRoleBadge();\n    // Reload vault for this role so each user sees only their own records\n    if (typeof reloadVaultForRole === 'function') reloadVaultForRole();\n    document.getElementById('roleModal')?.remove();\n    s4Notify('Role Applied', (title || _s4Roles[_currentRole]?.label || 'Custom') + ' — ' + visibleTabs.length + ' tools active', 'success');\n}\n\nfunction applyTabVisibility(visibleTabs) {\n    // Show/hide hub tab buttons based on role\n    document.querySelectorAll('.ils-hub-tab').forEach(function(btn) {\n        var onclick = btn.getAttribute('onclick') || '';\n        var match = onclick.match(/switchHubTab\\('([^']+)'/);\n        if (match) {\n            var panelId = match[1];\n            btn.style.display = visibleTabs.indexOf(panelId) >= 0 ? '' : 'none';\n        }\n    });\n    // Also show/hide tool cards in the ILS tool grid\n    document.querySelectorAll('.ils-tool-card[onclick]').forEach(function(card) {\n        var onclick = card.getAttribute('onclick') || '';\n        var match = onclick.match(/openILSTool\\('([^']+)'/);\n        if (match) {\n            card.style.display = visibleTabs.indexOf(match[1]) >= 0 ? '' : 'none';\n        }\n    });\n}\n\nfunction updateRoleBadge() {\n    var badge = document.getElementById('roleBadge');\n    if (!badge) {\n        // Create role badge next to Live/IL4 badges\n        var container = document.querySelector('.ils-hub-tabs')?.previousElementSibling;\n        if (!container) return;\n        var badgeGroup = container.querySelector('div:last-child');\n        if (!badgeGroup) return;\n        badge = document.createElement('span');\n        badge.id = 'roleBadge';\n        badge.style.cssText = 'display:inline-flex;align-items:center;gap:6px;padding:5px 12px;border-radius:3px;font-size:0.75rem;font-weight:600;background:rgba(0,170,255,0.1);border:1px solid rgba(0,170,255,0.25);color:#00aaff;cursor:pointer;transition:all 0.2s;hover:background:rgba(0,170,255,0.2)';badge.title='Click to change your role';\n        badge.onclick = showRoleSelector;\n        badgeGroup.appendChild(badge);\n    }\n    var icon = _currentRole ? (_s4Roles[_currentRole]?.icon || 'fa-user') : 'fa-user-cog';\n    var label = _currentTitle || (_currentRole ? _s4Roles[_currentRole]?.label : 'Set Role');\n    badge.innerHTML = '<i class=\"fas ' + icon + '\"></i> ' + label + ' <i class=\"fas fa-gear\" style=\"font-size:0.6rem;opacity:0.6\"></i>';\n}\n\n// Initialize role on load\nfunction initRoleSystem() {\n    if (_currentRole) {\n        var visibleTabs = _customVisibleTabs || (_s4Roles[_currentRole] ? _s4Roles[_currentRole].tabs : _allHubTabs);\n        applyTabVisibility(visibleTabs);\n        // Load the vault scoped to this role\n        if (typeof reloadVaultForRole === 'function') reloadVaultForRole();\n    }\n    updateRoleBadge();\n    // Show role selector ONLY when user is inside the platform (not landing page)\n    if (!_currentRole) {\n        setTimeout(function() {\n            // Must have entered platform AND onboarding must be done — check DOM visibility, not sessionStorage\n            var ws = document.getElementById('platformWorkspace');\n            if (ws && ws.style.display === 'block' && sessionStorage.getItem('s4_onboard_done')) {\n                showRoleSelector();\n            }\n        }, 2500);\n    }\n}\n\n(function() {\n    'use strict';\n\n    // ── Utility: format number with commas ──\n    function _bpFmt(n) {\n        return Math.round(n).toString().replace(/\\B(?=(?:\\d{3})+(?!\\d))/g, ',');\n    }\n\n    // ══════════════════════════════════════════════════════\n    // BULLETPROOF ROI CALCULATOR\n    // Programs & records now visibly affect ALL outputs\n    // ══════════════════════════════════════════════════════\n    function _bpCalcROI() {\n        try {\n            var gv = function(id) { var e = document.getElementById(id); return e ? (parseFloat(e.value) || 0) : 0; };\n            var programs  = gv('roiPrograms');\n            var records   = gv('roiRecords');\n            var ftes      = gv('roiFTEs');\n            var rate      = gv('roiRate');\n            var auditCost = gv('roiAudit');\n            var errorCost = gv('roiError');\n            var incidents = gv('roiIncidents');\n            var license   = gv('roiLicense');\n\n            // Volume multiplier — more programs/records = more manual work saved\n            var monthlyRecords = programs * records;\n            var volumeMultiplier = 1 + Math.sqrt(Math.max(0, monthlyRecords)) / 50;\n\n            var annualLaborHours = ftes * 2080;\n            var manualCost = annualLaborHours * rate;\n            var laborSavings = manualCost * 0.65 * volumeMultiplier;\n            var errorSavings = incidents * errorCost * 0.90;\n            var auditSavings = auditCost * 0.70 * Math.max(1, programs / 5);\n            var perRecordSavings = monthlyRecords > 0 ? (laborSavings / 12) / monthlyRecords : 0;\n            var totalAnnualSavings = laborSavings + errorSavings + auditSavings;\n            var netSavings = totalAnnualSavings - license;\n            var roiPct = license > 0 ? ((netSavings / license) * 100) : 0;\n            var paybackMonths = totalAnnualSavings > 0 ? Math.ceil((license / totalAnnualSavings) * 12) : 0;\n            var fiveYearNet = (totalAnnualSavings * 5) - (license * 5);\n\n            var set = function(id, val, color) {\n                var e = document.getElementById(id);\n                if (e) { e.textContent = val; if (color) e.style.color = color; }\n            };\n            set('roiSavings', '$' + _bpFmt(netSavings), netSavings > 0 ? '#00cc66' : '#ff4444');\n            set('roiPercent', roiPct.toFixed(0) + '%', roiPct > 0 ? '#00cc66' : '#ff4444');\n            set('roiPayback', paybackMonths + ' mo', null);\n            set('roi5Year', '$' + _bpFmt(fiveYearNet), fiveYearNet > 0 ? '#00cc66' : '#ff4444');\n\n            var output = document.getElementById('roiOutput');\n            if (output) {\n                output.innerHTML = '<div style=\"background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:20px;margin-top:12px\">'\n                    + '<div class=\"section-label\"><i class=\"fas fa-chart-line\"></i> ROI BREAKDOWN</div>'\n                    + '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:12px;font-size:0.85rem;margin-bottom:16px\">'\n                    + '<div><span style=\"color:var(--steel)\">Labor Automation (65%)</span><br><strong style=\"color:#00cc66\">$' + _bpFmt(laborSavings) + '</strong></div>'\n                    + '<div><span style=\"color:var(--steel)\">Error Reduction (90%)</span><br><strong style=\"color:#00cc66\">$' + _bpFmt(errorSavings) + '</strong></div>'\n                    + '<div><span style=\"color:var(--steel)\">Audit Cost Reduction (70%)</span><br><strong style=\"color:#00cc66\">$' + _bpFmt(auditSavings) + '</strong></div>'\n                    + '<div><span style=\"color:var(--steel)\">S4 Ledger License</span><br><strong style=\"color:#ff6b6b\">-$' + _bpFmt(license) + '</strong></div>'\n                    + '</div>'\n                    + '<hr style=\"border-color:var(--border);margin:12px 0\">'\n                    + '<div style=\"display:flex;justify-content:space-between;align-items:center\">'\n                    + '<div><span style=\"color:var(--steel);font-size:0.82rem\">Net Annual Savings</span><br><span style=\"font-size:1.5rem;font-weight:800;color:' + (netSavings > 0 ? '#00cc66' : '#ff4444') + '\">$' + _bpFmt(netSavings) + '</span></div>'\n                    + '<div><span style=\"color:var(--steel);font-size:0.82rem\">Per-Record Savings</span><br><span style=\"font-size:1.1rem;font-weight:700;color:var(--accent)\">$' + perRecordSavings.toFixed(2) + '/record</span></div>'\n                    + '<div><span style=\"color:var(--steel);font-size:0.82rem\">Volume Multiplier</span><br><span style=\"font-size:1.1rem;font-weight:700;color:var(--accent)\">' + volumeMultiplier.toFixed(2) + 'x</span></div>'\n                    + '</div></div>';\n            }\n\n            // Trigger chart rendering if available\n            try { if (typeof renderROICharts === 'function') renderROICharts(); } catch(e) {}\n        } catch (err) {\n            console.error('[S4-BP-ROI] Error:', err);\n        }\n    }\n\n    // Attach ROI listeners\n    function _bpAttachROI() {\n        var ids = ['roiPrograms','roiRecords','roiFTEs','roiRate','roiAudit','roiError','roiIncidents','roiLicense'];\n        var n = 0;\n        ids.forEach(function(id) {\n            var el = document.getElementById(id);\n            if (el) {\n                el.removeAttribute('oninput');\n                el.addEventListener('input', _bpCalcROI);\n                n++;\n            }\n        });\n        if (n > 0) { _bpCalcROI(); }\n        return n;\n    }\n\n    // ══════════════════════════════════════════════════════\n    // BULLETPROOF CHART RENDERING\n    // Calls injectChartContainers() from block 4 first,\n    // then renders charts into the injected canvases.\n    // ══════════════════════════════════════════════════════\n    // ── Helper: pull live data from tool state ──\n    function _getToolState() {\n        var s = {};\n        // ILS checklist scores\n        try {\n            var checks = document.querySelectorAll('#ilsCoverage input[type=\"checkbox\"], .ils-checklist input[type=\"checkbox\"]');\n            var done = 0, total = checks.length || 1;\n            checks.forEach(function(c){ if(c.checked) done++; });\n            s.ilsPct = Math.round((done / total) * 100);\n        } catch(e) { s.ilsPct = 0; }\n        // Compliance scores from bars\n        var compIds = ['pctCMMC','pctNIST','pctDFARS','pctFAR','pctILS','pctDMSMSmgmt'];\n        s.comp = compIds.map(function(id){ var e=document.getElementById(id); return e ? (parseInt(e.textContent)||0) : 0; });\n        // Vault records\n        s.vault = (typeof s4Vault !== 'undefined') ? s4Vault.length : (typeof getLocalRecords === 'function' ? getLocalRecords().length : 0);\n        // Action items\n        s.actions = (typeof s4ActionItems !== 'undefined') ? s4ActionItems.length : 0;\n        s.actionsDone = 0;\n        if (typeof s4ActionItems !== 'undefined') s4ActionItems.forEach(function(a){ if(a.status==='done') s.actionsDone++; });\n        // ROI values\n        var gv = function(id){ var e=document.getElementById(id); return e?(parseFloat(e.value)||0):0; };\n        s.roiPrograms = gv('roiPrograms');\n        s.roiRecords = gv('roiRecords');\n        s.roiFTEs = gv('roiFTEs');\n        s.roiRate = gv('roiRate');\n        s.roiLicense = gv('roiLicense');\n        s.roiAudit = gv('roiAudit');\n        // Stats\n        s.stats = (typeof stats !== 'undefined') ? stats : {anchored:0,slsFees:0};\n        // DMSMS\n        s.dmsmsItems = (typeof dmsmsItems !== 'undefined') ? dmsmsItems : [];\n        // Risk\n        s.riskItems = (typeof riskItems !== 'undefined') ? riskItems : [];\n        return s;\n    }\n\n    var _chartConfigs = {\n        gapRadarChart: function() {\n            var s = _getToolState();\n            var tracking = Math.min(100, 20 + s.vault * 3);\n            var audit = Math.min(100, 15 + s.vault * 4);\n            var compliance = Math.min(100, s.comp[0] || 10);\n            var obsol = Math.min(100, 10 + (s.dmsmsItems.length || 0) * 8);\n            var risk = Math.min(100, 15 + (s.riskItems.length || 0) * 5);\n            var budget = Math.min(100, 20 + s.ilsPct * 0.6);\n            var withS4 = [tracking,audit,compliance,obsol,risk,budget].map(function(v){ return Math.min(100, v + 30 + Math.random()*5|0); });\n            return { type:'radar', data:{ labels:['Tracking','Audit','Compliance','Obsolescence','Risk','Budget'], datasets:[{label:'Current (Manual)',data:[tracking,audit,compliance,obsol,risk,budget],borderColor:'#ff6b6b',backgroundColor:'rgba(255,107,107,0.1)',pointBackgroundColor:'#ff6b6b'},{label:'With S4 Ledger',data:withS4,borderColor:'#00aaff',backgroundColor:'rgba(0,170,255,0.1)',pointBackgroundColor:'#00aaff'}]}, options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:'#8ea4b8',font:{size:10}}}},scales:{r:{grid:{color:'rgba(255,255,255,0.06)'},angleLines:{color:'rgba(255,255,255,0.06)'},pointLabels:{color:'#8ea4b8',font:{size:9}},ticks:{display:false}}}}};\n        },\n        gapBarChart: function() {\n            var s = _getToolState();\n            var tracking = Math.max(0, 100 - (20 + s.vault * 3));\n            var audit = Math.max(0, 100 - (15 + s.vault * 4));\n            var compliance = Math.max(0, 100 - (s.comp[0] || 10));\n            var obsol = Math.max(0, 100 - (10 + (s.dmsmsItems.length||0)*8));\n            var risk = Math.max(0, 100 - (15 + (s.riskItems.length||0)*5));\n            var budget = Math.max(0, 100 - (20 + s.ilsPct * 0.6));\n            return { type:'bar', data:{ labels:['Tracking','Audit','Compliance','Obsolescence','Risk','Budget'], datasets:[{label:'Gap %',data:[tracking,audit,compliance,obsol,risk,budget],backgroundColor:['#ff6b6b','#fb923c','#c9a84c','#00aaff','#38bdf8','#06b6d4'],borderWidth:0,borderRadius:4}]}, options:{responsive:true,maintainAspectRatio:false,indexAxis:'y',plugins:{legend:{display:false}},scales:{x:{ticks:{color:'#6b7d93',font:{size:9}},grid:{color:'rgba(255,255,255,0.04)'},max:100},y:{ticks:{color:'#8ea4b8',font:{size:9}},grid:{display:false}}}}};\n        },\n        dmsmsPieChart: function() {\n            var s = _getToolState();\n            var items = s.dmsmsItems;\n            var active=0,atRisk=0,obsolete=0,discontinued=0,eol=0;\n            if (items.length > 0) {\n                items.forEach(function(it){ var st=(it.status||'').toLowerCase(); if(st.indexOf('obsolete')>=0) obsolete++; else if(st.indexOf('risk')>=0||st.indexOf('diminish')>=0) atRisk++; else if(st.indexOf('discontin')>=0) discontinued++; else if(st.indexOf('eol')>=0||st.indexOf('last')>=0) eol++; else active++; });\n            } else { active=45; atRisk=20; obsolete=15; discontinued=10; eol=10; }\n            return { type:'doughnut', data:{ labels:['Active','At Risk','Obsolete','Discontinued','EOL Planned'], datasets:[{data:[active,atRisk,obsolete,discontinued,eol],backgroundColor:['#00aaff','#c9a84c','#ff6b6b','#00aaff','#6b7d93'],borderWidth:0}]}, options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{color:'#8ea4b8',font:{size:9},padding:6}}}}};\n        },\n        readinessGauge: function() {\n            var s = _getToolState();\n            var base = Math.max(30, s.ilsPct);\n            var personnel = Math.min(100, base + 15 + (s.vault > 5 ? 10 : 0));\n            var equipment = Math.min(100, base + (s.dmsmsItems.length > 0 ? -5 : 8));\n            var supply = Math.min(100, base - 12 + s.vault * 2);\n            var training = Math.min(100, base + 20);\n            var maintenance = Math.min(100, base + 6 + (s.actionsDone * 3));\n            var c4isr = Math.min(100, base + 12);\n            return { type:'bar', data:{ labels:['Personnel','Equipment','Supply','Training','Maintenance','C4ISR'], datasets:[{label:'Readiness %',data:[personnel,equipment,supply,training,maintenance,c4isr],backgroundColor:'rgba(0,170,255,0.6)',borderColor:'#00aaff',borderWidth:1,borderRadius:4}]}, options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{ticks:{color:'#8ea4b8',font:{size:9}},grid:{display:false}},y:{ticks:{color:'#6b7d93',font:{size:9}},grid:{color:'rgba(255,255,255,0.04)'},beginAtZero:true,max:100}}}};\n        },\n        complianceRadarChart: function() {\n            var s = _getToolState();\n            var dfars = s.comp[2] || 30;\n            var itar = Math.min(100, 40 + s.vault * 4);\n            var nist = s.comp[1] || 25;\n            var cmmc = s.comp[0] || 20;\n            var iso = Math.min(100, 30 + s.ilsPct * 0.5);\n            var sox = Math.min(100, 35 + s.vault * 3);\n            return { type:'polarArea', data:{ labels:['DFARS','ITAR','NIST 800-171','CMMC','ISO 27001','SOX'], datasets:[{data:[dfars,itar,nist,cmmc,iso,sox],backgroundColor:['rgba(0,170,255,0.5)','rgba(201,168,76,0.5)','rgba(56,189,248,0.5)','rgba(255,107,107,0.5)','rgba(0,170,255,0.5)','rgba(6,182,212,0.5)'],borderWidth:0}]}, options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{color:'#8ea4b8',font:{size:9},padding:6}}},scales:{r:{grid:{color:'rgba(255,255,255,0.06)'},ticks:{display:false}}}}};\n        },\n        roiLineChart: function() {\n            var s = _getToolState();\n            var monthlyRecords = s.roiPrograms * s.roiRecords;\n            var volMult = 1 + Math.sqrt(Math.max(0, monthlyRecords)) / 50;\n            var annualLabor = s.roiFTEs * 2080 * s.roiRate;\n            var laborSave = annualLabor * 0.65 * volMult;\n            var auditSave = s.roiAudit * 0.70 * Math.max(1, s.roiPrograms / 5);\n            var totalAnnual = laborSave + auditSave;\n            var license = s.roiLicense || 1;\n            // Build 20 quarters (5 full years) with realistic adoption ramp\n            var labels = []; var data = [];\n            var hasInput = (s.roiPrograms > 0 || s.roiFTEs > 0 || s.roiLicense > 0);\n            if (hasInput) {\n                var cumNet = 0;\n                for (var y = 1; y <= 5; y++) { for (var q = 1; q <= 4; q++) { labels.push('Y'+y+'-Q'+q); var qtr = (y-1)*4+q; var adoptRate = 0.20 + 0.65 * (1 - Math.exp(-0.18 * qtr)); var qtrlySavings = (totalAnnual / 4) * adoptRate; var qtrlyLicense = license / 4; cumNet += (qtrlySavings - qtrlyLicense); var roiPct = license > 0 ? ((cumNet / license) * 100) : 0; data.push(Math.round(roiPct)); }}\n            }\n            // Always use the visually appealing default curve when no real inputs\n            if (!hasInput || data.length === 0 || data.every(function(v){return v===0;})) {\n                labels = []; data = [];\n                for (var y2 = 1; y2 <= 5; y2++) { for (var q2 = 1; q2 <= 4; q2++) {\n                    labels.push('Y'+y2+'-Q'+q2);\n                    var qtr = (y2-1)*4+q2;\n                    // Exponential growth curve: starts negative, crosses zero ~Q5, grows to ~350%\n                    data.push(Math.round(-15 + 3.5 * qtr + 0.8 * Math.pow(qtr, 1.45)));\n                }}\n            }\n            return { type:'line', data:{ labels:labels, datasets:[{label:'Cumulative ROI %',data:data,borderColor:'#00cc66',backgroundColor:'rgba(0,204,102,0.1)',fill:true,tension:0.3,pointRadius:2,pointBackgroundColor:'#00cc66'}]}, options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},title:{display:true,text:'5-Year Cumulative ROI',color:'#8ea4b8',font:{size:11}}},scales:{x:{ticks:{color:'#8ea4b8',font:{size:8},maxRotation:45},grid:{display:false}},y:{ticks:{color:'#6b7d93',font:{size:9},callback:function(v){return v+'%'}},grid:{color:'rgba(255,255,255,0.04)'},beginAtZero:true}}}};\n        },\n        riskHeatChart: function() {\n            var s = _getToolState();\n            var points = [];\n            if (s.riskItems.length > 0) {\n                s.riskItems.forEach(function(r){ points.push({x: r.likelihood||Math.ceil(Math.random()*9), y: r.impact||Math.ceil(Math.random()*9)}); });\n            } else {\n                // Generate from workspace state\n                var nRisks = Math.max(3, Math.min(12, 3 + s.vault + s.actions));\n                for (var i=0; i<nRisks; i++) { points.push({x: 1+Math.floor(Math.random()*9), y: 1+Math.floor(Math.random()*9)}); }\n            }\n            var colors = points.map(function(p){ var score=p.x*p.y; return score>=50?'rgba(255,70,70,0.8)':score>=25?'rgba(255,165,0,0.7)':score>=10?'rgba(201,168,76,0.6)':'rgba(0,170,255,0.5)'; });\n            return { type:'scatter', data:{ datasets:[{label:'Risk Items',data:points,backgroundColor:colors,borderColor:colors,pointRadius:7}]}, options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},title:{display:true,text:points.length+' Risk Items Mapped',color:'#8ea4b8',font:{size:11}}},scales:{x:{title:{display:true,text:'Likelihood →',color:'#8ea4b8',font:{size:9}},ticks:{color:'#6b7d93',font:{size:9}},grid:{color:'rgba(255,255,255,0.04)'},min:0,max:10},y:{title:{display:true,text:'Impact →',color:'#8ea4b8',font:{size:9}},ticks:{color:'#6b7d93',font:{size:9}},grid:{color:'rgba(255,255,255,0.04)'},min:0,max:10}}}};\n        },\n        lifecyclePieChart: function() {\n            var s = _getToolState();\n            // Adjust curves based on DMSMS alerts and ILS completeness\n            var dmsmsRisk = Math.min(30, (s.dmsmsItems.length || 0) * 5);\n            var ilsBoost = Math.min(15, s.ilsPct * 0.15);\n            return { type:'line', data:{ labels:['Intro','Growth','Maturity','Sustain','Phase Out','Disposal'], datasets:[{label:'Availability %',data:[95-dmsmsRisk*0.1, 92-dmsmsRisk*0.2+ilsBoost, 88-dmsmsRisk*0.4+ilsBoost, 75-dmsmsRisk*0.6+ilsBoost*2, 50-dmsmsRisk*0.3+ilsBoost, 20+ilsBoost*0.5].map(function(v){return Math.round(Math.max(5,Math.min(100,v)));}),borderColor:'#00aaff',backgroundColor:'rgba(0,170,255,0.1)',fill:true,tension:0.3},{label:'Cost Index',data:[30,25+dmsmsRisk*0.3,35+dmsmsRisk*0.5,55+dmsmsRisk*0.8-ilsBoost,70+dmsmsRisk-ilsBoost*2,90+dmsmsRisk*0.5-ilsBoost].map(function(v){return Math.round(Math.max(5,Math.min(100,v)));}),borderColor:'#ff6b6b',backgroundColor:'rgba(255,107,107,0.05)',fill:true,tension:0.3}]}, options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:'#8ea4b8',font:{size:10}}}},scales:{x:{ticks:{color:'#8ea4b8',font:{size:9}},grid:{display:false}},y:{ticks:{color:'#6b7d93',font:{size:9}},grid:{color:'rgba(255,255,255,0.04)'},beginAtZero:true}}}};\n        }\n    };\n\n    window._bpRenderInPanel = _bpRenderInPanel;\n    function _bpRenderInPanel(panel) {\n        if (typeof Chart === 'undefined') {\n            console.warn('[S4-BP-Charts] Chart.js not loaded');\n            return;\n        }\n        // CRITICAL: Inject chart containers first (the hook from block 4 never fires\n        // because block 5's function declaration overwrites it).\n        if (typeof injectChartContainers === 'function') {\n            try { injectChartContainers(); } catch(e) { console.error('[S4-BP-Charts] injectChartContainers error:', e); }\n        }\n        // Now render charts in this panel\n        var canvases = panel.querySelectorAll('canvas');\n        if (canvases.length === 0) {\n            console.log('[S4-BP-Charts] No canvases found in panel ' + panel.id);\n            return;\n        }\n        canvases.forEach(function(canvas) {\n            if (canvas.getAttribute('data-bp-rendered')) return;\n            var cfg = _chartConfigs[canvas.id];\n            if (!cfg) {\n                console.log('[S4-BP-Charts] No config for canvas: ' + canvas.id);\n                return;\n            }\n            try {\n                var existing = Chart.getChart(canvas);\n                if (existing) existing.destroy();\n                // Ensure canvas has size\n                if (!canvas.style.height && !canvas.getAttribute('height')) {\n                    canvas.style.height = '220px';\n                }\n                canvas.style.width = '100%';\n                canvas.style.display = 'block';\n                // Show parent container\n                var container = canvas.closest('.chart-container');\n                if (container) {\n                    container.style.display = 'block';\n                    container.style.visibility = 'visible';\n                }\n                new Chart(canvas, cfg());\n                canvas.setAttribute('data-bp-rendered', '1');\n                canvas.setAttribute('data-bp-ts', Date.now());\n                console.log('[S4-BP-Charts] Rendered: ' + canvas.id);\n            } catch(err) {\n                console.error('[S4-BP-Charts] Failed ' + canvas.id + ':', err);\n            }\n        });\n    }\n\n    // ══════════════════════════════════════════════════════\n    // INITIALIZATION — single clean init\n    // ══════════════════════════════════════════════════════\n    function _bpInit() {\n        console.log('[S4-Bulletproof-v5] Initializing...');\n\n        // 1) Attach ROI listeners (retry if inputs not in DOM yet)\n        if (_bpAttachROI() === 0) {\n            setTimeout(_bpAttachROI, 2000);\n            setTimeout(_bpAttachROI, 5000);\n        }\n\n        // 2) Override global calcROI\n        window.calcROI = _bpCalcROI;\n\n        // 3) Hook openILSTool to inject charts + render\n        if (typeof window.openILSTool === 'function') {\n            var _prev = window.openILSTool;\n            window.openILSTool = function(toolId) {\n                _prev(toolId);\n                // Inject + render at multiple timings for reliability\n                setTimeout(function() {\n                    var panel = document.getElementById(toolId);\n                    if (panel) _bpRenderInPanel(panel);\n                }, 300);\n                setTimeout(function() {\n                    var panel = document.getElementById(toolId);\n                    if (panel) _bpRenderInPanel(panel);\n                }, 800);\n                setTimeout(function() {\n                    var panel = document.getElementById(toolId);\n                    if (panel) _bpRenderInPanel(panel);\n                }, 2000);\n            };\n            console.log('[S4-Bulletproof-v5] Hooked openILSTool');\n        }\n\n        // 4) Also hook switchHubTab\n        if (typeof window.switchHubTab === 'function') {\n            var _prevSwitch = window.switchHubTab;\n            window.switchHubTab = function(panelId, btn) {\n                _prevSwitch(panelId, btn);\n                setTimeout(function() {\n                    var panel = document.getElementById(panelId);\n                    if (panel) _bpRenderInPanel(panel);\n                }, 400);\n            };\n        }\n\n        // 5) MutationObserver for panels becoming visible\n        document.querySelectorAll('.ils-hub-panel').forEach(function(panel) {\n            var obs = new MutationObserver(function(muts) {\n                muts.forEach(function(m) {\n                    if (m.target.classList && m.target.classList.contains('active')) {\n                        setTimeout(function() { _bpRenderInPanel(m.target); }, 400);\n                    }\n                });\n            });\n            obs.observe(panel, { attributes: true, attributeFilter: ['class', 'style'] });\n        });\n\n        // 6) Also render charts in any currently-active panel\n        setTimeout(function() {\n            document.querySelectorAll('.ils-hub-panel.active').forEach(function(p) {\n                _bpRenderInPanel(p);\n            });\n        }, 2000);\n\n        // 7) Auto-load metrics on session start\n        setTimeout(function() {\n            if (typeof loadPerformanceMetrics === 'function') {\n                try { loadPerformanceMetrics(); } catch(e) {}\n            }\n        }, 1500);\n\n        // 8) Safety net: re-attach ROI listeners\n        setTimeout(_bpAttachROI, 3000);\n\n        // 9) Initialize role-based access\n        if (typeof initRoleSystem === 'function') initRoleSystem();\n\n        console.log('[S4-Bulletproof-v5] Init complete');\n    }\n\n\n    // ── Global chart refresh: call after any tool data changes ──\n    window._s4RefreshCharts = function() {\n        document.querySelectorAll('canvas[data-bp-rendered]').forEach(function(c) {\n            c.removeAttribute('data-bp-rendered');\n        });\n        var activePanel = document.querySelector('.ils-hub-panel.active');\n        if (activePanel) _bpRenderInPanel(activePanel);\n    };\n    // Start when DOM is ready\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', _bpInit);\n    } else {\n        _bpInit();\n    }\n})();\n\n// === Window exports for inline event handlers ===\nwindow.applyRole = applyRole;\nwindow.onRoleToolToggle = onRoleToolToggle;\nwindow.selectRolePreset = selectRolePreset;\n"],"names":["name","mod","value","endpoint","ms","list","entries","e","nav","error","entry","batch","_originalFetch","url","options","start","urlStr","token","csrf","response","checks","v","loc","key","cat","_errorQueue","_errorFlushTimer","_reportErrors","sid","msg","source","line","col","_sanitizeDiv","str","html","temp","scripts","i","all","j","attrs","k","_sessionTimeout","_sessionWarnTimeout","_sessionTimer","_sessionWarnTimer","_sessionLocked","_resetSessionTimer","overlay","evt","_encKey","stored","raw","c","exported","plaintext","iv","data","encrypted","combined","ciphertext","decrypted","record","previousHash","payload","buf","b","vault","errors","prevHash","expected","_rateLimits","maxPerMinute","now","t","_token","_generate","arr","headers","recordHash","exists","r","proof","nonce","proofData","scroll","height","bar","btn","revealObserver","el","loadWalletData","walletData","noWallet","creds","explorerBase","fetchWalletBalance","address","toggleSeed","masked","revealed","copyWalletField","id","text","orig","setSLSAmount","usd","updateSLSPreview","slsTokens","handleBuySLS","resultEl","setChartRange","range","ws","_onboardStep","_onboardTier","_onboardTiers","showOnboarding","updateOnboardStep","closeOnboarding","onboardNext","animateAccountCreation","animateWalletFunding","step","dots","dot","idx","statusEl","acctIdEl","doneEl","addrEl","xrpEl","trustEl","chars","addr","selectOnboardTier","tier","info","balEl","anchorsEl","mainBal","toolBal","sidebarBal","_metricsChartTimes","_metricsChartTypes","loadPerformanceMetrics","localAnchors","localRecords","localTypes","label","res","val","vaultRecords","totalRecords","storageKB","timeCtx","times","_","typesCtx","types","reqEl","methodColor","vaultRecords2","totalRecords2","storageKB2","sessionRequests","localRecs","recentRecs","ri","rec","ago","agoStr","baselineRequests","allRequests","refreshOfflineQueue","metricsTab","syncSessionToTools","s","spent","tierAlloc","bal","anchEl","spentEl","tierAllocTool","toolAnch","toolSpent","items","open","badge","OFFLINE_QUEUE_KEY","OFFLINE_SYNC_KEY","OFFLINE_QUEUE_ENCRYPTED_KEY","_offlineCryptoKey","_getOfflineCryptoKey","seed","enc","keyMaterial","_encryptQueue","getOfflineQueue","encStr","_offlineQueueCache","_saveEncryptedQueue","queue","saveOfflineQueue","refreshOfflineQueueUI","countEl","listEl","syncEl","ls","on","item","lc","offlineQueueHash","existingHashes","q","unqueued","_showNotif","testData","encoder","hash","offlineRemoveItem","index","offlineClearQueue","offlineSyncAll","offlineSyncWithBackoff","_syncRetryCount","_syncMaxRetries","_syncBaseDelay","attempt","pending","_origFetch","delay","opts","isAnchorRoute","body","type","old","d","colors","handleFileSelect","files","processUploadedFile","file","nameEl","binaryReader","ev","textReader","renderGapAnalysisCharts","radarCanvas","barCanvas","chartsRow","labels","scores","l","barColors","renderDMSMSCharts","canvas","a","renderReadinessCharts","ao","parsed","base","personnel","equipment","supply","training","maintenance","c4isr","ctx","renderComplianceCharts","renderROICharts","panel","existing","ftes","rate","auditCost","errorCost","incidents","license","laborSavings","errorSavings","auditSavings","baseSavings","cumulative","years","adoptionRate","qtrlySavings","qtrlyLicense","prev","renderRiskCharts","renderLifecycleCharts","injectChartContainers","panels","panelId","conf","firstCanvasId","card","target","wrapper","_origOpenILSTool","toolId","_origSwitchHubTab","_origShowILSResults","calcLifecycle","progKey","serviceLife","opHours","acqCostM","fleetSize","sustRate","acqTotal","annualSust","sustTotal","dmsmsFactor","dmsmsCost","disposalCost","personnelCost","trainingCost","totalCost","totalOpHours","costPerHour","fmtM","acqPct","sustPct","dmsmsPct","disposalPct","personnelPct","trainingPct","output","platName","exportLifecycle","report","blob","anchorLifecycle","result","transformPanel","cards","h","sib","header","isAnchor","isExport","isRunAction","isDanger","div","btns","firstLabel","divider","hr","resultDiv","divider2","hr2","actionBar","divider3","firstCard","twoCol","allDirectRows","statRow","row","insertAfter","leftCol","innerCard","statsInActions","rows","h3a","chartAreas","gapChartsRow","_prevOpen2","_prevSwitch2","p","ilsTabLink","_calYear","_calMonth","changeCalMonth","delta","renderActionCalendar","grid","_now","months","firstDay","daysInMonth","today","isCurrentMonth","actionDates","dueStr","day","isToday","hasActions","bg","border","showCalDay","detail","dy","renderActionCalendarSafe","_actionsObserver","mutations","m","actionsPanel","ap","_currentILSTool","showHub","sh","ilsBackBar","ilsSubHub","hubTabs","hub","sr","hero","landing","showSection","sectionId","tabMap","tabId","pane","tabLink","subHub","toolBack","showSystemsSub","openILSTool","tabBtn","det","h3","showHIWModal","title","bodyContent","storageKey","visited","existingBtn","qBtn","closeILSTool","vis","STORAGE_KEY","getHub","restoreOrder","saved","order","map","saveOrder","setupDrag","dragSrc","allCards","fromIdx","toIdx","touchTimer","touchDragging","touchClone","touchSrc","self","touch","elem","openWalletSidebar","sidebar","walletPane","_rewireWalletFlowDetails","updateWalletTrigger","sidebarBody","flowBtn","flowPanel","slsBar","_sidebarFlowShown","closeWalletSidebar","trigger","updateActionBadge","openItems","_origShowSec2","syncToolSls","mainAnch","mainSpent","_origOpen3","_origHideAnchor","lastRec","banner","_s4Roles","_allHubTabs","_allHubLabels","_currentRole","_currentTitle","_customVisibleTabs","showRoleSelector","modal","sel","tab","selectRolePreset","roleKey","tabs","cb","titleEl","onRoleToolToggle","applyRole","visibleTabs","applyTabVisibility","updateRoleBadge","onclick","match","container","badgeGroup","icon","initRoleSystem","_bpFmt","_bpCalcROI","gv","programs","records","monthlyRecords","volumeMultiplier","annualLaborHours","manualCost","perRecordSavings","totalAnnualSavings","netSavings","roiPct","paybackMonths","fiveYearNet","set","color","err","_bpAttachROI","ids","n","_getToolState","done","total","compIds","_chartConfigs","tracking","audit","compliance","obsol","risk","budget","withS4","active","atRisk","obsolete","discontinued","eol","it","st","dfars","itar","nist","cmmc","iso","sox","volMult","annualLabor","laborSave","auditSave","totalAnnual","hasInput","cumNet","y","qtr","adoptRate","y2","q2","points","nRisks","score","dmsmsRisk","ilsBoost","_bpRenderInPanel","canvases","cfg","_bpInit","_prev","_prevSwitch","obs","muts","activePanel"],"mappings":"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"}