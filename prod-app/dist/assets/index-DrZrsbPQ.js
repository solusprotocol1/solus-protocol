import"./engine-PXq-qvQq.js";import"./enhancements-g1GvesQV.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function a(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(o){if(o.ep)return;o.ep=!0;const c=a(o);fetch(o.href,c)}})();window.supabase&&(window._sbClient=window.supabase.createClient("https://ysmwkkdpjgjokukxolel.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlzbXdra2Rwamdqb2t1a3hvbGVsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwMzA3NDQsImV4cCI6MjA4NzYwNjc0NH0.4u56RJ61Q5cqnqMqIEWwg50q6MlV8bEvueA45enQgxE"));document.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()},!1);document.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation()},!1);window.S4=window.S4||{version:"5.12.0",env:"production",buildDate:"2026-02-26",modules:{},register:function(e,t){this.modules[e]=t},getModule:function(e){return this.modules[e]||null}};(function(){S4.metrics={_data:{lcp:null,fid:null,cls:0,ttfb:null,fcp:null,errors:[],apiLatency:[]},_startTime:performance.now(),record:function(t,a){this._data[t]=a},addApiLatency:function(t,a){this._data.apiLatency.push({endpoint:t,ms:a,ts:Date.now()}),this._data.apiLatency.length>200&&this._data.apiLatency.shift()},getReport:function(){return Object.assign({},this._data,{uptime:Math.round((performance.now()-this._startTime)/1e3),memoryMB:performance.memory?Math.round(performance.memory.usedJSHeapSize/1048576):null,version:S4.version,env:S4.env,timestamp:new Date().toISOString()})}};try{typeof PerformanceObserver<"u"&&(new PerformanceObserver(function(t){var a=t.getEntries();a.length>0&&S4.metrics.record("lcp",Math.round(a[a.length-1].startTime))}).observe({type:"largest-contentful-paint",buffered:!0}),new PerformanceObserver(function(t){var a=t.getEntries();a.length>0&&S4.metrics.record("fid",Math.round(a[0].processingStart-a[0].startTime))}).observe({type:"first-input",buffered:!0}),new PerformanceObserver(function(t){var a=t.getEntries();a.forEach(function(r){r.hadRecentInput||(S4.metrics._data.cls+=r.value)}),S4.metrics._data.cls=Math.round(S4.metrics._data.cls*1e3)/1e3}).observe({type:"layout-shift",buffered:!0}),new PerformanceObserver(function(t){var a=t.getEntries();a.forEach(function(r){r.name==="first-contentful-paint"&&S4.metrics.record("fcp",Math.round(r.startTime))})}).observe({type:"paint",buffered:!0}))}catch{}window.addEventListener("load",function(){try{var t=performance.getEntriesByType("navigation")[0];t&&S4.metrics.record("ttfb",Math.round(t.responseStart-t.requestStart))}catch{}}),S4.errorReporter={_queue:[],_maxQueue:50,report:function(t){var a={message:typeof t=="string"?t:t.message||"Unknown error",stack:t.stack||null,url:window.location.href,timestamp:new Date().toISOString(),version:S4.version,userAgent:navigator.userAgent.substring(0,200)};this._queue.push(a),this._queue.length>this._maxQueue&&this._queue.shift(),console.error("[S4 Error]",a.message)},flush:async function(){if(this._queue.length!==0){var t=this._queue.splice(0);try{await fetch("/api/errors/report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({errors:t,session:sessionStorage.getItem("s4_session_id")||"unknown"})})}catch{this._queue=t.concat(this._queue)}}}},setInterval(function(){S4.errorReporter.flush()},6e4),window.addEventListener("beforeunload",function(){S4.errorReporter.flush()});var e=window.fetch;window.fetch=function(t,a){var r=performance.now(),o=typeof t=="string"?t:t.url||"";if(o.startsWith("/api/")&&(a=a||{},a.headers=a.headers||{},typeof a.headers.set!="function")){var c=sessionStorage.getItem("s4_auth_token");c&&(a.headers.Authorization="Bearer "+c);var f=S4.csrf?S4.csrf.getToken():null;f&&(a.headers["X-CSRF-Token"]=f),a.headers["X-S4-Version"]=S4.version,a.headers["X-S4-Client"]="web-prod"}return e.call(window,t,a).then(function(n){return o.startsWith("/api/")&&S4.metrics.addApiLatency(o.split("?")[0],Math.round(performance.now()-r)),n}).catch(function(n){throw o.startsWith("/api/")&&S4.metrics.addApiLatency(o.split("?")[0],-1),n})},S4.healthCheck=function(){var t={serviceWorker:"serviceWorker"in navigator,crypto:typeof crypto<"u"&&typeof crypto.subtle<"u",indexedDB:typeof indexedDB<"u",localStorage:(function(){try{return localStorage.setItem("_hc","1"),localStorage.removeItem("_hc"),!0}catch{return!1}})(),webSocket:typeof WebSocket<"u",fetchAPI:typeof fetch<"u",webCrypto:typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof crypto.subtle.digest=="function",performance:typeof PerformanceObserver<"u"};return t.allPassing=Object.values(t).every(function(a){return a===!0}),t},S4.register("monitoring",{version:"1.0.0",features:["web-vitals","error-reporter","api-interceptor","health-check"]}),console.log("[S4 Production] Monitoring module loaded — v"+S4.version+" ("+S4.env+")")})();S4.i18n={locale:(navigator.language||"en").split("-")[0],catalogs:{en:{"app.name":"S4 Ledger","nav.platform":"Platform","nav.useCases":"Use Cases","nav.pricing":"Pricing","nav.company":"Company","nav.docs":"Docs","nav.contact":"Contact Us","anchor.title":"Anchor Channel","anchor.placeholder":"Or paste/type your defense logistics record here...","anchor.button":"Anchor Record","verify.title":"Verify Channel","verify.placeholder":"Paste the original defense record content here...","vault.title":"Audit Record Vault","vault.empty":"No anchored records yet. Records will appear here automatically as you anchor them.","vault.search":"Search records by type, hash, content...","vault.exportCSV":"Export CSV","vault.exportXLSX":"Export XLSX","vault.reverifyAll":"Re-Verify All","vault.clear":"Clear Vault","toast.missingContent":"Please enter record content.","toast.noProgram":"Please select a program first.","toast.noAnalysis":"Run analysis first.","toast.copied":"Copied to clipboard!","toast.exported":"records exported.","toast.verified":"records re-verified.","shortcuts.title":"Keyboard Shortcuts","search.placeholder":"Search records, vault, tools, documents...","search.noResults":"No results found"}},setLocale:function(e){this.locale=e},t:function(e){var t=this.catalogs[this.locale]||this.catalogs.en;return t[e]||this.catalogs.en[e]||e}};window.S4.t=S4.i18n.t.bind(S4.i18n);var $=[],j=null;function le(){if($.length!==0){var e=$.splice(0,20);try{var t=localStorage.getItem("s4_session_id")||"unknown";navigator.sendBeacon("/api/errors/report",JSON.stringify({session_id:t,errors:e}))}catch{}}}window.onerror=function(e,t,a,r,o){return console.error("[S4 Error]",e,"at",t,a+":"+r),$.push({type:"js",msg:String(e).substring(0,500),source:t,line:a,col:r,ts:Date.now()}),clearTimeout(j),j=setTimeout(le,5e3),!0};window.addEventListener("unhandledrejection",function(e){console.warn("[S4 Unhandled Promise]",e.reason),$.push({type:"promise",msg:String(e.reason).substring(0,500),ts:Date.now()}),clearTimeout(j),j=setTimeout(le,5e3)});window.addEventListener("error",function(e){e.target&&e.target!==window&&(console.warn("[S4 Resource Error]",e.target.tagName,e.target.src||e.target.href),$.push({type:"resource",tag:e.target.tagName,url:(e.target.src||e.target.href||"").substring(0,300),ts:Date.now()}),clearTimeout(j),j=setTimeout(le,5e3))},!0);(function(){var e=document.createElement("div");S4.sanitize=function(i){return typeof i!="string"?"":(e.textContent=i,e.innerHTML)},S4.sanitizeHTML=function(i){if(typeof i!="string")return"";var u=document.createElement("div");u.innerHTML=i;for(var s=u.querySelectorAll("script,iframe,object,embed,form"),l=s.length-1;l>=0;l--)s[l].remove();for(var m=u.querySelectorAll("*"),p=0;p<m.length;p++)for(var h=m[p].attributes,v=h.length-1;v>=0;v--)(h[v].name.startsWith("on")||h[v].value.indexOf("javascript:")===0)&&m[p].removeAttribute(h[v].name);return u.innerHTML};var t=1800*1e3,a=1680*1e3,r=null,o=null,c=!1;S4.sessionTimeout=t;function f(){c||(clearTimeout(r),clearTimeout(o),o=setTimeout(function(){!c&&typeof s4Notify=="function"&&s4Notify("Session Expiring","Your session will lock in 2 minutes due to inactivity. Move your mouse or press a key to stay active.","warning")},a),r=setTimeout(function(){c=!0,S4.sessionLocked=!0;var i=document.getElementById("s4SessionLockOverlay");i&&(i.style.display="flex"),typeof s4Notify=="function"&&s4Notify("Session Locked","Inactive for 30 minutes. Click to resume.","warning")},t))}S4.resumeSession=function(){c=!1,S4.sessionLocked=!1;var i=document.getElementById("s4SessionLockOverlay");i&&(i.style.display="none"),f()},["mousemove","mousedown","keydown","scroll","touchstart"].forEach(function(i){document.addEventListener(i,f,{passive:!0})}),f();var n=null;S4.crypto={_getKey:async function(){if(n)return n;var i=sessionStorage.getItem("s4_enc_key");if(i){var u=Uint8Array.from(atob(i),function(l){return l.charCodeAt(0)});return n=await crypto.subtle.importKey("raw",u,"AES-GCM",!0,["encrypt","decrypt"]),n}n=await crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);var s=await crypto.subtle.exportKey("raw",n);return sessionStorage.setItem("s4_enc_key",btoa(String.fromCharCode.apply(null,new Uint8Array(s)))),n},encrypt:async function(i){var u=await this._getKey(),s=crypto.getRandomValues(new Uint8Array(12)),l=new TextEncoder().encode(i),m=await crypto.subtle.encrypt({name:"AES-GCM",iv:s},u,l),p=new Uint8Array(s.length+m.byteLength);return p.set(s),p.set(new Uint8Array(m),s.length),btoa(String.fromCharCode.apply(null,p))},decrypt:async function(i){var u=await this._getKey(),s=Uint8Array.from(atob(i),function(h){return h.charCodeAt(0)}),l=s.slice(0,12),m=s.slice(12),p=await crypto.subtle.decrypt({name:"AES-GCM",iv:l},u,m);return new TextDecoder().decode(p)}},S4.auditChain={computeChainHash:async function(i,u){var s=(u||"0".repeat(64))+"|"+i.hash+"|"+i.timestamp,l=new TextEncoder().encode(s),m=await crypto.subtle.digest("SHA-256",l);return Array.from(new Uint8Array(m)).map(function(p){return p.toString(16).padStart(2,"0")}).join("")},verifyChain:async function(i){if(!i||i.length===0)return{valid:!0,errors:[]};for(var u=[],s="0".repeat(64),l=0;l<i.length;l++)if(i[l].chainHash){var m=await this.computeChainHash(i[l],s);i[l].chainHash!==m&&u.push({index:l,expected:m,got:i[l].chainHash,record:i[l].label||i[l].type}),s=i[l].chainHash}else s=i[l].hash||s;return{valid:u.length===0,errors:u}}};var d={};S4.rateLimit=function(i,u){u=u||30;var s=Date.now();return d[i]||(d[i]=[]),d[i]=d[i].filter(function(l){return s-l<6e4}),d[i].length>=u?!1:(d[i].push(s),!0)},S4.csrf=(function(){var i=null;function u(){var s=new Uint8Array(32);return crypto.getRandomValues(s),Array.from(s,function(l){return l.toString(16).padStart(2,"0")}).join("")}return{getToken:function(){return i||(i=u()),i},refresh:function(){return i=u(),i},validate:function(s){return s&&s===i},addToHeaders:function(s){return s=s||{},s["X-CSRF-Token"]=this.getToken(),s}}})(),S4.zkVerify=async function(i){var u=typeof s4Vault<"u"&&s4Vault.some(function(h){return h.hash===i}),s={timestamp:new Date().toISOString(),claim:"Record with hash prefix "+i.substring(0,8)+"... exists in vault",verified:u,proofHash:null},l=crypto.getRandomValues(new Uint8Array(16)),m=new TextEncoder().encode(JSON.stringify(s)+Array.from(l).join("")),p=await crypto.subtle.digest("SHA-256",m);return s.proofHash=Array.from(new Uint8Array(p)).map(function(h){return h.toString(16).padStart(2,"0")}).join(""),s},S4.register("security",{version:"1.0.0",features:["xss-sanitizer","session-timeout","encrypted-storage","audit-chain","rate-limiter","zk-verify"]}),console.log("[S4 Security] Module loaded — 6 features active")})();(function(){var e=sessionStorage.getItem("s4_entered")==="1";if(e){var t=document.getElementById("platformLanding"),a=document.querySelector(".hero"),r=document.getElementById("platformWorkspace");t&&(t.style.display="none"),a&&(a.style.display="none"),r&&(r.style.display="block")}})();window.addEventListener("scroll",function(){var e=window.scrollY,t=document.documentElement.scrollHeight-window.innerHeight,a=document.getElementById("scrollProgress");a&&(a.style.width=(t>0?e/t*100:0)+"%");var r=document.getElementById("backToTop");r&&(e>400?(r.style.opacity="1",r.style.visibility="visible"):(r.style.opacity="0",r.style.visibility="hidden"))});var Re=new IntersectionObserver(function(e){e.forEach(function(t){t.isIntersecting&&t.target.classList.add("visible")})},{threshold:.1});document.querySelectorAll(".reveal-anim").forEach(function(e){Re.observe(e)});function he(){const e=JSON.parse(localStorage.getItem("s4_wallet")||"null"),t=document.getElementById("walletNoWallet"),a=document.getElementById("walletCredentials");if(!e||!e.wallet){t&&(t.style.display="block"),a&&(a.style.display="none");return}t&&(t.style.display="none"),a&&(a.style.display="block"),document.getElementById("walletAddress").textContent=e.wallet.address,document.getElementById("seedRevealed").textContent=e.wallet.seed;const r=e.wallet.network==="mainnet"?"https://livenet.xrpl.org/accounts/":"https://testnet.xrpl.org/accounts/";document.getElementById("walletExplorer").href=r+e.wallet.address,ye(e.wallet.address)}async function ye(e){try{const a=await(await fetch("/api/wallet/balance?address="+encodeURIComponent(e))).json();if(a.error){document.getElementById("walletSLSBalance").textContent="0",document.getElementById("walletAnchors").textContent="0",document.getElementById("walletXRP").textContent="0";return}document.getElementById("walletSLSBalance").textContent=parseFloat(a.sls_balance).toLocaleString(),document.getElementById("walletSLSUSD").textContent=(parseFloat(a.sls_balance)*a.sls_price_usd).toFixed(2),document.getElementById("walletAnchors").textContent=a.anchors_available.toLocaleString(),document.getElementById("walletXRP").textContent=a.xrp_balance.toFixed(2),document.getElementById("walletNetwork").textContent="XRPL "+a.network.charAt(0).toUpperCase()+a.network.slice(1)}catch(t){console.log("Balance fetch error:",t)}}function Oe(){const e=document.getElementById("seedMasked"),t=document.getElementById("seedRevealed"),a=document.getElementById("seedToggleBtn");t.style.display==="none"?(t.style.display="inline",e.style.display="none",a.innerHTML='<i class="fas fa-eye-slash"></i> Hide'):(t.style.display="none",e.style.display="inline",a.innerHTML='<i class="fas fa-eye"></i> Show')}function Fe(e){const t=document.getElementById(e).textContent;navigator.clipboard.writeText(t).then(()=>{const a=document.getElementById(e).parentElement.querySelector("button"),r=a.innerHTML;a.innerHTML='<i class="fas fa-check"></i>',setTimeout(()=>{a.innerHTML=r},1200)})}function Pe(e,t){document.getElementById("slsUsdInput").value=e,ve(),document.querySelectorAll(".sls-amt-btn").forEach(a=>{a.style.borderColor="var(--border)",a.style.background="var(--surface)",a.style.color="var(--steel)"}),t&&(t.style.borderColor="rgba(0,170,255,0.5)",t.style.background="rgba(0,170,255,0.08)",t.style.color="var(--accent)")}function ve(){const e=parseFloat(document.getElementById("slsUsdInput").value)||0,t=Math.round(e/.01);document.getElementById("slsPreviewTokens").textContent=t.toLocaleString()+" Credits",document.getElementById("slsPreviewAnchors").textContent=(t*100).toLocaleString()}async function De(){const e=JSON.parse(localStorage.getItem("s4_wallet")||"null"),t=document.getElementById("buySLSResult"),a=document.getElementById("buySLSBtn");if(!e||!e.wallet){t.style.display="block",t.style.background="rgba(255,51,51,0.08)",t.style.border="1px solid rgba(255,51,51,0.2)",t.style.color="#ff6b6b",t.innerHTML='<i class="fas fa-exclamation-circle" style="margin-right:6px"></i>Please <a href="/s4-login/" style="color:var(--accent)">create an account</a> first to get a wallet.';return}const r=parseFloat(document.getElementById("slsUsdInput").value)||0;if(r<=0){t.style.display="block",t.style.background="rgba(255,51,51,0.08)",t.style.border="1px solid rgba(255,51,51,0.2)",t.style.color="#ff6b6b",t.textContent="Please enter a valid amount.";return}a.disabled=!0,a.innerHTML='<i class="fas fa-spinner fa-spin"></i> Processing...',t.style.display="none";try{const c=await(await fetch("/api/wallet/buy-sls",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({wallet_address:e.wallet.address,usd_amount:r,payment_method:"card"})})).json();c.error?(t.style.display="block",t.style.background="rgba(255,51,51,0.08)",t.style.border="1px solid rgba(255,51,51,0.2)",t.style.color="#ff6b6b",t.innerHTML='<i class="fas fa-exclamation-circle" style="margin-right:6px"></i>'+c.error):(t.style.display="block",t.style.background="rgba(0,170,255,0.2)",t.style.border="1px solid rgba(0,170,255,0.2)",t.style.color="#00aaff",t.innerHTML='<i class="fas fa-check-circle" style="margin-right:6px"></i>Purchased '+parseFloat(c.purchase.sls_received).toLocaleString()+" Credits for $"+c.purchase.usd_paid.toFixed(2)+'! <a href="'+c.explorer_url+'" target="_blank" style="color:var(--accent);margin-left:8px">View TX <i class="fas fa-external-link-alt" style="font-size:0.7rem"></i></a>',ye(e.wallet.address))}catch(o){t.style.display="block",t.style.background="rgba(255,51,51,0.08)",t.style.border="1px solid rgba(255,51,51,0.2)",t.style.color="#ff6b6b",t.innerHTML='<i class="fas fa-exclamation-circle" style="margin-right:6px"></i>Network error: '+o.message}a.disabled=!1,a.innerHTML='<i class="fas fa-credit-card" style="margin-right:6px"></i> Purchase with Card'}function ze(e){document.querySelectorAll(".chart-range-btn").forEach(r=>{r.style.background="var(--surface)",r.style.border="1px solid var(--border)",r.style.color="var(--steel)",r.style.fontWeight="400"});const t=document.getElementById("chart"+e.charAt(0).toUpperCase()+e.slice(1));t&&(t.style.background="rgba(26,58,92,0.2)",t.style.border="1px solid rgba(201,168,76,0.3)",t.style.color="#00aaff",t.style.fontWeight="700");const a=document.getElementById("chartOverlay");a&&(a.querySelector("p").textContent="Showing "+e+" usage data. Chart populates as records are anchored.")}setTimeout(function(){var e=document.getElementById("platformWorkspace");e&&e.style.display==="block"&&typeof loadPerformanceMetrics=="function"&&loadPerformanceMetrics().catch(function(t){console.warn("[S4] metrics load:",t)})},2e3);document.addEventListener("shown.bs.tab",function(e){e.target.getAttribute("href")==="#tabWallet"&&he()});window.location.hash==="#tabWallet"&&document.addEventListener("DOMContentLoaded",()=>setTimeout(he,500));window.copyWalletField=Fe;window.handleBuySLS=De;window.setChartRange=ze;window.setSLSAmount=Pe;window.toggleSeed=Oe;window.updateSLSPreview=ve;var W=0,ge=localStorage.getItem("s4_selected_tier")||"starter",ne={pilot:{label:"Pilot (Free)",sls:100,price:"Free"},starter:{label:"Starter ($999/mo)",sls:25e3,price:"$999/mo"},professional:{label:"Professional ($2,499/mo)",sls:1e5,price:"$2,499/mo"},enterprise:{label:"Enterprise ($9,999/mo)",sls:5e5,price:"$9,999/mo"}};function be(){var e=document.getElementById("onboardOverlay");e&&(e.style.display="none"),sessionStorage.setItem("s4_onboard_done","1"),localStorage.setItem("s4_selected_tier",ge)}function qe(){if(W++,W>4){be();return}He(),W===1&&Ne(),W===2&&We()}function He(){for(var e=0;e<=4;e++){var t=document.getElementById("onboardStep"+e);t&&t.classList.toggle("active",e===W)}var a=document.querySelectorAll("#onboardProgress .onboard-dot");a.forEach(function(r,o){r.classList.remove("active","done"),o===W?r.classList.add("active"):o<W&&r.classList.add("done")})}function Ne(){var e=document.getElementById("onboardAcctStatus"),t=document.getElementById("onboardAcctId"),a=document.getElementById("onboardAcctDone");t&&(t.textContent="acct_"+Date.now().toString(36)),setTimeout(function(){e&&(e.innerHTML='<i class="fas fa-check-circle" style="color:var(--green)"></i> Active'),a&&(a.style.display="block")},1200)}function We(){for(var e=document.getElementById("onboardWalletAddr"),t=document.getElementById("onboardXrpBal"),a=document.getElementById("onboardTrustLine"),r=document.getElementById("onboardWalletDone"),o="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",c="r",f=0;f<28;f++)c+=o[Math.floor(Math.random()*o.length)];setTimeout(function(){e&&(e.textContent=c.substring(0,8)+"..."+c.slice(-4))},500),setTimeout(function(){t&&(t.textContent="12.000000 XRP")},1200),setTimeout(function(){a&&(a.innerHTML='Credits <i class="fas fa-check-circle" style="color:var(--green);margin-left:4px"></i>'),r&&(r.style.display="block")},1800)}function Ue(e,t){ge=t,(ne[t]||ne.starter).sls,document.querySelectorAll(".onboard-tier").forEach(function(d){d.classList.remove("selected")}),e.classList.add("selected");var a=ne[t],r=document.getElementById("onboardSlsBal"),o=document.getElementById("onboardSlsAnchors");r&&(r.textContent=a.sls.toLocaleString()),o&&(o.textContent=(a.sls*100).toLocaleString());var c=document.getElementById("slsBarBalance");c&&(c.textContent=a.sls.toLocaleString()+" Credits");var f=document.getElementById("toolSlsBal");f&&(f.textContent=a.sls.toLocaleString());var n=document.getElementById("sidebarSlsBal");n&&(n.textContent=a.sls.toLocaleString()+" Credits")}window.closeOnboarding=be;window.onboardNext=qe;window.selectOnboardTier=Ue;var H=null,N=null;async function X(){var e=stats.anchored||0;stats.slsFees;var t=getLocalRecords(),a={};t.forEach(function(b){var C=b.record_label||b.record_type||"Unknown";a[C]=(a[C]||0)+1});try{var r=await fetch("/api/metrics/performance"),o=await r.json(),c=function(b,C){var M=document.getElementById(b);M&&(M.textContent=C)};c("metricAnchorTime",o.avg_anchor_time_ms?(o.avg_anchor_time_ms/1e3).toFixed(2):"3.21"),c("metricAnchorsToday",o.anchors_today||(e>0?e:"—")),c("metricCostPerAnchor",o.cost_per_anchor||"0.01"),c("metricValidators",o.xrpl_validators||"35"),c("metricUptime",o.uptime_pct||"99.97"),c("metricAiAudit",o.ai_audit_entries||(e>0?Math.max(e,1):"—"));var f=[];try{f=JSON.parse(localStorage.getItem(_vaultKey())||"[]")}catch{}var n=t.length+f.length;c("metricRecordsGenerated",n>0?n:"—"),c("metricVaultSize",f.length>0?f.length:"—");var d=0;try{d=Math.round(new Blob([localStorage.getItem(_vaultKey())||""]).size/1024*10)/10}catch{}c("metricStorageUsed",d>0?d.toFixed(1):"—"),c("metricTotalTime",o.total_processing_time||(e>0?(e*3.2).toFixed(1):"—"));var i=document.getElementById("chartAnchorTimes");if(i&&typeof Chart<"u"){var u=o.recent_anchor_times||[];H&&H.destroy(),H=new Chart(i,{type:"line",data:{labels:u.map(function(b,C){return"#"+(C+1)}),datasets:[{label:"Anchor Time (s)",data:u,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"#00aaff"}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}})}var s=document.getElementById("chartRecordTypes");if(s&&typeof Chart<"u"){var l=o.record_type_counts||(Object.keys(a).length>0?a:{});N&&N.destroy(),N=new Chart(s,{type:"doughnut",data:{labels:Object.keys(l),datasets:[{data:Object.values(l),backgroundColor:["#00aaff","#c9a84c","#38bdf8","#ff6b6b","#00aaff","#fb923c","#06b6d4"],borderWidth:0}]},options:{responsive:!0,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:10},padding:8}}}}})}var m=document.getElementById("metricsRecentRequests");m&&o.recent_requests&&o.recent_requests.length?m.innerHTML=o.recent_requests.map(function(b){var C=(b.method||"GET")==="POST"?"#00cc66":"#00aaff";return'<div style="display:flex;align-items:center;gap:8px;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="background:'+C+"22;color:"+C+';font-weight:700;font-size:0.7rem;padding:2px 8px;border-radius:4px;min-width:42px;text-align:center">'+(b.method||"GET")+'</span><span style="color:var(--text);flex:1;font-family:monospace;font-size:0.72rem">'+(b.path||b.endpoint||"/api/anchor")+'</span><span style="color:var(--accent);font-size:0.68rem;font-weight:600">'+(b.time||b.duration||b.latency||"—")+'</span><span style="color:var(--muted);font-size:0.68rem">'+(b.timestamp||b.ts||"")+"</span></div>"}).join(""):m&&(m.innerHTML='<div style="color:var(--muted);text-align:center;padding:1rem">No recent requests. Metrics auto-refresh when data is available.</div>')}catch{console.warn("Metrics load info: using local session data");var c=function(A,z){var q=document.getElementById(A);q&&(q.textContent=z)};c("metricAnchorTime",e>0?(2.8+Math.random()*.5).toFixed(2):"—"),c("metricAnchorsToday",e>0?e:"—"),c("metricCostPerAnchor","0.01"),c("metricValidators","35"),c("metricUptime","99.97"),c("metricAiAudit",e>0?Math.max(e,1):"—");var p=[];try{p=JSON.parse(localStorage.getItem(_vaultKey())||"[]")}catch{}var h=t.length+p.length;c("metricRecordsGenerated",h>0?h:"—"),c("metricVaultSize",p.length>0?p.length:"—");var v=0;try{v=Math.round(new Blob([localStorage.getItem(_vaultKey())||""]).size/1024*10)/10}catch{}c("metricStorageUsed",v>0?v.toFixed(1):"—"),c("metricTotalTime",e>0?(e*3.2).toFixed(1):"—");var i=document.getElementById("chartAnchorTimes");if(i&&typeof Chart<"u"){var u=Array.from({length:Math.max(e,10)},function(){return(2.8+Math.random()*1.2).toFixed(2)});typeof H<"u"&&H&&H.destroy(),H=new Chart(i,{type:"line",data:{labels:u.map(function(z,q){return"#"+(q+1)}),datasets:[{label:"Anchor Time (s)",data:u,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"#00aaff"}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}})}var s=document.getElementById("chartRecordTypes");if(s&&typeof Chart<"u"){var l=Object.keys(a).length>0?a:{"No Records Yet":1};typeof N<"u"&&N&&N.destroy(),N=new Chart(s,{type:"doughnut",data:{labels:Object.keys(l),datasets:[{data:Object.values(l),backgroundColor:["#00aaff","#c9a84c","#38bdf8","#ff6b6b","#00aaff","#fb923c","#06b6d4"],borderWidth:0}]},options:{responsive:!0,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:10},padding:8}}}}})}var m=document.getElementById("metricsRecentRequests");if(m){for(var g=[],S=typeof getLocalRecords=="function"?getLocalRecords():[],E=S.slice(-5).reverse(),x=0;x<E.length;x++){var L=E[x],y=Math.floor((Date.now()-new Date(L.timestamp).getTime())/1e3),w=y<60?y+"s ago":y<3600?Math.floor(y/60)+"m ago":Math.floor(y/3600)+"h ago";g.push({method:"POST",path:"/api/anchor",time:(2.5+Math.random()*1.5).toFixed(1)+"s",ts:w,color:"#00cc66",detail:L.record_label||L.record_type||"Record"}),g.push({method:"GET",path:"/api/verify/"+(L.hash||"sha256").substring(0,12),time:(.3+Math.random()*.3).toFixed(1)+"s",ts:w,color:"#00aaff",detail:"Verify "+(L.record_label||"")})}var I=[{method:"GET",path:"/api/metrics/performance",time:"0.2s",ts:"auto",color:"#00aaff",detail:"Metrics refresh"},{method:"GET",path:"/api/health",time:"0.1s",ts:"auto",color:"#00aaff",detail:"Health check"},{method:"GET",path:"/api/records?limit=50",time:"0.4s",ts:"realtime",color:"#00aaff",detail:"Record listing"},{method:"POST",path:"/api/wallet/balance",time:"0.3s",ts:"auto",color:"#00cc66",detail:"Balance check"},{method:"GET",path:"/api/xrpl/account_info",time:"0.8s",ts:"auto",color:"#00aaff",detail:"XRPL query"}],T=g.length>0?g.concat(I):[{method:"POST",path:"/api/anchor",time:"2.8s",ts:"just now",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/verify/sha256:a1b2c3d4",time:"0.4s",ts:"12s ago",color:"#00aaff",detail:"Verify hash"},{method:"POST",path:"/api/anchor",time:"3.1s",ts:"45s ago",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/metrics/performance",time:"0.2s",ts:"1m ago",color:"#00aaff",detail:"Metrics"},{method:"GET",path:"/api/records?limit=50&branch=NAVY",time:"0.3s",ts:"2m ago",color:"#00aaff",detail:"Record query"},{method:"POST",path:"/api/anchor",time:"2.6s",ts:"3m ago",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/verify/sha256:e5f6a7b8",time:"0.5s",ts:"4m ago",color:"#00aaff",detail:"Verify hash"},{method:"POST",path:"/api/ai-chat",time:"1.2s",ts:"5m ago",color:"#00cc66",detail:"AI query"}];m.innerHTML=T.slice(0,12).map(function(A){return'<div style="display:flex;align-items:center;gap:8px;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="background:'+A.color+"22;color:"+A.color+';font-weight:700;font-size:0.7rem;padding:2px 8px;border-radius:4px;min-width:42px;text-align:center">'+A.method+'</span><span style="color:var(--text);flex:1;font-family:monospace;font-size:0.72rem">'+A.path+'</span><span style="color:var(--steel);font-size:0.65rem;max-width:90px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">'+A.detail+'</span><span style="color:var(--accent);font-size:0.68rem;font-weight:600">'+A.time+'</span><span style="color:var(--muted);font-size:0.68rem">'+A.ts+"</span></div>"}).join("")}}}document.addEventListener("shown.bs.tab",function(e){e.target&&e.target.getAttribute("href")==="#tabMetrics"&&X(),e.target&&e.target.getAttribute("href")==="#tabOffline"&&Je()});setInterval(function(){var e=document.getElementById("tabMetrics");e&&e.classList.contains("active")&&typeof X=="function"&&X()},3e4);(function(){function e(){var t=typeof stats<"u"?stats:{anchored:0,slsFees:0};typeof getLocalRecords=="function"&&getLocalRecords();var a=document.getElementById("slsBarBalance");if(a){var r=t.slsFees||0,o=typeof _onboardTiers<"u"&&typeof _onboardTier<"u"&&_onboardTiers[_onboardTier]?_onboardTiers[_onboardTier].sls:25e3,c=o-r;a.textContent=c.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})}var f=document.getElementById("slsBarAnchors");f&&(f.textContent=t.anchored||0);var n=document.getElementById("slsBarSpent");n&&(n.textContent=(t.slsFees||0).toFixed(2));var d=typeof _onboardTiers<"u"&&typeof _onboardTier<"u"&&_onboardTiers[_onboardTier]?_onboardTiers[_onboardTier].sls:25e3,i=document.getElementById("toolSlsBal");i&&(i.textContent=(d-(t.slsFees||0)).toLocaleString());var u=document.getElementById("toolSlsAnch");u&&(u.textContent=t.anchored||0);var s=document.getElementById("toolSlsSpent");s&&(s.textContent=(t.slsFees||0).toFixed(2));try{var l=JSON.parse(localStorage.getItem("s4ActionItems")||"[]"),m=l.filter(function(h){return h.status!=="Closed"&&h.status!=="Resolved"}).length,p=document.getElementById("actionItemBadge");p&&(p.textContent=m>0?m:"",p.style.display=m>0?"inline-flex":"none")}catch{}}setInterval(e,3e3),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()})();var Z="s4_offline_queue",Se="s4_offline_last_sync",we="s4_offline_queue_enc",K=null;async function Ve(){if(K)return K;var e=navigator.userAgent+"|"+location.origin+"|s4ledger_offline_v1",t=new TextEncoder,a=await crypto.subtle.importKey("raw",t.encode(e),"PBKDF2",!1,["deriveKey"]);return K=await crypto.subtle.deriveKey({name:"PBKDF2",salt:t.encode("s4_offline_salt_v1"),iterations:1e5,hash:"SHA-256"},a,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),K}async function je(e){var t=await Ve(),a=crypto.getRandomValues(new Uint8Array(12)),r=new TextEncoder,o=await crypto.subtle.encrypt({name:"AES-GCM",iv:a},t,r.encode(JSON.stringify(e)));return{iv:Array.from(a),data:Array.from(new Uint8Array(o))}}function D(){try{var e=localStorage.getItem(we);return e?ce||[]:JSON.parse(localStorage.getItem(Z)||"[]")}catch{return[]}}var ce=[];async function Qe(e){try{var t=await je(e);localStorage.setItem(we,JSON.stringify(t)),ce=e}catch(a){console.warn("Queue encrypt error, falling back to plain:",a),localStorage.setItem(Z,JSON.stringify(e))}}function Q(e){ce=e,localStorage.setItem(Z,JSON.stringify(e)),Qe(e).then(function(){localStorage.removeItem(Z)}).catch(function(){}),J()}function J(){var e=D(),t=document.getElementById("offlineQueueCount"),a=document.getElementById("offlineQueueList"),r=document.getElementById("offlineLastSync"),o=document.getElementById("offlineStatus");if(t&&(t.textContent=e.length),r){var c=localStorage.getItem(Se);r.textContent=c?new Date(c).toLocaleString():"Never"}if(o){var f=navigator.onLine;o.innerHTML=f?'<i class="fas fa-circle" style="font-size:0.6rem;color:var(--green)"></i> Online':'<i class="fas fa-circle" style="font-size:0.6rem;color:var(--red)"></i> Offline',o.style.color=f?"var(--green)":"var(--red)"}a&&(e.length?a.innerHTML=e.map(function(n,d){return'<div style="display:flex;align-items:center;gap:8px;padding:8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="color:var(--accent);font-weight:700;width:24px">'+(d+1)+'</span><span style="flex:1;color:var(--text);font-family:monospace;font-size:0.72rem">'+(n.hash?n.hash.substring(0,24)+"...":"N/A")+'</span><span style="color:var(--steel);font-size:0.7rem;width:80px">'+(n.record_type||"GENERAL")+'</span><span style="color:'+(n.synced?"var(--green)":"var(--gold)")+';font-size:0.72rem">'+(n.synced?"✓ Synced":"⏳ Pending")+'</span><button onclick="offlineRemoveItem('+d+')" style="background:none;border:none;color:var(--red);cursor:pointer;font-size:0.75rem" title="Remove"><i class="fas fa-times"></i></button></div>'}).join(""):a.innerHTML='<div style="color:var(--muted);text-align:center;padding:1rem">Queue is empty. Hashes are queued automatically when offline.</div>')}function Je(){J(),fetch("/api/offline/queue").then(function(e){return e.json()}).then(function(e){if(e.queue_size>0){var t=document.getElementById("offlineQueueCount"),a=D().length;t&&(t.textContent=a+e.queue_size)}if(e.last_sync){var r=document.getElementById("offlineLastSync");r&&(r.textContent=new Date(e.last_sync).toLocaleString())}}).catch(function(){})}function $e(){if(typeof s4Vault<"u"&&s4Vault.length>0){var e=D(),t={};e.forEach(function(f){t[f.hash]=!0});var a=s4Vault.filter(function(f){return f.hash&&!t[f.hash]});if(a.length>0){var r=a[0];e.push({hash:r.hash,record_type:r.type||"VAULT_RECORD",branch:r.branch||"JOINT",timestamp:r.timestamp||new Date().toISOString(),synced:!1,label:r.label||"Vault Record"}),Q(e),R("Vault record queued for offline sync: "+r.hash.substring(0,16)+"...","success")}else R("All vault records are already queued. Anchor new records first.","info")}else{var o="S4-SESSION-"+Date.now()+"-"+Math.random().toString(36).substring(2,10),c=new TextEncoder;crypto.subtle.digest("SHA-256",c.encode(o)).then(function(f){var n=Array.from(new Uint8Array(f)).map(function(i){return i.toString(16).padStart(2,"0")}).join(""),d=D();d.push({hash:n,record_type:"SESSION_HASH",branch:"JOINT",timestamp:new Date().toISOString(),synced:!1}),Q(d),R("Session hash queued for offline sync: "+n.substring(0,16)+"...","info")})}}function Ge(e){var t=D();t.splice(e,1),Q(t)}function Ye(){confirm("Clear all offline queued hashes?")&&(Q([]),R("Offline queue cleared.","info"))}async function Ke(){return de()}var V=0,oe=5,Xe=1e3;async function de(e){e=e||0;var t=D(),a=t.filter(function(n){return!n.synced});if(!a.length){V=0,R("No pending hashes to sync.","info");return}if(!navigator.onLine){R("Cannot sync — currently offline.","warning");return}R("Syncing "+a.length+" hashes to XRPL"+(e>0?" (retry "+e+"/"+oe+")":"")+"...","info");try{var r=await xe("/api/offline/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hashes:a})});if(!r.ok)throw new Error("Server returned "+r.status);for(var o=await r.json(),c=0;c<t.length;c++)t[c].synced||(t[c].synced=!0,t[c].synced_at=new Date().toISOString());Q(t),localStorage.setItem(Se,new Date().toISOString()),V=0,R("Sync complete: "+(o.synced||a.length)+" anchored.","success"),J()}catch(n){if(V=e+1,V<=oe){var f=Xe*Math.pow(2,e)+Math.floor(Math.random()*500);R("Sync failed ("+n.message+"). Retrying in "+Math.round(f/1e3)+"s...","warning"),setTimeout(function(){de(V)},f)}else V=0,R("Sync failed after "+oe+" retries: "+n.message+". Try again later.","error")}}var xe=window.fetch;window.fetch=function(e,t){if(!navigator.onLine&&typeof e=="string"){var a=e.indexOf("/api/anchor")!==-1;if(a){try{var r=t&&t.body?JSON.parse(t.body):{},o=D();o.push({hash:r.hash||r.data_hash||"UNKNOWN",record_type:r.record_type||"QUEUED_ANCHOR",branch:r.branch||"JOINT",timestamp:new Date().toISOString(),synced:!1}),Q(o),R("Offline: anchor queued locally. Will sync when reconnected.","info")}catch(c){console.warn("Offline queue error:",c)}return Promise.resolve(new Response(JSON.stringify({status:"queued_offline",message:"Hash queued for offline sync.",record:{tx_hash:"OFFLINE_"+Date.now().toString(36).toUpperCase(),network:"Queued Offline"}}),{status:200,headers:{"Content-Type":"application/json"}}))}}return xe.apply(this,arguments)};window.addEventListener("online",function(){J(),R("Connection restored. Auto-syncing offline queue...","success"),setTimeout(function(){var e=D(),t=e.filter(function(a){return!a.synced});t.length>0&&de()},2e3)});window.addEventListener("offline",function(){J(),R("Connection lost. Anchors will be queued locally.","warning")});function R(e,t){var a=document.querySelector(".workspace-notification");a&&a.remove();var r=document.createElement("div");r.className="workspace-notification";var o={success:"var(--green)",error:"var(--red)",warning:"var(--gold)",info:"var(--accent)"};r.style.borderColor=o[t]||o.info,r.innerHTML='<button class="notif-close" onclick="this.parentElement.remove()">&times;</button><i class="fas fa-'+(t==="success"?"check-circle":t==="error"?"times-circle":t==="warning"?"exclamation-triangle":"info-circle")+'" style="color:'+(o[t]||o.info)+';margin-right:6px"></i>'+e,document.body.appendChild(r),setTimeout(function(){r.remove()},5e3)}document.addEventListener("DOMContentLoaded",function(){J()});function Ze(e){e.preventDefault();var t=document.getElementById("dropZone");t&&t.classList.remove("drag-over");var a=e.dataTransfer.files;a.length>0&&Ce(a[0])}function et(e){var t=e.target.files;t.length>0&&Ce(t[0])}function Ce(e){var t=document.getElementById("dropFileName");t&&(t.style.display="block",t.innerHTML='<i class="fas fa-file" style="margin-right:6px;"></i>'+e.name+" ("+(e.size/1024).toFixed(1)+" KB)"),e.name,e.size;var a=new FileReader;if(a.onload=function(o){sha256Binary(o.target.result).then(function(c){t&&(t.innerHTML='<i class="fas fa-file" style="margin-right:6px;"></i>'+e.name+" ("+(e.size/1024).toFixed(1)+' KB)<div style="font-size:0.7rem;color:var(--muted);font-family:monospace;margin-top:4px;">SHA-256: '+c.substring(0,32)+"...</div>")})},a.readAsArrayBuffer(e),e.type.startsWith("text/")||e.name.match(/\.(txt|csv|json|xml|md|html|log|yaml|yml)$/i)){var r=new FileReader;r.onload=function(o){document.getElementById("recordInput").value=o.target.result.substring(0,1e4)},r.readAsText(e)}else document.getElementById("recordInput").value="FILE: "+e.name+" | SIZE: "+(e.size/1024).toFixed(1)+" KB | Binary file — SHA-256 hash computed from raw bytes"}function ue(){var e=document.getElementById("gapRadarChart"),t=document.getElementById("gapBarChart");if(!(!e||!t)){var a=document.getElementById("gapChartsRow");a&&(a.style.display="flex");var r,o;typeof ilsResults<"u"&&ilsResults&&ilsResults.elements&&Object.keys(ilsResults.elements).length>0?(r=Object.keys(ilsResults.elements),o=r.map(function(f){return ilsResults.elements[f]&&typeof ilsResults.elements[f].score=="number"?ilsResults.elements[f].score:0})):(r=["Supply Support","Maintenance Planning","Tech Data","Training","Config Mgmt","DMSMS","PHS&T","Reliability","Support Equipment","Manpower"],o=[72,58,85,44,91,35,67,78,52,63]),e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"radar",data:{labels:r.map(function(f){return f.replace(/_/g," ").replace(/\b\w/g,function(n){return n.toUpperCase()})}),datasets:[{label:"ILS Element Coverage %",data:o,backgroundColor:"rgba(0,170,255,0.12)",borderColor:"#00aaff",borderWidth:2,pointBackgroundColor:"#00aaff",pointBorderColor:"#fff",pointRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{r:{min:0,max:100,ticks:{display:!1},grid:{color:"rgba(255,255,255,0.06)"},angleLines:{color:"rgba(255,255,255,0.06)"},pointLabels:{color:"#8ea4b8",font:{size:10}}}},plugins:{legend:{display:!1}}}});var c=o.map(function(f){return f>=80?"#00cc66":f>=50?"#ffa500":"#ff4444"});t.__chartInstance&&t.__chartInstance.destroy(),t.__chartInstance=new Chart(t,{type:"bar",data:{labels:r.map(function(f){return f.replace(/_/g," ").replace(/\b\w/g,function(n){return n.toUpperCase()})}),datasets:[{label:"Score",data:o,backgroundColor:c,borderRadius:6,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{min:0,max:100,grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8"}},y:{ticks:{color:"#8ea4b8",font:{size:10}},grid:{display:!1}}},plugins:{legend:{display:!1}}}})}}function Ee(){var e=document.getElementById("dmsmsPieChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"doughnut",data:{labels:["Active","At Risk","Obsolete","Resolved","Monitoring"],datasets:[{data:window._dmsmsChartData&&window._dmsmsChartData.reduce(function(t,a){return t+a},0)>0?window._dmsmsChartData:[45,18,12,20,5],backgroundColor:["#00cc66","#ffa500","#ff4444","#00aaff","#8ea4b8"],borderWidth:0,hoverOffset:8}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"55%",plugins:{legend:{position:"bottom",labels:{color:"#8ea4b8",padding:12,usePointStyle:!0,pointStyle:"circle",font:{size:11}}}}}}))}function Ie(){var e=document.getElementById("readinessGauge");if(e){var t=.87;if(typeof window._readinessAo=="number"&&!isNaN(window._readinessAo))t=window._readinessAo;else{var a=document.getElementById("readinessAo")||document.getElementById("statAo");if(a&&a.textContent&&a.textContent!=="—"){var r=parseFloat(a.textContent);isNaN(r)||(t=r>1?r/100:r)}}e.__chartInstance&&e.__chartInstance.destroy();var o=Math.round(t*100),c=Math.min(100,o+8),f=Math.min(100,o-3),n=Math.min(100,o-10),d=Math.min(100,o+12),i=Math.min(100,o+2),u=Math.min(100,o+5),s=[c,f,n,d,i,u].map(function(l){return l>=90?"rgba(0,204,102,0.7)":l>=75?"rgba(0,170,255,0.6)":l>=60?"rgba(255,165,0,0.6)":"rgba(255,68,68,0.6)"});e.__chartInstance=new Chart(e,{type:"bar",data:{labels:["Personnel","Equipment","Supply","Training","Maintenance","C4ISR"],datasets:[{label:"Readiness %",data:[c,f,n,d,i,u],backgroundColor:s,borderColor:s.map(function(l){return l.replace("0.7","1").replace("0.6","1")}),borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(l){return l.parsed.y+"%"}}}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:11}},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:10},callback:function(l){return l+"%"}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0,max:100}}}})}}function Le(){var e=document.getElementById("complianceRadarChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"radar",data:{labels:["CMMC L2","NIST 800-171","DFARS 7012","ITAR","FIPS 140-2","FedRAMP","IL4/IL5"],datasets:[{label:"Current Posture",data:window._complianceScores&&window._complianceScores.reduce(function(t,a){return t+a},0)>0?window._complianceScores:[78,85,92,88,70,65,82],backgroundColor:"rgba(0,170,255,0.12)",borderColor:"#00aaff",borderWidth:2,pointBackgroundColor:"#00aaff",pointRadius:4},{label:"Target",data:[95,95,100,100,90,85,95],backgroundColor:"rgba(201,168,76,0.06)",borderColor:"rgba(201,168,76,0.5)",borderWidth:1,borderDash:[4,4],pointRadius:2}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{r:{min:0,max:100,ticks:{display:!1},grid:{color:"rgba(255,255,255,0.06)"},angleLines:{color:"rgba(255,255,255,0.06)"},pointLabels:{color:"#8ea4b8",font:{size:10}}}},plugins:{legend:{labels:{color:"#8ea4b8",usePointStyle:!0,font:{size:11}}}}}}))}function Te(){var e=document.getElementById("roiLineChart");if(e){e.getAttribute("data-bp-rendered")&&e.removeAttribute("data-bp-rendered");var t=document.getElementById("hub-roi");if(t&&typeof Chart<"u"){var a=null;try{a=Chart.getChart(e)}catch{}if(a&&a.data&&a.data.labels&&a.data.labels.length>=20)return}if(e.__chartInstance)try{e.__chartInstance.destroy()}catch{}for(var r=parseFloat((document.getElementById("roiFTEs")||{}).value)||8,o=parseFloat((document.getElementById("roiRate")||{}).value)||145,c=parseFloat((document.getElementById("roiAudit")||{}).value)||25e4,f=parseFloat((document.getElementById("roiError")||{}).value)||8500,n=parseFloat((document.getElementById("roiIncidents")||{}).value)||35,d=parseFloat((document.getElementById("roiLicense")||{}).value)||12e4,i=r*2080*o*.65,u=n*f*.9,s=c*.7,l=i+u+s,m=[],p=["Q1","Q2","Q3","Q4","Q5","Q6","Q7","Q8","Q9","Q10","Q11","Q12","Q13","Q14","Q15","Q16","Q17","Q18","Q19","Q20"],h=1;h<=20;h++){var v=.2+.65*(1-Math.exp(-.18*h)),g=l/4*v,S=d/4,E=h>1?m[h-2]:0;m.push(Math.round(E+g-S))}e.__chartInstance=new Chart(e,{type:"line",data:{labels:p,datasets:[{label:"Cumulative ROI ($)",data:m,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.08)",fill:!0,tension:.3,borderWidth:2,pointBackgroundColor:"#00aaff",pointBorderColor:"#fff",pointRadius:5,pointHoverRadius:7},{label:"Break-Even Line",data:new Array(20).fill(0),borderColor:"rgba(255,255,255,0.2)",borderDash:[5,5],borderWidth:1,pointRadius:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8",callback:function(x){return"$"+(x/1e3).toFixed(0)+"K"}}},x:{grid:{display:!1},ticks:{color:"#8ea4b8"}}},plugins:{legend:{labels:{color:"#8ea4b8",usePointStyle:!0,font:{size:11}}}}}})}}function Ae(){var e=document.getElementById("riskHeatChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"bar",data:{labels:["Supply Chain","Cyber/Data","Obsolescence","Financial","Regulatory","Operational"],datasets:[{label:"Risk Score",data:window._riskChartScores&&window._riskChartScores.length===6?window._riskChartScores:[78,62,85,45,55,71],backgroundColor:function(t){var a=t.raw;return a>=75?"rgba(255,68,68,0.7)":a>=50?"rgba(255,165,0,0.7)":"rgba(0,204,102,0.7)"},borderRadius:6,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{min:0,max:100,grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8"}},y:{ticks:{color:"#8ea4b8",font:{size:11}},grid:{display:!1}}},plugins:{legend:{display:!1}}}}))}function ee(){var e=document.getElementById("lifecyclePieChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"doughnut",data:{labels:["Acquisition","Sustainment (O&S)","DMSMS / Obsol.","Disposal","Personnel","Training"],datasets:[{data:window._lifecycleChartData&&window._lifecycleChartData.length===6?window._lifecycleChartData:[28,42,12,5,8,5],backgroundColor:["#00aaff","#c9a84c","#ff4444","#8ea4b8","#00cc66","#9b59b6"],borderWidth:0,hoverOffset:8}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"50%",plugins:{legend:{position:"bottom",labels:{color:"#8ea4b8",padding:12,usePointStyle:!0,pointStyle:"circle",font:{size:11}}}}}}))}function _e(){var e={"hub-analysis":{target:"ilsResult",charts:'<div class="row mt-3" id="gapChartsRow"><div class="col-md-6"><div class="chart-container"><div class="chart-title"><i class="fas fa-chart-pie"></i> ILS Element Coverage</div><canvas id="gapRadarChart" height="240"></canvas></div></div><div class="col-md-6"><div class="chart-container"><div class="chart-title"><i class="fas fa-chart-bar"></i> Element Scores</div><canvas id="gapBarChart" height="240"></canvas></div></div></div>'},"hub-dmsms":{target:null,charts:'<div class="chart-container mt-3" id="dmsmsChartArea"><div class="chart-title"><i class="fas fa-chart-pie"></i> Obsolescence Risk Distribution</div><canvas id="dmsmsPieChart" height="200"></canvas></div>'},"hub-readiness":{target:null,charts:'<div class="chart-container mt-3" style="max-width:100%" id="readinessGaugeArea"><div class="chart-title"><i class="fas fa-gauge-high"></i> Operational Availability</div><canvas id="readinessGauge" height="300"></canvas></div>'},"hub-compliance":{target:null,charts:'<div class="chart-container mt-3" id="complianceChartArea"><div class="chart-title"><i class="fas fa-shield-halved"></i> Compliance Framework Radar</div><canvas id="complianceRadarChart" height="250"></canvas></div>'},"hub-roi":{target:null,charts:'<div class="chart-container mt-3" id="roiChartArea"><div class="chart-title"><i class="fas fa-chart-line"></i> ROI Projection — 5 Year Cumulative</div><canvas id="roiLineChart" height="220"></canvas></div>'},"hub-risk":{target:null,charts:'<div class="chart-container mt-3" id="riskChartArea"><div class="chart-title"><i class="fas fa-triangle-exclamation"></i> Risk Category Assessment</div><canvas id="riskHeatChart" height="220"></canvas></div>'},"hub-lifecycle":{target:null,charts:'<div class="chart-container mt-3" id="lifecycleChartArea"><div class="chart-title"><i class="fas fa-chart-pie"></i> Total Ownership Cost Breakdown</div><canvas id="lifecyclePieChart" height="220"></canvas></div>'}};Object.keys(e).forEach(function(t){var a=e[t],r=document.getElementById(t);if(r&&!r.getAttribute("data-charts-injected")){var o=a.charts.match(/id="([^"]+)"/);if(o&&document.getElementById(o[1])){r.setAttribute("data-charts-injected","1");return}var c=r.querySelector(".s4-card");if(c){if(a.target){var f=document.getElementById(a.target);if(f){var n=document.createElement("div");n.innerHTML=a.charts,f.parentNode.insertBefore(n.firstElementChild,f.nextSibling),r.setAttribute("data-charts-injected","1");return}}var n=document.createElement("div");n.innerHTML=a.charts,c.appendChild(n.firstElementChild),r.setAttribute("data-charts-injected","1")}}})}var tt=openILSTool;openILSTool=function(e){tt(e),_e(),setTimeout(function(){e==="hub-analysis"&&ilsResults&&ue(),e==="hub-dmsms"&&Ee(),e==="hub-readiness"&&Ie(),e==="hub-compliance"&&Le(),e==="hub-roi"&&Te(),e==="hub-risk"&&Ae(),e==="hub-lifecycle"&&ee()},300)};var at=switchHubTab;switchHubTab=function(e,t){at(e,t),_e(),setTimeout(function(){e==="hub-analysis"&&typeof ilsResults<"u"&&ilsResults&&ue(),e==="hub-dmsms"&&Ee(),e==="hub-readiness"&&Ie(),e==="hub-compliance"&&Le(),e==="hub-roi"&&Te(),e==="hub-risk"&&Ae(),e==="hub-lifecycle"&&ee()},300)};var me=null;typeof showILSResults=="function"&&(me=showILSResults,showILSResults=function(){me.apply(this,arguments);var e=document.getElementById("gapChartsRow");e&&(e.style.display="flex"),setTimeout(ue,500)});function rt(){var e=(document.getElementById("lifecycleProgram")||{}).value||"ddg51",t=parseFloat((document.getElementById("lcServiceLife")||{}).value)||30,a=parseFloat((document.getElementById("lcOpHours")||{}).value)||2500,r=parseFloat((document.getElementById("lcAcqCost")||{}).value)||85,o=parseFloat((document.getElementById("lcFleetSize")||{}).value)||20,c=parseFloat((document.getElementById("lcSustRate")||{}).value)||8,f=r*o,n=f*(c/100),d=n*t,i=.12+(t>25?.04:0),u=d*i,s=f*.05,l=d*.18,m=d*.08,p=f+d+u+s+l+m,h=a*o*t,v=h>0?p/h:0;function g(C){return C>=1e3?"$"+(C/1e3).toFixed(1)+"B":"$"+C.toFixed(0)+"M"}var S=function(C){return document.getElementById(C)};S("lcTotalCost")&&(S("lcTotalCost").textContent=g(p)),S("lcSustCost")&&(S("lcSustCost").textContent=g(d)),S("lcDmsmsCost")&&(S("lcDmsmsCost").textContent=g(u)),S("lcCostPerHr")&&(S("lcCostPerHr").textContent="$"+v.toFixed(0)+"/hr");var E=Math.round(f/p*100),x=Math.round(d/p*100),L=Math.round(u/p*100),y=Math.round(s/p*100),w=Math.round(l/p*100),I=Math.round(m/p*100);window._lifecycleChartData=[E,x,L,y,w,I];var T=S("lifecycleOutput");if(T){var b=window.S4_PLATFORMS&&S4_PLATFORMS[e]?S4_PLATFORMS[e].n:e.toUpperCase();T.innerHTML='<div style="background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:20px;margin-top:12px"><div class="section-label"><i class="fas fa-clock"></i> LIFECYCLE COST BREAKDOWN — '+b+'</div><div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;font-size:0.85rem;margin-bottom:16px"><div><span style="color:var(--steel)">Acquisition ('+E+'%)</span><br><strong style="color:#00aaff">'+g(f)+'</strong></div><div><span style="color:var(--steel)">Sustainment ('+x+'%)</span><br><strong style="color:#c9a84c">'+g(d)+'</strong></div><div><span style="color:var(--steel)">DMSMS/Obsol ('+L+'%)</span><br><strong style="color:#ff4444">'+g(u)+'</strong></div><div><span style="color:var(--steel)">Disposal ('+y+'%)</span><br><strong style="color:#8ea4b8">'+g(s)+'</strong></div><div><span style="color:var(--steel)">Personnel ('+w+'%)</span><br><strong style="color:#00cc66">'+g(l)+'</strong></div><div><span style="color:var(--steel)">Training ('+I+'%)</span><br><strong style="color:#9b59b6">'+g(m)+'</strong></div></div><hr style="border-color:var(--border);margin:12px 0"><div style="display:flex;justify-content:space-between;align-items:center"><div><span style="color:var(--steel);font-size:0.82rem">Total Ownership Cost</span><br><span style="font-size:1.5rem;font-weight:800;color:#00aaff">'+g(p)+'</span></div><div><span style="color:var(--steel);font-size:0.82rem">Cost per Op Hour</span><br><span style="font-size:1.1rem;font-weight:700;color:var(--accent)">$'+v.toFixed(0)+'/hr</span></div><div><span style="color:var(--steel);font-size:0.82rem">Fleet Size</span><br><span style="font-size:1.1rem;font-weight:700;color:#fff">'+o+" units × "+t+" yrs</span></div></div></div>"}typeof ee=="function"&&setTimeout(ee,300)}function nt(){var e=(document.getElementById("lifecycleProgram")||{}).value||"ddg51",t=window.S4_PLATFORMS&&S4_PLATFORMS[e]?S4_PLATFORMS[e].n:e.toUpperCase(),a=parseFloat((document.getElementById("lcServiceLife")||{}).value)||30,r=parseFloat((document.getElementById("lcAcqCost")||{}).value)||85,o=parseFloat((document.getElementById("lcFleetSize")||{}).value)||20,c=parseFloat((document.getElementById("lcSustRate")||{}).value)||8,f=r*o,n=f*(c/100)*a,d=n*(.12+(a>25?.04:0)),i=f+n+d+f*.05+n*.18+n*.08,u=`S4 LEDGER — LIFECYCLE COST REPORT
================================

Platform: `+t+`
Fleet Size: `+o+` units
Service Life: `+a+` years
Sustainment Rate: `+c+`%

Acquisition: $`+f.toFixed(0)+`M
Sustainment: $`+n.toFixed(0)+`M
DMSMS/Obsolescence: $`+d.toFixed(0)+`M
Total Ownership Cost: $`+i.toFixed(0)+`M

Generated: `+new Date().toISOString()+`
`,s=new Blob([u],{type:"text/plain"}),l=document.createElement("a");l.href=URL.createObjectURL(s),l.download="S4_Lifecycle_"+t.replace(/\s+/g,"_")+"_"+new Date().toISOString().substring(0,10)+".txt",l.click(),URL.revokeObjectURL(l.href),typeof s4Notify=="function"&&s4Notify("Exported","Lifecycle cost report downloaded.","success")}async function ot(){var e=(document.getElementById("lifecycleProgram")||{}).value||"ddg51",t=window.S4_PLATFORMS&&S4_PLATFORMS[e]?S4_PLATFORMS[e].n:e.toUpperCase(),a=parseFloat((document.getElementById("lcServiceLife")||{}).value)||30,r=parseFloat((document.getElementById("lcAcqCost")||{}).value)||85,o=parseFloat((document.getElementById("lcFleetSize")||{}).value)||20,c=parseFloat((document.getElementById("lcSustRate")||{}).value)||8,f=r*o,n=f*(c/100)*a,d=n*(.12+(a>25?.04:0)),i=f+n+d+f*.05+n*.18+n*.08,u="Lifecycle Cost | Program: "+t+" | Fleet: "+o+" | TOC: $"+i.toFixed(0)+"M | Date: "+new Date().toISOString(),s=await sha256(u);showAnchorAnimation(s,"Lifecycle Cost Report","CUI"),stats.anchored++,stats.types.add("LIFECYCLE_COST"),stats.slsFees=Math.round((stats.slsFees+.01)*100)/100,updateStats(),saveStats();var l=await _anchorToXRPL(s,"LIFECYCLE_COST",u.substring(0,100)),m={hash:s,type:"LIFECYCLE_COST",branch:"JOINT",timestamp:new Date().toISOString(),label:"Lifecycle Cost — "+t,txHash:l.txHash};sessionRecords.push(m),saveLocalRecord({hash:s,record_type:"LIFECYCLE_COST",record_label:"Lifecycle Cost — "+t,branch:"JOINT",timestamp:new Date().toISOString(),timestamp_display:new Date().toISOString().replace("T"," ").substring(0,19)+" UTC",fee:.01,tx_hash:l.txHash,system:"Lifecycle Cost Estimator",explorer_url:l.explorerUrl,network:l.network}),addToVault({hash:s,txHash:l.txHash,type:"LIFECYCLE_COST",label:"Lifecycle Cost — "+t,branch:"JOINT",icon:'<i class="fas fa-clock"></i>',content:u.substring(0,100),encrypted:!1,timestamp:new Date().toISOString(),source:"Lifecycle Cost Estimator",fee:.01,explorerUrl:l.explorerUrl,network:l.network}),updateTxLog(),_updateSlsBalance(),setTimeout(function(){document.getElementById("animStatus").innerHTML='<i class="fas fa-check-circle" style="color:var(--accent)"></i> Lifecycle report anchored!',document.getElementById("animStatus").style.color="#00aaff"},2200),await new Promise(function(p){setTimeout(p,3200)}),hideAnchorAnimation(),typeof s4Notify=="function"&&s4Notify("Anchored","Lifecycle cost report anchored to XRPL.","success")}(function(){function e(r){var o=document.getElementById(r);if(!(!o||o.dataset.uxDone)){o.dataset.uxDone="1",o.querySelectorAll("details").forEach(function(y){y.removeAttribute("style")}),o.querySelectorAll("details summary").forEach(function(y){y.removeAttribute("style")}),o.querySelectorAll("details > div").forEach(function(y){y.removeAttribute("style")}),o.querySelectorAll("h3 > i[style], h4 > i[style]").forEach(function(y){y.removeAttribute("style")});var c=o.querySelectorAll(".s4-card");c.forEach(function(y){var w=y.querySelector("h3, h4");if(w){var I=w.nextElementSibling,T=y.querySelector(".hub-tool-header");T&&(I=T.nextElementSibling),I&&I.tagName==="P"&&I.getAttribute("style")&&I.removeAttribute("style")}}),o.querySelectorAll("button[style]").forEach(function(y){if(!(y.closest(".ils-dropzone")||y.closest(".post-actions")||y.closest(".post-action-btn"))&&y.style.display!=="none"){var w=y.textContent.toLowerCase(),I=w.includes("anchor")||w.includes("xrpl"),T=w.includes("export")||w.includes("download")||w.includes("generate"),b=w.includes("run ")||w.includes("analyze")||w.includes("calculate"),C=w.includes("clear")||w.includes("delete");C||(y.innerHTML,y.getAttribute("onclick"),I||b?(y.removeAttribute("style"),y.className="btn-anchor"):T&&(y.removeAttribute("style"),y.className="btn-export"))}}),o.querySelectorAll("div[style]").forEach(function(y){var w=y.getAttribute("style")||"";if(w.includes("display:flex")&&w.includes("gap:10")&&w.includes("flex-wrap:wrap")&&!y.classList.contains("ils-dropzone")&&!y.querySelector(".ils-dropzone")&&!y.closest(".post-actions")){var I=y.querySelectorAll("button");I.length>0&&(y.className="tool-actions-bar",y.removeAttribute("style"))}}),c.forEach(function(y){y.querySelectorAll(":scope > label, :scope > .row > .col-md-6 > label");var w=y.querySelector(":scope > label");if(w&&!w.previousElementSibling?.classList?.contains("section-label")){var I=document.createElement("div");I.className="section-label",I.innerHTML='<i class="fas fa-sliders"></i> CONFIGURATION';var T=document.createElement("hr");T.className="section-divider",w.parentNode.insertBefore(T,w),w.parentNode.insertBefore(I,T)}var b=y.querySelector('[id$="Results"], [id$="Output"], [id$="result"], [id$="Result"]');if(b&&!b.previousElementSibling?.classList?.contains("section-label")){var C=document.createElement("div");C.className="section-label",C.innerHTML='<i class="fas fa-chart-bar"></i> RESULTS';var M=document.createElement("hr");M.className="section-divider",b.parentNode.insertBefore(M,b),b.parentNode.insertBefore(C,M)}var F=y.querySelector(".tool-actions-bar");if(F&&!F.previousElementSibling?.classList?.contains("section-label")){var U=document.createElement("div");U.className="section-label",U.innerHTML='<i class="fas fa-bolt"></i> ACTIONS',F.parentNode.insertBefore(U,F)}});var f=o.querySelector(".s4-card");if(f){var n=r==="hub-analysis"||r==="hub-actions";if(!n){for(var d=f.querySelectorAll(":scope > .row"),i=null,u=0;u<d.length;u++){var s=d[u];if(s.querySelectorAll(".stat-mini").length>=3){i=s;break}}if(i){var l=f.querySelector(".hub-tool-header")||f.querySelector("h3, h4");if(l){var m=l;i.style.cssText="",i.classList.add("mb-3"),m.parentNode.insertBefore(i,m.nextSibling)}}}if(r==="hub-actions"){var p=f.querySelector(".col-lg-8");if(p){var h=p.querySelector(".s4-card");if(h){for(var v=null,g=h.querySelectorAll(":scope > .row"),S=0;S<g.length;S++)if(g[S].querySelectorAll(".stat-mini").length>=3){v=g[S];break}if(v){var E=h.querySelector("h3");E&&(v.style.cssText="",v.classList.add("mb-3"),E.parentNode.insertBefore(v,E.nextSibling))}}}}o.querySelectorAll("input[style], select[style]").forEach(function(y){y.type==="file"||y.type==="hidden"||y.style.display!=="none"&&y.removeAttribute("style")});var x=o.querySelectorAll(".chart-container");x.forEach(function(y){y.style.display="block"});var L=o.querySelector("#gapChartsRow");L&&(L.style.display="flex")}}}var t=openILSTool;openILSTool=function(r){t(r),setTimeout(function(){e(r)},100)};var a=switchHubTab;switchHubTab=function(r,o){a(r,o),setTimeout(function(){e(r)},100)},document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){document.querySelectorAll('.ils-hub-panel.active, .ils-hub-panel[style*="display:block"], .ils-hub-panel[style*="display: block"]').forEach(function(r){e(r.id)})},2500)})})();console.log("[Anchor-S4] Chart & KPI Enhancement Engine loaded");document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector('a[href="#tabILS"]');e&&e.addEventListener("shown.bs.tab",function(){updateAiContext(currentHubPanel||"hub-analysis")})});var k,B;(function(){var t=new Date;k=t.getFullYear(),B=t.getMonth()})();function it(e){B+=e,B>11&&(B=0,k++),B<0&&(B=11,k--),te()}function te(){var e=document.getElementById("actionCalendarGrid"),t=document.getElementById("calMonthLabel");if(!(!e||!t)){if(typeof k>"u"||k===void 0||k===null){var a=new Date;k=a.getFullYear(),B=a.getMonth()}var r=["January","February","March","April","May","June","July","August","September","October","November","December"];t.textContent=r[B]+" "+k;var o=new Date(k,B,1).getDay(),c=new Date(k,B+1,0).getDate(),f=new Date,n=f.getFullYear()===k&&f.getMonth()===B,d={};try{var i=typeof s4ActionItems<"u"&&s4ActionItems.length>0?s4ActionItems:JSON.parse(localStorage.getItem("s4ActionItems")||"[]");i.forEach(function(S){var E=S.due||S.schedule||"";if(E){var x=new Date(E);if(!isNaN(x.getTime())&&x.getFullYear()===k&&x.getMonth()===B){var L=x.getDate();d[L]||(d[L]=[]),d[L].push(S)}}})}catch{}var u="";["Su","Mo","Tu","We","Th","Fr","Sa"].forEach(function(S){u+='<div style="padding:4px;font-weight:700;color:var(--steel);font-size:0.7rem">'+S+"</div>"});for(var s=0;s<o;s++)u+='<div style="padding:6px"></div>';for(var l=1;l<=c;l++){var m=n&&l===f.getDate(),p=d[l],h=m?"rgba(0,170,255,0.2)":p?"rgba(0,170,255,0.06)":"var(--surface)",v=m?"1px solid var(--accent)":p?"1px solid rgba(0,170,255,0.15)":"1px solid var(--border)",g="";p&&p.forEach(function(S){var E=S.severity==="critical"?"#ff3333":S.severity==="warning"?"#ffa500":"#00aaff";g+='<span style="display:inline-block;width:4px;height:4px;border-radius:50%;background:'+E+';margin:0 1px"></span>'}),u+='<div onclick="showCalDay('+l+')" style="padding:4px 2px;background:'+h+";border:"+v+";border-radius:4px;cursor:"+(p?"pointer":"default")+';min-height:32px"><div style="color:'+(m?"#00aaff":"#fff")+";font-weight:"+(m?"800":"400")+'">'+l+"</div>"+(g?'<div style="margin-top:2px">'+g+"</div>":"")+"</div>"}e.innerHTML=u}}function st(e){var t=document.getElementById("calDayDetail");if(t){var a={};try{var r=typeof s4ActionItems<"u"&&s4ActionItems.length>0?s4ActionItems:JSON.parse(localStorage.getItem("s4ActionItems")||"[]");r.forEach(function(n){var d=n.due||n.schedule||"";if(d){var i=new Date(d);if(!isNaN(i.getTime())&&i.getFullYear()===k&&i.getMonth()===B){var u=i.getDate();a[u]||(a[u]=[]),a[u].push(n)}}})}catch{}var r=a[e]||[];if(r.length===0){t.style.display="none";return}var o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],c='<div style="font-weight:700;color:#fff;margin-bottom:6px"><i class="fas fa-calendar-day" style="color:var(--accent);margin-right:4px"></i>'+o[B]+" "+e+", "+k+"</div>";r.forEach(function(f){var n=f.severity==="critical"?"#ff3333":f.severity==="warning"?"#ffa500":"#00aaff";c+='<div style="padding:6px 8px;background:rgba(0,0,0,0.2);border-left:3px solid '+n+';border-radius:4px;margin-bottom:4px"><div style="font-weight:600;color:#fff;font-size:0.8rem">'+(f.title||"Action Item")+"</div>"+(f.owner?'<div style="font-size:0.72rem;color:var(--steel)">Owner: '+f.owner+"</div>":"")+"</div>"}),t.innerHTML=c,t.style.display="block"}}function ie(){var e=document.getElementById("actionCalendarGrid"),t=document.getElementById("calMonthLabel");if(!e||!t){setTimeout(ie,500);return}te(),(!e.innerHTML||e.innerHTML.trim()==="")&&setTimeout(te,300)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){setTimeout(ie,800)}):setTimeout(ie,800);(function(){var e=new MutationObserver(function(a){a.forEach(function(r){if(r.type==="attributes"&&r.attributeName==="style"){var o=r.target;o.id==="hub-actions"&&o.style.display!=="none"&&setTimeout(te,150)}})}),t=document.getElementById("hub-actions");t?e.observe(t,{attributes:!0,attributeFilter:["style"]}):document.addEventListener("DOMContentLoaded",function(){var a=document.getElementById("hub-actions");a&&e.observe(a,{attributes:!0,attributeFilter:["style"]})})})();window.anchorLifecycle=ot;window.calcLifecycle=rt;window.changeCalMonth=it;window.exportLifecycle=nt;window.handleFileSelect=et;window.loadPerformanceMetrics=X;window.offlineClearQueue=Ye;window.offlineQueueHash=$e;window.offlineRemoveItem=Ge;window.handleFileDrop=Ze;window.offlineSyncAll=Ke;window.showCalDay=st;var G=null;function lt(){document.querySelectorAll(".tab-pane").forEach(function(d){d.classList.remove("show","active"),d.style.display="none"});var e=document.getElementById("sectionSystems");e&&(e.style.display="none"),document.querySelectorAll(".ils-hub-panel").forEach(function(d){d.classList.remove("active"),d.style.display="none"});var t=document.getElementById("ilsToolBackBar");t&&(t.style.display="none");var a=document.getElementById("ilsSubHub");a&&(a.style.display="grid");var r=document.querySelector(".ils-hub-tabs");r&&(r.style.display="none"),G=null;var o=document.getElementById("platformHub");o&&(o.style.display="block",o.style.animation="fadeIn 0.3s ease");var c=document.getElementById("statsRow");if(c&&(c.style.display="flex"),!sessionStorage.getItem("s4_entered")){var f=document.querySelector(".hero");f&&(f.style.display="block");var n=document.getElementById("platformLanding");n&&(n.style.display="block")}history.replaceState(null,"",window.location.pathname)}function Y(e){var t=document.getElementById("platformHub");t&&(t.style.display="none");var a=document.querySelector(".hero");a&&(a.style.display="none");var r=document.getElementById("platformLanding");r&&(r.style.display="none"),document.querySelectorAll(".tab-pane").forEach(function(s){s.classList.remove("show","active"),s.style.display="none"});var o=document.getElementById("sectionSystems");o&&(o.style.display="none");var c={sectionAnchor:"tabAnchor",sectionVerify:"tabVerify",sectionLog:"tabLog",sectionILS:"tabILS",sectionSystems:"sectionSystems",sectionMetrics:"tabMetrics",sectionOffline:"tabOffline"};if(e==="sectionSystems")o&&(o.style.display="block",o.classList.add("show","active"),o.style.animation="fadeIn 0.3s ease");else{var f=c[e]||e,n=document.getElementById(f);n&&(n.style.display="block",n.classList.add("show","active"),n.style.animation="fadeIn 0.3s ease");var d=document.querySelector('a[href="#'+f+'"]');if(d)try{new bootstrap.Tab(d).show()}catch{}}if(e==="sectionILS"){var i=document.getElementById("ilsSubHub");i&&(i.style.display="grid");var u=document.getElementById("ilsToolBackBar");u&&(u.style.display="none"),document.querySelectorAll(".ils-hub-panel").forEach(function(s){s.classList.remove("active")})}}function ct(e){var t=document.getElementById("sectionSystems");t&&(t.style.display="none");var a=document.getElementById(e);a&&(a.style.display="block",a.classList.add("show","active"),a.style.animation="fadeIn 0.3s ease")}function se(e){var t=document.getElementById("ilsSubHub");t&&(t.style.display="none");var a=document.getElementById("ilsToolBackBar");a&&(a.style.display="block"),document.querySelectorAll(".ils-hub-panel").forEach(function(c){c.classList.remove("active"),c.style.display="none"});var r=document.getElementById(e);r&&(r.style.display="block",r.classList.add("active"),r.style.animation="fadeIn 0.3s ease");var o=document.querySelector('.ils-hub-tab[onclick*="'+e+'"]');o&&(document.querySelectorAll(".ils-hub-tab").forEach(function(c){c.classList.remove("active")}),o.classList.add("active")),e==="hub-actions"&&(typeof renderHubActions=="function"&&renderHubActions(),typeof renderActionCalendar=="function"&&(setTimeout(renderActionCalendar,200),setTimeout(renderActionCalendar,600))),e==="hub-vault"&&typeof renderVault=="function"&&renderVault(),e==="hub-docs"&&typeof renderDocLibrary=="function"&&renderDocLibrary(),e==="hub-compliance"&&typeof calcCompliance=="function"&&calcCompliance(),e==="hub-risk"&&typeof loadRiskData=="function"&&loadRiskData(),e==="hub-roi"&&typeof calcROI=="function"&&calcROI(),e==="hub-reports"&&typeof loadReportPreview=="function"&&loadReportPreview(),e==="hub-predictive"&&typeof loadPredictiveData=="function"&&loadPredictiveData(),e==="hub-submissions"&&typeof loadSubmissionHistory=="function"&&loadSubmissionHistory(),e==="hub-sbom"&&typeof loadSBOMData=="function"&&loadSBOMData(),e==="hub-dmsms"&&typeof loadDMSMSData=="function"&&loadDMSMSData(),e==="hub-readiness"&&typeof loadReadinessData=="function"&&loadReadinessData(),e==="hub-lifecycle"&&typeof calcLifecycle=="function"&&calcLifecycle(),e==="hub-analysis"&&typeof initILSChecklist=="function"&&initILSChecklist(),typeof updateAiContext=="function"&&updateAiContext(e),G=e}function dt(){document.querySelectorAll(".ils-hub-panel").forEach(function(o){o.classList.remove("active"),o.style.display="none"});var e=document.getElementById("ilsSubHub");e&&(e.style.display="grid",e.style.animation="fadeIn 0.3s ease");var t=document.getElementById("ilsToolBackBar");t&&(t.style.display="none");var a=document.querySelector(".ils-hub-tabs");if(a&&(a.style.display="none"),G=null,_currentRole&&typeof applyTabVisibility=="function"){var r=_customVisibleTabs||(_s4Roles[_currentRole]?_s4Roles[_currentRole].tabs:_allHubTabs);applyTabVisibility(r)}}(function(){var t="s4_tool_card_order";function a(){return document.getElementById("ilsSubHub")}function r(){var f=a();if(f){var n=localStorage.getItem(t);if(n)try{var d=JSON.parse(n),i=Array.from(f.querySelectorAll(".ils-tool-card")),u={};i.forEach(function(s){var l=s.getAttribute("onclick")||"",m=(l.match(/openILSTool\('([^']+)'\)/)||[])[1];m&&(u[m]=s)}),d.forEach(function(s){u[s]&&f.appendChild(u[s])})}catch{}}}function o(){var f=a();if(f){var n=f.querySelectorAll(".ils-tool-card"),d=[];n.forEach(function(i){var u=i.getAttribute("onclick")||"",s=(u.match(/openILSTool\('([^']+)'\)/)||[])[1];s&&d.push(s)}),localStorage.setItem(t,JSON.stringify(d))}}function c(){var f=a();if(f){var n=null;f.querySelectorAll(".ils-tool-card").forEach(function(d){d.setAttribute("draggable","true"),d.addEventListener("dragstart",function(m){n=this,this.classList.add("dragging"),m.dataTransfer.effectAllowed="move",m.dataTransfer.setData("text/plain","")}),d.addEventListener("dragend",function(){this.classList.remove("dragging"),f.querySelectorAll(".ils-tool-card").forEach(function(m){m.classList.remove("drag-over")})}),d.addEventListener("dragover",function(m){m.preventDefault(),m.dataTransfer.dropEffect="move",this!==n&&this.classList.add("drag-over")}),d.addEventListener("dragleave",function(){this.classList.remove("drag-over")}),d.addEventListener("drop",function(m){if(m.preventDefault(),this.classList.remove("drag-over"),n&&n!==this){var p=Array.from(f.querySelectorAll(".ils-tool-card")),h=p.indexOf(n),v=p.indexOf(this);h<v?f.insertBefore(n,this.nextSibling):f.insertBefore(n,this),o(),c()}n=null});var i=null,u=!1,s=null,l=null;d.addEventListener("touchstart",function(m){var p=this;i=setTimeout(function(){u=!0,l=p,p.classList.add("dragging"),s=p.cloneNode(!0),s.style.position="fixed",s.style.pointerEvents="none",s.style.opacity="0.85",s.style.zIndex="9999",s.style.width=p.offsetWidth+"px",s.style.transform="scale(1.05)",s.style.boxShadow="0 8px 32px rgba(0,170,255,0.3)",document.body.appendChild(s)},500)},{passive:!0}),d.addEventListener("touchmove",function(m){if(!(!u||!s)){m.preventDefault();var p=m.touches[0];s.style.left=p.clientX-s.offsetWidth/2+"px",s.style.top=p.clientY-s.offsetHeight/2+"px",f.querySelectorAll(".ils-tool-card").forEach(function(g){g.classList.remove("drag-over")});var h=document.elementFromPoint(p.clientX,p.clientY);if(h){var v=h.closest(".ils-tool-card");v&&v!==l&&v.classList.add("drag-over")}}},{passive:!1}),d.addEventListener("touchend",function(m){if(clearTimeout(i),u&&l){var p=m.changedTouches[0],h=document.elementFromPoint(p.clientX,p.clientY),v=h?h.closest(".ils-tool-card"):null;if(v&&v!==l){var g=Array.from(f.querySelectorAll(".ils-tool-card")),S=g.indexOf(l),E=g.indexOf(v);S<E?f.insertBefore(l,v.nextSibling):f.insertBefore(l,v),o(),c()}l.classList.remove("dragging"),f.querySelectorAll(".ils-tool-card").forEach(function(x){x.classList.remove("drag-over")})}s&&s.parentNode&&s.parentNode.removeChild(s),u=!1,s=null,l=null}),d.addEventListener("touchcancel",function(){clearTimeout(i),s&&s.parentNode&&s.parentNode.removeChild(s),l&&l.classList.remove("dragging"),f.querySelectorAll(".ils-tool-card").forEach(function(m){m.classList.remove("drag-over")}),u=!1,s=null,l=null})})}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){r(),c()}):(r(),c())})();function ut(){var e=document.getElementById("walletSidebar"),t=document.getElementById("walletOverlay");e&&e.classList.add("open"),t&&t.classList.add("show");var a=document.getElementById("walletSidebarBody"),r=document.getElementById("tabWallet");a&&r&&!a.dataset.loaded&&(a.innerHTML=r.innerHTML,a.dataset.loaded="true",typeof loadWalletData=="function"&&loadWalletData(),ft(a)),ke()}function ft(e){var t=e.querySelector("#slsToggleBtn");if(t){t.removeAttribute("onclick");var a=document.createElement("div");a.id="sidebarFlowPanel",a.style.cssText="display:none;margin-top:12px;background:linear-gradient(135deg,rgba(0,170,255,0.06),rgba(201,168,76,0.04));border:1px solid rgba(0,170,255,0.25);border-radius:3px;padding:16px 18px;",a.innerHTML='<div style="position:relative"><div style="position:absolute;top:-4px;right:0;background:linear-gradient(135deg,#00aaff,#c9a84c);padding:3px 12px;border-radius:0 10px 0 8px;font-size:0.62rem;font-weight:700;color:#050810;letter-spacing:0.5px">LIVE PREVIEW</div><h4 style="margin:0 0 4px;font-size:0.95rem;color:#fff"><i class="fas fa-flask" style="color:#00aaff;margin-right:6px"></i>Credit Economic Flow</h4><p style="color:#8ea4b8;font-size:0.72rem;margin:0 0 12px">See how the Credit economy works. <strong style="color:#c9a84c">Every anchor costs 0.01 Credits.</strong></p><div style="display:grid;grid-template-columns:1fr 1fr;gap:8px"><div style="background:rgba(0,170,255,0.08);border:1px solid rgba(0,170,255,0.2);border-radius:3px;padding:10px;text-align:center"><div style="width:28px;height:28px;border-radius:50%;background:rgba(0,170,255,0.15);display:inline-flex;align-items:center;justify-content:center;margin-bottom:6px"><i class="fas fa-user-plus" style="color:#00aaff;font-size:0.75rem"></i></div><div style="font-size:0.68rem;font-weight:700;color:#fff">1. Account</div><div style="font-size:0.62rem;color:#8ea4b8">Created &amp; provisioned</div></div><div style="background:rgba(0,170,255,0.08);border:1px solid rgba(0,170,255,0.2);border-radius:3px;padding:10px;text-align:center"><div style="width:28px;height:28px;border-radius:50%;background:rgba(0,170,255,0.15);display:inline-flex;align-items:center;justify-content:center;margin-bottom:6px"><i class="fas fa-wallet" style="color:#00aaff;font-size:0.75rem"></i></div><div style="font-size:0.68rem;font-weight:700;color:#fff">2. Wallet Funded</div><div style="font-size:0.62rem;color:#8ea4b8">12 XRP reserve</div></div><div style="background:rgba(201,168,76,0.08);border:1px solid rgba(201,168,76,0.2);border-radius:3px;padding:10px;text-align:center"><div style="width:28px;height:28px;border-radius:50%;background:rgba(201,168,76,0.15);display:inline-flex;align-items:center;justify-content:center;margin-bottom:6px"><i class="fas fa-coins" style="color:#c9a84c;font-size:0.75rem"></i></div><div style="font-size:0.68rem;font-weight:700;color:#fff">3. $SLS Allocated</div><div style="font-size:0.62rem;color:#8ea4b8">Based on plan tier</div></div><div style="background:rgba(0,170,255,0.08);border:1px solid rgba(0,170,255,0.2);border-radius:3px;padding:10px;text-align:center"><div style="width:28px;height:28px;border-radius:50%;background:rgba(0,170,255,0.15);display:inline-flex;align-items:center;justify-content:center;margin-bottom:6px"><i class="fas fa-arrow-right" style="color:#00aaff;font-size:0.75rem"></i></div><div style="font-size:0.68rem;font-weight:700;color:#fff">4. 0.01 Credits &rarr; Treasury</div><div style="font-size:0.62rem;color:#8ea4b8">Per anchor fee</div></div></div><div style="margin-top:10px;padding:8px 12px;background:rgba(0,0,0,0.25);border-radius:3px;font-size:0.7rem"><div style="display:flex;justify-content:space-between;flex-wrap:wrap;gap:6px"><div><span style="color:#8ea4b8">Wallet:</span> <span style="color:#00aaff;font-family:monospace" id="sidebarWalletAddr">rMLmk...f1KLqJ</span></div><div><span style="color:#8ea4b8">Balance:</span> <span style="color:#c9a84c;font-weight:700" id="sidebarSlsBal">'+(document.getElementById("slsBarBalance")?document.getElementById("slsBarBalance").textContent:"25,000")+" Credits</span></div></div></div></div>";var r=e.querySelector("#slsBalanceBar");r?r.parentNode.insertBefore(a,r.nextSibling):e.insertBefore(a,e.firstChild?e.firstChild.nextSibling:null);var o=!1;t.addEventListener("click",function(){o=!o,a.style.display=o?"block":"none",t.innerHTML=o?'<i class="fas fa-chevron-up" style="margin-right:4px"></i>Hide Flow Details':'<i class="fas fa-chart-simple" style="margin-right:4px"></i>Show Flow Details'})}}function mt(){var e=document.getElementById("walletSidebar"),t=document.getElementById("walletOverlay");e&&e.classList.remove("open"),t&&t.classList.remove("show")}function ke(){var e=document.getElementById("slsBarBalance"),t=document.getElementById("walletTriggerBal");e&&t&&(t.textContent=e.textContent||"--")}document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){var e=document.getElementById("platformHub");e&&(e.style.display="block"),document.querySelectorAll(".tab-pane").forEach(function(t){t.classList.remove("show","active"),t.style.display="none"})},100)});document.addEventListener("shown.bs.tab",function(e){ke()});(function(){function e(){var a=document.getElementById("actionItemBadge");if(a){var r=0;typeof s4ActionItems<"u"&&Array.isArray(s4ActionItems)&&(r=s4ActionItems.filter(function(o){return!o.done}).length),r>0?(a.textContent=r,a.style.display="inline-flex"):a.style.display="none"}}setInterval(e,3e3),document.addEventListener("DOMContentLoaded",function(){setTimeout(e,2e3)});var t=Y;Y=function(a){t(a),setTimeout(e,500)}})();(function(){function e(){var a=document.getElementById("slsBarBalance"),r=document.getElementById("slsBarAnchors"),o=document.getElementById("slsBarSpent"),c=document.getElementById("toolSlsBal"),f=document.getElementById("toolSlsAnch"),n=document.getElementById("toolSlsSpent");c&&a&&(c.textContent=a.textContent.replace(" Credits","")),f&&r&&(f.textContent=r.textContent),n&&o&&(n.textContent=o.textContent.replace(" Credits",""))}setInterval(e,2e3);var t=se;se=function(a){t(a),setTimeout(e,200)}})();(function(){var e=hideAnchorAnimation;hideAnchorAnimation=function(){if(e(),G){var t=document.getElementById(G);if(!t)return;var a=t.querySelector(".anchor-confirm-banner");a&&a.remove();var r=s4Vault.length>0?s4Vault[0]:null;if(!r)return;var o=document.createElement("div");o.className="anchor-confirm-banner",o.style.cssText="background:linear-gradient(135deg,rgba(0,204,102,0.08),rgba(0,170,255,0.06));border:1px solid rgba(0,204,102,0.2);border-radius:3px;padding:16px 20px;margin-bottom:16px;animation:panelSlideIn 0.4s ease;position:relative",o.innerHTML='<button onclick="this.parentElement.remove()" style="position:absolute;top:8px;right:12px;background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.85rem">&times;</button><div style="display:flex;align-items:center;gap:8px;margin-bottom:8px"><i class="fas fa-check-circle" style="color:#00cc66;font-size:1.1rem"></i><strong style="color:#fff;font-size:0.9rem">Record Anchored Successfully</strong></div><div style="font-size:0.78rem;color:var(--steel);display:grid;grid-template-columns:80px 1fr;gap:4px 12px"><span style="color:var(--muted)">Type:</span><span>'+(r.label||r.type)+'</span><span style="color:var(--muted)">Hash:</span><span style="font-family:monospace;color:var(--accent);font-size:0.72rem;word-break:break-all">'+(r.hash||"").substring(0,32)+'...</span><span style="color:var(--muted)">TX:</span><span>'+(r.txHash?'<a href="'+(r.explorerUrl||"#")+'" target="_blank" style="color:var(--accent);text-decoration:none">'+r.txHash.substring(0,16)+'... <i class="fas fa-external-link-alt" style="font-size:0.6rem"></i></a>':"Pending")+'</span><span style="color:var(--muted)">Fee:</span><span style="color:#c9a84c">0.01 Credits</span><span style="color:var(--muted)">Time:</span><span>'+new Date().toLocaleTimeString()+"</span></div>";var c=t.querySelector(".s4-card");c&&c.insertBefore(o,c.firstChild),setTimeout(function(){o.parentElement&&o.remove()},15e3)}}})();window.closeILSTool=dt;window.closeWalletSidebar=mt;window.openILSTool=se;window.openWalletSidebar=ut;window.showHub=lt;window.showSection=Y;window.showSystemsSub=ct;(function(){function t(){document.querySelectorAll(".hub-card[data-section]").forEach(function(a){a._s4bound||(a._s4bound=!0,a.addEventListener("click",function(r){var o=this.getAttribute("data-section");o&&typeof Y=="function"&&Y(o)}))})}t(),document.readyState==="loading"&&document.addEventListener("DOMContentLoaded",t)})();var O={ils_manager:{label:"ILS Manager",icon:"fa-clipboard-list",desc:"Full ILS tool suite access",tabs:["hub-analysis","hub-dmsms","hub-readiness","hub-compliance","hub-risk","hub-actions","hub-predictive","hub-lifecycle","hub-roi","hub-vault","hub-docs","hub-reports","hub-submissions","hub-sbom","hub-gfp","hub-cdrl","hub-contract","hub-provenance","hub-analytics","hub-team"]},dmsms_analyst:{label:"DMSMS Analyst",icon:"fa-microchip",desc:"DMSMS tracking and obsolescence management",tabs:["hub-dmsms","hub-risk","hub-lifecycle","hub-actions","hub-vault","hub-docs","hub-reports"]},auditor:{label:"Auditor / Compliance",icon:"fa-shield-halved",desc:"Compliance scorecard and audit vault",tabs:["hub-compliance","hub-vault","hub-actions","hub-docs","hub-reports","hub-submissions"]},contracts:{label:"Contract Specialist",icon:"fa-file-contract",desc:"ROI, submissions, and document management",tabs:["hub-roi","hub-vault","hub-docs","hub-reports","hub-submissions","hub-actions","hub-cdrl","hub-contract"]},supply_chain:{label:"Supply Chain / Provisioning",icon:"fa-truck",desc:"Supply, readiness, and provisioning tools",tabs:["hub-readiness","hub-risk","hub-lifecycle","hub-actions","hub-vault","hub-docs","hub-submissions"]},admin:{label:"Full Access Admin",icon:"fa-user-shield",desc:"All tools visible — unrestricted access",tabs:["hub-analysis","hub-dmsms","hub-readiness","hub-compliance","hub-risk","hub-actions","hub-predictive","hub-lifecycle","hub-roi","hub-vault","hub-docs","hub-reports","hub-submissions","hub-sbom","hub-gfp","hub-cdrl","hub-contract","hub-provenance","hub-analytics","hub-team"]}},fe=["hub-analysis","hub-dmsms","hub-readiness","hub-compliance","hub-risk","hub-actions","hub-predictive","hub-lifecycle","hub-roi","hub-vault","hub-docs","hub-reports","hub-submissions","hub-sbom","hub-gfp","hub-cdrl","hub-contract","hub-provenance","hub-analytics","hub-team"],pt={"hub-analysis":"Gap Analysis","hub-dmsms":"DMSMS Tracker","hub-readiness":"Readiness Calc","hub-compliance":"Compliance","hub-risk":"Supply Chain Risk","hub-actions":"Action Items","hub-predictive":"Predictive Maint","hub-lifecycle":"Lifecycle Cost","hub-roi":"ROI Calculator","hub-vault":"Audit Vault","hub-docs":"Document Library","hub-reports":"Report Gen","hub-submissions":"Submissions & PTD","hub-sbom":"SBOM Viewer","hub-gfp":"GFP Tracker","hub-cdrl":"CDRL Validator","hub-contract":"Contract Extractor","hub-provenance":"Provenance Chain","hub-analytics":"Cross-Program Analytics","hub-team":"Team Management"},_=sessionStorage.getItem("s4_user_role")||"",ae=sessionStorage.getItem("s4_user_title")||"",P=JSON.parse(sessionStorage.getItem("s4_visible_tabs")||"null");function ht(){var e=document.createElement("div");e.id="roleModal",e.style.cssText="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:10000;display:flex;align-items:center;justify-content:center;animation:fadeIn 0.3s ease";var t='<div style="background:var(--card);border:1px solid var(--border);border-radius:3px;padding:32px;max-width:620px;width:95%;max-height:85vh;overflow-y:auto"><h3 style="color:#fff;margin:0 0 4px"><i class="fas fa-user-cog" style="color:var(--accent);margin-right:8px"></i>Configure Your Role</h3><p style="color:var(--steel);font-size:0.85rem;margin-bottom:20px">Select your role to see relevant tools. You can customize visible tools and your displayed title.</p><div style="margin-bottom:16px"><label style="color:var(--steel);font-size:0.8rem;font-weight:600">Your Display Title</label><input id="roleTitle" value="'+(ae||"")+'" style="background:#0a0e1a;color:#fff;border:1px solid rgba(255,255,255,0.15);border-radius:3px;padding:10px;width:100%;margin-top:4px" placeholder="e.g., ILS Analyst, Logistics Specialist, Contract Manager"></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px">';Object.keys(O).forEach(function(a){var r=O[a],o=_===a?"border-color:var(--accent);background:rgba(0,170,255,0.08)":"";t+=`<div class="role-card" onclick="selectRolePreset('`+a+`')" style="border:2px solid `+(o?"var(--accent)":"var(--border)")+";border-radius:3px;padding:14px;cursor:pointer;transition:all 0.2s;"+(o?"background:rgba(0,170,255,0.08)":"")+'" data-role="'+a+'"><div style="display:flex;align-items:center;gap:8px;margin-bottom:6px"><i class="fas '+r.icon+'" style="color:var(--accent);font-size:1.1rem"></i><strong style="color:#fff;font-size:0.9rem">'+r.label+'</strong></div><div style="color:var(--steel);font-size:0.78rem">'+r.desc+'</div><div style="color:var(--muted);font-size:0.72rem;margin-top:4px">'+r.tabs.length+" tools</div></div>"}),t+='</div><details style="margin-bottom:20px;background:rgba(0,170,255,0.03);border:1px solid rgba(0,170,255,0.12);border-radius:3px;padding:0 16px"><summary style="cursor:pointer;color:var(--accent);font-weight:600;font-size:0.85rem;padding:12px 0;list-style:none;display:flex;align-items:center;gap:8px"><i class="fas fa-sliders-h"></i> Customize Visible Tools <i class="fas fa-chevron-down" style="font-size:0.7rem;margin-left:auto;opacity:0.5"></i></summary><div id="roleToolChecks" style="display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:0 0 16px">',fe.forEach(function(a){var r=P?P.indexOf(a)>=0:_?(O[_]?.tabs||[]).indexOf(a)>=0:!0;t+='<label style="display:flex;align-items:center;gap:8px;font-size:0.82rem;color:var(--steel);cursor:pointer;padding:6px 10px;border-radius:3px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);transition:all 0.2s"><input type="checkbox" data-tab="'+a+'" '+(r?"checked":"")+' onchange="onRoleToolToggle()" style="accent-color:#00aaff;width:16px;height:16px;flex-shrink:0"> <span>'+(pt[a]||a)+"</span></label>"}),t+=`</div></details><div style="display:flex;gap:10px;justify-content:flex-end"><button onclick="document.getElementById('roleModal').remove()" style="background:rgba(255,255,255,0.06);color:var(--steel);border:1px solid var(--border);border-radius:3px;padding:8px 20px;cursor:pointer">Cancel</button><button onclick="applyRole()" style="background:var(--accent);color:#fff;border:none;border-radius:3px;padding:8px 24px;cursor:pointer;font-weight:600">Apply Role</button></div></div>`,e.innerHTML=t,document.body.appendChild(e)}function yt(e){_=e,document.querySelectorAll(".role-card").forEach(function(o){o.style.borderColor="var(--border)",o.style.background=""});var t=document.querySelector('.role-card[data-role="'+e+'"]');t&&(t.style.borderColor="var(--accent)",t.style.background="rgba(0,170,255,0.08)");var a=O[e].tabs;document.querySelectorAll('#roleToolChecks input[type="checkbox"]').forEach(function(o){o.checked=a.indexOf(o.dataset.tab)>=0});var r=document.getElementById("roleTitle");r&&!r.value&&(r.value=O[e].label)}function vt(){P=[],document.querySelectorAll('#roleToolChecks input[type="checkbox"]').forEach(function(e){e.checked&&P.push(e.dataset.tab)})}function gt(){var e=document.getElementById("roleTitle")?.value?.trim()||"";ae=e,sessionStorage.setItem("s4_user_role",_),sessionStorage.setItem("s4_user_title",ae);var t;P?(t=P,sessionStorage.setItem("s4_visible_tabs",JSON.stringify(P))):_&&O[_]?(t=O[_].tabs,sessionStorage.removeItem("s4_visible_tabs")):t=fe,Be(t),Me(),typeof reloadVaultForRole=="function"&&reloadVaultForRole(),document.getElementById("roleModal")?.remove(),s4Notify("Role Applied",(e||O[_]?.label||"Custom")+" — "+t.length+" tools active","success")}function Be(e){document.querySelectorAll(".ils-hub-tab").forEach(function(t){var a=t.getAttribute("onclick")||"",r=a.match(/switchHubTab\('([^']+)'/);if(r){var o=r[1];t.style.display=e.indexOf(o)>=0?"":"none"}}),document.querySelectorAll(".ils-tool-card[onclick]").forEach(function(t){var a=t.getAttribute("onclick")||"",r=a.match(/openILSTool\('([^']+)'/);r&&(t.style.display=e.indexOf(r[1])>=0?"":"none")})}function Me(){var e=document.getElementById("roleBadge");if(!e){var t=document.querySelector(".ils-hub-tabs")?.previousElementSibling;if(!t)return;var a=t.querySelector("div:last-child");if(!a)return;e=document.createElement("span"),e.id="roleBadge",e.style.cssText="display:inline-flex;align-items:center;gap:6px;padding:5px 12px;border-radius:3px;font-size:0.75rem;font-weight:600;background:rgba(0,170,255,0.1);border:1px solid rgba(0,170,255,0.25);color:#00aaff;cursor:pointer;transition:all 0.2s;hover:background:rgba(0,170,255,0.2)",e.title="Click to change your role",e.onclick=ht,a.appendChild(e)}var r=_?O[_]?.icon||"fa-user":"fa-user-cog",o=ae||(_?O[_]?.label:"Set Role");e.innerHTML='<i class="fas '+r+'"></i> '+o+' <i class="fas fa-gear" style="font-size:0.6rem;opacity:0.6"></i>'}function pe(){if(_){var e=P||(O[_]?O[_].tabs:fe);Be(e),typeof reloadVaultForRole=="function"&&reloadVaultForRole()}Me()}(function(){function e(n){return Math.round(n).toString().replace(/\B(?=(?:\d{3})+(?!\d))/g,",")}function t(){try{var n=function(A){var z=document.getElementById(A);return z&&parseFloat(z.value)||0},d=n("roiPrograms"),i=n("roiRecords"),u=n("roiFTEs"),s=n("roiRate"),l=n("roiAudit"),m=n("roiError"),p=n("roiIncidents"),h=n("roiLicense"),v=d*i,g=1+Math.sqrt(Math.max(0,v))/50,S=u*2080,E=S*s,x=E*.65*g,L=p*m*.9,y=l*.7*Math.max(1,d/5),w=v>0?x/12/v:0,I=x+L+y,T=I-h,b=h>0?T/h*100:0,C=I>0?Math.ceil(h/I*12):0,M=I*5-h*5,F=function(A,z,q){var re=document.getElementById(A);re&&(re.textContent=z,q&&(re.style.color=q))};F("roiSavings","$"+e(T),T>0?"#00cc66":"#ff4444"),F("roiPercent",b.toFixed(0)+"%",b>0?"#00cc66":"#ff4444"),F("roiPayback",C+" mo",null),F("roi5Year","$"+e(M),M>0?"#00cc66":"#ff4444");var U=document.getElementById("roiOutput");U&&(U.innerHTML='<div style="background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:20px;margin-top:12px"><div class="section-label"><i class="fas fa-chart-line"></i> ROI BREAKDOWN</div><div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;font-size:0.85rem;margin-bottom:16px"><div><span style="color:var(--steel)">Labor Automation (65%)</span><br><strong style="color:#00cc66">$'+e(x)+'</strong></div><div><span style="color:var(--steel)">Error Reduction (90%)</span><br><strong style="color:#00cc66">$'+e(L)+'</strong></div><div><span style="color:var(--steel)">Audit Cost Reduction (70%)</span><br><strong style="color:#00cc66">$'+e(y)+'</strong></div><div><span style="color:var(--steel)">S4 Ledger License</span><br><strong style="color:#ff6b6b">-$'+e(h)+'</strong></div></div><hr style="border-color:var(--border);margin:12px 0"><div style="display:flex;justify-content:space-between;align-items:center"><div><span style="color:var(--steel);font-size:0.82rem">Net Annual Savings</span><br><span style="font-size:1.5rem;font-weight:800;color:'+(T>0?"#00cc66":"#ff4444")+'">$'+e(T)+'</span></div><div><span style="color:var(--steel);font-size:0.82rem">Per-Record Savings</span><br><span style="font-size:1.1rem;font-weight:700;color:var(--accent)">$'+w.toFixed(2)+'/record</span></div><div><span style="color:var(--steel);font-size:0.82rem">Volume Multiplier</span><br><span style="font-size:1.1rem;font-weight:700;color:var(--accent)">'+g.toFixed(2)+"x</span></div></div></div>");try{typeof renderROICharts=="function"&&renderROICharts()}catch{}}catch(A){console.error("[S4-BP-ROI] Error:",A)}}function a(){var n=["roiPrograms","roiRecords","roiFTEs","roiRate","roiAudit","roiError","roiIncidents","roiLicense"],d=0;return n.forEach(function(i){var u=document.getElementById(i);u&&(u.removeAttribute("oninput"),u.addEventListener("input",t),d++)}),d>0&&t(),d}function r(){var n={};try{var d=document.querySelectorAll('#ilsCoverage input[type="checkbox"], .ils-checklist input[type="checkbox"]'),i=0,u=d.length||1;d.forEach(function(m){m.checked&&i++}),n.ilsPct=Math.round(i/u*100)}catch{n.ilsPct=0}var s=["pctCMMC","pctNIST","pctDFARS","pctFAR","pctILS","pctDMSMSmgmt"];n.comp=s.map(function(m){var p=document.getElementById(m);return p&&parseInt(p.textContent)||0}),n.vault=typeof s4Vault<"u"?s4Vault.length:typeof getLocalRecords=="function"?getLocalRecords().length:0,n.actions=typeof s4ActionItems<"u"?s4ActionItems.length:0,n.actionsDone=0,typeof s4ActionItems<"u"&&s4ActionItems.forEach(function(m){m.status==="done"&&n.actionsDone++});var l=function(m){var p=document.getElementById(m);return p&&parseFloat(p.value)||0};return n.roiPrograms=l("roiPrograms"),n.roiRecords=l("roiRecords"),n.roiFTEs=l("roiFTEs"),n.roiRate=l("roiRate"),n.roiLicense=l("roiLicense"),n.roiAudit=l("roiAudit"),n.stats=typeof stats<"u"?stats:{anchored:0,slsFees:0},n.dmsmsItems=typeof dmsmsItems<"u"?dmsmsItems:[],n.riskItems=typeof riskItems<"u"?riskItems:[],n}var o={gapRadarChart:function(){var n=r(),d=Math.min(100,20+n.vault*3),i=Math.min(100,15+n.vault*4),u=Math.min(100,n.comp[0]||10),s=Math.min(100,10+(n.dmsmsItems.length||0)*8),l=Math.min(100,15+(n.riskItems.length||0)*5),m=Math.min(100,20+n.ilsPct*.6),p=[d,i,u,s,l,m].map(function(h){return Math.min(100,h+30+Math.random()*5|0)});return{type:"radar",data:{labels:["Tracking","Audit","Compliance","Obsolescence","Risk","Budget"],datasets:[{label:"Current (Manual)",data:[d,i,u,s,l,m],borderColor:"#ff6b6b",backgroundColor:"rgba(255,107,107,0.1)",pointBackgroundColor:"#ff6b6b"},{label:"With S4 Ledger",data:p,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",pointBackgroundColor:"#00aaff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"#8ea4b8",font:{size:10}}}},scales:{r:{grid:{color:"rgba(255,255,255,0.06)"},angleLines:{color:"rgba(255,255,255,0.06)"},pointLabels:{color:"#8ea4b8",font:{size:9}},ticks:{display:!1}}}}}},gapBarChart:function(){var n=r(),d=Math.max(0,100-(20+n.vault*3)),i=Math.max(0,100-(15+n.vault*4)),u=Math.max(0,100-(n.comp[0]||10)),s=Math.max(0,100-(10+(n.dmsmsItems.length||0)*8)),l=Math.max(0,100-(15+(n.riskItems.length||0)*5)),m=Math.max(0,100-(20+n.ilsPct*.6));return{type:"bar",data:{labels:["Tracking","Audit","Compliance","Obsolescence","Risk","Budget"],datasets:[{label:"Gap %",data:[d,i,u,s,l,m],backgroundColor:["#ff6b6b","#fb923c","#c9a84c","#00aaff","#38bdf8","#06b6d4"],borderWidth:0,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},max:100},y:{ticks:{color:"#8ea4b8",font:{size:9}},grid:{display:!1}}}}}},dmsmsPieChart:function(){var n=r(),d=n.dmsmsItems,i=0,u=0,s=0,l=0,m=0;return d.length>0?d.forEach(function(p){var h=(p.status||"").toLowerCase();h.indexOf("obsolete")>=0?s++:h.indexOf("risk")>=0||h.indexOf("diminish")>=0?u++:h.indexOf("discontin")>=0?l++:h.indexOf("eol")>=0||h.indexOf("last")>=0?m++:i++}):(i=45,u=20,s=15,l=10,m=10),{type:"doughnut",data:{labels:["Active","At Risk","Obsolete","Discontinued","EOL Planned"],datasets:[{data:[i,u,s,l,m],backgroundColor:["#00aaff","#c9a84c","#ff6b6b","#00aaff","#6b7d93"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:9},padding:6}}}}}},readinessGauge:function(){var n=r(),d=Math.max(30,n.ilsPct),i=Math.min(100,d+15+(n.vault>5?10:0)),u=Math.min(100,d+(n.dmsmsItems.length>0?-5:8)),s=Math.min(100,d-12+n.vault*2),l=Math.min(100,d+20),m=Math.min(100,d+6+n.actionsDone*3),p=Math.min(100,d+12);return{type:"bar",data:{labels:["Personnel","Equipment","Supply","Training","Maintenance","C4ISR"],datasets:[{label:"Readiness %",data:[i,u,s,l,m,p],backgroundColor:"rgba(0,170,255,0.6)",borderColor:"#00aaff",borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:9}},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0,max:100}}}}},complianceRadarChart:function(){var n=r(),d=n.comp[2]||30,i=Math.min(100,40+n.vault*4),u=n.comp[1]||25,s=n.comp[0]||20,l=Math.min(100,30+n.ilsPct*.5),m=Math.min(100,35+n.vault*3);return{type:"polarArea",data:{labels:["DFARS","ITAR","NIST 800-171","CMMC","ISO 27001","SOX"],datasets:[{data:[d,i,u,s,l,m],backgroundColor:["rgba(0,170,255,0.5)","rgba(201,168,76,0.5)","rgba(56,189,248,0.5)","rgba(255,107,107,0.5)","rgba(0,170,255,0.5)","rgba(6,182,212,0.5)"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:9},padding:6}}},scales:{r:{grid:{color:"rgba(255,255,255,0.06)"},ticks:{display:!1}}}}}},roiLineChart:function(){var n=r(),d=n.roiPrograms*n.roiRecords,i=1+Math.sqrt(Math.max(0,d))/50,u=n.roiFTEs*2080*n.roiRate,s=u*.65*i,l=n.roiAudit*.7*Math.max(1,n.roiPrograms/5),m=s+l,p=n.roiLicense||1,h=[],v=[],g=n.roiPrograms>0||n.roiFTEs>0||n.roiLicense>0;if(g)for(var S=0,E=1;E<=5;E++)for(var x=1;x<=4;x++){h.push("Y"+E+"-Q"+x);var L=(E-1)*4+x,y=.2+.65*(1-Math.exp(-.18*L)),w=m/4*y,I=p/4;S+=w-I;var T=p>0?S/p*100:0;v.push(Math.round(T))}if(!g||v.length===0||v.every(function(M){return M===0})){h=[],v=[];for(var b=1;b<=5;b++)for(var C=1;C<=4;C++){h.push("Y"+b+"-Q"+C);var L=(b-1)*4+C;v.push(Math.round(-15+3.5*L+.8*Math.pow(L,1.45)))}}return{type:"line",data:{labels:h,datasets:[{label:"Cumulative ROI %",data:v,borderColor:"#00cc66",backgroundColor:"rgba(0,204,102,0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"#00cc66"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"5-Year Cumulative ROI",color:"#8ea4b8",font:{size:11}}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:8},maxRotation:45},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:9},callback:function(M){return M+"%"}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}}},riskHeatChart:function(){var n=r(),d=[];if(n.riskItems.length>0)n.riskItems.forEach(function(l){d.push({x:l.likelihood||Math.ceil(Math.random()*9),y:l.impact||Math.ceil(Math.random()*9)})});else for(var i=Math.max(3,Math.min(12,3+n.vault+n.actions)),u=0;u<i;u++)d.push({x:1+Math.floor(Math.random()*9),y:1+Math.floor(Math.random()*9)});var s=d.map(function(l){var m=l.x*l.y;return m>=50?"rgba(255,70,70,0.8)":m>=25?"rgba(255,165,0,0.7)":m>=10?"rgba(201,168,76,0.6)":"rgba(0,170,255,0.5)"});return{type:"scatter",data:{datasets:[{label:"Risk Items",data:d,backgroundColor:s,borderColor:s,pointRadius:7}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:d.length+" Risk Items Mapped",color:"#8ea4b8",font:{size:11}}},scales:{x:{title:{display:!0,text:"Likelihood →",color:"#8ea4b8",font:{size:9}},ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},min:0,max:10},y:{title:{display:!0,text:"Impact →",color:"#8ea4b8",font:{size:9}},ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},min:0,max:10}}}}},lifecyclePieChart:function(){var n=r(),d=Math.min(30,(n.dmsmsItems.length||0)*5),i=Math.min(15,n.ilsPct*.15);return{type:"line",data:{labels:["Intro","Growth","Maturity","Sustain","Phase Out","Disposal"],datasets:[{label:"Availability %",data:[95-d*.1,92-d*.2+i,88-d*.4+i,75-d*.6+i*2,50-d*.3+i,20+i*.5].map(function(u){return Math.round(Math.max(5,Math.min(100,u)))}),borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",fill:!0,tension:.3},{label:"Cost Index",data:[30,25+d*.3,35+d*.5,55+d*.8-i,70+d-i*2,90+d*.5-i].map(function(u){return Math.round(Math.max(5,Math.min(100,u)))}),borderColor:"#ff6b6b",backgroundColor:"rgba(255,107,107,0.05)",fill:!0,tension:.3}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"#8ea4b8",font:{size:10}}}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:9}},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}}}};window._bpRenderInPanel=c;function c(n){if(typeof Chart>"u"){console.warn("[S4-BP-Charts] Chart.js not loaded");return}if(typeof injectChartContainers=="function")try{injectChartContainers()}catch(i){console.error("[S4-BP-Charts] injectChartContainers error:",i)}var d=n.querySelectorAll("canvas");if(d.length===0){console.log("[S4-BP-Charts] No canvases found in panel "+n.id);return}d.forEach(function(i){if(!i.getAttribute("data-bp-rendered")){var u=o[i.id];if(!u){console.log("[S4-BP-Charts] No config for canvas: "+i.id);return}try{var s=Chart.getChart(i);s&&s.destroy(),!i.style.height&&!i.getAttribute("height")&&(i.style.height="220px"),i.style.width="100%",i.style.display="block";var l=i.closest(".chart-container");l&&(l.style.display="block",l.style.visibility="visible"),new Chart(i,u()),i.setAttribute("data-bp-rendered","1"),i.setAttribute("data-bp-ts",Date.now()),console.log("[S4-BP-Charts] Rendered: "+i.id)}catch(m){console.error("[S4-BP-Charts] Failed "+i.id+":",m)}}})}function f(){if(console.log("[S4-Bulletproof-v5] Initializing..."),a()===0&&(setTimeout(a,2e3),setTimeout(a,5e3)),window.calcROI=t,typeof window.openILSTool=="function"){var n=window.openILSTool;window.openILSTool=function(i){n(i),setTimeout(function(){var u=document.getElementById(i);u&&c(u)},300),setTimeout(function(){var u=document.getElementById(i);u&&c(u)},800),setTimeout(function(){var u=document.getElementById(i);u&&c(u)},2e3)},console.log("[S4-Bulletproof-v5] Hooked openILSTool")}if(typeof window.switchHubTab=="function"){var d=window.switchHubTab;window.switchHubTab=function(i,u){d(i,u),setTimeout(function(){var s=document.getElementById(i);s&&c(s)},400)}}document.querySelectorAll(".ils-hub-panel").forEach(function(i){var u=new MutationObserver(function(s){s.forEach(function(l){l.target.classList&&l.target.classList.contains("active")&&setTimeout(function(){c(l.target)},400)})});u.observe(i,{attributes:!0,attributeFilter:["class","style"]})}),setTimeout(function(){document.querySelectorAll(".ils-hub-panel.active").forEach(function(i){c(i)})},2e3),setTimeout(function(){if(typeof loadPerformanceMetrics=="function")try{loadPerformanceMetrics()}catch{}},1500),setTimeout(a,3e3),typeof pe=="function"&&pe(),console.log("[S4-Bulletproof-v5] Init complete")}window._s4RefreshCharts=function(){document.querySelectorAll("canvas[data-bp-rendered]").forEach(function(d){d.removeAttribute("data-bp-rendered")});var n=document.querySelector(".ils-hub-panel.active");n&&c(n)},document.readyState==="loading"?document.addEventListener("DOMContentLoaded",f):f()})();window.applyRole=gt;window.onRoleToolToggle=vt;window.selectRolePreset=yt;
//# sourceMappingURL=index-DrZrsbPQ.js.map
