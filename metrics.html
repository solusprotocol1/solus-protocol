<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <title>S4 Ledger | Live Network Metrics</title>
    <meta name="description" content="Real-time defense logistics analytics — hash anchoring volume, $SLS fee activity, and network stats from the XRP Ledger.">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/s4-assets/style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .stat-box{background:linear-gradient(135deg,rgba(0,170,255,0.08),rgba(26,58,92,0.15));border:1px solid rgba(0,170,255,0.2);border-radius:16px;padding:28px 20px;text-align:center;transition:all 0.4s ease;margin-bottom:20px}
        .stat-box:hover{transform:translateY(-5px);border-color:rgba(0,170,255,0.5);box-shadow:0 15px 40px rgba(0,170,255,0.15)}
        .stat-value{font-size:2.5rem;font-weight:800;background:#00aaff;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1.1}
        .stat-label{font-size:0.9rem;color:var(--text-secondary);margin-top:8px;font-weight:500}
        .stat-delta{font-size:0.85rem;color:var(--accent);margin-top:6px;font-weight:600}
        .live-indicator{display:inline-flex;align-items:center;gap:10px;background:rgba(0,170,255,0.1);padding:10px 20px;border-radius:30px;font-size:0.9rem;font-weight:600;color:var(--accent);border:1px solid rgba(0,170,255,0.3);animation:indicatorGlow 2s ease-in-out infinite}
        @keyframes indicatorGlow{0%,100%{box-shadow:0 0 10px rgba(0,170,255,0.2)}50%{box-shadow:0 0 25px rgba(0,170,255,0.4)}}
        .live-dot{width:10px;height:10px;background:var(--accent);border-radius:50%;box-shadow:0 0 10px var(--accent)}
        .filter-btn{background:rgba(0,170,255,0.08);color:var(--accent);border:1px solid rgba(0,170,255,0.25);border-radius:10px;padding:10px 18px;margin:4px;cursor:pointer;font-weight:600;font-size:0.85rem;transition:all 0.3s;font-family:inherit}
        .filter-btn:hover{background:rgba(0,170,255,0.15);transform:translateY(-2px)}
        .filter-btn.active{background:linear-gradient(135deg,#00aaff,#0088cc);color:#fff;border-color:transparent;box-shadow:0 5px 20px rgba(0,170,255,0.3)}
        .filter-select{background:rgba(0,170,255,0.08);color:#fff;border:1px solid rgba(0,170,255,0.25);border-radius:10px;padding:10px 15px;font-weight:500;cursor:pointer;font-family:inherit}
        .filter-select:focus{outline:none;border-color:var(--accent)}
        .filter-select option{background:#0a0a0f}
        .export-btn{background:var(--accent-dim);color:var(--accent);border:1px solid rgba(0,170,255,0.2);border-radius:12px;padding:12px 24px;cursor:pointer;font-weight:600;font-size:0.9rem;transition:all 0.3s;display:inline-flex;align-items:center;gap:8px;font-family:inherit}
        .export-btn:hover{background:rgba(201,168,76,0.2);transform:translateY(-3px);box-shadow:0 10px 30px rgba(201,168,76,0.2)}
        .recent-table{width:100%;margin-top:20px;border-collapse:collapse}
        .recent-table th{color:var(--accent);padding:15px 12px;border-bottom:2px solid rgba(0,170,255,0.2);text-align:left;font-weight:700;font-size:0.85rem;text-transform:uppercase;letter-spacing:0.5px}
        .recent-table td{padding:14px 12px;border-bottom:1px solid rgba(255,255,255,0.05);transition:background 0.2s;color:var(--text-secondary)}
        .recent-table tr:hover td{background:rgba(0,170,255,0.03)}
        .badge-type{background:linear-gradient(135deg,#00aaff,#0088cc);color:#fff;padding:6px 12px;border-radius:8px;font-size:0.75rem;font-weight:600;text-transform:uppercase}
        @media(max-width:768px){.stat-value{font-size:1.8rem}.d-flex.justify-content-between{flex-direction:column;gap:15px}}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.3}}
    </style>
</head>
<body>
<nav id="mainNav" style="position:fixed;top:0;left:0;right:0;z-index:1000;background:rgba(5,8,16,0.95);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid rgba(255,255,255,0.06);height:64px;">
    <div style="max-width:1200px;margin:0 auto;padding:0 2rem;display:flex;align-items:center;justify-content:space-between;height:100%;">
        <a href="/" style="display:flex;align-items:center;gap:10px;text-decoration:none;color:#fff;font-weight:700;font-size:1rem;">
            <img src="/s4-assets/S4Ledger_logo.png" alt="S4 Ledger" style="height:32px;width:32px;">
            <span>S4 Ledger</span>
        </a>
        <ul id="navLinks" style="display:flex;align-items:center;gap:0.25rem;list-style:none;margin:0;padding:0;">
            <li><a href="/demo-app/" style="color:rgba(255,255,255,0.7);padding:0.5rem 0.75rem;font-size:0.875rem;font-weight:500;text-decoration:none;border-radius:6px;">Platform</a></li>
            <li><a href="/s4-use-cases/" style="color:rgba(255,255,255,0.7);padding:0.5rem 0.75rem;font-size:0.875rem;font-weight:500;text-decoration:none;border-radius:6px;">Use Cases</a></li>
            <li><a href="/s4-pricing/" style="color:rgba(255,255,255,0.7);padding:0.5rem 0.75rem;font-size:0.875rem;font-weight:500;text-decoration:none;border-radius:6px;">Pricing</a></li>
            <li><a href="/s4-investors/" style="color:rgba(255,255,255,0.7);padding:0.5rem 0.75rem;font-size:0.875rem;font-weight:500;text-decoration:none;border-radius:6px;">Company</a></li>
            <li><a href="https://github.com/s4ledger/s4-ledger" target="_blank" style="color:rgba(255,255,255,0.7);padding:0.5rem 0.75rem;font-size:0.875rem;font-weight:500;text-decoration:none;border-radius:6px;">Docs</a></li>
            <li><a href="/s4-contact/" style="background:#00aaff;color:#fff;padding:0.5rem 1.25rem;font-size:0.875rem;font-weight:600;text-decoration:none;border-radius:6px;margin-left:0.5rem;">Request Demo</a></li>
        </ul>
        <button onclick="var nl=document.getElementById('navLinks');nl.style.display=nl.style.display==='flex'?'none':'flex';" aria-label="Menu" style="display:none;background:none;border:none;color:#fff;font-size:1.25rem;cursor:pointer;padding:0.5rem;">
            <i class="fas fa-bars"></i>
        </button>
    </div>
</nav>
<div class="page-hero">
    <div class="container">
        <div class="section-label">Live Metrics</div>
        <h1>Network Analytics</h1>
        <p>Real-time hash anchoring volume, $SLS fee activity, and network stats from the XRP Ledger.</p>
    </div>
</div>
<div class="container"><div class="divider"></div></div>
<section class="section"><div class="container">

        <div class="card reveal">
            <h3 style="margin-bottom:5px;"><i class="fas fa-bolt" style="color:var(--accent);margin-right:8px;"></i> Hash Anchoring Over Time</h3>
            <p style="color:var(--text-secondary);font-size:0.9rem;">Each bar represents hashes anchored during that time period</p>
            <div class="mb-3" id="hashBtns">
                <button class="filter-btn active" data-view="minute">Per Minute</button>
                <button class="filter-btn" data-view="hour">Per Hour</button>
                <button class="filter-btn" data-view="day">Daily</button>
                <button class="filter-btn" data-view="week">Weekly</button>
                <button class="filter-btn" data-view="month">Monthly</button>
            </div>
            <canvas id="hashChart" height="100"></canvas>
        </div>

        <div class="card reveal">
            <h3 style="margin-bottom:5px;"><i class="fas fa-shield-halved" style="color:var(--accent);margin-right:8px;"></i> Records Secured Breakdown</h3>
            <div style="display:flex;align-items:center;flex-wrap:wrap;gap:8px;color:var(--text-secondary);font-size:0.9rem;margin-bottom:12px;">
                <span>Distribution of record types anchored to XRPL</span>
                <select class="filter-select" id="recordTypeFilter" onchange="filterByRecordType()" style="font-size:0.85rem;padding:6px 12px;">
                    <option value="all">All Record Types</option>
                </select>
                <select class="filter-select" id="platformFilter" onchange="filterByRecordType()" style="font-size:0.85rem;padding:6px 12px;">
                    <option value="all">All Platforms</option>
                </select>
            </div>
            <canvas id="recordChart" height="100"></canvas>
        </div>

        <div class="card reveal">
            <h3 style="margin-bottom:5px;"><i class="fas fa-coins" style="color:var(--accent);margin-right:8px;"></i> $SLS Fee Activity</h3>
            <p style="color:var(--text-secondary);font-size:0.9rem;">Fees collected per time period (0.01 $SLS per anchor)</p>
            <div class="mb-3" id="feeBtns">
                <button class="filter-btn active" data-view="minute">Per Minute</button>
                <button class="filter-btn" data-view="hour">Per Hour</button>
                <button class="filter-btn" data-view="day">Daily</button>
                <button class="filter-btn" data-view="week">Weekly</button>
                <button class="filter-btn" data-view="month">Monthly</button>
            </div>
            <canvas id="feeChart" height="100"></canvas>
        </div>

        <div class="card reveal">
            <h3 style="margin-bottom:5px;"><i class="fas fa-arrow-trend-up" style="color:var(--text-muted);margin-right:8px;"></i> XRPL Transaction Volume</h3>
            <p style="color:var(--text-secondary);font-size:0.9rem;">Number of transactions per time period</p>
            <div class="mb-3" id="txBtns">
                <button class="filter-btn active" data-view="minute">Per Minute</button>
                <button class="filter-btn" data-view="hour">Per Hour</button>
                <button class="filter-btn" data-view="day">Daily</button>
                <button class="filter-btn" data-view="week">Weekly</button>
                <button class="filter-btn" data-view="month">Monthly</button>
            </div>
            <canvas id="txChart" height="100"></canvas>
        </div>

        <div class="card reveal">
            <h3 style="margin-bottom:5px;"><i class="fas fa-list-check" style="color:var(--accent);margin-right:8px;"></i> Recent Anchored Records</h3>
            <p style="color:var(--text-secondary);font-size:0.9rem;">Individual records with exact timestamps</p>
            <div style="max-height:400px;overflow-y:auto;border:1px solid rgba(0,170,255,0.2);border-radius:8px;">
                <table class="recent-table" style="display:table;width:100%;">
                    <thead style="position:sticky;top:0;background:#0a0a0f;z-index:1;"><tr><th>Timestamp</th><th>Record Type</th><th>Hash (truncated)</th><th>Fee</th></tr></thead>
                    <tbody id="recentBody"><tr><td colspan="4" style="text-align:center;color:var(--text-secondary);">Loading...</td></tr></tbody>
                </table>
            </div>
            <p style="color:var(--text-muted);font-size:0.85rem;text-align:center;margin-top:12px;"><span id="liveRefreshDot" style="display:inline-block;width:8px;height:8px;border-radius:50%;background:#14f195;margin-right:6px;vertical-align:middle;animation:pulse 2s infinite"></span>Auto-refreshes every 5 seconds | Last updated: <span id="lastUpdated">—</span></p>
        </div>

        <div style="text-align:center;padding:30px 20px;margin-top:30px;border-top:1px solid var(--border);color:var(--text-secondary);font-size:0.9rem;">
            <p><i class="fas fa-satellite-dish" style="color:var(--accent);margin-right:6px;"></i> Data sourced from XRPL public ledger via account <a href="https://livenet.xrpl.org/accounts/r95GyZac4butvVcsTWUPpxzekmyzaHsTA5" target="_blank" style="color:var(--accent);font-family:monospace;">r95GyZac...TA5</a></p>
            <p style="margin-top:5px;">All metrics are real-time and verifiable on-chain. <a href="https://xrpl.org" target="_blank" style="color:var(--accent);">Learn about XRPL &rarr;</a></p>
        </div>

        <!-- ILS Workspace Cross-Link -->
        <div class="card reveal" style="border-color:rgba(0,170,255,0.3);background:linear-gradient(135deg,rgba(0,170,255,0.04),rgba(20,241,149,0.02));text-align:center;margin-top:20px;">
            <h3 style="margin-bottom:8px;"><i class="fas fa-brain" style="color:var(--accent);margin-right:8px;"></i> ILS Workspace</h3>
            <p style="color:var(--text-secondary);font-size:0.88rem;margin-bottom:16px;">13-tool ILS command center &mdash; gap analysis, DMSMS, readiness, lifecycle cost, ROI, action items, audit vault, doc library, compliance scorecard, supply chain risk, audit reports, predictive maintenance, integrated logistics insights engine (ILIE) &amp; AI agent.</p>
            <div style="display:flex;justify-content:center;gap:10px;flex-wrap:wrap;">
                <a href="/demo-app/#tabILS" style="background:linear-gradient(135deg,#00aaff,#0088cc);color:#fff;padding:10px 22px;border-radius:10px;text-decoration:none;font-weight:700;font-size:0.9rem;transition:all 0.3s;display:inline-flex;align-items:center;gap:6px;"><i class="fas fa-brain"></i> Open ILS Workspace</a>
                <a href="/sdk-playground/" style="background:var(--accent-dim);color:var(--accent);border:1px solid rgba(0,170,255,0.2);padding:10px 22px;border-radius:10px;text-decoration:none;font-weight:700;font-size:0.9rem;transition:all 0.3s;display:inline-flex;align-items:center;gap:6px;"><i class="fas fa-code"></i> SDK Playground</a>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="footer">
    <div class="container">
        <div class="footer-inner">
            <div>
                <a href="/" class="footer-brand">
                    <img src="/s4-assets/S4Ledger_logo.png" alt="S4 Ledger">
                    <span>S4 Ledger</span>
                </a>
                <div class="footer-tagline">Immutable defense logistics. Built on the XRP Ledger.</div>
            </div>
            <div class="footer-links">
                <div class="footer-col">
                    <h5>Product</h5>
                    <a href="/demo-app/">Platform</a>
                    <a href="/sdk-playground/">SDK Playground</a>
                    <a href="/metrics.html">Live Metrics</a>
                    <a href="/transactions.html">Transactions</a>
                </div>
                <div class="footer-col">
                    <h5>Company</h5>
                    <a href="/s4-about/">About</a>
                    <a href="/s4-investors/">Investors</a>
                    <a href="/s4-partners/">Partners</a>
                    <a href="/s4-roadmap/">Roadmap</a>
                </div>
                <div class="footer-col">
                    <h5>Resources</h5>
                    <a href="/s4-use-cases/">Use Cases</a>
                    <a href="/s4-faq/">FAQ</a>
                    <a href="/s4-pricing/">Pricing</a>
                    <a href="/security/">Security</a>
                </div>
                <div class="footer-col">
                    <h5>Connect</h5>
                    <a href="/s4-contact/">Contact</a>
                    <a href="https://github.com/s4ledger/s4-ledger" target="_blank">GitHub</a>
                    <a href="https://x.com" target="_blank">X / Twitter</a>
                    <a href="https://linkedin.com" target="_blank">LinkedIn</a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <span>&copy; 2025 S4 Systems, LLC. $SLS is a utility token &mdash; not equity or an investment contract.</span>
            <div class="footer-bottom-links">
                <a href="/s4-terms/">Terms</a>
                <a href="/s4-privacy/">Privacy</a>
                <a href="/security-policy/">Security Policy</a>
            </div>
        </div>
    </div>
</footer>

    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ── localStorage cross-page record sync ──
        const S4_STORAGE_KEY = 's4_anchored_records';
        function getLocalRecords() { try { return JSON.parse(localStorage.getItem(S4_STORAGE_KEY) || '[]'); } catch { return []; } }

        let metricsData = null;
        let hashChart, recordChart, feeChart, txChart;
        let currentHashView = 'minute', currentFeeView = 'minute', currentTxView = 'minute';
        let selectedRecordType = 'all';

        async function loadMetrics() {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 8000);
                const response = await fetch('/api/metrics', { signal: controller.signal });
                clearTimeout(timeoutId);
                metricsData = await response.json();

                // Merge locally-anchored records from localStorage
                const localRecs = getLocalRecords();
                if (localRecs.length > 0) {
                    metricsData.total_hashes = (metricsData.total_hashes || 0) + localRecs.length;
                    metricsData.total_fees = +((metricsData.total_fees || 0) + localRecs.length * 0.01).toFixed(2);
                    metricsData.individual_records = [...(metricsData.individual_records || []), ...localRecs];
                    if (!metricsData.records_by_type) metricsData.records_by_type = {};
                    if (!metricsData.records_by_branch) metricsData.records_by_branch = {};
                    for (const r of localRecs) {
                        const label = r.record_label || r.record_type || 'Unknown';
                        metricsData.records_by_type[label] = (metricsData.records_by_type[label] || 0) + 1;
                        metricsData.records_by_branch[r.branch || 'JOINT'] = (metricsData.records_by_branch[r.branch || 'JOINT'] || 0) + 1;
                        // Add to time-series for day view
                        try {
                            const ts = new Date(r.timestamp);
                            const dayKey = ts.toLocaleDateString('en-US', { month: 'short', day: '2-digit' });
                            if (!metricsData.hashes_by_day) metricsData.hashes_by_day = {};
                            if (!metricsData.fees_by_day) metricsData.fees_by_day = {};
                            metricsData.hashes_by_day[dayKey] = (metricsData.hashes_by_day[dayKey] || 0) + 1;
                            metricsData.fees_by_day[dayKey] = +((metricsData.fees_by_day[dayKey] || 0) + 0.01).toFixed(4);
                        } catch(e) {}
                    }
                }

                document.getElementById('totalHashes').textContent = metricsData.total_hashes || 0;
                document.getElementById('totalFees').textContent = (metricsData.total_fees || 0).toFixed(2);
                document.getElementById('recordTypes').textContent = Object.keys(metricsData.records_by_type || {}).length;
                const hashesToday = metricsData.hashes_today || 0;
                const feesToday = metricsData.fees_today || 0;
                document.getElementById('hashesToday').textContent = '+' + hashesToday + ' today';
                document.getElementById('feesToday').textContent = '+$' + feesToday.toFixed(2) + ' today';
                const thisMonth = metricsData.this_month || 0;
                document.getElementById('thisMonth').textContent = thisMonth;
                rebuildRecordTypeFilter();
                renderHashChart(currentHashView);
                renderRecordChart();
                renderFeeChart(currentFeeView);
                renderTxChart(currentTxView);
                renderRecentTable();
                try { document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString('en-US',{hour12:false}); } catch(e){}
            } catch (err) {
                console.warn('Metrics load issue, loading from localStorage:', err.message);
                // Fallback: build metrics entirely from localStorage records
                const localRecs = getLocalRecords();
                if (!metricsData) metricsData = { total_hashes: 0, total_fees: 0, records_by_type: {}, records_by_branch: {}, individual_records: [], hashes_today: 0, fees_today: 0, this_month: 0, hashes_by_minute: {}, hashes_by_hour: {}, hashes_by_day: {}, hashes_by_week: {}, hashes_by_month: {}, fees_by_minute: {}, fees_by_hour: {}, fees_by_day: {}, fees_by_week: {}, fees_by_month: {} };
                const now = new Date();
                const todayStr = now.toLocaleDateString('en-US');
                const monthStr = now.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                if (localRecs.length > 0) {
                    metricsData.total_hashes = localRecs.length;
                    metricsData.total_fees = +(localRecs.length * 0.01).toFixed(2);
                    metricsData.individual_records = localRecs;
                    for (const r of localRecs) {
                        const label = r.record_label || r.record_type || 'Unknown';
                        metricsData.records_by_type[label] = (metricsData.records_by_type[label] || 0) + 1;
                        metricsData.records_by_branch[r.branch || 'JOINT'] = (metricsData.records_by_branch[r.branch || 'JOINT'] || 0) + 1;
                        try {
                            const ts = new Date(r.timestamp);
                            const dayKey = ts.toLocaleDateString('en-US', { month: 'short', day: '2-digit' });
                            const hourKey = ts.toLocaleTimeString('en-US', { hour: '2-digit', hour12: false }) + ':00';
                            const minKey = ts.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false });
                            const weekKey = 'Week ' + Math.ceil(ts.getDate() / 7);
                            const monKey = ts.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                            metricsData.hashes_by_day[dayKey] = (metricsData.hashes_by_day[dayKey] || 0) + 1;
                            metricsData.hashes_by_hour[hourKey] = (metricsData.hashes_by_hour[hourKey] || 0) + 1;
                            metricsData.hashes_by_minute[minKey] = (metricsData.hashes_by_minute[minKey] || 0) + 1;
                            metricsData.hashes_by_week[weekKey] = (metricsData.hashes_by_week[weekKey] || 0) + 1;
                            metricsData.hashes_by_month[monKey] = (metricsData.hashes_by_month[monKey] || 0) + 1;
                            metricsData.fees_by_day[dayKey] = +((metricsData.fees_by_day[dayKey] || 0) + 0.01).toFixed(4);
                            metricsData.fees_by_hour[hourKey] = +((metricsData.fees_by_hour[hourKey] || 0) + 0.01).toFixed(4);
                            metricsData.fees_by_minute[minKey] = +((metricsData.fees_by_minute[minKey] || 0) + 0.01).toFixed(4);
                            metricsData.fees_by_week[weekKey] = +((metricsData.fees_by_week[weekKey] || 0) + 0.01).toFixed(4);
                            metricsData.fees_by_month[monKey] = +((metricsData.fees_by_month[monKey] || 0) + 0.01).toFixed(4);
                            if (ts.toLocaleDateString('en-US') === todayStr) { metricsData.hashes_today++; metricsData.fees_today = +((metricsData.fees_today || 0) + 0.01).toFixed(2); }
                            if (ts.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }) === monthStr) metricsData.this_month++;
                        } catch(e) {}
                    }
                }
                document.getElementById('totalHashes').textContent = metricsData.total_hashes || 0;
                document.getElementById('totalFees').textContent = (metricsData.total_fees || 0).toFixed(2);
                document.getElementById('recordTypes').textContent = Object.keys(metricsData.records_by_type || {}).length;
                document.getElementById('hashesToday').textContent = '+' + (metricsData.hashes_today || 0) + ' today';
                document.getElementById('feesToday').textContent = '+$' + (metricsData.fees_today || 0).toFixed(2) + ' today';
                document.getElementById('thisMonth').textContent = metricsData.this_month || 0;
                rebuildRecordTypeFilter();
                renderHashChart(currentHashView);
                renderRecordChart();
                renderFeeChart(currentFeeView);
                renderTxChart(currentTxView);
                renderRecentTable();
                try { document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString('en-US',{hour12:false}); } catch(e){}
            } finally {
                // Guarantee the "Loading..." text is always cleared
                try {
                    const tbody = document.getElementById('recentBody');
                    if (tbody && tbody.innerHTML.includes('Loading')) {
                        if (!metricsData) metricsData = { individual_records: [] };
                        renderRecentTable();
                    }
                } catch(e) {
                    document.getElementById('recentBody').innerHTML = '<tr><td colspan="4" style="text-align:center;color:var(--text-muted);">No records available</td></tr>';
                }
            }
        }

        function filterByRecordType() { selectedRecordType = document.getElementById('recordTypeFilter').value; renderRecordChart(); renderRecentTable(); }

        // Rebuild record type and platform filter dropdowns from current data
        function rebuildRecordTypeFilter() {
            const filterSelect = document.getElementById('recordTypeFilter');
            const prevVal = filterSelect.value;
            // Clear all options except "All Record Types"
            filterSelect.innerHTML = '<option value="all">All Record Types</option>';
            const types = Object.keys(metricsData.records_by_type || {}).sort();
            types.forEach(type => { const o = document.createElement('option'); o.value = type; o.textContent = type; filterSelect.appendChild(o); });
            // Restore previous selection if still valid
            if (types.includes(prevVal)) filterSelect.value = prevVal;
            else { selectedRecordType = 'all'; filterSelect.value = 'all'; }

            // Rebuild platform filter
            const platSelect = document.getElementById('platformFilter');
            const prevPlat = platSelect.value;
            platSelect.innerHTML = '<option value="all">All Platforms</option>';
            const branches = Object.keys(metricsData.records_by_branch || {}).sort();
            branches.forEach(b => { const o = document.createElement('option'); o.value = b; o.textContent = b; platSelect.appendChild(o); });
            if (branches.includes(prevPlat)) platSelect.value = prevPlat;
        }

        function exportCSV() {
            if (!metricsData || !metricsData.individual_records) { alert('No data available to export'); return; }
            const records = metricsData.individual_records;
            const headers = ['Timestamp', 'Record Type', 'Hash', 'Fee ($SLS)', 'TX Hash'];
            const csvRows = [headers.join(',')];
            records.forEach(r => { csvRows.push(['"' + r.timestamp_display + '"', '"' + r.record_type + '"', '"' + r.hash + '"', r.fee, '"' + (r.tx_hash || '') + '"'].join(',')); });
            const blob = new Blob([csvRows.join('\n')], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 's4_ledger_metrics_' + new Date().toISOString().split('T')[0] + '.csv';
            link.click();
        }

        function getDataForView(baseKey, view) { return metricsData[baseKey + '_by_' + view] || {}; }

        const chartGrid = '#1a2a3a';
        const chartTick = '#6b7d93';

        function renderHashChart(view) {
            const data = getDataForView('hashes', view);
            const labels = Object.keys(data), values = Object.values(data);
            const ctx = document.getElementById('hashChart').getContext('2d');
            if (hashChart) hashChart.destroy();
            hashChart = new Chart(ctx, { type: 'bar', data: { labels: labels.length ? labels : ['No data'], datasets: [{ label: 'Hashes', data: values.length ? values : [0], backgroundColor: '#00aaff', borderRadius: 4 }] }, options: { responsive: true, plugins: { legend: { display: false } }, scales: { x: { grid: { color: chartGrid }, ticks: { color: chartTick } }, y: { grid: { color: chartGrid }, ticks: { color: chartTick, stepSize: 1 }, beginAtZero: true } } } });
        }

        function renderRecordChart() {
            let data = metricsData.records_by_type || {};
            if (selectedRecordType !== 'all') { data = { [selectedRecordType]: data[selectedRecordType] || 0 }; }
            const labels = Object.keys(data), values = Object.values(data);
            const colors = ['#00aaff', 'var(--accent)', 'var(--text-muted)', '#ffa502', '#3742fa', '#2ed573', '#ff6b81', '#70a1ff', '#eccc68', '#a29bfe', '#fd79a8', '#00cec9', '#55efc4', '#74b9ff', '#fab1a0', '#8ea4b8', '#ffeaa7', '#81ecec'];
            const ctx = document.getElementById('recordChart').getContext('2d');
            if (recordChart) recordChart.destroy();
            recordChart = new Chart(ctx, { type: 'doughnut', data: { labels: labels.length ? labels : ['No records'], datasets: [{ data: values.length ? values : [1], backgroundColor: labels.length ? colors.slice(0, labels.length) : ['#333'], borderWidth: 0 }] }, options: { responsive: true, plugins: { legend: { display: true, position: 'right', labels: { color: '#fff' } } } } });
        }

        function renderFeeChart(view) {
            const data = getDataForView('fees', view);
            const labels = Object.keys(data), values = Object.values(data);
            const ctx = document.getElementById('feeChart').getContext('2d');
            if (feeChart) feeChart.destroy();
            feeChart = new Chart(ctx, { type: 'line', data: { labels: labels.length ? labels : ['No data'], datasets: [{ label: '$SLS Fees', data: values.length ? values : [0], borderColor: 'var(--accent)', backgroundColor: 'rgba(201,168,76,0.2)', fill: true, tension: 0.3, pointRadius: 6, pointBackgroundColor: 'var(--accent)' }] }, options: { responsive: true, plugins: { legend: { display: false } }, scales: { x: { grid: { color: chartGrid }, ticks: { color: chartTick } }, y: { grid: { color: chartGrid }, ticks: { color: chartTick }, beginAtZero: true } } } });
        }

        function renderTxChart(view) {
            const data = getDataForView('hashes', view);
            const labels = Object.keys(data), values = Object.values(data);
            const ctx = document.getElementById('txChart').getContext('2d');
            if (txChart) txChart.destroy();
            txChart = new Chart(ctx, { type: 'line', data: { labels: labels.length ? labels : ['No data'], datasets: [{ label: 'Transactions', data: values.length ? values : [0], borderColor: 'var(--text-muted)', backgroundColor: 'rgba(255,107,107,0.2)', fill: true, tension: 0.3, pointRadius: 6, pointBackgroundColor: 'var(--text-muted)' }] }, options: { responsive: true, plugins: { legend: { display: false } }, scales: { x: { grid: { color: chartGrid }, ticks: { color: chartTick } }, y: { grid: { color: chartGrid }, ticks: { color: chartTick, stepSize: 1 }, beginAtZero: true } } } });
        }

        function renderRecentTable() {
            let records = metricsData.individual_records || [];
            const tbody = document.getElementById('recentBody');
            if (records.length === 0) { tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:var(--text-muted);">No records found</td></tr>'; return; }
            if (selectedRecordType !== 'all') { records = records.filter(r => (r.record_label || r.record_type) === selectedRecordType); }
            const recent = [...records].reverse().slice(0, 50);
            if (recent.length === 0) { tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:var(--text-muted);">No records for selected type</td></tr>'; return; }
            tbody.innerHTML = recent.map(r => { const label = r.record_label || r.record_type || 'Unknown'; return '<tr><td style="color:#00aaff;">' + (r.timestamp_display || '') + '</td><td><span class="badge-type">' + label + '</span></td><td style="font-family:monospace;font-size:0.85rem;color:var(--text-secondary);">' + (r.hash || '').substring(0,24) + '...</td><td style="color:var(--accent);">$' + (r.fee || 0.01).toFixed(2) + '</td></tr>'; }).join('');
        }

        document.getElementById('hashBtns').addEventListener('click', e => { if (e.target.dataset.view) { currentHashView = e.target.dataset.view; document.querySelectorAll('#hashBtns .filter-btn').forEach(b => b.classList.toggle('active', b.dataset.view === currentHashView)); renderHashChart(currentHashView); } });
        document.getElementById('feeBtns').addEventListener('click', e => { if (e.target.dataset.view) { currentFeeView = e.target.dataset.view; document.querySelectorAll('#feeBtns .filter-btn').forEach(b => b.classList.toggle('active', b.dataset.view === currentFeeView)); renderFeeChart(currentFeeView); } });
        document.getElementById('txBtns').addEventListener('click', e => { if (e.target.dataset.view) { currentTxView = e.target.dataset.view; document.querySelectorAll('#txBtns .filter-btn').forEach(b => b.classList.toggle('active', b.dataset.view === currentTxView)); renderTxChart(currentTxView); } });

        // ── Cross-page sync: instantly update when records are anchored elsewhere ──
        window.addEventListener('storage', (e) => {
            if (e.key === S4_STORAGE_KEY) loadMetrics();
        });

        window.addEventListener('DOMContentLoaded', loadMetrics);
        setInterval(loadMetrics, 5000);
    </script>

</div></section>
<footer class="footer">
    <div class="container">
        <div class="footer-inner">
            <div>
                <a href="/" class="footer-brand"><img src="/s4-assets/S4Ledger_logo.png" alt="S4 Ledger"><span>S4 Ledger</span></a>
                <div class="footer-tagline">Immutable defense logistics. Built on the XRP Ledger.</div>
            </div>
            <div class="footer-links">
                <div class="footer-col"><h5>Product</h5><a href="/demo-app/">Platform</a><a href="/sdk-playground/">SDK Playground</a><a href="/metrics.html">Live Metrics</a><a href="/transactions.html">Transactions</a></div>
                <div class="footer-col"><h5>Company</h5><a href="/s4-about/">About</a><a href="/s4-investors/">Investors</a><a href="/s4-partners/">Partners</a><a href="/s4-roadmap/">Roadmap</a></div>
                <div class="footer-col"><h5>Resources</h5><a href="/s4-use-cases/">Use Cases</a><a href="/s4-faq/">FAQ</a><a href="/s4-pricing/">Pricing</a><a href="/security/">Security</a></div>
                <div class="footer-col"><h5>Connect</h5><a href="/s4-contact/">Contact</a><a href="https://github.com/s4ledger/s4-ledger" target="_blank">GitHub</a></div>
            </div>
        </div>
        <div class="footer-bottom">
            <span>&copy; 2025 S4 Systems, LLC. $SLS is a utility token &mdash; not equity or an investment contract.</span>
            <div class="footer-bottom-links"><a href="/s4-terms/">Terms</a><a href="/s4-privacy/">Privacy</a><a href="/security-policy/">Security Policy</a></div>
        </div>
    </div>
</footer>
<script>
var nav=document.getElementById('mainNav');
if(nav){window.addEventListener('scroll',function(){nav.classList.toggle('scrolled',window.scrollY>40);});}
var obs=new IntersectionObserver(function(e){e.forEach(function(x){if(x.isIntersecting)x.target.classList.add('visible');});},{threshold:0.1});
document.querySelectorAll('.reveal').forEach(function(el){obs.observe(el);});
</script>
</body>
</html>
