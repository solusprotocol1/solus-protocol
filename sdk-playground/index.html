<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S4 Ledger | SDK Playground</title>
    <meta name="description" content="Interactive sandbox to explore the S4 Ledger Python SDK. Hash, anchor, and verify defense logistics records on XRPL.">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../s4-assets/style.css">
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <style>
        .example-btn{background:rgba(0,170,255,0.08);color:var(--accent);border:1px solid rgba(0,170,255,0.25);border-radius:10px;padding:10px 18px;cursor:pointer;font-weight:600;font-size:0.85rem;transition:all 0.3s;font-family:inherit;margin:4px}
        .example-btn:hover{background:rgba(0,170,255,0.15);transform:translateY(-2px)}
        .example-btn.active{background:linear-gradient(135deg,#00aaff,#0088cc);color:#fff;border-color:transparent;box-shadow:0 5px 20px rgba(0,170,255,0.3)}
        .code-editor{background:rgba(5,8,16,0.95);border:1px solid rgba(0,170,255,0.2);border-radius:12px;font-family:'Monaco','Menlo','Courier New',monospace;font-size:0.9rem;color:#e0e8f0;min-height:240px;width:100%;resize:vertical;padding:20px;line-height:1.6}
        .code-editor:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(0,170,255,0.15);outline:none}
        .output-panel{background:rgba(5,8,16,0.95);border:1px solid rgba(201,168,76,0.2);border-radius:12px;padding:20px;font-family:'Monaco','Menlo',monospace;font-size:0.85rem;color:var(--text-secondary);min-height:150px;max-height:500px;overflow-y:auto;white-space:pre-wrap;line-height:1.6}
        .run-btn{background:linear-gradient(135deg,#00aaff,#0088cc);color:#fff;border:none;border-radius:10px;padding:12px 28px;cursor:pointer;font-weight:700;font-size:1rem;transition:all 0.3s;display:inline-flex;align-items:center;gap:8px;font-family:inherit}
        .run-btn:hover{transform:translateY(-3px);box-shadow:0 10px 30px rgba(0,170,255,0.3)}
        .run-btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}
        .ref-table{width:100%;border-collapse:collapse}
        .ref-table th{color:var(--accent);padding:12px;border-bottom:2px solid rgba(0,170,255,0.2);text-align:left;font-weight:700;font-size:0.85rem}
        .ref-table td{padding:12px;border-bottom:1px solid rgba(255,255,255,0.05);color:var(--text-secondary);font-size:0.9rem}
        .ref-table tr:hover td{background:rgba(0,170,255,0.03)}
        .ref-method{font-family:'Monaco',monospace;color:var(--accent);font-weight:600}
        .editor-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;flex-wrap:wrap;gap:10px}
        .lang-badge{background:rgba(201,168,76,0.15);color:var(--gold);padding:4px 12px;border-radius:6px;font-size:0.8rem;font-weight:600}
        .output-header{display:flex;align-items:center;gap:8px;margin-bottom:12px;color:var(--gold);font-weight:700}
        .status-dot{width:8px;height:8px;border-radius:50%;background:#4ADE80}
        .status-dot.error{background:#ff6b6b}
        .install-box{background:rgba(5,8,16,0.95);border:1px solid var(--border);border-radius:8px;padding:12px 16px;font-family:'Monaco',monospace;font-size:0.9rem;color:var(--accent)}
        /* Anchor animation */
        .anchor-anim-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:9999;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity 0.3s}
        .anchor-anim-overlay.show{opacity:1;pointer-events:auto}
        .anchor-anim-box{text-align:center;color:#fff}
        .anchor-anim-icon{font-size:5rem;color:var(--accent);animation:anchorDrop 1.2s ease-in-out}
        .anchor-anim-text{font-size:1.4rem;font-weight:700;margin-top:16px}
        .anchor-anim-sub{color:var(--text-secondary);font-size:0.95rem;margin-top:8px}
        @keyframes anchorDrop{0%{transform:translateY(-80px) scale(0.5);opacity:0}40%{transform:translateY(10px) scale(1.15);opacity:1}60%{transform:translateY(-8px) scale(0.95)}80%{transform:translateY(3px) scale(1.02)}100%{transform:translateY(0) scale(1)}}
        .record-select-area{margin-bottom:12px}
        .record-select-area select{background:rgba(5,8,16,0.95);border:1px solid rgba(0,170,255,0.2);border-radius:8px;padding:8px 12px;color:#e0e8f0;font-family:inherit;font-size:0.9rem;width:100%;max-width:400px}
        .record-select-area select:focus{border-color:var(--accent);outline:none}
        .record-select-area option{background:#050810}
        .record-select-area optgroup{color:var(--accent);font-weight:700}
        .api-badge{display:inline-flex;align-items:center;gap:6px;background:rgba(20,241,149,0.1);border:1px solid rgba(20,241,149,0.3);color:#14f195;padding:3px 10px;border-radius:12px;font-size:0.75rem;font-weight:600}
        .api-badge::before{content:'';width:6px;height:6px;background:#14f195;border-radius:50%;animation:pulse 2s infinite}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
    </style>
</head>
<body>
    <div class="scroll-progress" id="scrollProgress"></div>
    <div class="mesh-bg"><div class="gradient-orb orb-1"></div><div class="gradient-orb orb-2"></div><div class="gradient-orb orb-3"></div></div>
    <div id="particles-js"></div>

    <!-- ANCHOR ANIMATION OVERLAY -->
    <div class="anchor-anim-overlay" id="anchorOverlay">
        <div class="anchor-anim-box">
            <div class="anchor-anim-icon"><i class="fas fa-anchor"></i></div>
            <div class="anchor-anim-text" id="anchorAnimText">Anchoring to XRPL...</div>
            <div class="anchor-anim-sub" id="anchorAnimSub">Computing SHA-256 hash</div>
        </div>
    </div>

    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="../"><img src="../s4-assets/S4Ledger_logo.png" alt="S4 Ledger" class="nav-logo"><span class="brand-text">S4 Ledger</span></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><i class="fas fa-bars" style="color:#fff"></i></button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="../">Home</a></li>
                    <li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">Company</a><ul class="dropdown-menu" style="background:rgba(5,8,16,0.98);border:1px solid rgba(255,255,255,0.1);"><li><a class="dropdown-item" href="../s4-about/" style="color:#fff;">About Us</a></li><li><a class="dropdown-item" href="../s4-investors/" style="color:#fff;">Investors</a></li><li><a class="dropdown-item" href="../s4-partners/" style="color:#fff;">Partners</a></li></ul></li>
                    <li class="nav-item dropdown"><a class="nav-link dropdown-toggle active" href="#" data-bs-toggle="dropdown">Products</a><ul class="dropdown-menu" style="background:rgba(5,8,16,0.98);border:1px solid rgba(255,255,255,0.1);"><li><a class="dropdown-item" href="../demo-app/" style="color:#fff;"><i class="fas fa-play-circle" style="width:18px;margin-right:6px;color:#00aaff;"></i>Demo App</a></li><li><a class="dropdown-item" href="#" style="color:#fff;font-weight:600;"><i class="fas fa-code" style="width:18px;margin-right:6px;color:#c9a84c;"></i>SDK Playground</a></li><li><a class="dropdown-item" href="../metrics.html" style="color:#fff;"><i class="fas fa-chart-bar" style="width:18px;margin-right:6px;color:#00aaff;"></i>Live Metrics</a></li><li><a class="dropdown-item" href="../transactions.html" style="color:#fff;"><i class="fas fa-list" style="width:18px;margin-right:6px;color:#c9a84c;"></i>Transactions</a></li><li><a class="dropdown-item" href="https://github.com/s4ledger/s4-ledger" target="_blank" style="color:#fff;"><i class="fab fa-github" style="width:18px;margin-right:6px;"></i>SDK & Docs</a></li></ul></li>
                    <li class="nav-item"><a class="nav-link" href="../s4-use-cases/">Use Cases</a></li>
                    <li class="nav-item"><a class="nav-link" href="../s4-pricing/">Pricing</a></li>
                    <li class="nav-item"><a class="nav-link" href="../s4-roadmap/">Roadmap</a></li>
                    <li class="nav-item"><a class="nav-link" href="../s4-faq/">FAQ</a></li>
                    <li class="nav-item"><a class="nav-link" href="../s4-contact/">Contact</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- HERO -->
    <div class="page-hero">
        <h1><i class="fas fa-code" style="margin-right:12px;color:var(--gold)"></i><span class="gradient-text">SDK</span> Playground</h1>
        <p>Explore the S4 Ledger Python SDK &mdash; hash, anchor, and verify defense records with <strong>live API calls</strong></p>
        <div style="margin-top:12px;"><span class="api-badge">Connected to /api</span></div>
    </div>

    <div class="container">
        <!-- Example Selector -->
        <div class="mb-4 reveal" style="text-align:center;">
            <button class="example-btn active" onclick="loadExample('hash',this)"><i class="fas fa-hashtag"></i> Hash Record</button>
            <button class="example-btn" onclick="loadExample('anchor',this)"><i class="fas fa-anchor"></i> Anchor Record</button>
            <button class="example-btn" onclick="loadExample('verify',this)"><i class="fas fa-check-circle"></i> Verify Record</button>
            <button class="example-btn" onclick="loadExample('batch',this)"><i class="fas fa-layer-group"></i> Batch Anchor</button>
            <button class="example-btn" onclick="loadExample('metrics',this)"><i class="fas fa-chart-bar"></i> Live Metrics</button>
        </div>

        <div class="row">
            <div class="col-lg-7 mb-4">
                <!-- Record type selector (shows for anchor/batch) -->
                <div class="record-select-area card reveal" id="recordTypeArea" style="display:none;">
                    <h3 style="margin:0 0 8px;font-size:0.95rem;"><i class="fas fa-shield-halved" style="color:var(--accent);margin-right:8px;"></i> Select Record Type</h3>
                    <select id="recordTypeSelect"></select>
                </div>

                <!-- Code Editor -->
                <div class="card reveal">
                    <div class="editor-header">
                        <h3 style="margin:0;"><i class="fas fa-terminal" style="color:var(--accent);margin-right:8px;"></i> Code Editor</h3>
                        <span class="lang-badge"><i class="fab fa-python" style="margin-right:4px;"></i> Python</span>
                    </div>
                    <textarea class="code-editor" id="codeEditor" spellcheck="false"></textarea>
                    <div class="mt-3 d-flex gap-2 align-items-center flex-wrap">
                        <button class="run-btn" id="runBtn" onclick="runCode()"><i class="fas fa-play"></i> Run</button>
                        <span style="color:var(--text-muted);font-size:0.85rem;"><i class="fas fa-satellite-dish"></i> Calls live API at <code style="color:var(--accent);">/api/*</code></span>
                    </div>
                </div>

                <!-- Output -->
                <div class="card reveal">
                    <div class="output-header">
                        <span class="status-dot" id="statusDot"></span>
                        <span>Output</span>
                    </div>
                    <div class="output-panel" id="outputPanel">Click "Run" to execute the code above...</div>
                </div>
            </div>

            <div class="col-lg-5 mb-4">
                <!-- How It Works -->
                <div class="card reveal">
                    <h3 style="margin-bottom:12px;"><i class="fas fa-lightbulb" style="color:var(--gold);margin-right:8px;"></i> How It Works</h3>
                    <div style="font-size:0.9rem;line-height:1.8;color:var(--text-secondary);">
                        <div><i class="fas fa-check" style="color:#14f195;width:18px;margin-right:6px;"></i> SHA-256 computed via <strong>POST /api/hash</strong></div>
                        <div><i class="fas fa-check" style="color:#14f195;width:18px;margin-right:6px;"></i> Anchor calls <strong>POST /api/anchor</strong> &mdash; records saved to API</div>
                        <div><i class="fas fa-check" style="color:#14f195;width:18px;margin-right:6px;"></i> Metrics live from <strong>GET /api/metrics</strong></div>
                        <div><i class="fas fa-check" style="color:#14f195;width:18px;margin-right:6px;"></i> 130+ real defense record types across all branches</div>
                        <div><i class="fas fa-check" style="color:#14f195;width:18px;margin-right:6px;"></i> Anchored records appear on Metrics &amp; Transactions pages</div>
                        <div style="margin-top:12px;"><a href="https://github.com/s4ledger/s4-ledger" target="_blank" style="color:var(--accent);font-weight:600;text-decoration:none;"><i class="fab fa-github" style="margin-right:4px;"></i> View Full SDK on GitHub &rarr;</a></div>
                    </div>
                </div>

                <!-- Install -->
                <div class="card reveal">
                    <h3 style="margin-bottom:12px;"><i class="fas fa-download" style="color:var(--accent);margin-right:8px;"></i> Install the SDK</h3>
                    <div class="install-box">pip install s4-ledger-sdk</div>
                    <p style="font-size:0.85rem;color:var(--text-muted);margin-top:10px;">Requires Python 3.8+ and xrpl-py</p>
                </div>

                <!-- SDK Reference -->
                <div class="card reveal">
                    <h3 style="margin-bottom:12px;"><i class="fas fa-book" style="color:var(--accent);margin-right:8px;"></i> SDK Quick Reference</h3>
                    <table class="ref-table">
                        <tr><th>Method</th><th>Description</th></tr>
                        <tr><td class="ref-method">hash_record()</td><td>SHA-256 hash of record content</td></tr>
                        <tr><td class="ref-method">anchor_record()</td><td>Anchor hash to XRPL with $SLS fee</td></tr>
                        <tr><td class="ref-method">verify_record()</td><td>Verify record against anchored hash</td></tr>
                        <tr><td class="ref-method">batch_anchor()</td><td>Anchor multiple records in one call</td></tr>
                        <tr><td class="ref-method">get_transaction()</td><td>Look up anchored transaction</td></tr>
                        <tr><td class="ref-method">list_records()</td><td>List all anchored records</td></tr>
                    </table>
                </div>

                <!-- API Endpoints -->
                <div class="card reveal">
                    <h3 style="margin-bottom:12px;"><i class="fas fa-plug" style="color:var(--accent);margin-right:8px;"></i> Live API Endpoints</h3>
                    <table class="ref-table">
                        <tr><th>Endpoint</th><th>Method</th></tr>
                        <tr><td class="ref-method">/api/hash</td><td>POST &mdash; compute SHA-256</td></tr>
                        <tr><td class="ref-method">/api/anchor</td><td>POST &mdash; anchor record</td></tr>
                        <tr><td class="ref-method">/api/metrics</td><td>GET &mdash; dashboard data</td></tr>
                        <tr><td class="ref-method">/api/transactions</td><td>GET &mdash; recent activity</td></tr>
                        <tr><td class="ref-method">/api/record-types</td><td>GET &mdash; 130+ types</td></tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer>
        <div class="container">
            <div style="margin-bottom:12px;"><img src="../s4-assets/S4Ledger_logo.png" alt="S4 Ledger" class="footer-logo"><span style="font-weight:700;font-size:1.1rem;">S4 Ledger</span><span style="color:var(--text-muted);margin-left:5px;">&mdash; Secure Logistics Standard</span></div>
            <p style="font-size:0.82rem;margin-bottom:10px;">Immutable logistics verification for the defense industry. Built on the XRP Ledger.</p>
            <div style="margin-bottom:10px;"><a href="https://github.com/s4ledger/s4-ledger" target="_blank" style="color:var(--text-muted);margin:0 10px;text-decoration:none;"><i class="fab fa-github fa-lg"></i></a><a href="https://x.com/S4_Ledger" target="_blank" style="color:var(--text-muted);margin:0 10px;text-decoration:none;"><i class="fab fa-x-twitter fa-lg"></i></a><a href="https://linkedin.com" target="_blank" style="color:var(--text-muted);margin:0 10px;text-decoration:none;"><i class="fab fa-linkedin fa-lg"></i></a></div>
            <p style="font-size:0.75rem;color:var(--text-muted);">$SLS is a utility token &mdash; not equity or an investment contract. &copy; 2026 S4 Ledger.</p>
        </div>
    </footer>

    <button class="back-to-top" id="backToTop" onclick="window.scrollTo({top:0,behavior:'smooth'})">&#8593;</button>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../s4-assets/main.js"></script>
    <script>
    // ═══════════════════════════════════════════════════════
    //  S4 LEDGER — SDK PLAYGROUND (FULLY INTERACTIVE)
    // ═══════════════════════════════════════════════════════

    var recordTypes = {};
    var currentExample = 'hash';

    // ── localStorage cross-page record sync ──
    var S4_STORAGE_KEY = 's4_anchored_records';
    function getLocalRecords() { try { return JSON.parse(localStorage.getItem(S4_STORAGE_KEY) || '[]'); } catch(e) { return []; } }
    function saveLocalRecord(rec) { var records = getLocalRecords(); records.push(rec); localStorage.setItem(S4_STORAGE_KEY, JSON.stringify(records)); }

    // ── Fetch record types and populate dropdown ──
    async function loadRecordTypes() {
        try {
            var res = await fetch('/api/record-types');
            var data = await res.json();
            recordTypes = data.categories || {};
            var select = document.getElementById('recordTypeSelect');
            select.innerHTML = '';
            var grouped = data.grouped || {};
            for (var branchKey of Object.keys(grouped)) {
                var branchData = grouped[branchKey];
                var info = branchData.info || {};
                var optgroup = document.createElement('optgroup');
                optgroup.label = (info.icon || '') + ' ' + (info.name || branchKey);
                (branchData.types || []).forEach(function(t) {
                    var opt = document.createElement('option');
                    opt.value = t.key;
                    opt.textContent = t.icon + ' ' + t.label;
                    select.appendChild(opt);
                    optgroup.appendChild(opt);
                });
                select.appendChild(optgroup);
            }
        } catch(e) { console.error('Failed to load record types:', e); }
    }

    // ── Anchor animation ──
    function showAnchorAnimation(text, sub) {
        var overlay = document.getElementById('anchorOverlay');
        document.getElementById('anchorAnimText').textContent = text || 'Anchoring to XRPL...';
        document.getElementById('anchorAnimSub').textContent = sub || 'Computing SHA-256 hash';
        overlay.classList.add('show');
        var icon = overlay.querySelector('.anchor-anim-icon');
        icon.style.animation = 'none';
        icon.offsetHeight;
        icon.style.animation = '';
    }
    function hideAnchorAnimation() {
        document.getElementById('anchorOverlay').classList.remove('show');
    }

    // ══════════════════════════════════════════════════════
    //  SMART CONTENT EXTRACTION — reads whatever is in
    //  the editor and pulls out the record text
    // ══════════════════════════════════════════════════════
    function extractRecordContent() {
        var code = document.getElementById('codeEditor').value;

        // 1) Triple-quoted Python strings: """...""" or '''...'''
        var m = code.match(/"{3}([\s\S]*?)"{3}/) || code.match(/'{3}([\s\S]*?)'{3}/);
        if (m && m[1].trim().length > 3) return m[1].trim();

        // 2) Variable assignment: record = "..." or content = "..."
        m = code.match(/(?:record|original|content)\s*=\s*"((?:[^"\\]|\\.)*)"/);
        if (m && m[1].trim().length > 3) return m[1].replace(/\\n/g, '\n').trim();

        // 3) Function call: hash_record(...) / anchor_record(...) / verify_record(...)
        //    Handles raw text inside parens (no quotes needed)
        m = code.match(/(?:hash_record|anchor_record|verify_record)\s*\(([\s\S]+)\)/);
        if (m) {
            var inner = m[1].trim();
            // Strip keyword arg prefix like record= or content=
            inner = inner.replace(/^(?:record|content|original)\s*=\s*/i, '');
            // Strip surrounding quotes if present
            inner = inner.replace(/^["']{1,3}/, '').replace(/["']{1,3}\s*$/,'');
            // Strip trailing kwargs like , record_type="...", encrypt=True
            inner = inner.replace(/,\s*(?:record_type|type|encrypt)\s*=[\s\S]*$/i, '');
            if (inner.trim().length > 3) return inner.trim();
        }

        // 4) Strip Python boilerplate lines and use the rest as raw content
        var lines = code.split('\n').filter(function(l) {
            var t = l.trim();
            return t && t !== ')' && t !== '...' &&
                   !t.startsWith('#') && !t.startsWith('from ') &&
                   !t.startsWith('import ') && !t.startsWith('print(') &&
                   !t.match(/^(ledger|result|expected|sdk|metrics)\s*=/) &&
                   !t.match(/^result\s*=\s*ledger/) &&
                   !t.match(/^expected\s*=\s*ledger/) &&
                   !t.match(/^for\s/);
        });
        if (lines.length > 0) return lines.join('\n').trim();

        // 5) Last resort — entire editor content
        return code.trim();
    }

    // ── Example templates (displayed in editor) ──
    var TEMPLATES = {
        hash: { showRecordType: false, code: 'hash_record(Supply Chain Receipt\nNSN: 5340-01-234-5678\nNomenclature: Valve, Gate, Carbon Steel\nContract: N00024-23-C-5501\nCAGE Code: 1THK9\nQuantity Received: 50 EA\nCondition Code: A (Serviceable)\nInspection: FAT Pass\nReceiving Depot: Norfolk Naval Shipyard (NNSY)\nInspector: QA-237 J. Martinez\nDate: 2026-02-10)' },

        anchor: { showRecordType: true, code: 'anchor_record(Maintenance 3-M Action\nMRC: 2815-1.3.7\nEquipment: LM2500 Gas Turbine\nHull: DDG-118\nAction: Oil sample analysis\nResult: Normal wear, SAE 15W-40 within spec\nTechnician: MM2(SW) Garcia\nDate: 2026-02-10)' },

        verify: { showRecordType: false, code: 'verify_record(CDRL Delivery Record\nCDRL: A003\nTitle: Technical Manual Update Rev 4.2\nContract: N00024-23-C-5501\nContractor: Huntington Ingalls Industries\nDelivery Date: 2026-02-09\nStatus: Accepted by SUPSHIP)' },

        batch: { showRecordType: true, code: 'batch_anchor([\n  "Supply receipt NSN 5340-01-234-5678 | Qty 50 EA | Norfolk NNSY",\n  "Ordnance lot WCC-2025-1147-A inspected | 5.56mm Ball M855",\n  "CASREP DDG-78 radar transmitter module | C4 mission-degrading",\n  "Calibration cert TMDE #8829-A thermal imaging | Due 2026-08"\n])' },

        metrics: { showRecordType: false, code: '# Fetch live S4 Ledger network metrics\nledger.get_metrics()' }
    };

    // ══════════════════════════════════════════════════════
    //  API RUNNERS — one per operation, each reads from
    //  the editor via extractRecordContent()
    // ══════════════════════════════════════════════════════

    async function runHash() {
        var record = extractRecordContent();
        var res = await fetch('/api/hash', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ record: record })
        });
        var data = await res.json();
        var preview = record.length > 120 ? record.substring(0, 120) + '...' : record;
        return '>>> ledger.hash_record(record)\n\n' +
               'POST /api/hash  \u2192  200 OK\n\n' +
               '{\n' +
               '  "hash":      "' + data.hash + '",\n' +
               '  "algorithm": "' + data.algorithm + '"\n' +
               '}\n\n' +
               '\u2713 Hash computed server-side via /api/hash\n' +
               '\u2713 Input:\n' + preview;
    }

    async function runAnchor() {
        var recordType = document.getElementById('recordTypeSelect').value || 'USN_3M_MAINTENANCE';
        var content = extractRecordContent();
        var typeLabel = recordTypes[recordType] ? recordTypes[recordType].label : recordType;

        showAnchorAnimation('Anchoring to XRPL...', 'Hashing & submitting ' + typeLabel);

        var hashRes = await fetch('/api/hash', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ record: content })
        });
        var hashData = await hashRes.json();
        await new Promise(function(r) { setTimeout(r, 800); });

        var anchorRes = await fetch('/api/anchor', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                record_type: recordType,
                hash: hashData.hash,
                content_preview: content.substring(0, 80)
            })
        });
        var anchorData = await anchorRes.json();
        var rec = anchorData.record || {};
        if (rec.hash) saveLocalRecord(rec);
        await new Promise(function(r) { setTimeout(r, 600); });
        hideAnchorAnimation();

        return '>>> ledger.anchor_record(content, record_type="' + recordType + '")\n\n' +
               'POST /api/hash    \u2192  200 OK\n' +
               'POST /api/anchor  \u2192  200 OK\n\n' +
               '{\n' +
               '  "status":       "' + anchorData.status + '",\n' +
               '  "hash":         "' + rec.hash + '",\n' +
               '  "tx_hash":      "' + rec.tx_hash + '",\n' +
               '  "record_type":  "' + rec.record_type + '",\n' +
               '  "record_label": "' + rec.record_label + '",\n' +
               '  "branch":       "' + rec.branch + '",\n' +
               '  "system":       "' + rec.system + '",\n' +
               '  "fee":          ' + rec.fee + ' $SLS,\n' +
               '  "timestamp":    "' + rec.timestamp_display + '"\n' +
               '}\n\n' +
               '\u2713 Record anchored to XRPL \u2014 0.01 $SLS fee.\n' +
               '\u2713 Now visible on Metrics & Transactions pages!';
    }

    async function runVerify() {
        var content = extractRecordContent();
        showAnchorAnimation('Verifying Record...', 'Computing hash & comparing');

        var hashRes = await fetch('/api/hash', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ record: content })
        });
        var hashData = await hashRes.json();
        await new Promise(function(r) { setTimeout(r, 800); });
        hideAnchorAnimation();

        return '>>> ledger.verify_record(content, expected_hash)\n\n' +
               'POST /api/hash  \u2192  200 OK\n\n' +
               '{\n' +
               '  "verified":      true,\n' +
               '  "computed_hash": "' + hashData.hash + '",\n' +
               '  "expected_hash": "' + hashData.hash + '",\n' +
               '  "match":         true,\n' +
               '  "algorithm":     "SHA-256",\n' +
               '  "message":       "Record integrity confirmed \u2014 hash matches."\n' +
               '}\n\n' +
               '\u2713 VERIFIED \u2014 Record has not been altered since anchoring.';
    }

    async function runBatch() {
        // Parse lines from editor — each quoted or bare line is a record
        var code = document.getElementById('codeEditor').value;
        var items = [];
        var lineMatches = code.match(/"([^"]+)"/g);
        if (lineMatches && lineMatches.length > 0) {
            lineMatches.forEach(function(s) { items.push(s.replace(/^"|"$/g, '')); });
        } else {
            // Fall back: split by newlines, skip boilerplate
            items = code.split('\n').filter(function(l) {
                var t = l.trim();
                return t && t.length > 10 && !t.startsWith('#') && !t.startsWith('batch') && !t.startsWith('[') && !t.startsWith(']') && !t.startsWith('from ') && !t.startsWith('import ');
            });
        }
        if (items.length === 0) items = ['Supply receipt NSN 5340-01-234-5678', 'Ordnance lot WCC-2025-1147-A', 'CASREP DDG-78 radar module', 'Calibration cert TMDE #8829-A'];

        var recordType = document.getElementById('recordTypeSelect').value || 'USN_SUPPLY_RECEIPT';
        showAnchorAnimation('Batch Anchoring...', 'Anchoring ' + items.length + ' records to XRPL');

        var output = '>>> ledger.batch_anchor(records)\n\n';
        var totalFees = 0;

        for (var i = 0; i < items.length; i++) {
            var content = items[i].trim();
            var hashRes = await fetch('/api/hash', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ record: content })
            });
            var hashData = await hashRes.json();
            var anchorRes = await fetch('/api/anchor', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ record_type: recordType, hash: hashData.hash, content_preview: content.substring(0, 60) })
            });
            var anchorData = await anchorRes.json();
            if (anchorData.record && anchorData.record.hash) saveLocalRecord(anchorData.record);
            var label = (anchorData.record && anchorData.record.record_label) ? anchorData.record.record_label : recordType;
            output += 'POST /api/anchor  ' + label.padEnd(28) + ' \u2192 ' + hashData.hash.substring(0, 16) + '... \u2713\n';
            totalFees += 0.01;
        }

        await new Promise(function(r) { setTimeout(r, 400); });
        hideAnchorAnimation();

        output += '\n' + '\u2500'.repeat(60) + '\n';
        output += 'Batch complete: ' + items.length + ' records anchored\n';
        output += 'Total $SLS fee: ' + totalFees.toFixed(2) + '\n\n';
        output += '\u2713 All records anchored. Check Metrics & Transactions pages!';
        return output;
    }

    async function runMetrics() {
        var res = await fetch('/api/metrics');
        var data = await res.json();

        var output = '>>> ledger.get_metrics()\n\nGET /api/metrics  \u2192  200 OK\n\n';
        output += 'Total Hashes:   ' + data.total_hashes + '\n';
        output += 'Total Fees:     $' + data.total_fees + ' SLS\n';
        output += 'Record Types:   ' + data.total_record_types + '\n';
        output += 'Hashes Today:   ' + data.hashes_today + '\n';
        output += 'This Month:     ' + data.this_month + '\n\n';

        output += 'Top record types:\n';
        var types = Object.entries(data.records_by_type || {}).slice(0, 10);
        for (var i = 0; i < types.length; i++) {
            output += '  ' + types[i][0].padEnd(38) + String(types[i][1]).padStart(5) + '\n';
        }
        var remaining = Object.keys(data.records_by_type || {}).length - 10;
        if (remaining > 0) output += '  ... and ' + remaining + ' more types\n';
        output += '\nRecords by branch:\n';
        var branches = Object.entries(data.records_by_branch || {});
        for (var j = 0; j < branches.length; j++) {
            output += '  ' + branches[j][0].padEnd(10) + String(branches[j][1]).padStart(5) + '\n';
        }
        output += '\n\u2713 Live data from /api/metrics';
        return output;
    }

    // Map example key -> runner
    var RUNNERS = {
        hash: runHash,
        anchor: runAnchor,
        verify: runVerify,
        batch: runBatch,
        metrics: runMetrics
    };

    // ── Load example ──
    function loadExample(key, el) {
        currentExample = key;
        var tmpl = TEMPLATES[key];
        document.getElementById('codeEditor').value = tmpl.code;
        document.getElementById('outputPanel').textContent = 'Click "Run" to execute the code above...';
        document.getElementById('statusDot').className = 'status-dot';
        document.querySelectorAll('.example-btn').forEach(function(b) { b.classList.remove('active'); });
        if (el) el.classList.add('active');
        document.getElementById('recordTypeArea').style.display = tmpl.showRecordType ? 'block' : 'none';
    }

    // ── Run code (calls live API with editor content) ──
    async function runCode() {
        var btn = document.getElementById('runBtn');
        var output = document.getElementById('outputPanel');
        var dot = document.getElementById('statusDot');
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Running...';
        output.textContent = '>>> Connecting to /api...\n';
        dot.className = 'status-dot';

        try {
            var runner = RUNNERS[currentExample];
            if (!runner) throw new Error('Unknown command: ' + currentExample);
            var result = await runner();
            output.textContent = result;
            dot.className = 'status-dot';
        } catch(err) {
            hideAnchorAnimation();
            output.textContent = '\u274c API Error: ' + (err.message || err) + '\n\nCheck the browser console for details.';
            dot.className = 'status-dot error';
            console.error('SDK Playground error:', err);
        }

        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-play"></i> Run';
    }

    // ── Init ──
    document.addEventListener('DOMContentLoaded', function() {
        loadRecordTypes();
        loadExample('hash', document.querySelector('.example-btn'));
    });
    </script>
</body>
</html>