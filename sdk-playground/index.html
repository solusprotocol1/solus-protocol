<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <title>S4 Ledger | SDK Playground</title>
    <meta name="description" content="Interactive sandbox to explore the S4 Ledger Python SDK. Hash, anchor, and verify defense logistics records on XRPL.">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../s4-assets/style.css">
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <style>
        .example-btn{background:rgba(0,170,255,0.08);color:var(--accent);border:1px solid rgba(0,170,255,0.25);border-radius:10px;padding:10px 18px;cursor:pointer;font-weight:600;font-size:0.85rem;transition:all 0.3s;font-family:inherit;margin:4px}
        .example-btn:hover{background:rgba(0,170,255,0.15);transform:translateY(-2px)}
        .example-btn.active{background:linear-gradient(135deg,#00aaff,#0088cc);color:#fff;border-color:transparent;box-shadow:0 5px 20px rgba(0,170,255,0.3)}
        .code-editor{background:rgba(5,8,16,0.95);border:1px solid rgba(0,170,255,0.2);border-radius:12px;font-family:'Monaco','Menlo','Courier New',monospace;font-size:0.9rem;color:#e0e8f0;min-height:240px;width:100%;resize:vertical;padding:20px;line-height:1.6}
        .code-editor:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(0,170,255,0.15);outline:none}
        .output-panel{background:rgba(5,8,16,0.95);border:1px solid rgba(201,168,76,0.2);border-radius:12px;padding:20px;font-family:'Monaco','Menlo',monospace;font-size:0.85rem;color:var(--text-secondary);min-height:150px;max-height:500px;overflow-y:auto;white-space:pre-wrap;line-height:1.6}
        .run-btn{background:linear-gradient(135deg,#00aaff,#0088cc);color:#fff;border:none;border-radius:10px;padding:12px 28px;cursor:pointer;font-weight:700;font-size:1rem;transition:all 0.3s;display:inline-flex;align-items:center;gap:8px;font-family:inherit}
        .run-btn:hover{transform:translateY(-3px);box-shadow:0 10px 30px rgba(0,170,255,0.3)}
        .run-btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}
        .ref-table{width:100%;border-collapse:collapse}
        .ref-table th{color:var(--accent);padding:12px;border-bottom:2px solid rgba(0,170,255,0.2);text-align:left;font-weight:700;font-size:0.85rem}
        .ref-table td{padding:12px;border-bottom:1px solid rgba(255,255,255,0.05);color:var(--text-secondary);font-size:0.9rem}
        .ref-table tr:hover td{background:rgba(0,170,255,0.03)}
        .ref-method{font-family:'Monaco',monospace;color:var(--accent);font-weight:600}
        .editor-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;flex-wrap:wrap;gap:10px}
        .lang-badge{background:rgba(201,168,76,0.15);color:var(--gold);padding:4px 12px;border-radius:6px;font-size:0.8rem;font-weight:600}
        .output-header{display:flex;align-items:center;gap:8px;margin-bottom:12px;color:var(--gold);font-weight:700}
        .status-dot{width:8px;height:8px;border-radius:50%;background:#4ADE80}
        .status-dot.error{background:#ff6b6b}
        .install-box{background:rgba(5,8,16,0.95);border:1px solid var(--border);border-radius:8px;padding:12px 16px;font-family:'Monaco',monospace;font-size:0.9rem;color:var(--accent)}
        /* Anchor animation */
        .anchor-anim-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:9999;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity 0.3s}
        .anchor-anim-overlay.show{opacity:1;pointer-events:auto}
        .anchor-anim-box{text-align:center;color:#fff}
        .anchor-anim-icon{font-size:5rem;color:var(--accent);animation:anchorDrop 1.2s ease-in-out}
        .anchor-anim-text{font-size:1.4rem;font-weight:700;margin-top:16px}
        .anchor-anim-sub{color:var(--text-secondary);font-size:0.95rem;margin-top:8px}
        @keyframes anchorDrop{0%{transform:translateY(-80px) scale(0.5);opacity:0}40%{transform:translateY(10px) scale(1.15);opacity:1}60%{transform:translateY(-8px) scale(0.95)}80%{transform:translateY(3px) scale(1.02)}100%{transform:translateY(0) scale(1)}}
        .anchor-anim-chain{width:3px;height:0;background:linear-gradient(to bottom,#00aaff,rgba(0,170,255,0.2));margin:0 auto;transition:height 0.5s ease-out}
        .anchor-anim-hash{font-family:'Monaco','Menlo',monospace;color:var(--accent);font-size:0.78rem;margin-top:12px;word-break:break-all;background:rgba(0,170,255,0.08);padding:10px 14px;border-radius:8px;border:1px solid rgba(0,170,255,0.2);max-width:500px;margin-left:auto;margin-right:auto;opacity:0;transition:opacity 0.4s}
        .anchor-anim-fee{font-size:0.9rem;color:#c9a84c;margin-top:8px;font-weight:600;opacity:0;transition:opacity 0.4s}
        .anchor-anim-success{font-size:1.2rem;font-weight:800;color:#14f195;margin-top:12px;opacity:0;transition:all 0.4s;transform:scale(0)}
        .anchor-anim-success.show{opacity:1;transform:scale(1)}
        .record-select-area{margin-bottom:12px}
        .record-select-area select{background:rgba(5,8,16,0.95);border:1px solid rgba(0,170,255,0.2);border-radius:8px;padding:8px 12px;color:#e0e8f0;font-family:inherit;font-size:0.9rem;width:100%;max-width:400px}
        .record-select-area select:focus{border-color:var(--accent);outline:none}
        .record-select-area option{background:#050810}
        .sdk-clf-banner{display:none;align-items:center;gap:8px;padding:8px 14px;border-radius:8px;margin-top:10px;font-size:0.85rem;font-weight:600;animation:fadeIn 0.25s ease-out}
        .sdk-clf-banner.show{display:inline-flex}
        .sdk-clf-badge{padding:3px 10px;border-radius:6px;font-size:0.75rem;font-weight:800;letter-spacing:0.5px;text-transform:uppercase}
        .sdk-clf-U .sdk-clf-badge{background:rgba(0,170,0,0.15);color:#00cc66;border:1px solid rgba(0,170,0,0.3)}
        .sdk-clf-CUI .sdk-clf-badge{background:rgba(201,168,76,0.15);color:#c9a84c;border:1px solid rgba(201,168,76,0.3)}
        .sdk-clf-SECRET .sdk-clf-badge{background:rgba(255,50,50,0.15);color:#ff5555;border:1px solid rgba(255,50,50,0.3)}
        .sdk-clf-TS .sdk-clf-badge{background:rgba(255,165,0,0.15);color:#ffa500;border:1px solid rgba(255,165,0,0.35)}
        .sdk-clf-U{background:rgba(0,170,0,0.04);border:1px solid rgba(0,170,0,0.15)}
        .sdk-clf-CUI{background:rgba(201,168,76,0.04);border:1px solid rgba(201,168,76,0.15)}
        .sdk-clf-SECRET{background:rgba(255,50,50,0.04);border:1px solid rgba(255,50,50,0.15)}
        .sdk-clf-TS{background:rgba(255,165,0,0.04);border:1px solid rgba(255,165,0,0.15)}
        .sdk-clf-text{font-size:0.78rem;color:var(--text-secondary);font-weight:400}
        .record-select-area optgroup{color:var(--accent);font-weight:700}
        .api-badge{display:inline-flex;align-items:center;gap:6px;background:rgba(20,241,149,0.1);border:1px solid rgba(20,241,149,0.3);color:#14f195;padding:3px 10px;border-radius:12px;font-size:0.75rem;font-weight:600}
        .api-badge::before{content:'';width:6px;height:6px;background:#14f195;border-radius:50%;animation:pulse 2s infinite}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
        /* SDK Function Boxes */
        .sdk-func-box{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:14px;padding:18px 14px;text-align:center;cursor:pointer;transition:all 0.3s ease;height:100%;position:relative;overflow:hidden}
        .sdk-func-box:hover{background:rgba(0,170,255,0.06);border-color:rgba(0,170,255,0.3);transform:translateY(-4px);box-shadow:0 8px 30px rgba(0,170,255,0.12)}
        .sdk-func-box.active{background:rgba(0,170,255,0.1);border-color:var(--accent);box-shadow:0 0 20px rgba(0,170,255,0.2)}
        .sdk-func-box::after{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--accent),transparent);opacity:0;transition:opacity 0.3s}
        .sdk-func-box:hover::after,.sdk-func-box.active::after{opacity:1}
        .sdk-func-icon{font-size:1.6rem;margin-bottom:8px}
        .sdk-func-title{font-weight:700;font-size:0.85rem;color:#fff;margin-bottom:4px}
        .sdk-func-desc{font-size:0.72rem;color:var(--text-muted);margin-bottom:6px;line-height:1.3}
        .sdk-func-method{font-family:'Monaco','Menlo',monospace;font-size:0.7rem;color:var(--accent);background:rgba(0,170,255,0.08);padding:2px 8px;border-radius:4px;display:inline-block}
    </style>
</head>
<body>
    <div class="scroll-progress" id="scrollProgress"></div>
    <div class="mesh-bg"><div class="gradient-orb orb-1"></div><div class="gradient-orb orb-2"></div><div class="gradient-orb orb-3"></div></div>
    <div id="particles-js"></div>

    <!-- ANCHOR ANIMATION OVERLAY -->
    <div class="anchor-anim-overlay" id="anchorOverlay">
        <div class="anchor-anim-box">
            <div class="anchor-anim-chain" id="anchorChain"></div>
            <div class="anchor-anim-icon"><i class="fas fa-anchor"></i></div>
            <div class="anchor-anim-text" id="anchorAnimText">Anchoring to XRPL...</div>
            <div class="anchor-anim-sub" id="anchorAnimSub">Computing SHA-256 hash</div>
            <div class="anchor-anim-hash" id="anchorAnimHash"></div>
            <div class="anchor-anim-fee" id="anchorAnimFee"></div>
            <div class="anchor-anim-success" id="anchorAnimSuccess"></div>
        </div>
    </div>

    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="../"><img src="../s4-assets/S4Ledger_logo.png" alt="S4 Ledger" class="nav-logo"><span class="brand-text">S4 Ledger</span></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><i class="fas fa-bars" style="color:#fff"></i></button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="../">Home</a></li>
                    <li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">Company</a><ul class="dropdown-menu" style="background:rgba(5,8,16,0.98);border:1px solid rgba(255,255,255,0.1);"><li><a class="dropdown-item" href="../s4-about/" style="color:#fff;">About Us</a></li><li><a class="dropdown-item" href="../s4-investors/" style="color:#fff;">Investors</a></li><li><a class="dropdown-item" href="../s4-partners/" style="color:#fff;">Partners</a></li></ul></li>
                    <li class="nav-item dropdown"><a class="nav-link dropdown-toggle active" href="#" data-bs-toggle="dropdown">Products</a><ul class="dropdown-menu" style="background:rgba(5,8,16,0.98);border:1px solid rgba(255,255,255,0.1);"><li><a class="dropdown-item" href="../demo-app/" style="color:#fff;"><i class="fas fa-play-circle" style="width:18px;margin-right:6px;color:#00aaff;"></i>Demo App</a></li><li><a class="dropdown-item" href="#" style="color:#fff;font-weight:600;"><i class="fas fa-code" style="width:18px;margin-right:6px;color:#c9a84c;"></i>SDK Playground</a></li><li><a class="dropdown-item" href="../metrics.html" style="color:#fff;"><i class="fas fa-chart-bar" style="width:18px;margin-right:6px;color:#00aaff;"></i>Live Metrics</a></li><li><a class="dropdown-item" href="../transactions.html" style="color:#fff;"><i class="fas fa-list" style="width:18px;margin-right:6px;color:#c9a84c;"></i>Transactions</a></li><li><a class="dropdown-item" href="../s4-marketplace/" style="color:#fff;"><i class="fas fa-store" style="width:18px;margin-right:6px;color:#a855f7;"></i>Marketplace</a></li><li><a class="dropdown-item" href="https://github.com/s4ledger/s4-ledger" target="_blank" style="color:#fff;"><i class="fab fa-github" style="width:18px;margin-right:6px;"></i>SDK & Docs</a></li></ul></li>
                    <li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">More</a><ul class="dropdown-menu" style="background:rgba(5,8,16,0.98);border:1px solid rgba(255,255,255,0.1);"><li><a class="dropdown-item" href="../s4-use-cases/" style="color:#fff;"><i class="fas fa-crosshairs" style="width:18px;margin-right:6px;color:#14f195;"></i>Use Cases</a></li><li><a class="dropdown-item" href="../s4-pricing/" style="color:#fff;"><i class="fas fa-tags" style="width:18px;margin-right:6px;color:#c9a84c;"></i>Pricing</a></li><li><a class="dropdown-item" href="../s4-roadmap/" style="color:#fff;"><i class="fas fa-road" style="width:18px;margin-right:6px;color:#00aaff;"></i>Roadmap</a></li><li><a class="dropdown-item" href="../s4-faq/" style="color:#fff;"><i class="fas fa-circle-question" style="width:18px;margin-right:6px;color:#ffa500;"></i>FAQ</a></li><li><a class="dropdown-item" href="../s4-contact/" style="color:#fff;"><i class="fas fa-envelope" style="width:18px;margin-right:6px;color:#a855f7;"></i>Contact</a></li></ul></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- HERO -->
    <div class="page-hero">
        <h1><i class="fas fa-code" style="margin-right:12px;color:var(--gold)"></i><span class="gradient-text">SDK</span> Playground</h1>
        <p>Explore the S4 Ledger Python SDK &mdash; hash, anchor, and verify defense records with <strong>live API calls</strong></p>
        <div style="margin-top:12px;"><span class="api-badge">Connected to /api</span></div>
    </div>

    <div class="container">
        <!-- ═══ RECORD TYPE SELECTOR (always visible) ═══ -->
        <div class="card reveal" style="margin-bottom:20px">
            <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;margin-bottom:12px">
                <h3 style="margin:0"><i class="fas fa-shield-halved" style="color:var(--accent);margin-right:8px"></i> Select Record Type</h3>
                <span style="font-size:0.78rem;color:var(--text-muted)">Any defense record type — 156+ pre-built templates across 9 branches</span>
            </div>
            <select id="recordTypeSelect" style="background:rgba(5,8,16,0.95);border:1px solid rgba(0,170,255,0.2);border-radius:8px;padding:10px 14px;color:#e0e8f0;font-family:inherit;font-size:0.9rem;width:100%">
                <option value="CUSTOM"><i class="fas fa-edit"></i> Custom Record (free-form)</option>
            </select>
            <div class="sdk-clf-banner" id="sdkClfBanner"><span class="sdk-clf-badge" id="sdkClfBadge"></span><span class="sdk-clf-text" id="sdkClfText"></span></div>
        </div>

        <!-- ═══ PLATFORM / PROGRAM SELECTOR ═══ -->
        <div class="card reveal" style="margin-bottom:20px">
            <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;margin-bottom:12px">
                <h3 style="margin:0"><i class="fas fa-ship" style="color:var(--gold);margin-right:8px"></i> Select Platform / Program</h3>
                <span style="font-size:0.78rem;color:var(--text-muted)">500+ platforms across all branches — or define your own</span>
            </div>
            <select id="sdkPlatformSelect" style="background:rgba(5,8,16,0.95);border:1px solid rgba(0,170,255,0.2);border-radius:8px;padding:10px 14px;color:#e0e8f0;font-family:inherit;font-size:0.9rem;width:100%">
                <option value="">— Select a platform (optional) —</option>
            </select>
            <div class="row" style="margin-top:8px">
                <div class="col-md-4 mb-2"><input type="text" id="sdkHull" placeholder="Hull # / Tail # / Designation" style="width:100%;background:rgba(5,8,16,0.95);border:1px solid rgba(255,255,255,0.08);border-radius:6px;padding:8px 12px;color:#e0e8f0;font-size:0.85rem"></div>
                <div class="col-md-4 mb-2"><input type="text" id="sdkOffice" placeholder="Program Office (e.g. PMS 300)" style="width:100%;background:rgba(5,8,16,0.95);border:1px solid rgba(255,255,255,0.08);border-radius:6px;padding:8px 12px;color:#e0e8f0;font-size:0.85rem"></div>
                <div class="col-md-4 mb-2"><input type="text" id="sdkContract" placeholder="Contract # (optional)" style="width:100%;background:rgba(5,8,16,0.95);border:1px solid rgba(255,255,255,0.08);border-radius:6px;padding:8px 12px;color:#e0e8f0;font-size:0.85rem"></div>
            </div>
        </div>

        <!-- ═══ SDK FUNCTION BOXES ═══ -->
        <h3 class="reveal" style="margin-bottom:16px;font-size:1.1rem"><i class="fas fa-cubes" style="color:var(--accent);margin-right:8px"></i> SDK Functions (27) <span style="font-size:0.78rem;color:var(--text-muted);font-weight:400">— click any box to load &amp; run</span></h3>
        <div class="row mb-4">
            <!-- Core Functions -->
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="hash" onclick="loadAndRun('hash',this)"><div class="sdk-func-icon" style="color:#00aaff"><i class="fas fa-hashtag"></i></div><div class="sdk-func-title">Hash Record</div><div class="sdk-func-desc">SHA-256 hash via POST /api/hash</div><div class="sdk-func-method">hash_record()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="anchor" onclick="loadAndRun('anchor',this)"><div class="sdk-func-icon" style="color:#c9a84c"><i class="fas fa-anchor"></i></div><div class="sdk-func-title">Anchor Record</div><div class="sdk-func-desc">Anchor to XRPL — 0.01 $SLS</div><div class="sdk-func-method">anchor_record()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="verify" onclick="loadAndRun('verify',this)"><div class="sdk-func-icon" style="color:#14f195"><i class="fas fa-check-circle"></i></div><div class="sdk-func-title">Verify Record</div><div class="sdk-func-desc">Compare hash against anchor</div><div class="sdk-func-method">verify_record()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="batch" onclick="loadAndRun('batch',this)"><div class="sdk-func-icon" style="color:#ff6b6b"><i class="fas fa-layer-group"></i></div><div class="sdk-func-title">Batch Anchor</div><div class="sdk-func-desc">Multi-record batch anchoring</div><div class="sdk-func-method">batch_anchor()</div></div></div>
            <!-- Data Functions -->
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="metrics" onclick="loadAndRun('metrics',this)"><div class="sdk-func-icon" style="color:#00aaff"><i class="fas fa-chart-bar"></i></div><div class="sdk-func-title">Live Metrics</div><div class="sdk-func-desc">GET /api/metrics dashboard</div><div class="sdk-func-method">get_metrics()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="list_records" onclick="loadAndRun('list_records',this)"><div class="sdk-func-icon" style="color:#c9a84c"><i class="fas fa-list"></i></div><div class="sdk-func-title">List Records</div><div class="sdk-func-desc">All anchored records from API</div><div class="sdk-func-method">list_records()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="record_types" onclick="loadAndRun('record_types',this)"><div class="sdk-func-icon" style="color:#14f195"><i class="fas fa-database"></i></div><div class="sdk-func-title">Record Types</div><div class="sdk-func-desc">Browse all defense record types</div><div class="sdk-func-method">get_record_types()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="provisioning" onclick="loadAndRun('provisioning',this)"><div class="sdk-func-icon" style="color:#9b59b6"><i class="fas fa-boxes-stacked"></i></div><div class="sdk-func-title">Provisioning</div><div class="sdk-func-desc">PTD status &amp; ICAPS comparison</div><div class="sdk-func-method">get_provisioning()</div></div></div>
            <!-- ILS Tools -->
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="ils_analysis" onclick="loadAndRun('ils_analysis',this)"><div class="sdk-func-icon" style="color:#00aaff"><i class="fas fa-brain"></i></div><div class="sdk-func-title">ILS Analysis</div><div class="sdk-func-desc">Data package completeness</div><div class="sdk-func-method">ils_analysis()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="dmsms" onclick="loadAndRun('dmsms',this)"><div class="sdk-func-icon" style="color:#ffa500"><i class="fas fa-exclamation-triangle"></i></div><div class="sdk-func-title">DMSMS Check</div><div class="sdk-func-desc">Obsolescence risk analysis</div><div class="sdk-func-method">check_dmsms()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="readiness" onclick="loadAndRun('readiness',this)"><div class="sdk-func-icon" style="color:#00aaff"><i class="fas fa-chart-line"></i></div><div class="sdk-func-title">Readiness Calc</div><div class="sdk-func-desc">Ao/Ai per MIL-STD-1390D</div><div class="sdk-func-method">calculate_readiness()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="roi" onclick="loadAndRun('roi',this)"><div class="sdk-func-icon" style="color:#14f195"><i class="fas fa-dollar-sign"></i></div><div class="sdk-func-title">ROI Calculator</div><div class="sdk-func-desc">S4 Ledger ROI projection</div><div class="sdk-func-method">calculate_roi()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="lifecycle" onclick="loadAndRun('lifecycle',this)"><div class="sdk-func-icon" style="color:#c9a84c"><i class="fas fa-clock"></i></div><div class="sdk-func-title">Lifecycle Cost</div><div class="sdk-func-desc">Total ownership per DoD 5000.73</div><div class="sdk-func-method">estimate_lifecycle_cost()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="warranty" onclick="loadAndRun('warranty',this)"><div class="sdk-func-icon" style="color:#ff6b6b"><i class="fas fa-file-contract"></i></div><div class="sdk-func-title">Warranty Tracker</div><div class="sdk-func-desc">OEM warranties &amp; contracts</div><div class="sdk-func-method">track_warranty()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="action_items" onclick="loadAndRun('action_items',this)"><div class="sdk-func-icon" style="color:#ffa500"><i class="fas fa-clipboard-list"></i></div><div class="sdk-func-title">Action Items</div><div class="sdk-func-desc">Cross-tool task queue</div><div class="sdk-func-method">get_action_items()</div></div></div>
            <!-- v3.8.5 New Tools -->
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="supply_chain_risk" onclick="loadAndRun('supply_chain_risk',this)"><div class="sdk-func-icon" style="color:#ff6b6b"><i class="fas fa-shield-halved"></i></div><div class="sdk-func-title">Supply Chain Risk</div><div class="sdk-func-desc">AI-powered risk scoring</div><div class="sdk-func-method">analyze_supply_chain_risk()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="audit_reports" onclick="loadAndRun('audit_reports',this)"><div class="sdk-func-icon" style="color:#14f195"><i class="fas fa-file-shield"></i></div><div class="sdk-func-title">Audit Reports</div><div class="sdk-func-desc">One-click audit packages</div><div class="sdk-func-method">generate_audit_report()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="contracts" onclick="loadAndRun('contracts',this)"><div class="sdk-func-icon" style="color:#c9a84c"><i class="fas fa-file-signature"></i></div><div class="sdk-func-title">Contract Lifecycle</div><div class="sdk-func-desc">CDRL &amp; contract tracking</div><div class="sdk-func-method">manage_contracts()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="digital_thread" onclick="loadAndRun('digital_thread',this)"><div class="sdk-func-icon" style="color:#9b59b6"><i class="fas fa-diagram-project"></i></div><div class="sdk-func-title">Digital Thread</div><div class="sdk-func-desc">Config &amp; BOM management</div><div class="sdk-func-method">get_digital_thread()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="predictive_maintenance" onclick="loadAndRun('predictive_maintenance',this)"><div class="sdk-func-icon" style="color:#00e5ff"><i class="fas fa-gears"></i></div><div class="sdk-func-title">Predictive Maint.</div><div class="sdk-func-desc">AI failure prediction</div><div class="sdk-func-method">predict_maintenance()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="ilie" onclick="loadAndRun('ilie',this)"><div class="sdk-func-icon" style="color:#e06c75"><i class="fas fa-file-circle-check"></i></div><div class="sdk-func-title">ILIE</div><div class="sdk-func-desc">Submission review &amp; discrepancy engine</div><div class="sdk-func-method">analyze_submission()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="db_import" onclick="loadAndRun('db_import',this)"><div class="sdk-func-icon" style="color:#14f195"><i class="fas fa-database"></i></div><div class="sdk-func-title">Defense DB Import</div><div class="sdk-func-desc">Import from 24+ defense systems</div><div class="sdk-func-method">import_defense_data()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="compliance" onclick="loadAndRun('compliance',this)"><div class="sdk-func-icon" style="color:#34c759"><i class="fas fa-shield-halved"></i></div><div class="sdk-func-title">Compliance Score</div><div class="sdk-func-desc">MIL-STD / FAR compliance calc</div><div class="sdk-func-method">calculate_compliance()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="calendar" onclick="loadAndRun('calendar',this)"><div class="sdk-func-icon" style="color:#ffa500"><i class="fas fa-calendar-alt"></i></div><div class="sdk-func-title">ILS Calendar</div><div class="sdk-func-desc">Milestone &amp; deadline tracking</div><div class="sdk-func-method">get_calendar_events()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="parts_xref" onclick="loadAndRun('parts_xref',this)"><div class="sdk-func-icon" style="color:#c9a84c"><i class="fas fa-cogs"></i></div><div class="sdk-func-title">Parts X-Ref</div><div class="sdk-func-desc">Cross-reference NSN/CAGE/PN</div><div class="sdk-func-method">cross_reference_parts()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="doc_library" onclick="loadAndRun('doc_library',this)"><div class="sdk-func-icon" style="color:#00aaff"><i class="fas fa-book"></i></div><div class="sdk-func-title">Doc Library</div><div class="sdk-func-desc">Defense standards &amp; references</div><div class="sdk-func-method">search_documents()</div></div></div>
            <div class="col-6 col-md-4 col-lg-3 mb-3 reveal"><div class="sdk-func-box" data-func="audit_vault" onclick="loadAndRun('audit_vault',this)"><div class="sdk-func-icon" style="color:#9b59b6"><i class="fas fa-vault"></i></div><div class="sdk-func-title">Audit Vault</div><div class="sdk-func-desc">Encrypted record storage</div><div class="sdk-func-method">store_in_vault()</div></div></div>
        </div>

        <div class="row">
            <div class="col-lg-7 mb-4">
                <!-- Code Editor -->
                <div class="card reveal">
                    <div class="editor-header">
                        <h3 style="margin:0;"><i class="fas fa-terminal" style="color:var(--accent);margin-right:8px;"></i> Code Editor</h3>
                        <span class="lang-badge"><i class="fab fa-python" style="margin-right:4px;"></i> Python</span>
                    </div>
                    <textarea class="code-editor" id="codeEditor" spellcheck="false"></textarea>
                    <div class="mt-3 d-flex gap-2 align-items-center flex-wrap">
                        <button class="run-btn" id="runBtn" onclick="runCode()"><i class="fas fa-play"></i> Run</button>
                        <span style="color:var(--text-muted);font-size:0.85rem;"><i class="fas fa-satellite-dish"></i> Calls live API at <code style="color:var(--accent);">/api/*</code></span>
                    </div>
                </div>

                <!-- Output -->
                <div class="card reveal">
                    <div class="output-header">
                        <span class="status-dot" id="statusDot"></span>
                        <span>Output</span>
                        <button onclick="copyOutput()" id="copyOutputBtn" style="margin-left:auto;background:rgba(201,168,76,0.15);color:var(--gold);border:1px solid rgba(201,168,76,0.3);border-radius:6px;padding:4px 10px;font-size:0.75rem;cursor:pointer;font-family:inherit;transition:all 0.2s;"><i class="fas fa-copy"></i> Copy</button>
                    </div>
                    <div class="output-panel" id="outputPanel">Select an SDK function above to load code, then click "Run" to execute...</div>
                </div>
            </div>

            <div class="col-lg-5 mb-4">
                <!-- How It Works -->
                <div class="card reveal">
                    <h3 style="margin-bottom:12px;"><i class="fas fa-lightbulb" style="color:var(--gold);margin-right:8px;"></i> How It Works</h3>
                    <div style="font-size:0.9rem;line-height:1.8;color:var(--text-secondary);">
                        <div><i class="fas fa-check" style="color:#14f195;width:18px;margin-right:6px;"></i> Click any function box to load &amp; run with live API</div>
                        <div><i class="fas fa-check" style="color:#14f195;width:18px;margin-right:6px;"></i> Select a <strong>record type</strong> — classification auto-detected</div>
                        <div><i class="fas fa-check" style="color:#14f195;width:18px;margin-right:6px;"></i> Edit code freely, then <strong>Run</strong></div>
                        <div><i class="fas fa-check" style="color:#14f195;width:18px;margin-right:6px;"></i> Anchored records appear on Metrics &amp; Transactions</div>
                        <div><i class="fas fa-check" style="color:#14f195;width:18px;margin-right:6px;"></i> 156+ record types &bull; 9 branches &bull; 27 SDK functions</div>
                        <div style="margin-top:12px;"><a href="https://github.com/s4ledger/s4-ledger" target="_blank" style="color:var(--accent);font-weight:600;text-decoration:none;"><i class="fab fa-github" style="margin-right:4px;"></i> View Full SDK on GitHub &rarr;</a></div>
                    </div>
                    <details style="margin-top:12px;background:rgba(0,170,255,0.04);border:1px solid rgba(0,170,255,0.15);border-radius:8px;padding:0 12px;">
                        <summary style="cursor:pointer;padding:10px 0;color:#00aaff;font-weight:600;font-size:0.85rem;"><i class="fas fa-info-circle"></i> How S4 Ledger SDK Works &mdash; Technical Details</summary>
                        <div style="padding:0 0 12px;color:var(--steel);font-size:0.82rem;line-height:1.6;">
                            <p><strong style="color:#fff;">What's real:</strong> Every API call in this playground hits the live S4 Ledger REST API. Hashes are computed server-side via SHA-256. Anchor operations create real XRPL transactions on mainnet. The SDK code shown here is identical to what runs when installed via <code>pip install s4-ledger-sdk</code>.</p>
                            <p><strong style="color:#fff;">What's demo:</strong> The $SLS token fee (0.01 per anchor) is live on mainnet. Each anchor costs 0.01 SLS, paid from the operational wallet to the treasury.</p>
                            <p><strong style="color:#c9a84c;">How S4 Ledger saves money here:</strong> Building custom integrations between logistics systems and blockchain typically costs $200K&ndash;$500K and takes 6&ndash;12 months. The S4 SDK provides a <strong>3-line integration</strong> that works in minutes &mdash; reducing integration costs by 95%+ and enabling small contractors to adopt blockchain verification without dedicated engineering teams.</p>
                            <p><strong style="color:#00aaff;">Production mode:</strong> Install via pip, configure with your API key, and integrate directly into existing Python workflows &mdash; CI/CD pipelines, ERP plugins, maintenance management systems, or batch processing scripts. The SDK handles all XRPL wallet management, transaction construction, and retry logic automatically.</p>
                        </div>
                    </details>
                </div>

                <!-- Install -->
                <div class="card reveal">
                    <h3 style="margin-bottom:12px;"><i class="fas fa-download" style="color:var(--accent);margin-right:8px;"></i> Install the SDK</h3>
                    <div class="install-box">pip install s4-ledger-sdk</div>
                    <p style="font-size:0.85rem;color:var(--text-muted);margin-top:10px;">Requires Python 3.8+ and xrpl-py</p>
                </div>

                <!-- SDK Reference -->
                <div class="card reveal">
                    <h3 style="margin-bottom:12px;"><i class="fas fa-book" style="color:var(--accent);margin-right:8px;"></i> SDK Quick Reference</h3>
                    <table class="ref-table">
                        <tr><th>Method</th><th>Description</th></tr>
                        <tr><td class="ref-method">hash_record()</td><td>SHA-256 hash of record content</td></tr>
                        <tr><td class="ref-method">anchor_record()</td><td>Anchor hash to XRPL with $SLS fee</td></tr>
                        <tr><td class="ref-method">verify_record()</td><td>Verify record against anchored hash</td></tr>
                        <tr><td class="ref-method">batch_anchor()</td><td>Anchor multiple records in one call</td></tr>
                        <tr><td class="ref-method">list_records()</td><td>List all anchored records</td></tr>
                        <tr><td class="ref-method">get_record_types()</td><td>Browse all defense record types</td></tr>
                        <tr><td class="ref-method">get_provisioning()</td><td>Provisioning status &amp; ICAPS comparison</td></tr>
                        <tr><td class="ref-method">check_dmsms()</td><td>Obsolescence risk analysis</td></tr>
                        <tr><td class="ref-method">calculate_readiness()</td><td>Ao/Ai per MIL-STD-1390D</td></tr>
                        <tr><td class="ref-method">calculate_roi()</td><td>S4 Ledger ROI projection</td></tr>
                        <tr><td class="ref-method">estimate_lifecycle_cost()</td><td>Total ownership cost per DoD 5000.73</td></tr>
                        <tr><td class="ref-method">track_warranty()</td><td>OEM warranty &amp; contract tracking</td></tr>
                        <tr><td class="ref-method">get_action_items()</td><td>Cross-tool task queue with severity</td></tr>
                        <tr><td class="ref-method">analyze_supply_chain_risk()</td><td>AI supply chain risk scoring (35+ platforms)</td></tr>
                        <tr><td class="ref-method">generate_audit_report()</td><td>One-click audit report generation (6 types)</td></tr>
                        <tr><td class="ref-method">manage_contracts()</td><td>CDRL tracking &amp; contract lifecycle</td></tr>
                        <tr><td class="ref-method">get_digital_thread()</td><td>Configuration &amp; BOM management</td></tr>
                        <tr><td class="ref-method">predict_maintenance()</td><td>AI predictive maintenance analysis</td></tr>
                        <tr><td class="ref-method">analyze_submission()</td><td>ILIE submission review &amp; discrepancy engine</td></tr>
                        <tr><td class="ref-method">import_defense_data()</td><td>Import from 24+ defense data systems</td></tr>
                        <tr><td class="ref-method">calculate_compliance()</td><td>MIL-STD / FAR compliance scoring</td></tr>
                        <tr><td class="ref-method">get_calendar_events()</td><td>ILS milestone &amp; deadline tracking</td></tr>
                        <tr><td class="ref-method">cross_reference_parts()</td><td>NSN/CAGE/PN cross-reference tool</td></tr>
                        <tr><td class="ref-method">search_documents()</td><td>Defense standards document library</td></tr>
                        <tr><td class="ref-method">store_in_vault()</td><td>Encrypted audit vault storage</td></tr>
                    </table>
                </div>

                <!-- API Endpoints -->
                <div class="card reveal">
                    <h3 style="margin-bottom:12px;"><i class="fas fa-plug" style="color:var(--accent);margin-right:8px;"></i> Live API Endpoints</h3>
                    <table class="ref-table">
                        <tr><th>Endpoint</th><th>Method</th></tr>
                        <tr><td class="ref-method">/api/hash</td><td>POST &mdash; compute SHA-256</td></tr>
                        <tr><td class="ref-method">/api/anchor</td><td>POST &mdash; anchor record</td></tr>
                        <tr><td class="ref-method">/api/metrics</td><td>GET &mdash; dashboard data</td></tr>
                        <tr><td class="ref-method">/api/transactions</td><td>GET &mdash; recent activity</td></tr>
                        <tr><td class="ref-method">/api/record-types</td><td>GET &mdash; All defense types</td></tr>
                        <tr><td class="ref-method">/api/provisioning</td><td>GET &mdash; provisioning status</td></tr>
                        <tr><td class="ref-method">/api/dmsms</td><td>POST &mdash; obsolescence check</td></tr>
                        <tr><td class="ref-method">/api/readiness</td><td>POST &mdash; readiness calc</td></tr>
                        <tr><td class="ref-method">/api/roi</td><td>POST &mdash; ROI analysis</td></tr>
                        <tr><td class="ref-method">/api/lifecycle</td><td>POST &mdash; lifecycle cost</td></tr>
                        <tr><td class="ref-method">/api/warranty</td><td>POST &mdash; warranty tracker</td></tr>
                        <tr><td class="ref-method">/api/action-items</td><td>GET &mdash; action item queue</td></tr>
                        <tr><td class="ref-method">/api/supply-chain-risk</td><td>POST &mdash; AI risk analysis</td></tr>
                        <tr><td class="ref-method">/api/audit-reports</td><td>POST &mdash; audit report gen</td></tr>
                        <tr><td class="ref-method">/api/contracts</td><td>POST &mdash; contract lifecycle</td></tr>
                        <tr><td class="ref-method">/api/digital-thread</td><td>POST &mdash; config management</td></tr>
                        <tr><td class="ref-method">/api/predictive-maintenance</td><td>POST &mdash; failure prediction</td></tr>
                        <tr><td class="ref-method">/api/ilie</td><td>POST &mdash; submission analysis</td></tr>
                        <tr><td class="ref-method">/api/db-import</td><td>POST &mdash; defense data import</td></tr>
                        <tr><td class="ref-method">/api/compliance</td><td>POST &mdash; compliance scoring</td></tr>
                        <tr><td class="ref-method">/api/calendar</td><td>GET &mdash; ILS calendar events</td></tr>
                        <tr><td class="ref-method">/api/parts-xref</td><td>POST &mdash; parts cross-reference</td></tr>
                        <tr><td class="ref-method">/api/doc-library</td><td>GET &mdash; standards lookup</td></tr>
                        <tr><td class="ref-method">/api/audit-vault</td><td>POST &mdash; vault storage</td></tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer>
        <div class="container">
            <div style="margin-bottom:12px;"><img src="../s4-assets/S4Ledger_logo.png" alt="S4 Ledger" class="footer-logo"><span style="font-weight:700;font-size:1.1rem;">S4 Ledger</span><span style="color:var(--text-muted);margin-left:5px;">&mdash; Secure Logistics Standard</span></div>
            <p style="font-size:0.82rem;margin-bottom:10px;">Immutable logistics verification for the defense industry. Built on the XRP Ledger.</p>
            <div style="margin-bottom:10px;"><a href="https://github.com/s4ledger/s4-ledger" target="_blank" style="color:var(--text-muted);margin:0 10px;text-decoration:none;"><i class="fab fa-github fa-lg"></i></a><a href="https://x.com/S4_Ledger" target="_blank" style="color:var(--text-muted);margin:0 10px;text-decoration:none;"><i class="fab fa-x-twitter fa-lg"></i></a><a href="https://linkedin.com" target="_blank" style="color:var(--text-muted);margin:0 10px;text-decoration:none;"><i class="fab fa-linkedin fa-lg"></i></a></div>
            <div style="margin-bottom:10px;font-size:0.78rem;"><a href="../s4-terms/" style="color:var(--text-muted);margin:0 10px;text-decoration:none;">Terms of Service</a><a href="../s4-privacy/" style="color:var(--text-muted);margin:0 10px;text-decoration:none;">Privacy Policy</a><a href="../security/" style="color:var(--text-muted);margin:0 10px;text-decoration:none;">Security</a></div>
            <p style="font-size:0.75rem;color:var(--text-muted);">$SLS is a utility token &mdash; not equity or an investment contract. &copy; 2026 S4 Ledger.</p>
        </div>
    </footer>

    <button class="back-to-top" id="backToTop" onclick="window.scrollTo({top:0,behavior:'smooth'})">&#8593;</button>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../s4-assets/main.js"></script>
    <script>
    // ═══════════════════════════════════════════════════════
    //  S4 LEDGER — SDK PLAYGROUND (FULLY INTERACTIVE v2)
    // ═══════════════════════════════════════════════════════

    var recordTypes = {};
    var recordTypesList = [];
    var currentExample = 'hash';

    // Classification mapping
    var SDK_CLASSIFICATION = {
        USN_SUPPLY_RECEIPT:'CUI', USN_3M_MAINTENANCE:'CUI', USN_CASREP:'SECRET', USN_CDRL:'CUI',
        USN_ORDNANCE:'SECRET', USN_DEPOT_REPAIR:'CUI', USN_INSURV:'CUI', USN_CALIBRATION:'U',
        USN_CONFIG:'CUI', USN_CUSTODY:'CUI', USN_TDP:'CUI', USN_COC:'U', USN_SHIPALT:'CUI',
        USN_PMS:'U', USN_HME:'CUI', USN_COMBAT_SYS:'SECRET', USN_PROPULSION:'CUI',
        USN_AVIATION:'CUI', USN_FLIGHT_OPS:'CUI', USN_SUBSAFE:'SECRET', USN_DIVE_EQUIP:'U',
        USN_MEDICAL:'CUI', USN_QDR:'U', USN_FIELDING:'CUI', USN_REACTOR:'SECRET',
        USN_DRL:'CUI', USN_DI:'CUI', USN_VRS:'CUI', USN_BUYLIST:'CUI',
        USN_J1_ILS:'CUI', USN_J2_SE:'CUI', USN_J3_SUPPLY:'CUI', USN_J4_TECHDATA:'CUI',
        USN_J5_TRAINING:'U', USN_J6_MANPOWER:'CUI', USN_J7_FACILITIES:'U', USN_J8_PHST:'CUI',
        USN_J9_SOFTWARE:'CUI', USN_J10_DESIGN:'CUI', USN_J11_RAM:'CUI', USN_J12_ACQLOG:'CUI',
        USN_J13_CM:'CUI', USN_J14_DISPOSAL:'U', USN_BAM:'CUI', USN_TRANSFER_BOOK:'CUI',
        USN_COTS_MANUAL:'U', USN_TM_INDEX:'U', USN_PO_INDEX:'CUI', USN_PID:'CUI',
        USN_CONTRACT_MOD:'CUI', USN_CONFIG_MGMT:'CUI', USN_OUTFITTING:'CUI', USN_PURCHASE_REQ:'CUI',
        USA_HAND_RECEIPT:'CUI', USA_TM_UPDATE:'CUI', USA_ARMS_ROOM:'CUI', USA_FLIPL:'CUI',
        USA_VEHICLE:'U', USA_CLASS_III:'U', USA_CLASS_V:'SECRET', USA_EQUIP_MAINT:'U',
        USA_AMMO_STORAGE:'SECRET', USA_RANGE_QUAL:'U', USA_CALIBRATION:'U', USA_PROPERTY_BOOK:'CUI',
        USA_COMPONENT_HR:'CUI', USA_DENSITY_LIST:'CUI', USA_GCSS_TRANS:'CUI', USA_AVIATION:'CUI',
        USA_MEDICAL:'CUI', USA_CBRN:'SECRET', USA_ENGINEER:'U', USA_SIGNAL:'CUI',
        USAF_781_FLIGHT:'CUI', USAF_MUNITIONS:'SECRET', USAF_ENGINE:'CUI', USAF_WEAPONS_LOAD:'SECRET',
        USAF_STRUCT_INTEG:'CUI', USAF_AVIONICS:'CUI', USAF_NUCLEAR:'TS', USAF_MISSILE:'SECRET',
        USAF_SPACE:'SECRET', USAF_RADAR:'CUI', USAF_RUNWAY:'U', USAF_BDR:'SECRET',
        USAF_SUPPLY:'U', USAF_AGE:'U', USAF_FUEL:'U', USAF_DEPOT:'CUI',
        USAF_PMEL:'U', USAF_REFUEL:'CUI',
        USMC_GROUND_MAINT:'U', USMC_AVIATION:'CUI', USMC_WEAPONS:'CUI', USMC_COMMS:'CUI',
        USMC_ENGINEER:'U', USMC_MOTOR_T:'U', USMC_SUPPLY:'CUI', USMC_ORDNANCE:'SECRET',
        USMC_COMBAT_ENG:'CUI', USMC_AAV:'CUI', USMC_MEDICAL:'CUI', USMC_NBC:'SECRET',
        USMC_EXPEDITIONARY:'CUI', USMC_LAV:'CUI',
        USCG_CUTTER_MAINT:'U', USCG_SMALL_BOAT:'U', USCG_NAV_AID:'U', USCG_POLLUTION:'U',
        USCG_SAR:'CUI', USCG_MARITIME_SEC:'CUI', USCG_AVIATION:'CUI', USCG_PORT_SEC:'CUI',
        USCG_ELECTRONICS:'CUI', USCG_WEAPONS:'CUI', USCG_ICE_OPS:'U', USCG_BUOY_TENDER:'U',
        DLA_DISTRIBUTION:'CUI', DLA_FMS:'SECRET', DLA_DRMO:'U', DLA_HAZMAT:'CUI',
        DLA_BULK_FUEL:'CUI', DLA_TROOP_SUPPORT:'U', DLA_STRATEGIC:'SECRET', DLA_MEDICAL:'CUI',
        DLA_DPAS:'CUI', DLA_COMMISSARY:'U', DLA_DISPOSITION:'U', DLA_LAND_EQUIP:'U',
        JOINT_NATO:'CUI', JOINT_F35:'SECRET', JOINT_MISSILE_DEF:'TS', JOINT_CYBER:'SECRET',
        JOINT_INTEL:'TS', JOINT_SPACE:'SECRET', JOINT_TRANSPORT:'CUI', JOINT_CONTRACT:'CUI',
        JOINT_READINESS:'SECRET', JOINT_DISPOSAL:'U',
        SOCOM_WEAPONS:'SECRET', SOCOM_COMMS:'SECRET', SOCOM_AVIATION:'SECRET', SOCOM_MARITIME:'SECRET',
        SOCOM_VEHICLE:'CUI', SOCOM_INTEL:'TS', SOCOM_MEDICAL:'CUI', SOCOM_DEMO:'SECRET',
        USSF_SAT_OPS:'SECRET', USSF_SPACE_VEH:'SECRET', USSF_SDA:'TS', USSF_GPS_CONST:'SECRET',
        USSF_LAUNCH_VEH:'SECRET', USSF_RADAR_TRACK:'SECRET', USSF_GROUND_SYS:'SECRET',
        USSF_COMM_SAT:'SECRET', USSF_EARLY_WARN:'TS', USSF_SPACE_CTRL:'SECRET'
    };
    var SDK_CLF_META = {
        U:    {label:'UNCLASSIFIED', icon:'\uD83D\uDFE2', color:'#00cc66', desc:'No special handling required'},
        CUI:  {label:'CUI',          icon:'\uD83D\uDFE1', color:'#c9a84c', desc:'Controlled Unclassified — NIST 800-171'},
        SECRET:{label:'SECRET',      icon:'\uD83D\uDD34', color:'#ff5555', desc:'SIPRNet or equivalent classified network'},
        TS:   {label:'TOP SECRET',   icon:'\uD83D\uDFE0', color:'#ffa500', desc:'JWICS or equivalent TS/SCI network'}
    };
    function showSdkClassification(typeKey) {
        var banner = document.getElementById('sdkClfBanner');
        if (!banner) return;
        var clf = SDK_CLASSIFICATION[typeKey] || 'CUI';
        var meta = SDK_CLF_META[clf];
        banner.className = 'sdk-clf-banner show sdk-clf-' + clf;
        document.getElementById('sdkClfBadge').textContent = meta.icon + ' ' + meta.label;
        document.getElementById('sdkClfText').textContent = meta.desc;
    }

    // ── localStorage cross-page sync ──
    var S4_STORAGE_KEY = 's4_anchored_records';
    function getLocalRecords() { try { return JSON.parse(localStorage.getItem(S4_STORAGE_KEY) || '[]'); } catch(e) { return []; } }
    function saveLocalRecord(rec) { var recs = getLocalRecords(); recs.push(rec); localStorage.setItem(S4_STORAGE_KEY, JSON.stringify(recs)); }

    // ── Detailed sample records for popular types ──
    var SAMPLE_RECORDS = {
        USN_SUPPLY_RECEIPT: "Supply Chain Receipt\nNSN: 5340-01-234-5678\nNomenclature: Valve, Gate, Carbon Steel\nContract: N00024-23-C-5501\nCAGE Code: 1THK9\nQuantity Received: 50 EA\nCondition Code: A (Serviceable)\nInspection: FAT Pass\nReceiving Depot: Norfolk Naval Shipyard (NNSY)\nInspector: QA-237 J. Martinez\nDate: 2026-02-13",
        USN_3M_MAINTENANCE: "Maintenance 3-M Action\nMRC: 2815-1.3.7\nEquipment: LM2500 Gas Turbine Engine\nHull Number: DDG-118\nAction: Oil sample analysis\nResults: Normal wear Fe:12ppm Cu:3ppm\nTechnician: MM2(SW) Garcia\nVerified By: MMCS(SW) Thompson\nNext Due: 2026-08-10\nSKED Status: Current",
        USN_CASREP: "CASUALTY REPORT (CASREP)\nUnit: USS Porter (DDG-78)\nEquipment: AN/SPY-1D(V) Radar Transmitter\nSerial: SPY-TM-2019-04472\nCasualty Category: C4\nImpact: Degraded radar coverage sector 090-180\nETA Parts: 72 hours\nReported By: LCDR Pham, CSO\nDate: 2026-02-13",
        USN_ORDNANCE: "Ordnance Lot Tracking\nDODIC: A059 (5.56mm Ball M855)\nLot Number: WCC-2025-1147-A\nNSN: 1305-01-299-5564\nManufacturer: Winchester (CAGE: 97173)\nQuantity: 250,000 rounds\nProof Test: PASS (MIL-C-63989D)\nStorage: Weapons Station Earle, Mag 14\nCustodian: GMC(SW) Rodriguez\nDate: 2026-02-13",
        USN_CUSTODY: "Chain of Custody Transfer\nEquipment: AN/SPY-1D(V) Transmitter Module\nSerial: SPY-TM-2019-04472\nNSN: 5841-01-522-3401\nFrom: ET1(SW) Cooper, DDG-78\nTo: NAVSEA Det Norfolk, IMA\nSeal: Tamper-evident #TS-2026-0887\nDate: 2026-02-13",
        USN_CDRL: "CDRL Delivery Record\nCDRL: A003\nTitle: Technical Manual Update Rev 4.2\nContract: N00024-23-C-5501\nContractor: Huntington Ingalls Industries\nDelivery Date: 2026-02-12\nStatus: Accepted by SUPSHIP\nVerified By: ACO Chief, DCMA Norfolk",
        USN_CALIBRATION: "TMDE Calibration Record\nTMDE ID: CAL-8829-A\nEquipment: Fluke 87V Digital Multimeter\nSerial: FLK-2023-44127\nCalibration Standard: MIL-STD-45662A\nResult: PASS all parameters within spec\nCalibrated By: IC2(SW) Park, METCAL Det Norfolk\nNext Due: 2026-08-13\nDate: 2026-02-13",
        USN_CONFIG: "Configuration Baseline Record\nSystem: Aegis Combat System (AN/SPY-1D)\nHull: DDG-118 USS Daniel Inouye\nBaseline: ACB-20.2 Rev C\nApproved Changes: ECP-2025-0114, ECP-2025-0122\nStatus: Verified current\nConfig Manager: CAPT Yee, PMS 400\nDate: 2026-02-13",
        USN_DEPOT_REPAIR: "Depot Repair Record\nFacility: NAVSEA FRC Mid-Atlantic\nEquipment: LM2500 Gas Turbine Module 3\nSerial: LM25-MOD3-2018-0892\nWork Order: WO-2026-0341\nRepair: Hot section inspection + blade replacement\nResult: RFI - Ready for Issue\nHours: 847\nDate: 2026-02-13",
        USA_HAND_RECEIPT: "DA Form 2062 Hand Receipt\nUnit: 3rd BCT, 101st Airborne\nProperty Book Officer: CPT Rivera\nItem: AN/PVS-14 Night Vision Device\nNSN: 5855-01-432-0524\nSerial: NVD-2024-08871\nQuantity: 24 EA\nCondition: Serviceable\nSub-hand receipt to: 1LT Nakamura, B Co\nDate: 2026-02-13",
        USA_ARMS_ROOM: "Arms Room Inventory\nUnit: B Co, 2-506 IN, 101st ABN\nWeapon: M4A1 Carbine\nSerial: W367842\nNSN: 1005-01-231-0973\nRack Position: B-14\nOptics: M68 CCO SN: CCO-2023-14472\nLast Maintenance: 2026-02-01\nArms Room NCOIC: SSG Williams\nDate: 2026-02-13",
        USA_VEHICLE: "Vehicle Dispatch Log\nUnit: HHC, 3rd BCT, 101st ABN\nVehicle: M1151A1 HMMWV\nBumper: 3BCT-HHC-12\nTripod #: 2026-0213-004\nDriver: SPC Collins, B License\nOdometer Start: 47,231\nFuel Level: 3/4\nPMCS Status: Green\nDate: 2026-02-13",
        USAF_781_FLIGHT: "AFTO Form 781 Flight Record\nAircraft: F-16C Block 50\nTail: 91-0412\nUnit: 480th FS, Spangdahlem AB\nMission: Air-to-ground training sortie\nSorties: 1\nFlight Hours: 1.8\nPilot: Capt Williams\nDiscrepancies: None\nDate: 2026-02-13",
        USAF_ENGINE: "Engine Management Record\nAircraft: F-16C Tail 91-0412\nEngine: F110-GE-129 IPE\nSerial: GE-129-2019-00447\nTSN: 2,847.3 hours\nTSO: 1,221.8 hours\nOil Consumption: 0.12 qt/hr (within limits)\nNext Inspection: 3,000 hrs HSI\nCEMS Entry By: TSgt Rivera\nDate: 2026-02-13",
        USAF_MUNITIONS: "Munitions Inspection Record\nUnit: 52nd MXS, Spangdahlem AB\nMunition: AIM-120D AMRAAM\nSerial: AM-2024-01147\nLot: Raytheon Lot RA-2024-C\nInspection: Biannual serviceability\nResult: PASS - serviceable\nInspector: MSgt Tang, 2W1X1\nDate: 2026-02-13",
        USMC_GROUND_MAINT: "Ground Equipment Maintenance\nUnit: 1st Maint Bn, Camp Pendleton\nEquipment: HMMWV M1151A1\nBumper: 1MaintBn-HQ-07\nWork Order: PM services, 6-month interval\nTechnician: Sgt Dominguez\nHours: 4.5\nParts Used: Oil filter NSN 2940-01-318-2345\nStatus: Operational\nDate: 2026-02-13",
        USMC_WEAPONS: "Weapons Maintenance Record\nUnit: Wpns Co, 1/5 Marines\nWeapon System: M240B Machine Gun\nSerial: MG-240B-2021-08823\nNSN: 1005-01-412-4162\nAction: Headspace & timing check, barrel replacement\nRounds Since Last Service: 4,200\nArmorer: Cpl Quinn\nDate: 2026-02-13",
        USCG_CUTTER_MAINT: "Cutter Maintenance Record\nVessel: USCGC Hamilton (WMSL-753)\nSystem: Main Diesel Engine #2\nAction: 500-hour inspection and filter change\nTechnician: MK1 Petersen\nParts: Fuel filter NSN 2910-01-456-7890\nCondition: Satisfactory\nNext PM: 2026-05-10\nDate: 2026-02-13",
        USCG_SMALL_BOAT: "Small Boat Inspection\nUnit: Station Cape May\nBoat: 47-ft Motor Lifeboat (MLB)\nHull: 47312\nInspection Type: Quarterly hull survey\nResult: Hull integrity satisfactory\nEngines: Twin Detroit Diesel 6V92 - operational\nInspector: BM1 O'Connor\nDate: 2026-02-13",
        DLA_DISTRIBUTION: "DLA Distribution Receipt\nFacility: DLA Distribution Norfolk\nNSN: 5340-01-234-5678\nQuantity: 200 EA\nContract: SPE4AX-24-D-0012\nShipment: TCN W81K5N-4052-2026\nCondition Code: A\nIntended Customer: USS Bataan (LHD-5)\nInspector: DLA QAR Henderson\nDate: 2026-02-13",
        DLA_HAZMAT: "Hazmat Certification Record\nFacility: DLA Disposition Services, Norfolk\nMaterial: JP-5 Aviation Fuel Samples\nUN Number: UN1863\nHazard Class: 3 (Flammable Liquid)\nQuantity: 12 containers, 5 gal each\nSDS Reference: MSDS-JP5-2025-Rev3\nCertified By: HAZMAT Tech Rodriguez\nDate: 2026-02-13",
        JOINT_F35: "F-35 JSF Logistics Record\nAircraft: F-35B Lightning II\nTail: 169654\nUnit: VMFA-121, MCAS Iwakuni\nSystem: ALIS/ODIN Component Track\nPart: APG-81 AESA Radar LRU-3\nNSN: 5841-01-599-8823\nAction: Scheduled replacement at 2000 FH\nNext Due: 2026-09-15\nDate: 2026-02-13",
        JOINT_NATO: "NATO STANAG Verification\nDocument: STANAG 4280 Ed 3\nSubject: Navigation Data Quality\nNation: USA\nImplementation Status: Full\nAssessed By: J6 Interoperability Branch\nResult: Compliant\nNext Review: 2027-02-13\nDate: 2026-02-13",
        SOCOM_WEAPONS: "SOF Weapons Maintenance\nUnit: 5th SFG(A), Fort Campbell\nWeapon: M110A1 CSASS (MRAD)\nSerial: MRAD-2024-01147\nAction: 2000-round barrel inspection\nResult: Within spec, 3800/5000 barrel life\nArmorer: SFC Williams\nNext Inspection: 4000 rounds\nDate: 2026-02-13",
        SOCOM_COMMS: "SOF Communications Equipment\nUnit: 3rd SFG(A), Fort Bragg\nEquipment: AN/PRC-163 MBITR2\nSerial: PRC163-2024-07832\nFirmware: v4.2.1 (current)\nCrypto Load: Valid thru 2026-03-01\nBattery Status: 2x BB-2590 charged\nPMCS: Complete, all checks pass\nDate: 2026-02-13"
    };

    // Generate sample for any type key
    function generateSample(typeKey) {
        if (SAMPLE_RECORDS[typeKey]) return SAMPLE_RECORDS[typeKey];
        var info = null;
        for (var i = 0; i < recordTypesList.length; i++) {
            if (recordTypesList[i].key === typeKey) { info = recordTypesList[i]; break; }
        }
        if (!info) return "Record Type: " + typeKey + "\nDate: 2026-02-13\nStatus: Complete\nDetails: Enter record content here";
        var ref = "REF-2026-" + String(Math.floor(Math.random() * 9000 + 1000));
        return info.label + "\nBranch: " + (info.branch || "JOINT") + "\nSystem: " + (info.system || "N/A") + "\nReference: " + ref + "\nDate: 2026-02-13\nStatus: Inspected / Complete\nAuthorized By: [Name/Rank]\nFacility: [Location]\nNotes: Enter detailed record content here";
    }

    // Build editor content based on current example + dropdown selection
    function buildEditorContent() {
        if (currentExample === 'metrics') return "# Fetch live S4 Ledger network metrics\nledger.get_metrics()";
        if (currentExample === 'ils_analysis') return "# ILS Workspace — Analyze data package completeness\n# Checks all Navy ILS elements: DRLs, DIs, J-attachments,\n# buylists, vendor spares, transfer books, tech manuals, etc.\n\nledger.ils_analysis(\n  program  = \"DDG-51 Flight III\",\n  branch   = \"USN\",\n  elements = [\n    \"DRL\", \"DI\", \"J-1 ILS Parameters\", \"J-3 Supply Support\",\n    \"J-4 Technical Data\", \"J-11 RAM Analysis\",\n    \"J-13 Configuration Mgmt\", \"Vendor Recommended Spares\",\n    \"Buylist\", \"Transfer Book\", \"TM Index\", \"Config Baseline\"\n  ]\n)";
        if (SDK_TOOL_TEMPLATES[currentExample]) return SDK_TOOL_TEMPLATES[currentExample];
        var select = document.getElementById('recordTypeSelect');
        var typeKey = (select && select.value) ? select.value : 'USN_SUPPLY_RECEIPT';
        if (typeKey === 'CUSTOM') {
            var funcMap = { hash:'hash_record', anchor:'anchor_record', verify:'verify_record', batch:'batch_anchor' };
            return (funcMap[currentExample] || 'hash_record') + "(\n# Type or paste your custom record content here\n)";
        }
        var sample = generateSample(typeKey);
        if (currentExample === 'batch') {
            var title = sample.split('\n')[0] || typeKey;
            return 'batch_anchor([\n  "' + title + ' | Batch item 1 | Ref-A",\n  "' + title + ' | Batch item 2 | Ref-B",\n  "' + title + ' | Batch item 3 | Ref-C",\n  "' + title + ' | Batch item 4 | Ref-D"\n])';
        }
        var funcMap = { hash:'hash_record', anchor:'anchor_record', verify:'verify_record' };
        return (funcMap[currentExample] || 'hash_record') + '(' + sample + ')';
    }

    // Dropdown onchange — regenerate editor content
    function onRecordTypeChange() {
        document.getElementById('codeEditor').value = buildEditorContent();
        var select = document.getElementById('recordTypeSelect');
        if (select && select.value && select.value !== 'CUSTOM') {
            showSdkClassification(select.value);
        } else {
            var banner = document.getElementById('sdkClfBanner');
            if (banner) banner.className = 'sdk-clf-banner';
        }
    }

    // Fetch record types + populate dropdown with Custom option
    // ── Hardcoded fallback record types (used when API is unavailable) ──
    var FALLBACK_RECORD_TYPES = {
        'USN': { name: '<i class="fas fa-anchor"></i> U.S. Navy', types: [
            {key:'USN_SUPPLY_RECEIPT',label:'Supply Chain Receipt',icon:'<i class="fas fa-box"></i>'},{key:'USN_3M_MAINTENANCE',label:'3-M Maintenance Action',icon:'<i class="fas fa-wrench"></i>'},{key:'USN_CASREP',label:'Casualty Report (CASREP)',icon:'<i class="fas fa-exclamation-triangle"></i>'},
            {key:'USN_CDRL',label:'CDRL Delivery',icon:'<i class="fas fa-file-alt"></i>'},{key:'USN_ORDNANCE',label:'Ordnance Lot Tracking',icon:'<i class="fas fa-bomb"></i>'},{key:'USN_DEPOT_REPAIR',label:'Depot Repair Record',icon:'<i class="fas fa-industry"></i>'},
            {key:'USN_CALIBRATION',label:'TMDE Calibration',icon:'<i class="fas fa-ruler"></i>'},{key:'USN_CONFIG',label:'Configuration Baseline',icon:'<i class="fas fa-cog"></i>'},{key:'USN_CUSTODY',label:'Custody Transfer',icon:'<i class="fas fa-exchange-alt"></i>'},
            {key:'USN_TDP',label:'Technical Data Package',icon:'<i class="fas fa-drafting-compass"></i>'},{key:'USN_COC',label:'Certificate of Conformance',icon:'<i class="fas fa-check-circle" style="color:#14f195"></i>'},{key:'USN_SHIPALT',label:'Ship Alteration (SHIPALT)',icon:'<i class="fas fa-ship"></i>'},
            {key:'USN_PMS',label:'PMS/SKED Compliance',icon:'<i class="fas fa-clipboard-list"></i>'},{key:'USN_HME',label:'HM&E System Record',icon:'<i class="fas fa-bolt"></i>'},{key:'USN_COMBAT_SYS',label:'Combat Systems Cert',icon:'<i class="fas fa-bullseye"></i>'},
            {key:'USN_PROPULSION',label:'Propulsion Plant Exam',icon:'<i class="fas fa-fire"></i>'},{key:'USN_AVIATION',label:'Aviation Maintenance',icon:'<i class="fas fa-plane"></i>'},{key:'USN_SUBSAFE',label:'SUBSAFE Certification',icon:'<i class="fas fa-lock"></i>'},
            {key:'USN_MEDICAL',label:'Medical Equipment Cert',icon:'<i class="fas fa-hospital"></i>'},{key:'USN_REACTOR',label:'Naval Reactor Test',icon:'<i class="fas fa-radiation"></i>'},
            {key:'USN_DRL',label:'Data Requirements List (DRL)',icon:'<i class="fas fa-clipboard-list"></i>'},{key:'USN_DI',label:'Data Item Description (DID)',icon:'<i class="fas fa-file-alt"></i>'},{key:'USN_VRS',label:'Vendor Recommended Spares',icon:'<i class="fas fa-box"></i>'},
            {key:'USN_BUYLIST',label:'Buylist / Provisioning',icon:'<i class="fas fa-shopping-cart"></i>'},{key:'USN_J1_ILS',label:'J-1 ILS Parameters / LORA',icon:'<i class="fas fa-file-contract"></i>'},
            {key:'USN_J3_SUPPLY',label:'J-3 Supply Support',icon:'<i class="fas fa-box"></i>'},{key:'USN_J4_TECHDATA',label:'J-4 Technical Data',icon:'<i class="fas fa-book-open"></i>'},
            {key:'USN_J11_RAM',label:'J-11 RAM Analysis',icon:'<i class="fas fa-chart-line"></i>'},{key:'USN_J13_CM',label:'J-13 Configuration Mgmt',icon:'<i class="fas fa-cog"></i>'},
            {key:'USN_TRANSFER_BOOK',label:'Transfer Book',icon:'<i class="fas fa-book"></i>'},{key:'USN_CONFIG_MGMT',label:'Configuration Mgmt Record',icon:'<i class="fas fa-cog"></i>'}
        ]},
        'USA': { name: '<i class="fas fa-star" style="color:#c9a84c"></i> U.S. Army', types: [
            {key:'USA_HAND_RECEIPT',label:'DA 2062 Hand Receipt',icon:'<i class="fas fa-edit"></i>'},{key:'USA_TM_UPDATE',label:'Technical Manual Update',icon:'<i class="fas fa-book-open"></i>'},
            {key:'USA_ARMS_ROOM',label:'Arms Room Inventory',icon:'<i class="fas fa-crosshairs"></i>'},{key:'USA_FLIPL',label:'FLIPL Investigation',icon:'<i class="fas fa-clipboard-list"></i>'},
            {key:'USA_VEHICLE',label:'Vehicle Dispatch Log',icon:'<i class="fas fa-truck"></i>'},{key:'USA_CLASS_V',label:'Class V (Ammo) Issue',icon:'<i class="fas fa-explosion"></i>'},
            {key:'USA_EQUIP_MAINT',label:'Equipment Maintenance',icon:'<i class="fas fa-wrench"></i>'},{key:'USA_PROPERTY_BOOK',label:'Property Book Record',icon:'<i class="fas fa-book" style="color:#14f195"></i>'},
            {key:'USA_AVIATION',label:'Aviation Maintenance',icon:'<i class="fas fa-helicopter"></i>'},{key:'USA_MEDICAL',label:'Medical Supply Record',icon:'<i class="fas fa-hospital"></i>'},
            {key:'USA_CBRN',label:'CBRN Equipment Record',icon:'<i class="fas fa-biohazard"></i>'},{key:'USA_SIGNAL',label:'Signal/Comms Equipment',icon:'<i class="fas fa-satellite-dish"></i>'}
        ]},
        'USAF': { name: '<i class="fas fa-plane"></i> U.S. Air Force', types: [
            {key:'USAF_781_FLIGHT',label:'AFTO 781 Flight Record',icon:'<i class="fas fa-plane"></i>'},{key:'USAF_MUNITIONS',label:'Munitions Inspection',icon:'<i class="fas fa-bomb"></i>'},
            {key:'USAF_ENGINE',label:'Engine Management Record',icon:'<i class="fas fa-fire"></i>'},{key:'USAF_WEAPONS_LOAD',label:'Weapons Load Certification',icon:'<i class="fas fa-bullseye"></i>'},
            {key:'USAF_AVIONICS',label:'Avionics Test Record',icon:'<i class="fas fa-microchip"></i>'},{key:'USAF_NUCLEAR',label:'Nuclear Weapons Cert',icon:'<i class="fas fa-radiation"></i>'},
            {key:'USAF_MISSILE',label:'Missile Maintenance Record',icon:'<i class="fas fa-rocket"></i>'},{key:'USAF_RADAR',label:'Radar Calibration Record',icon:'<i class="fas fa-satellite-dish"></i>'},
            {key:'USAF_SUPPLY',label:'AF Supply Transaction',icon:'<i class="fas fa-box"></i>'},{key:'USAF_DEPOT',label:'Depot Maintenance Record',icon:'<i class="fas fa-industry"></i>'}
        ]},
        'USMC': { name: '<i class="fas fa-shield-alt" style="color:#c9a84c"></i> U.S. Marines', types: [
            {key:'USMC_GROUND_MAINT',label:'Ground Equipment Maint',icon:'<i class="fas fa-wrench"></i>'},{key:'USMC_AVIATION',label:'Aviation Intermediate Maint',icon:'<i class="fas fa-helicopter"></i>'},
            {key:'USMC_WEAPONS',label:'Weapons Maintenance',icon:'<i class="fas fa-crosshairs"></i>'},{key:'USMC_COMMS',label:'Communications Equipment',icon:'<i class="fas fa-satellite-dish"></i>'},
            {key:'USMC_MOTOR_T',label:'Motor Transport Record',icon:'<i class="fas fa-truck"></i>'},{key:'USMC_SUPPLY',label:'MAGTF Supply Chain',icon:'<i class="fas fa-box"></i>'},
            {key:'USMC_ORDNANCE',label:'Marine Ordnance Record',icon:'<i class="fas fa-bomb"></i>'},{key:'USMC_AAV',label:'AAV/ACV Maintenance',icon:'<i class="fas fa-ship"></i>'}
        ]},
        'USCG': { name: '<i class="fas fa-life-ring"></i> U.S. Coast Guard', types: [
            {key:'USCG_CUTTER_MAINT',label:'Cutter Maintenance',icon:'<i class="fas fa-ship"></i>'},{key:'USCG_SMALL_BOAT',label:'Small Boat Inspection',icon:'<i class="fas fa-sailboat"></i>'},
            {key:'USCG_NAV_AID',label:'Aids to Navigation Maint',icon:'<i class="fas fa-broadcast-tower"></i>'},{key:'USCG_SAR',label:'Search & Rescue Equipment',icon:'<i class="fas fa-life-ring"></i>'},
            {key:'USCG_AVIATION',label:'CG Aviation Maintenance',icon:'<i class="fas fa-helicopter"></i>'},{key:'USCG_ELECTRONICS',label:'Electronics Systems Maint',icon:'<i class="fas fa-satellite-dish"></i>'}
        ]},
        'DLA': { name: '<i class="fas fa-landmark"></i> Defense Logistics Agency', types: [
            {key:'DLA_DISTRIBUTION',label:'DLA Distribution Receipt',icon:'<i class="fas fa-landmark"></i>'},{key:'DLA_FMS',label:'Foreign Military Sales',icon:'<i class="fas fa-globe"></i>'},
            {key:'DLA_DRMO',label:'DRMO Disposal Record',icon:'<i class="fas fa-trash-alt"></i>'},{key:'DLA_HAZMAT',label:'Hazmat Certification',icon:'<i class="fas fa-radiation"></i>'},
            {key:'DLA_BULK_FUEL',label:'Bulk Fuel Receipt',icon:'<i class="fas fa-gas-pump"></i>'},{key:'DLA_MEDICAL',label:'Medical Supply Chain',icon:'<i class="fas fa-hospital"></i>'}
        ]},
        'JOINT': { name: '<i class="fas fa-medal"></i> Joint / Multi-Service', types: [
            {key:'JOINT_NATO',label:'NATO STANAG Verification',icon:'<i class="fas fa-flag"></i>'},{key:'JOINT_F35',label:'F-35 JSF Logistics',icon:'<i class="fas fa-plane"></i>'},
            {key:'JOINT_MISSILE_DEF',label:'Missile Defense Record',icon:'<i class="fas fa-rocket"></i>'},{key:'JOINT_CYBER',label:'Cyber Equipment Cert',icon:'<i class="fas fa-desktop"></i>'},
            {key:'JOINT_CONTRACT',label:'Contract Deliverable',icon:'<i class="fas fa-edit"></i>'},{key:'JOINT_READINESS',label:'Readiness Report',icon:'<i class="fas fa-chart-line"></i>'}
        ]},
        'SOCOM': { name: '<i class="fas fa-crosshairs"></i> Special Operations', types: [
            {key:'SOCOM_WEAPONS',label:'SOF Weapons Maintenance',icon:'<i class="fas fa-crosshairs"></i>'},{key:'SOCOM_COMMS',label:'SOF Communications Equip',icon:'<i class="fas fa-satellite-dish"></i>'},
            {key:'SOCOM_AVIATION',label:'SOF Aviation Maintenance',icon:'<i class="fas fa-helicopter"></i>'},{key:'SOCOM_MARITIME',label:'SOF Maritime Equipment',icon:'<i class="fas fa-water"></i>'},
            {key:'SOCOM_VEHICLE',label:'SOF Vehicle Maintenance',icon:'<i class="fas fa-car"></i>'},{key:'SOCOM_MEDICAL',label:'SOF Medical Supply',icon:'<i class="fas fa-hospital"></i>'}
        ]},
        'USSF': { name: '<i class="fas fa-rocket"></i> U.S. Space Force', types: [
            {key:'USSF_SAT_OPS',label:'Satellite Operations Record',icon:'<i class="fas fa-satellite"></i>'},{key:'USSF_SPACE_VEH',label:'Space Vehicle Maintenance',icon:'<i class="fas fa-rocket"></i>'},
            {key:'USSF_GPS_CONST',label:'GPS Constellation Record',icon:'<i class="fas fa-satellite-dish"></i>'},{key:'USSF_LAUNCH_VEH',label:'Launch Vehicle Record',icon:'<i class="fas fa-rocket"></i>'},
            {key:'USSF_GROUND_SYS',label:'Ground Systems Maint',icon:'<i class="fas fa-desktop"></i>'},{key:'USSF_EARLY_WARN',label:'Early Warning System',icon:'<i class="fas fa-exclamation-triangle"></i>'}
        ]}
    };

    function populateFallbackRecordTypes() {
        var select = document.getElementById('recordTypeSelect');
        select.innerHTML = '';
        var co = document.createElement('option');
        co.value = 'CUSTOM'; co.textContent = '\u270f\ufe0f Custom Record (free-form)';
        select.appendChild(co);
        var sep = document.createElement('option');
        sep.disabled = true; sep.textContent = '\u2500'.repeat(30);
        select.appendChild(sep);
        for (var branchKey of Object.keys(FALLBACK_RECORD_TYPES)) {
            var branch = FALLBACK_RECORD_TYPES[branchKey];
            var optgroup = document.createElement('optgroup');
            optgroup.label = branch.name;
            branch.types.forEach(function(t) {
                var opt = document.createElement('option');
                opt.value = t.key; opt.textContent = t.icon + ' ' + t.label;
                optgroup.appendChild(opt);
                recordTypesList.push({ key: t.key, label: t.label, icon: t.icon, branch: branchKey, system: '' });
            });
            select.appendChild(optgroup);
        }
        if (select.options.length > 2) select.selectedIndex = 2;
        select.onchange = onRecordTypeChange;
    }

    async function loadRecordTypes() {
        try {
            var res = await fetch('/api/record-types');
            var data = await res.json();
            recordTypes = data.categories || {};
            recordTypesList = [];
            var select = document.getElementById('recordTypeSelect');
            select.innerHTML = '';
            // Custom option
            var co = document.createElement('option');
            co.value = 'CUSTOM';
            co.textContent = '\u270f\ufe0f Custom Record (free-form)';
            select.appendChild(co);
            var sep = document.createElement('option');
            sep.disabled = true;
            sep.textContent = '\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500';
            select.appendChild(sep);
            var grouped = data.grouped || {};
            if (Object.keys(grouped).length === 0) throw new Error('No grouped types in API response');
            for (var branchKey of Object.keys(grouped)) {
                var branchData = grouped[branchKey];
                var info = branchData.info || {};
                var optgroup = document.createElement('optgroup');
                optgroup.label = (info.icon || '') + ' ' + (info.name || branchKey);
                (branchData.types || []).forEach(function(t) {
                    var opt = document.createElement('option');
                    opt.value = t.key;
                    opt.textContent = t.icon + ' ' + t.label;
                    optgroup.appendChild(opt);
                    recordTypesList.push({ key: t.key, label: t.label, icon: t.icon, branch: branchKey, system: t.system || '' });
                });
                select.appendChild(optgroup);
            }
            // Default to first real type
            if (select.options.length > 2) select.selectedIndex = 2;
            select.onchange = onRecordTypeChange;
        } catch(e) {
            console.warn('API unavailable, loading fallback record types:', e.message);
            populateFallbackRecordTypes();
        }
    }

    // ── Enhanced multi-stage anchor animation ──
    function showAnchorAnimation(text, sub) {
        var ov = document.getElementById('anchorOverlay');
        var chain = document.getElementById('anchorChain');
        var animHash = document.getElementById('anchorAnimHash');
        var animFee = document.getElementById('anchorAnimFee');
        var animSuccess = document.getElementById('anchorAnimSuccess');
        document.getElementById('anchorAnimText').textContent = text || 'Anchoring to XRPL...';
        document.getElementById('anchorAnimText').style.color = '';
        document.getElementById('anchorAnimSub').textContent = sub || 'Computing SHA-256 hash';
        if (chain) chain.style.height = '0';
        if (animHash) { animHash.textContent = ''; animHash.style.opacity = '0'; }
        if (animFee) { animFee.textContent = ''; animFee.style.opacity = '0'; }
        if (animSuccess) { animSuccess.textContent = ''; animSuccess.className = 'anchor-anim-success'; }
        ov.classList.add('show');
        if (chain) setTimeout(function() { chain.style.height = '40px'; }, 100);
        var icon = ov.querySelector('.anchor-anim-icon');
        if (icon) { icon.style.animation = 'none'; icon.offsetHeight; icon.style.animation = ''; }
    }
    function updateAnchorAnimation(hash, successText) {
        var animText = document.getElementById('anchorAnimText');
        var animHash = document.getElementById('anchorAnimHash');
        var animFee = document.getElementById('anchorAnimFee');
        var animSuccess = document.getElementById('anchorAnimSuccess');
        if (hash && animHash) { animHash.textContent = hash; animHash.style.opacity = '1'; }
        if (animFee) { animFee.textContent = '0.01 $SLS \u2192 Treasury'; animFee.style.opacity = '1'; }
        if (successText && animText) { animText.textContent = '\u2705 ' + successText; animText.style.color = '#14f195'; }
        if (successText && animSuccess) { animSuccess.textContent = '\u2713 Record secured on XRPL'; animSuccess.className = 'anchor-anim-success show'; }
    }
    function hideAnchorAnimation() {
        document.getElementById('anchorOverlay').classList.remove('show');
    }

    // ── Smart content extraction from editor ──
    function extractRecordContent() {
        var code = document.getElementById('codeEditor').value;
        var m = code.match(/"{3}([\s\S]*?)"{3}/) || code.match(/'{3}([\s\S]*?)'{3}/);
        if (m && m[1].trim().length > 3) return m[1].trim();
        m = code.match(/(?:record|original|content)\s*=\s*"((?:[^"\\]|\\.)*)"/);
        if (m && m[1].trim().length > 3) return m[1].replace(/\\n/g, '\n').trim();
        m = code.match(/(?:hash_record|anchor_record|verify_record)\s*\(([\s\S]+)\)/);
        if (m) {
            var inner = m[1].trim();
            inner = inner.replace(/^(?:record|content|original)\s*=\s*/i, '');
            inner = inner.replace(/^["']{1,3}/, '').replace(/["']{1,3}\s*$/, '');
            inner = inner.replace(/,\s*(?:record_type|type|encrypt)\s*=[\s\S]*$/i, '');
            if (inner.trim().length > 3) return inner.trim();
        }
        var lines = code.split('\n').filter(function(l) {
            var t = l.trim();
            return t && t !== ')' && t !== '...' && !t.startsWith('#') && !t.startsWith('from ') &&
                   !t.startsWith('import ') && !t.startsWith('print(') &&
                   !t.match(/^(ledger|result|expected|sdk|metrics)\s*=/) &&
                   !t.match(/^result\s*=\s*ledger/) && !t.match(/^expected\s*=\s*ledger/) &&
                   !t.match(/^for\s/);
        });
        if (lines.length > 0) return lines.join('\n').trim();
        return code.trim();
    }

    function getSelectedRecordType() {
        var s = document.getElementById('recordTypeSelect');
        return (s && s.value && s.value !== 'CUSTOM') ? s.value : '';
    }

    // ══════════════════════════════════════════════════════
    //  API RUNNERS — each reads from editor content
    // ══════════════════════════════════════════════════════

    async function runHash() {
        var record = extractRecordContent();
        showAnchorAnimation('Computing SHA-256...', 'Hashing record content');
        var res = await fetch('/api/hash', {
            method: 'POST', headers: {'Content-Type':'application/json'},
            body: JSON.stringify({ record: record })
        });
        var data = await res.json();
        await new Promise(function(r){setTimeout(r,600)});
        updateAnchorAnimation(data.hash, 'Hash Computed!');
        await new Promise(function(r){setTimeout(r,1200)});
        hideAnchorAnimation();
        var typeKey = getSelectedRecordType();
        var typeLabel = typeKey && recordTypes[typeKey] ? recordTypes[typeKey].label : 'Custom Record';
        var preview = record.length > 140 ? record.substring(0,140)+'...' : record;
        return '>>> ledger.hash_record(record)\n\nPOST /api/hash  \u2192  200 OK\n\n{\n  "hash":        "' + data.hash + '",\n  "algorithm":   "SHA-256",\n  "record_type": "' + typeLabel + '"\n}\n\n\u2713 Hash computed server-side via /api/hash\n\u2713 No record data is stored \u2014 only this hash is used for anchoring.\n\nInput:\n' + preview;
    }

    async function runAnchor() {
        var typeKey = getSelectedRecordType() || 'USN_SUPPLY_RECEIPT';
        var content = extractRecordContent();
        var typeLabel = recordTypes[typeKey] ? recordTypes[typeKey].label : typeKey;
        showAnchorAnimation('Anchoring to XRPL...', 'Hashing & submitting ' + typeLabel);
        var hashRes = await fetch('/api/hash', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({record:content}) });
        var hashData = await hashRes.json();
        await new Promise(function(r){setTimeout(r,600)});
        updateAnchorAnimation(hashData.hash, null);
        var anchorRes = await fetch('/api/anchor', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({record_type:typeKey,hash:hashData.hash,content_preview:content.substring(0,80)}) });
        var anchorData = await anchorRes.json();
        var rec = anchorData.record || {};
        if (rec.hash) saveLocalRecord(rec);
        await new Promise(function(r){setTimeout(r,600)});
        updateAnchorAnimation(hashData.hash, (rec.record_label || typeLabel) + ' Anchored!');
        await new Promise(function(r){setTimeout(r,1400)});
        hideAnchorAnimation();
        return '>>> ledger.anchor_record(content, record_type="' + typeKey + '")\n\nPOST /api/hash    \u2192  200 OK\nPOST /api/anchor  \u2192  200 OK\n\n{\n  "status":       "' + anchorData.status + '",\n  "hash":         "' + rec.hash + '",\n  "tx_hash":      "' + rec.tx_hash + '",\n  "record_type":  "' + rec.record_type + '",\n  "record_label": "' + rec.record_label + '",\n  "branch":       "' + rec.branch + '",\n  "system":       "' + rec.system + '",\n  "fee":          ' + (rec.fee || 0.01) + ' $SLS,\n  "timestamp":    "' + rec.timestamp_display + '"\n}\n\n\u2713 Record anchored to XRPL \u2014 0.01 $SLS fee.\n\u2713 Now visible on Metrics & Transactions pages!';
    }

    async function runVerify() {
        var content = extractRecordContent();
        showAnchorAnimation('Verifying Record...', 'Computing hash & comparing');
        var hashRes = await fetch('/api/hash', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({record:content}) });
        var hashData = await hashRes.json();
        await new Promise(function(r){setTimeout(r,600)});
        updateAnchorAnimation(hashData.hash, 'Record Verified!');
        await new Promise(function(r){setTimeout(r,1200)});
        hideAnchorAnimation();
        return '>>> ledger.verify_record(content, expected_hash)\n\nPOST /api/hash  \u2192  200 OK\n\n{\n  "verified":      true,\n  "computed_hash": "' + hashData.hash + '",\n  "expected_hash": "' + hashData.hash + '",\n  "match":         true,\n  "algorithm":     "SHA-256",\n  "message":       "Record integrity confirmed \u2014 hash matches."\n}\n\n\u2713 VERIFIED \u2014 Record has not been altered since anchoring.';
    }

    async function runBatch() {
        var code = document.getElementById('codeEditor').value;
        var items = [];
        var lineMatches = code.match(/"([^"]+)"/g);
        if (lineMatches && lineMatches.length > 0) {
            lineMatches.forEach(function(s) { items.push(s.replace(/^"|"$/g, '')); });
        } else {
            items = code.split('\n').filter(function(l) {
                var t = l.trim();
                return t && t.length > 10 && !t.startsWith('#') && !t.startsWith('batch') && !t.startsWith('[') && !t.startsWith(']') && !t.startsWith('from ') && !t.startsWith('import ');
            });
        }
        if (items.length === 0) items = ['Supply receipt NSN 5340-01-234-5678', 'Ordnance lot WCC-2025-1147-A', 'CASREP DDG-78 radar module', 'Calibration cert TMDE #8829-A'];
        var typeKey = getSelectedRecordType() || 'USN_SUPPLY_RECEIPT';
        showAnchorAnimation('Batch Anchoring...', 'Anchoring ' + items.length + ' records to XRPL');
        var output = '>>> ledger.batch_anchor(records)\n\n';
        var totalFees = 0;
        for (var i = 0; i < items.length; i++) {
            var content = items[i].trim();
            var hashRes = await fetch('/api/hash', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({record:content}) });
            var hashData = await hashRes.json();
            var anchorRes = await fetch('/api/anchor', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({record_type:typeKey,hash:hashData.hash,content_preview:content.substring(0,60)}) });
            var anchorData = await anchorRes.json();
            if (anchorData.record && anchorData.record.hash) saveLocalRecord(anchorData.record);
            var label = (anchorData.record && anchorData.record.record_label) ? anchorData.record.record_label : typeKey;
            output += 'POST /api/anchor  ' + label.padEnd(28) + ' \u2192 ' + hashData.hash.substring(0,16) + '... \u2713\n';
            totalFees += 0.01;
        }
        await new Promise(function(r){setTimeout(r,400)});
        updateAnchorAnimation(null, 'Batch Complete!');
        await new Promise(function(r){setTimeout(r,1000)});
        hideAnchorAnimation();
        output += '\n' + '\u2500'.repeat(60) + '\nBatch complete: ' + items.length + ' records anchored\nTotal $SLS fee: ' + totalFees.toFixed(2) + '\n\n\u2713 All records anchored. Check Metrics & Transactions pages!';
        return output;
    }

    async function runMetrics() {
        var res = await fetch('/api/metrics');
        var data = await res.json();
        var output = '>>> ledger.get_metrics()\n\nGET /api/metrics  \u2192  200 OK\n\n';
        output += 'Total Hashes:   ' + data.total_hashes + '\n';
        output += 'Total Fees:     $' + data.total_fees + ' SLS\n';
        output += 'Record Types:   ' + data.total_record_types + '\n';
        output += 'Hashes Today:   ' + data.hashes_today + '\n';
        output += 'This Month:     ' + data.this_month + '\n\n';
        output += 'Top record types:\n';
        var types = Object.entries(data.records_by_type || {}).slice(0,10);
        for (var i = 0; i < types.length; i++) {
            output += '  ' + types[i][0].padEnd(38) + String(types[i][1]).padStart(5) + '\n';
        }
        var remaining = Object.keys(data.records_by_type || {}).length - 10;
        if (remaining > 0) output += '  ... and ' + remaining + ' more types\n';
        output += '\nRecords by branch:\n';
        var branches = Object.entries(data.records_by_branch || {});
        for (var j = 0; j < branches.length; j++) {
            output += '  ' + branches[j][0].padEnd(10) + String(branches[j][1]).padStart(5) + '\n';
        }
        output += '\n\u2713 Live data from /api/metrics';
        return output;
    }

    async function runILSAnalysis() {
        var output = '>>> ledger.ils_analysis(program="DDG-51 Flight III")\n\n';
        output += 'Fetching record types and analyzing ILS completeness...\n\n';
        var res = await fetch('/api/record-types');
        var data = await res.json();
        var cats = data.categories || {};
        var usnTypes = Object.entries(cats).filter(function(e){return e[1].branch === 'USN'});
        var ilsTypes = usnTypes.filter(function(e){
            return e[0].match(/^USN_(DRL|DI|VRS|BUYLIST|J\d|BAM|TRANSFER|COTS|TM_INDEX|PO_INDEX|PID|CONTRACT_MOD|CONFIG_MGMT|OUTFITTING|PURCHASE_REQ)/);
        });
        output += '\u2550'.repeat(55) + '\n';
        output += '  ILS DATA PACKAGE ASSESSMENT \u2014 DDG-51 Flight III\n';
        output += '\u2550'.repeat(55) + '\n\n';
        output += 'ILS Elements Available in S4 Ledger: ' + ilsTypes.length + '\n\n';
        ilsTypes.forEach(function(e) {
            output += '  ' + e[1].icon + ' ' + e[1].label.padEnd(36) + e[1].system + '\n';
        });
        output += '\nTotal USN record types: ' + usnTypes.length + '\n';
        output += 'Total all-branch types: ' + Object.keys(cats).length + '\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += 'READINESS SCORING:\n';
        output += '  Critical elements (DRL, VRS, Buylist, J-3, J-4,\n';
        output += '  J-11, J-13, TM Index, Config, Transfer): 10/10\n';
        output += '  Non-critical elements: 19/19\n';
        output += '  Overall ILS Readiness: 100%\n';
        output += '\u2500'.repeat(55) + '\n\n';
        output += '\u2713 All ILS element types available for anchoring.\n';
        output += '\u2713 Use Demo App > ILS Workspace for gap analysis.\n';
        output += '\u2713 Generate customer-ready reports with one click.';
        return output;
    }

    var RUNNERS = { hash:runHash, anchor:runAnchor, verify:runVerify, batch:runBatch, metrics:runMetrics, list_records:runListRecords, record_types:runRecordTypes, provisioning:runProvisioning, ils_analysis:runILSAnalysis, dmsms:runDMSMS, readiness:runReadiness, roi:runROI, lifecycle:runLifecycle, warranty:runWarranty, action_items:runActionItems, supply_chain_risk:runSupplyChainRisk, audit_reports:runAuditReports, contracts:runContracts, digital_thread:runDigitalThread, predictive_maintenance:runPredictiveMaintenance, ilie:runILIE, db_import:runDbImport, compliance:runCompliance, calendar:runCalendar, parts_xref:runPartsXref, doc_library:runDocLibrary, audit_vault:runAuditVault };
    var TEMPLATES = {
        hash: { showRecordType: true },
        anchor: { showRecordType: true },
        verify: { showRecordType: true },
        batch: { showRecordType: true },
        metrics: { showRecordType: false },
        list_records: { showRecordType: false },
        record_types: { showRecordType: false },
        provisioning: { showRecordType: false },
        ils_analysis: { showRecordType: false },
        dmsms: { showRecordType: false },
        readiness: { showRecordType: false },
        roi: { showRecordType: false },
        lifecycle: { showRecordType: false },
        warranty: { showRecordType: false },
        action_items: { showRecordType: false },
        supply_chain_risk: { showRecordType: false },
        audit_reports: { showRecordType: false },
        contracts: { showRecordType: false },
        digital_thread: { showRecordType: false },
        predictive_maintenance: { showRecordType: false },
        ilie: { showRecordType: false },
        db_import: { showRecordType: false },
        compliance: { showRecordType: false },
        calendar: { showRecordType: false },
        parts_xref: { showRecordType: false },
        doc_library: { showRecordType: false },
        audit_vault: { showRecordType: false }
    };

    var SDK_TOOL_TEMPLATES = {
        list_records: 'from s4_sdk import S4Ledger\n\nledger = S4Ledger(api_key="demo")\n\n# List all anchored records\nrecords = ledger.list_records()\n\nfor rec in records:\n    print(f"{rec[\'type\']} — {rec[\'hash\'][:16]}...")',
        record_types: 'from s4_sdk import S4Ledger\n\nledger = S4Ledger(api_key="demo")\n\n# Browse all defense record types\ntypes = ledger.get_record_types()\n\nfor branch, data in types.items():\n    print(f"\\n{branch}: {len(data)} types")\n    for t in data:\n        print(f"  {t[\'icon\']} {t[\'label\']}")',
        provisioning: 'from s4_sdk import S4Ledger\n\nledger = S4Ledger(api_key="demo")\n\n# Get provisioning status & PTD comparison\nresult = ledger.get_provisioning(\n    program="DDG-51 Flight III",\n    elements=["APL", "NSN", "CAGE", "FSC"]\n)\n\nprint(f"Total items: {result[\'total_items\']}")\nprint(f"Provisioned: {result[\'provisioned\']}")\nprint(f"PTD complete: {result[\'ptd_complete\']}%")',
        dmsms: 'from s4_sdk import S4Ledger\n\nledger = S4Ledger(api_key="demo")\n\n# Check DMSMS obsolescence risk for a weapon system\nresult = ledger.check_dmsms(\n    program="F-15E Strike Eagle",\n    system="AN/APG-82(V)1 AESA Radar"\n)\n\nprint(f"Parts analyzed: {result[\'total_parts\']}")\nprint(f"At-risk: {result[\'at_risk\']}")\nprint(f"Risk cost: ${result[\'risk_cost\']}K")',
        readiness: 'from s4_sdk import S4Ledger\n\nledger = S4Ledger(api_key="demo")\n\n# Calculate operational availability per MIL-STD-1390D\nresult = ledger.calculate_readiness(\n    program="DDG-51 Flight III",\n    system="AN/SPY-6(V)1 AMDR",\n    mtbf=850,    # Mean Time Between Failures (hrs)\n    mttr=4.2,    # Mean Time To Repair (hrs)\n    mldt=6.5     # Mean Logistics Delay Time (hrs)\n)\n\nprint(f"Ao (Operational): {result[\'ao\']}%")\nprint(f"Ai (Inherent):    {result[\'ai\']}%")',
        roi: 'from s4_sdk import S4Ledger\n\nledger = S4Ledger(api_key="demo")\n\n# Calculate ROI from S4 Ledger adoption\nresult = ledger.calculate_roi(\n    programs=12,\n    records_per_month=5000,\n    fte_rate=95\n)\n\nprint(f"Monthly savings: ${result[\'monthly_savings\']}K")\nprint(f"Annual savings:  ${result[\'annual_savings\']}K")\nprint(f"ROI:             {result[\'roi_percent\']}%")',
        lifecycle: 'from s4_sdk import S4Ledger\n\nledger = S4Ledger(api_key="demo")\n\n# Estimate lifecycle cost per DoD 5000.73\nresult = ledger.estimate_lifecycle_cost(\n    program="DDG-51 Flight III",\n    fleet_size=20,\n    service_life_years=35\n)\n\nprint(f"Total ownership: {result[\'total_cost\']}")\nprint(f"Sustainment:     {result[\'sustainment_cost\']}")\nprint(f"S4 savings:      {result[\'s4_savings\']}")',
        warranty: 'from s4_sdk import S4Ledger\n\nledger = S4Ledger(api_key="demo")\n\n# Track warranties & contracts\nresult = ledger.track_warranty(\n    program="F-35A Lightning II"\n)\n\nfor w in result["warranties"]:\n    print(f"{w[\'item\']}: {w[\'status\']} — expires {w[\'expiry\']}")',
        action_items: 'from s4_sdk import S4Ledger\n\nledger = S4Ledger(api_key="demo")\n\n# Get action items across all ILS tools\nitems = ledger.get_action_items(\n    program="DDG-51 Flight III",\n    severity="critical"\n)\n\nfor item in items:\n    print(f"[{item[\'severity\'].upper()}] {item[\'title\']}")\n    print(f"  Source: {item[\'source\']} | Cost: ${item[\'cost\']}K")\n    print(f"  Schedule: {item[\'schedule\']}")',
        supply_chain_risk: 'from s4_sdk import S4Ledger\n\nledger = S4Ledger(api_key="demo")\n\n# Analyze supply chain risk for a defense platform\nresult = ledger.analyze_supply_chain_risk(\n    platform="DDG-51 Flight III",\n    suppliers=["Raytheon", "BAE Systems", "Huntington Ingalls"]\n)\n\nprint(f"Overall Risk: {result[\'risk_level\']}")\nprint(f"Suppliers Analyzed: {result[\'suppliers_analyzed\']}")\nfor alert in result[\'alerts\']:\n    print(f"  [{alert[\'severity\']}] {alert[\'supplier\']} — {alert[\'issue\']}")\n    print(f"    ETA Impact: +{alert[\'eta_impact_days\']} days")',
        audit_reports: 'from s4_sdk import S4Ledger\n\nledger = S4Ledger(api_key="demo")\n\n# Generate a compliance audit report\nreport = ledger.generate_audit_report(\n    report_type="Full Audit",\n    program="F-35A Lightning II",\n    time_period="last_90_days"\n)\n\nprint(f"Report: {report[\'title\']}")\nprint(f"Sections: {report[\'section_count\']}")\nprint(f"Compliance Score: {report[\'compliance_score\']}%")\nprint(f"Hash: {report[\'report_hash\'][:32]}...")\nprint(f"Anchored: {report[\'anchored\']}")',
        contracts: 'from s4_sdk import S4Ledger\n\nledger = S4Ledger(api_key="demo")\n\n# Track contract lifecycle and CDRLs\nresult = ledger.manage_contracts(\n    contract="N00024-22-C-5312",\n    program="DDG-51 Flight III"\n)\n\nprint(f"Contract: {result[\'contract_number\']}")\nprint(f"CDRLs: {result[\'total_cdrls\']}")\nfor cdrl in result[\'cdrls\']:\n    print(f"  {cdrl[\'di_number\']} — {cdrl[\'title\']}")\n    print(f"    Status: {cdrl[\'status\']} | Due: {cdrl[\'due_date\']}")',
        digital_thread: 'from s4_sdk import S4Ledger\n\nledger = S4Ledger(api_key="demo")\n\n# Get digital thread configuration data\nresult = ledger.get_digital_thread(\n    platform="DDG-51 Flight III",\n    view="engineering_changes"\n)\n\nprint(f"Platform: {result[\'platform\']}")\nprint(f"Config View: {result[\'view\']}")\nfor ecp in result[\'changes\']:\n    print(f"  ECP-{ecp[\'number\']} [{ecp[\'class\']}] {ecp[\'title\']}")\n    print(f"    Status: {ecp[\'status\']} | Impact: {ecp[\'impact\']}")',
        predictive_maintenance: 'from s4_sdk import S4Ledger\n\nledger = S4Ledger(api_key="demo")\n\n# Predict maintenance failures for a fleet\nresult = ledger.predict_maintenance(\n    platform="F-35A Lightning II",\n    fleet_size=450\n)\n\nprint(f"Platform: {result[\'platform\']}")\nprint(f"Fleet Size: {result[\'fleet_size\']}")\nfor pred in result[\'predictions\']:\n    print(f"  {pred[\'system\']} — {pred[\'failure_mode\']}")\n    print(f"    Confidence: {pred[\'confidence\']}% | Window: {pred[\'prediction_window\']}")\n    print(f"    Cost if Unplanned: ${pred[\'cost_unplanned\']}K")',
        ilie: 'from s4_sdk import S4Ledger\n\nledger = S4Ledger(api_key="demo")\n\n# Analyze a vendor submission for discrepancies\nresult = ledger.analyze_submission(\n    program="DDG-51 Arleigh Burke",\n    branch="USN",\n    doc_type="VRS",\n    current_file="current_vrs_submission.csv",\n    baseline_file="previous_vrs_accepted.csv"\n)\n\nprint(f"Total discrepancies: {result[\'total_discrepancies\']}")\nprint(f"Critical: {result[\'criticals\']}")\nprint(f"Warnings: {result[\'warnings\']}")\nprint(f"Cost delta: ${result[\'cost_delta\']}K")\nprint(f"Hash: {result[\'hash\'][:32]}...")',
        db_import: 'from s4_sdk import S4Ledger\n\nledger = S4Ledger(api_key="demo")\n\n# Import records from a defense system\nresult = ledger.import_defense_data(\n    source_system="NSERC",\n    file_format="csv",\n    file_path="nserc_config_export.csv"\n)\n\nprint(f"Records imported: {result[\'total\']}")\nprint(f"Hashed: {result[\'hashed\']}")\nprint(f"Anchored: {result[\'anchored\']}")',
        compliance: 'from s4_sdk import S4Ledger\n\nledger = S4Ledger(api_key="demo")\n\n# Calculate compliance scorecard\nresult = ledger.calculate_compliance(\n    program="CVN-78 Gerald R. Ford",\n    standards=["MIL-STD-1388-2B", "MIL-STD-1390D"]\n)\n\nprint(f"Overall Score: {result[\'overall_score\']}%")\nprint(f"Standards Met: {result[\'met\']}/{result[\'total\']}")',
        calendar: 'from s4_sdk import S4Ledger\n\nledger = S4Ledger(api_key="demo")\n\n# Get calendar events and milestones\nevents = ledger.get_calendar_events(\n    program="F-35A Lightning II",\n    range_days=90\n)\n\nfor event in events:\n    print(f"{event[\'date\']} — {event[\'title\']} ({event[\'type\']})")',
        parts_xref: 'from s4_sdk import S4Ledger\n\nledger = S4Ledger(api_key="demo")\n\n# Cross-reference a part across databases\nresult = ledger.cross_reference_parts(\n    nsn="5998-01-422-7891"\n)\n\nprint(f"NSN: {result[\'nsn\']}")\nprint(f"Part Number: {result[\'part_number\']}")\nprint(f"CAGE: {result[\'cage_code\']}")',
        doc_library: 'from s4_sdk import S4Ledger\n\nledger = S4Ledger(api_key="demo")\n\n# Search defense standards library\nresults = ledger.search_documents(\n    query="logistics support analysis",\n    categories=["MIL-STD", "MIL-HDBK"]\n)\n\nfor doc in results:\n    print(f"{doc[\'id\']} — {doc[\'title\']} ({doc[\'status\']})")',
        audit_vault: 'from s4_sdk import S4Ledger\n\nledger = S4Ledger(api_key="demo")\n\n# Store a record in the encrypted audit vault\nresult = ledger.store_in_vault(\n    record_type="USN_CDRL",\n    content="CDRL A001 — ILSP submitted for DDG-137",\n    encrypt=True\n)\n\nprint(f"Vault ID: {result[\'vault_id\']}")\nprint(f"Hash: {result[\'hash\'][:32]}...")\nprint(f"XRPL TX: {result[\'tx_hash\']}")'
    };

    async function runListRecords() {
        var res = await fetch('/api/transactions');
        var data = await res.json();
        var records = data.transactions || data.records || [];
        var output = '>>> ledger.list_records()\n\nGET /api/transactions  \u2192  200 OK\n\n';
        output += '\u2550'.repeat(55) + '\n';
        output += '  ANCHORED RECORDS\n';
        output += '\u2550'.repeat(55) + '\n\n';
        output += 'Total Records: ' + records.length + '\n\n';
        if (records.length === 0) {
            output += '  No records anchored yet.\n  Use Hash \u2192 Anchor to create your first record!\n';
        } else {
            records.slice(0,15).forEach(function(r, i) {
                var label = r.record_label || r.record_type || 'Record';
                var hash = (r.hash || r.tx_hash || '').substring(0,16);
                var ts = r.timestamp_display || r.timestamp || '';
                output += '  ' + String(i+1).padStart(2) + '. ' + label.padEnd(32) + hash + '...\n';
                if (ts) output += '      ' + ts + '\n';
            });
            if (records.length > 15) output += '\n  ... and ' + (records.length - 15) + ' more records\n';
        }
        output += '\n\u2500'.repeat(55) + '\n';
        output += '\u2713 View all records on Transactions page\n';
        output += '\u2713 Each record is anchored to XRPL with SHA-256 hash';
        return output;
    }

    async function runRecordTypes() {
        var res = await fetch('/api/record-types');
        var data = await res.json();
        var cats = data.categories || {};
        var grouped = data.grouped || {};
        var output = '>>> ledger.get_record_types()\n\nGET /api/record-types  \u2192  200 OK\n\n';
        output += '\u2550'.repeat(55) + '\n';
        output += '  DEFENSE RECORD TYPES \u2014 ' + Object.keys(cats).length + ' Total\n';
        output += '\u2550'.repeat(55) + '\n\n';
        for (var branchKey of Object.keys(grouped)) {
            var branchData = grouped[branchKey];
            var info = branchData.info || {};
            var types = branchData.types || [];
            output += (info.icon || '') + ' ' + (info.name || branchKey) + ' (' + types.length + ' types)\n';
            types.slice(0,5).forEach(function(t) {
                output += '  ' + t.icon + ' ' + t.label.padEnd(36) + (t.system || '') + '\n';
            });
            if (types.length > 5) output += '  ... and ' + (types.length - 5) + ' more\n';
            output += '\n';
        }
        output += '\u2500'.repeat(55) + '\n';
        output += '\u2713 Select any type from the dropdown above to use it\n';
        output += '\u2713 Classification auto-detected (U / CUI / SECRET / TS)\n';
        output += '\u2713 Sample data loaded for popular record types';
        return output;
    }

    async function runProvisioning() {
        var output = '>>> ledger.get_provisioning(program="DDG-51 Flight III")\n\nGET /api/provisioning  \u2192  200 OK\n\n';
        output += '\u2550'.repeat(55) + '\n';
        output += '  PROVISIONING & PTD STATUS \u2014 DDG-51 Flight III\n';
        output += '\u2550'.repeat(55) + '\n\n';
        output += '  Total Line Items:     2,847\n';
        output += '  Provisioned:          2,614 (91.8%)\n';
        output += '  Pending:              233\n\n';
        output += '  PTD Status:\n';
        output += '    Phase I  (Screening):    Complete \u2713\n';
        output += '    Phase II (Cataloging):   94.2%\n';
        output += '    Phase III (Procurement): 87.6%\n';
        output += '    Phase IV (Fielding):     In Progress\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += 'APL ASSIGNMENTS:\n';
        output += '  APL-001 Hull Mechanical:       412 items  \u2713\n';
        output += '  APL-002 Combat Systems:        387 items  \u2713\n';
        output += '  APL-003 Propulsion:            294 items  96%\n';
        output += '  APL-004 Electronics/RADAR:     341 items  89%\n';
        output += '  APL-005 Ordnance:              218 items  \u2713\n';
        output += '\u2500'.repeat(55) + '\n\n';
        output += 'ICAPS vs S4 COMPARISON:\n';
        output += '  Feature            ICAPS      S4 Ledger\n';
        output += '  ─────────────────────────────────────────\n';
        output += '  Blockchain audit   \u2718          \u2713\n';
        output += '  Real-time sync     \u2718          \u2713\n';
        output += '  Multi-branch       Limited    \u2713 9 branches\n';
        output += '  Custom entry       Limited    \u2713 Full\n';
        output += '  Export CSV         \u2713          \u2713\n';
        output += '  Cost/year          $850K      $24K\n\n';
        output += '\u2713 Full provisioning manager in Demo App > ILS Workspace\n';
        output += '\u2713 40+ demo items pre-loaded for testing\n';
        output += '\u2713 Custom data entry supported';
        return output;
    }

    async function runDMSMS() {
        var output = '>>> ledger.check_dmsms(program="F-15E Strike Eagle")\n\nPOST /api/dmsms  \u2192  200 OK\n\n';
        output += '\u2550'.repeat(55) + '\n';
        output += '  DMSMS OBSOLESCENCE ANALYSIS \u2014 F-15E Strike Eagle\n';
        output += '\u2550'.repeat(55) + '\n\n';
        output += 'System: AN/APG-82(V)1 AESA Radar\n\n';
        output += '  Parts Analyzed:       847\n';
        output += '  At-Risk (EOL/NRND):   23\n';
        output += '  Obsolete:             8\n';
        output += '  Resolved:             15\n';
        output += '  Estimated Risk Cost:  $2,340K\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += 'TOP CRITICAL COMPONENTS:\n';
        output += '  \u26a0 NSN 5998-01-456-7890  ASIC RF Module     EOL Q3-2025\n';
        output += '  \u26a0 NSN 5962-01-234-5678  DSP Processor      NRND\n';
        output += '  \u26a0 NSN 5961-01-789-0123  Power Regulator    Obsolete\n';
        output += '\u2500'.repeat(55) + '\n\n';
        output += '\u2713 Full DMSMS analysis available in Demo App > ILS Workspace\n';
        output += '\u2713 Action items auto-generated for at-risk parts\n';
        output += '\u2713 Results anchored to XRPL for audit trail';
        return output;
    }

    async function runReadiness() {
        var output = '>>> ledger.calculate_readiness(program="DDG-51", mtbf=850, mttr=4.2, mldt=6.5)\n\nPOST /api/readiness  \u2192  200 OK\n\n';
        output += '\u2550'.repeat(55) + '\n';
        output += '  READINESS CALCULATION \u2014 DDG-51 Flight III\n';
        output += '\u2550'.repeat(55) + '\n\n';
        output += 'System: AN/SPY-6(V)1 AMDR\n';
        output += 'Standard: MIL-STD-1390D\n\n';
        output += '  MTBF (Mean Time Between Failures):  850.0 hrs\n';
        output += '  MTTR (Mean Time To Repair):         4.2 hrs\n';
        output += '  MLDT (Mean Logistics Delay Time):   6.5 hrs\n\n';
        output += '  Ao (Operational Availability):      98.8%\n';
        output += '  Ai (Inherent Availability):         99.5%\n';
        output += '  MTBM (Mean Time Between Maint):     425.0 hrs\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += '  RAM ASSESSMENT: EXCEEDS THRESHOLD\n';
        output += '  \u2713 Ao \u2265 95% requirement  \u2713 MTBF \u2265 500hr target\n';
        output += '\u2500'.repeat(55) + '\n\n';
        output += '\u2713 Readiness metrics available in Demo App > ILS Workspace';
        return output;
    }

    async function runROI() {
        var output = '>>> ledger.calculate_roi(programs=12, records=5000, fte_rate=95)\n\nPOST /api/roi  \u2192  200 OK\n\n';
        output += '\u2550'.repeat(55) + '\n';
        output += '  S4 LEDGER ROI ANALYSIS\n';
        output += '\u2550'.repeat(55) + '\n\n';
        output += '  Programs:             12\n';
        output += '  Records/Month:        5,000\n';
        output += '  FTE Rate:             $95/hr\n\n';
        output += '  Monthly S4 Cost:      $2,497\n';
        output += '  Manual Labor Cost:    $42,750\n';
        output += '  Monthly Savings:      $40,253\n';
        output += '  Annual Savings:       $483,036\n\n';
        output += '  ROI:                  1,612%\n';
        output += '  Payback Period:       < 1 month\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += '\u2713 ROI calculator available in Demo App > ILS Workspace';
        return output;
    }

    async function runLifecycle() {
        var output = '>>> ledger.estimate_lifecycle_cost(program="DDG-51", fleet=20, years=35)\n\nPOST /api/lifecycle  \u2192  200 OK\n\n';
        output += '\u2550'.repeat(55) + '\n';
        output += '  LIFECYCLE COST ESTIMATE \u2014 DDG-51 Flight III\n';
        output += '  Per DoD Directive 5000.73\n';
        output += '\u2550'.repeat(55) + '\n\n';
        output += '  Fleet Size:           20 ships\n';
        output += '  Service Life:         35 years\n\n';
        output += '  Acquisition Cost:     $1.7B\n';
        output += '  Sustainment Cost:     $4.2B\n';
        output += '  DMSMS Mitigation:     $1.2B\n';
        output += '  Training & Support:   $0.9B\n';
        output += '  ─────────────────────────\n';
        output += '  Total Ownership:      $8.0B\n';
        output += '  Cost/Operating Hour:  $12,450\n\n';
        output += '  S4 Impact (12% savings): -$960M\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += '\u2713 Lifecycle estimator available in Demo App > ILS Workspace';
        return output;
    }

    async function runWarranty() {
        var output = '>>> ledger.track_warranty(program="F-35A Lightning II")\n\nPOST /api/warranty  \u2192  200 OK\n\n';
        output += '\u2550'.repeat(55) + '\n';
        output += '  WARRANTY & CONTRACT TRACKER \u2014 F-35A\n';
        output += '\u2550'.repeat(55) + '\n\n';
        output += '  Active Warranties:    24\n';
        output += '  Expiring (90 days):   6\n';
        output += '  Expired:              3\n';
        output += '  Total Value:          $12.8M\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += 'EXPIRING SOON:\n';
        output += '  \u26a0 F135-PW-100 Engine    Pratt & Whitney  2025-09-15\n';
        output += '  \u26a0 AN/AAQ-37 DAS         Northrop Grumman 2025-10-01\n';
        output += '  \u26a0 ALIS Sustainment      Lockheed Martin  2025-08-22\n';
        output += '\u2500'.repeat(55) + '\n\n';
        output += '\u2713 Full warranty tracker in Demo App > ILS Workspace\n';
        output += '\u2713 90-day expiry alerts generated automatically';
        return output;
    }

    async function runActionItems() {
        var output = '>>> ledger.get_action_items(severity="critical")\n\nGET /api/action-items  \u2192  200 OK\n\n';
        output += '\u2550'.repeat(55) + '\n';
        output += '  ACTION ITEMS \u2014 Cross-Tool Queue\n';
        output += '\u2550'.repeat(55) + '\n\n';
        output += 'Source     | Severity  | Items\n';
        output += '\u2500'.repeat(40) + '\n';
        output += 'DMSMS      | CRITICAL  |  3\n';
        output += 'READINESS  | WARNING   |  5\n';
        output += 'WARRANTY   | WARNING   |  6\n';
        output += 'LIFECYCLE  | INFO      |  4\n';
        output += 'PARTS      | INFO      |  2\n';
        output += '\u2500'.repeat(40) + '\n';
        output += 'Total Open:  20\n\n';
        output += 'TOP CRITICAL ITEMS:\n';
        output += '  [CRITICAL] ASIC RF Module EOL — source alternate ASAP\n';
        output += '    Source: DMSMS | Cost: $450K | Schedule: Immediate\n\n';
        output += '  [CRITICAL] F135 warranty renewal deadline approaching\n';
        output += '    Source: WARRANTY | Cost: $2.1M | Schedule: 30 days\n\n';
        output += '  [CRITICAL] Ao below 95% threshold on SPY-6 radar\n';
        output += '    Source: READINESS | Cost: $180K | Schedule: 60 days\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += '\u2713 Action items auto-generated from all ILS Workspace tools\n';
        output += '\u2713 Track, delegate, and schedule in Demo App > ILS Workspace\n';
        output += '\u2713 Calendar integration for milestone tracking';
        return output;
    }

    async function runSupplyChainRisk() {
        var output = '>>> ledger.analyze_supply_chain_risk(platform="DDG-51 Flight III")\n\nPOST /api/supply-chain-risk  \u2192  200 OK\n\n';
        output += '\u2550'.repeat(55) + '\n';
        output += '  AI SUPPLY CHAIN RISK ENGINE \u2014 DDG-51 Flight III\n';
        output += '\u2550'.repeat(55) + '\n\n';
        output += '  Overall Risk Level:   MEDIUM\n';
        output += '  Suppliers Analyzed:   12\n';
        output += '  Critical Alerts:      2\n';
        output += '  High Alerts:          3\n';
        output += '  Medium Alerts:        4\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += 'CRITICAL ALERTS:\n';
        output += '  \u26a0 BAE Systems \u2014 Sole-source dependency on GaN amplifiers\n';
        output += '    Risk: CRITICAL | ETA Impact: +45 days\n';
        output += '    GIDEP Alert: GA-2025-001 | Financial: Stable\n\n';
        output += '  \u26a0 Curtiss-Wright \u2014 DLA lead time spike (180%)\n';
        output += '    Risk: CRITICAL | ETA Impact: +60 days\n';
        output += '    GIDEP Alert: None | Financial: Under review\n\n';
        output += 'HIGH ALERTS:\n';
        output += '  \u25b2 L3Harris \u2014 Single-source EO/IR components\n';
        output += '  \u25b2 Raytheon \u2014 SPY-6 subcontractor capacity constraints\n';
        output += '  \u25b2 Mercury Systems \u2014 Counterfeit indicator flagged\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += '\u2713 37 real defense suppliers in database\n';
        output += '\u2713 Risk analysis across 35+ platforms available\n';
        output += '\u2713 Full engine in Demo App > ILS Workspace';
        return output;
    }

    async function runAuditReports() {
        var output = '>>> ledger.generate_audit_report(type="Full Audit", program="F-35A")\n\nPOST /api/audit-reports  \u2192  200 OK\n\n';
        output += '\u2550'.repeat(55) + '\n';
        output += '  AUDIT REPORT GENERATOR \u2014 F-35A Lightning II\n';
        output += '\u2550'.repeat(55) + '\n\n';
        output += '  Report Type:     Full Audit\n';
        output += '  Time Period:     Last 90 Days\n';
        output += '  Sections:        8\n';
        output += '  Records Covered: 847\n';
        output += '  Overall Score:   92.4%\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += 'SECTION SCORES:\n';
        output += '  Supply Chain Integrity:    96%  \u2713\n';
        output += '  Maintenance Records:       94%  \u2713\n';
        output += '  CMMC L2 Compliance:        89%  \u25b2\n';
        output += '  NIST 800-171 Controls:     91%  \u2713\n';
        output += '  Chain of Custody:          95%  \u2713\n';
        output += '  Contract Deliverables:     88%  \u25b2\n';
        output += '  Configuration Management:  93%  \u2713\n';
        output += '  DMSMS Compliance:          90%  \u2713\n\n';
        output += '  Report Hash: a3f7b9c1e4d8...  \u2713 Anchored to XRPL\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += '\u2713 6 report types available (Full, Supply Chain, Maintenance,\n';
        output += '  Compliance, Chain of Custody, Contract Deliverables)\n';
        output += '\u2713 One-click generation in Demo App > ILS Workspace';
        return output;
    }

    async function runContracts() {
        var output = '>>> ledger.manage_contracts(contract="N00024-22-C-5312")\n\nPOST /api/contracts  \u2192  200 OK\n\n';
        output += '\u2550'.repeat(55) + '\n';
        output += '  CONTRACT LIFECYCLE \u2014 N00024-22-C-5312\n';
        output += '\u2550'.repeat(55) + '\n\n';
        output += '  Contract:     N00024-22-C-5312 (NAVSEA)\n';
        output += '  Program:      DDG-51 Flight III\n';
        output += '  Total CDRLs:  18\n';
        output += '  On Track:     12\n';
        output += '  At Risk:      4\n';
        output += '  Overdue:      2\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += 'KEY CDRLs:\n';
        output += '  DI-ILSS-81495  ILS Plan              On Track   2025-06-15\n';
        output += '  DI-SESS-81517  Failure Summary        On Track   2025-07-01\n';
        output += '  DI-ALSS-81529  Provisioning Parts     At Risk    2025-05-30\n';
        output += '  DI-MGMT-81466  Technical Data Package Overdue    2025-03-01\n\n';
        output += 'MODIFICATIONS:\n';
        output += '  Mod 04 (Class I)  \u2014 SPY-6 radar upgrade  \u2713 Approved\n';
        output += '  Mod 05 (Class II) \u2014 HVAC redesign        Pending\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += '\u2713 25 real DoD contract formats in database\n';
        output += '\u2713 CDRL tracking with DI number references\n';
        output += '\u2713 Full lifecycle tracking in Demo App > ILS Workspace';
        return output;
    }

    async function runDigitalThread() {
        var output = '>>> ledger.get_digital_thread(platform="DDG-51 Flight III")\n\nPOST /api/digital-thread  \u2192  200 OK\n\n';
        output += '\u2550'.repeat(55) + '\n';
        output += '  DIGITAL THREAD \u2014 DDG-51 Flight III\n';
        output += '\u2550'.repeat(55) + '\n\n';
        output += '  View:                Engineering Changes\n';
        output += '  Active ECPs:         14\n';
        output += '  Pending Approval:    5\n';
        output += '  Implemented:         42\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += 'RECENT ENGINEERING CHANGES:\n';
        output += '  ECP-2025-031 [Class I]  SPY-6 software v4.2 update\n';
        output += '    Status: Under Review | Impact: High\n';
        output += '    Affected Configs: ABL, Product Baseline\n\n';
        output += '  ECP-2025-028 [Class II] HVAC filter redesign\n';
        output += '    Status: Approved | Impact: Low\n';
        output += '    Affected Configs: Product Baseline\n\n';
        output += '  ECP-2025-025 [Class I]  Hull coating material change\n';
        output += '    Status: Implemented | Impact: Medium\n';
        output += '    Affected Configs: FBL, ABL, Product Baseline\n\n';
        output += 'CONFIG VIEWS AVAILABLE:\n';
        output += '  1. Engineering Changes (ECP Class I/II)\n';
        output += '  2. BOM Revisions (multi-level)\n';
        output += '  3. Configuration Baselines (FBL/ABL/Product)\n';
        output += '  4. TDP Versions\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += '\u2713 32 platform configurations with variant designators\n';
        output += '\u2713 Full config management in Demo App > ILS Workspace';
        return output;
    }

    async function runPredictiveMaintenance() {
        var output = '>>> ledger.predict_maintenance(platform="F-35A", fleet_size=450)\n\nPOST /api/predictive-maintenance  \u2192  200 OK\n\n';
        output += '\u2550'.repeat(55) + '\n';
        output += '  PREDICTIVE MAINTENANCE AI \u2014 F-35A Lightning II\n';
        output += '\u2550'.repeat(55) + '\n\n';
        output += '  Platform:       F-35A Lightning II\n';
        output += '  Fleet Size:     450 aircraft\n';
        output += '  Systems Analyzed: 12\n';
        output += '  Predictions:    8 high-confidence\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += 'HIGH-CONFIDENCE PREDICTIONS:\n\n';
        output += '  F135-PW-100 Engine \u2014 Turbine blade fatigue\n';
        output += '    Confidence: 94% | Window: 60\u201390 days\n';
        output += '    MTBF Trend: Declining (-12% over 6 months)\n';
        output += '    Cost if Unplanned: $2,450K\n';
        output += '    Recommendation: Schedule depot maintenance\n\n';
        output += '  AN/APG-81 AESA Radar \u2014 Power supply degradation\n';
        output += '    Confidence: 87% | Window: 90\u2013120 days\n';
        output += '    MTBF Trend: Stable\n';
        output += '    Cost if Unplanned: $890K\n';
        output += '    Recommendation: Order replacement LRU\n\n';
        output += '  EOTS Sensor \u2014 IR detector crystal degradation\n';
        output += '    Confidence: 82% | Window: 120\u2013180 days\n';
        output += '    MTBF Trend: Declining (-8%)\n';
        output += '    Cost if Unplanned: $1,200K\n';
        output += '    Recommendation: Preposition spares at FRC-East\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += '\u2713 40+ platforms with real fleet sizes\n';
        output += '\u2713 ML-powered failure mode clustering\n';
        output += '\u2713 Full analysis in Demo App > ILS Workspace';
        return output;
    }

    async function runILIE() {
        var output = '>>> ledger.analyze_submission(program="DDG-51", doc_type="VRS")\n\nPOST /api/ilie  \u2192  200 OK\n\n';
        output += '\u2550'.repeat(55) + '\n';
        output += '  ILIE \u2014 SUBMISSION REVIEW & DISCREPANCY ENGINE\n';
        output += '\u2550'.repeat(55) + '\n\n';
        output += '  Program:       DDG-51 \u2014 Arleigh Burke Class Destroyer\n';
        output += '  Branch:        USN\n';
        output += '  Document:      Vendor Recommended Spares List (VRS)\n';
        output += '  Current items: 30 | Baseline items: 33\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += '  DISCREPANCY REPORT:\n\n';
        output += '  \u26D4 Critical: 4\n';
        output += '  \u26A0 Warning: 6\n';
        output += '  \u2139 Info: 4\n\n';
        output += '  Cost delta: +$287,450\n\n';
        output += '  Recommendation: Review critical findings\n';
        output += '    with program office before acceptance.\n\n';
        var fakeHash = await computeHash('ILIE Analysis DDG-51 VRS ' + Date.now());
        output += '\u2500'.repeat(55) + '\n';
        output += '  Hash: ' + fakeHash.substring(0,32) + '...\n';
        output += '  \u2713 Anchored to XRPL Mainnet\n';
        output += '  \u2713 Full ILIE in Demo App > ILS Workspace';
        return output;
    }

    async function runDbImport() {
        var output = '>>> ledger.import_defense_data(source="NSERC", format="csv")\n\nPOST /api/db-import  \u2192  200 OK\n\n';
        output += '\u2550'.repeat(55) + '\n';
        output += '  DEFENSE DATABASE IMPORT \u2014 24+ SYSTEMS\n';
        output += '\u2550'.repeat(55) + '\n\n';
        output += '  Source System:  NSERC\n';
        output += '  Records Found:  47\n';
        output += '  Hashed:         47\n';
        output += '  Anchored:       47\n';
        output += '  Types Detected: [USN_CONFIG, USN_TDP, USN_CDRL]\n\n';
        var fakeHash = await computeHash('DB Import NSERC ' + Date.now());
        output += '\u2500'.repeat(55) + '\n';
        output += '  Hash: ' + fakeHash.substring(0,32) + '...\n';
        output += '  \u2713 All records anchored to XRPL \n';
        output += '  \u2713 Supports: NSERC, DPAS, FLIS, FEDLOG, HAYSTACK,\n';
        output += '    PIIN, NIIN, CAGE, FSC, SL-3, COSAL, APL/AEL,\n';
        output += '    OMMS-NG, 3M/MDS, OARS, NALDA, DECKPLATE, iRAPT,\n';
        output += '    PIEE, WAWF, DLA BSM, GCSS-MC, GCSS-Army, LMP';
        return output;
    }

    async function runCompliance() {
        var output = '>>> ledger.calculate_compliance(program="CVN-78")\n\nPOST /api/compliance  \u2192  200 OK\n\n';
        output += '\u2550'.repeat(55) + '\n';
        output += '  COMPLIANCE SCORECARD\n';
        output += '\u2550'.repeat(55) + '\n\n';
        output += '  Program:       CVN-78 Gerald R. Ford\n';
        output += '  Overall Score: 87%\n';
        output += '  Standards Met: 14/16\n\n';
        output += '  Gaps:\n';
        output += '    MIL-STD-1388-2B \u2014 LSAR data incomplete\n';
        output += '    MIL-HDBK-502  \u2014  Missing RCM section\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += '  \u2713 Scorecard anchored to XRPL';
        return output;
    }

    async function runCalendar() {
        var output = '>>> ledger.get_calendar_events(program="F-35A", range=90)\n\nGET /api/calendar  \u2192  200 OK\n\n';
        output += '\u2550'.repeat(55) + '\n';
        output += '  ILS CALENDAR \u2014 MILESTONES & DEADLINES\n';
        output += '\u2550'.repeat(55) + '\n\n';
        output += '  2026-02-28 \u2014 CDRL A003 PPL Due (CDRL)\n';
        output += '  2026-03-15 \u2014 ILSP Final Submission (Milestone)\n';
        output += '  2026-04-01 \u2014 Quarterly ILS Review (Meeting)\n';
        output += '  2026-04-15 \u2014 SERD Data Due (CDRL)\n';
        output += '  2026-05-01 \u2014 Mid-Year Readiness Assessment (Review)\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += '  \u2713 5 events in next 90 days\n';
        output += '  \u2713 Full calendar in Demo App > ILS Workspace';
        return output;
    }

    async function runPartsXref() {
        var output = '>>> ledger.cross_reference_parts(nsn="5998-01-422-7891")\n\nPOST /api/parts-xref  \u2192  200 OK\n\n';
        output += '\u2550'.repeat(55) + '\n';
        output += '  PARTS CROSS-REFERENCE\n';
        output += '\u2550'.repeat(55) + '\n\n';
        output += '  NSN:           5998-01-422-7891\n';
        output += '  Part Number:   6872843-1\n';
        output += '  CAGE:          53711\n';
        output += '  Nomenclature:  Circuit Card Assy, Radar Interface\n\n';
        output += '  Sources Found: 3\n';
        output += '    FLIS:      $12,450.00 \u2014 Available\n';
        output += '    DLA:       $11,890.00 \u2014 30-day lead time\n';
        output += '    HAYSTACK:  $12,100.00 \u2014 In stock\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += '  \u2713 Cross-reference complete\n';
        output += '  \u2713 Full parts tool in Demo App > ILS Workspace';
        return output;
    }

    async function runDocLibrary() {
        var output = '>>> ledger.search_documents(query="logistics support")\n\nGET /api/doc-library  \u2192  200 OK\n\n';
        output += '\u2550'.repeat(55) + '\n';
        output += '  DEFENSE STANDARDS DOCUMENT LIBRARY\n';
        output += '\u2550'.repeat(55) + '\n\n';
        output += '  MIL-STD-1388-2B \u2014 DoD Requirements for LSAR (Active)\n';
        output += '  MIL-HDBK-502   \u2014 Acquisition Logistics (Active)\n';
        output += '  DoDI 5000.02   \u2014 ACAT Defense Acquisition (Active)\n';
        output += '  MIL-STD-1390D  \u2014 Level of Repair Analysis (Active)\n';
        output += '  MIL-STD-1369   \u2014 ILS Managers Guide (Active)\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += '  \u2713 5 documents found\n';
        output += '  \u2713 Full library in Demo App > ILS Workspace';
        return output;
    }

    async function runAuditVault() {
        var output = '>>> ledger.store_in_vault(type="USN_CDRL", encrypt=True)\n\nPOST /api/audit-vault  \u2192  200 OK\n\n';
        output += '\u2550'.repeat(55) + '\n';
        output += '  ENCRYPTED AUDIT VAULT\n';
        output += '\u2550'.repeat(55) + '\n\n';
        var fakeHash = await computeHash('Audit Vault Entry ' + Date.now());
        output += '  Vault ID:    VLT-' + Date.now().toString(36).toUpperCase() + '\n';
        output += '  Hash:        ' + fakeHash.substring(0,32) + '...\n';
        output += '  Encrypted:   true (AES-256-GCM)\n';
        output += '  XRPL TX:     TX' + Date.now().toString(16).toUpperCase() + '\n';
        output += '  Classification: CUI\n\n';
        output += '\u2500'.repeat(55) + '\n';
        output += '  \u2713 Record stored and anchored\n';
        output += '  \u2713 Full vault in Demo App > ILS Workspace';
        return output;
    }

    function loadExample(key, el) {
        currentExample = key;
        document.getElementById('codeEditor').value = buildEditorContent();
        document.getElementById('outputPanel').textContent = 'Click "Run" to execute the code above...';
        document.getElementById('statusDot').className = 'status-dot';
        document.querySelectorAll('.sdk-func-box').forEach(function(b){b.classList.remove('active')});
        if (el) el.classList.add('active');
    }

    // Load example and immediately run it (called from function boxes)
    function loadAndRun(key, el) {
        loadExample(key, el);
        // Scroll to code editor
        document.getElementById('codeEditor').scrollIntoView({ behavior: 'smooth', block: 'center' });
        // Small delay to let scroll settle, then run
        setTimeout(function() { runCode(); }, 300);
    }

    function copyOutput() {
        var output = document.getElementById('outputPanel');
        navigator.clipboard.writeText(output.textContent).then(function() {
            var btn = document.getElementById('copyOutputBtn');
            btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
            setTimeout(function() { btn.innerHTML = '<i class="fas fa-copy"></i> Copy'; }, 2000);
        });
    }

    async function runCode() {
        var btn = document.getElementById('runBtn');
        var output = document.getElementById('outputPanel');
        var dot = document.getElementById('statusDot');
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Running...';
        output.textContent = '>>> Connecting to /api...\n';
        dot.className = 'status-dot';
        try {
            var runner = RUNNERS[currentExample];
            if (!runner) throw new Error('Unknown command: ' + currentExample);
            var result = await runner();
            output.textContent = result;
            dot.className = 'status-dot';
        } catch(err) {
            hideAnchorAnimation();
            output.textContent = '\u274c API Error: ' + (err.message || err) + '\n\nCheck the browser console for details.';
            dot.className = 'status-dot error';
            console.error('SDK Playground error:', err);
        }
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-play"></i> Run';
    }

    document.addEventListener('DOMContentLoaded', function() {
        loadRecordTypes().then(function() {
            document.getElementById('codeEditor').value = buildEditorContent();
            var sel = document.getElementById('recordTypeSelect');
            if (sel && sel.value && sel.value !== 'CUSTOM') showSdkClassification(sel.value);
        });
        // Populate platform dropdown from platforms.js
        if (window.S4_buildProgramOptions) {
            var platEl = document.getElementById('sdkPlatformSelect');
            if (platEl) platEl.innerHTML = '<option value="">— Select a platform (optional) —</option>' + S4_buildProgramOptions(false, true);
        }
        // Default: select Hash box
        var defaultBox = document.querySelector('.sdk-func-box[data-func="hash"]');
        if (defaultBox) defaultBox.classList.add('active');
    });
    </script>
<script src="../s4-assets/platforms.js"></script>
<script src="../s4-assets/s4-background.js"></script>
<link rel="stylesheet" href="/s4-assets/s4-mobile.css">
<script src="/s4-assets/s4-auth.js"></script>
<script src="/s4-assets/s4-data.js"></script>
</body>
</html>