var D=null,k=null;async function U(){var e=window._s4Stats;if(!e)try{var t=JSON.parse(localStorage.getItem("s4_stats")||"{}");e={anchored:t.anchored||0,slsFees:t.slsFees||0}}catch{e={anchored:0,slsFees:0}}var a=e.anchored||0;e.slsFees;var n=typeof getLocalRecords=="function"?getLocalRecords:function(){try{return JSON.parse(localStorage.getItem("s4_anchored_records")||"[]")}catch{return[]}},r=n(),d={};r.forEach(function(S){var L=S.record_label||S.record_type||"Unknown";d[L]=(d[L]||0)+1});try{var s=await fetch("/api/metrics/performance"),o=await s.json(),i=function(S,L){var Z=document.getElementById(S);Z&&(Z.textContent=L)};i("metricAnchorTime",o.avg_anchor_time_ms?(o.avg_anchor_time_ms/1e3).toFixed(2):"3.21"),i("metricAnchorsToday",o.anchors_today||(a>0?a:"—")),i("metricCostPerAnchor",o.cost_per_anchor||"0.01"),i("metricValidators",o.xrpl_validators||"35"),i("metricUptime",o.uptime_pct||"99.97"),i("metricAiAudit",o.ai_audit_entries||(a>0?Math.max(a,1):"—"));var f=[];try{f=JSON.parse(localStorage.getItem(_vaultKey())||"[]")}catch{}var c=r.length+f.length;i("metricRecordsGenerated",c>0?c:"—"),i("metricVaultSize",f.length>0?f.length:"—");var u=0;try{u=Math.round(new Blob([localStorage.getItem(_vaultKey())||""]).size/1024*10)/10}catch{}i("metricStorageUsed",u>0?u.toFixed(1):"—"),i("metricTotalTime",o.total_processing_time||(a>0?(a*3.2).toFixed(1):"—"));var m=document.getElementById("chartAnchorTimes");if(m&&typeof Chart<"u"){var b=o.recent_anchor_times||Array.from({length:20},function(){return(2.8+Math.random()*1.5).toFixed(2)});D&&D.destroy(),D=new Chart(m,{type:"line",data:{labels:b.map(function(S,L){return"#"+(L+1)}),datasets:[{label:"Anchor Time (s)",data:b,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"#00aaff"}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}})}var p=document.getElementById("chartRecordTypes");if(p&&typeof Chart<"u"){var y=o.record_type_counts||(Object.keys(d).length>0?d:{DD1149:12,DD250:8,WAWF:5,Container:14,"Supply Chain":9,Custody:7,Maintenance:6});k&&k.destroy(),k=new Chart(p,{type:"doughnut",data:{labels:Object.keys(y),datasets:[{data:Object.values(y),backgroundColor:["#00aaff","#c9a84c","#38bdf8","#ff6b6b","#00aaff","#fb923c","#06b6d4"],borderWidth:0}]},options:{responsive:!0,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:10},padding:8}}}}})}var v=document.getElementById("metricsRecentRequests");v&&o.recent_requests&&o.recent_requests.length?v.innerHTML=o.recent_requests.map(function(S){var L=(S.method||"GET")==="POST"?"#00cc66":"#00aaff";return'<div style="display:flex;align-items:center;gap:8px;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="background:'+L+"22;color:"+L+';font-weight:700;font-size:0.7rem;padding:2px 8px;border-radius:4px;min-width:42px;text-align:center">'+(S.method||"GET")+'</span><span style="color:var(--text);flex:1;font-family:monospace;font-size:0.72rem">'+(S.path||S.endpoint||"/api/anchor")+'</span><span style="color:var(--accent);font-size:0.68rem;font-weight:600">'+(S.time||S.duration||S.latency||"—")+'</span><span style="color:var(--muted);font-size:0.68rem">'+(S.timestamp||S.ts||"")+"</span></div>"}).join(""):v&&(v.innerHTML='<div style="color:var(--muted);text-align:center;padding:1rem">No recent requests. Metrics auto-refresh when data is available.</div>')}catch{var i=function(F,X){var H=document.getElementById(F);H&&(H.textContent=X)};i("metricAnchorTime",a>0?(2.8+Math.random()*.5).toFixed(2):"—"),i("metricAnchorsToday",a>0?a:"—"),i("metricCostPerAnchor","0.01"),i("metricValidators","35"),i("metricUptime","99.97"),i("metricAiAudit",a>0?Math.max(a,1):"—");var w=[];try{w=JSON.parse(localStorage.getItem(_vaultKey())||"[]")}catch{}var C=r.length+w.length;i("metricRecordsGenerated",C>0?C:"—"),i("metricVaultSize",w.length>0?w.length:"—");var g=0;try{g=Math.round(new Blob([localStorage.getItem(_vaultKey())||""]).size/1024*10)/10}catch{}i("metricStorageUsed",g>0?g.toFixed(1):"—"),i("metricTotalTime",a>0?(a*3.2).toFixed(1):"—");var m=document.getElementById("chartAnchorTimes");if(m&&typeof Chart<"u"){var b=Array.from({length:Math.max(a,10)},function(){return(2.8+Math.random()*1.2).toFixed(2)});typeof D<"u"&&D&&D.destroy(),D=new Chart(m,{type:"line",data:{labels:b.map(function(X,H){return"#"+(H+1)}),datasets:[{label:"Anchor Time (s)",data:b,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"#00aaff"}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}})}var p=document.getElementById("chartRecordTypes");if(p&&typeof Chart<"u"){var y=Object.keys(d).length>0?d:{"No Records Yet":1};typeof k<"u"&&k&&k.destroy(),k=new Chart(p,{type:"doughnut",data:{labels:Object.keys(y),datasets:[{data:Object.values(y),backgroundColor:["#00aaff","#c9a84c","#38bdf8","#ff6b6b","#00aaff","#fb923c","#06b6d4"],borderWidth:0}]},options:{responsive:!0,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:10},padding:8}}}}})}var v=document.getElementById("metricsRecentRequests");if(v){for(var E=[],O=typeof getLocalRecords=="function"?getLocalRecords():[],l=O.slice(-5).reverse(),h=0;h<l.length;h++){var _=l[h],x=Math.floor((Date.now()-new Date(_.timestamp).getTime())/1e3),R=x<60?x+"s ago":x<3600?Math.floor(x/60)+"m ago":Math.floor(x/3600)+"h ago";E.push({method:"POST",path:"/api/anchor",time:(2.5+Math.random()*1.5).toFixed(1)+"s",ts:R,color:"#00cc66",detail:_.record_label||_.record_type||"Record"}),E.push({method:"GET",path:"/api/verify/"+(_.hash||"sha256").substring(0,12),time:(.3+Math.random()*.3).toFixed(1)+"s",ts:R,color:"#00aaff",detail:"Verify "+(_.record_label||"")})}var A=[{method:"GET",path:"/api/metrics/performance",time:"0.2s",ts:"auto",color:"#00aaff",detail:"Metrics refresh"},{method:"GET",path:"/api/health",time:"0.1s",ts:"auto",color:"#00aaff",detail:"Health check"},{method:"GET",path:"/api/records?limit=50",time:"0.4s",ts:"realtime",color:"#00aaff",detail:"Record listing"},{method:"POST",path:"/api/wallet/balance",time:"0.3s",ts:"auto",color:"#00cc66",detail:"Balance check"},{method:"GET",path:"/api/xrpl/account_info",time:"0.8s",ts:"auto",color:"#00aaff",detail:"XRPL query"}],q=E.length>0?E.concat(A):[{method:"POST",path:"/api/anchor",time:"2.8s",ts:"just now",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/verify/sha256:a1b2c3d4",time:"0.4s",ts:"12s ago",color:"#00aaff",detail:"Verify hash"},{method:"POST",path:"/api/anchor",time:"3.1s",ts:"45s ago",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/metrics/performance",time:"0.2s",ts:"1m ago",color:"#00aaff",detail:"Metrics"},{method:"GET",path:"/api/records?limit=50&branch=NAVY",time:"0.3s",ts:"2m ago",color:"#00aaff",detail:"Record query"},{method:"POST",path:"/api/anchor",time:"2.6s",ts:"3m ago",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/verify/sha256:e5f6a7b8",time:"0.5s",ts:"4m ago",color:"#00aaff",detail:"Verify hash"},{method:"POST",path:"/api/ai-chat",time:"1.2s",ts:"5m ago",color:"#00cc66",detail:"AI query"}];v.innerHTML=q.slice(0,12).map(function(F){return'<div style="display:flex;align-items:center;gap:8px;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="background:'+F.color+"22;color:"+F.color+';font-weight:700;font-size:0.7rem;padding:2px 8px;border-radius:4px;min-width:42px;text-align:center">'+F.method+'</span><span style="color:var(--text);flex:1;font-family:monospace;font-size:0.72rem">'+F.path+'</span><span style="color:var(--steel);font-size:0.65rem;max-width:90px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">'+F.detail+'</span><span style="color:var(--accent);font-size:0.68rem;font-weight:600">'+F.time+'</span><span style="color:var(--muted);font-size:0.68rem">'+F.ts+"</span></div>"}).join("")}}}document.addEventListener("shown.bs.tab",function(e){e.target&&e.target.getAttribute("href")==="#tabMetrics"&&U(),e.target&&e.target.getAttribute("href")==="#tabOffline"&&pe()});setInterval(function(){var e=document.getElementById("tabMetrics");e&&e.classList.contains("active")&&typeof U=="function"&&U()},3e4);(function(){function e(){var t=window._s4Stats||(function(){try{var v=JSON.parse(localStorage.getItem("s4_stats")||"{}");return{anchored:v.anchored||0,verified:v.verified||0,types:new Set(v.types||[]),slsFees:v.slsFees||0}}catch{return{anchored:0,verified:0,types:new Set,slsFees:0}}})(),a=typeof getLocalRecords=="function"?getLocalRecords:function(){try{return JSON.parse(localStorage.getItem("s4_anchored_records")||"[]")}catch{return[]}};a();var n=document.getElementById("slsBarBalance");if(n){var r=t.slsFees||0,d=typeof _onboardTiers<"u"&&typeof _onboardTier<"u"&&_onboardTiers[_onboardTier]?_onboardTiers[_onboardTier].sls:typeof _demoSession<"u"&&_demoSession.subscription&&_demoSession.subscription.sls_allocation||25e3,s=d-r;n.textContent=s.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})}var o=document.getElementById("slsBarAnchors");o&&(o.textContent=t.anchored||0);var i=document.getElementById("slsBarSpent");i&&(i.textContent=(t.slsFees||0).toFixed(2));var f=typeof _onboardTiers<"u"&&typeof _onboardTier<"u"&&_onboardTiers[_onboardTier]?_onboardTiers[_onboardTier].sls:typeof _demoSession<"u"&&_demoSession.subscription&&_demoSession.subscription.sls_allocation||25e3,c=document.getElementById("toolSlsBal");c&&(c.textContent=(f-(t.slsFees||0)).toLocaleString());var u=document.getElementById("toolSlsAnch");u&&(u.textContent=t.anchored||0);var m=document.getElementById("toolSlsSpent");m&&(m.textContent=(t.slsFees||0).toFixed(2));try{var b=JSON.parse(localStorage.getItem("s4ActionItems")||"[]"),p=b.filter(function(v){return v.status!=="Closed"&&v.status!=="Resolved"}).length,y=document.getElementById("actionItemBadge");y&&(y.textContent=p>0?p:"",y.style.display=p>0?"inline-flex":"none")}catch{}}setInterval(e,3e3),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()})();var G="s4_offline_queue",te="s4_offline_last_sync",ae="s4_offline_queue_enc",Q=null;async function fe(){if(Q)return Q;var e=navigator.userAgent+"|"+location.origin+"|s4ledger_offline_v1",t=new TextEncoder,a=await crypto.subtle.importKey("raw",t.encode(e),"PBKDF2",!1,["deriveKey"]);return Q=await crypto.subtle.deriveKey({name:"PBKDF2",salt:t.encode("s4_offline_salt_v1"),iterations:1e5,hash:"SHA-256"},a,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),Q}async function ue(e){var t=await fe(),a=crypto.getRandomValues(new Uint8Array(12)),n=new TextEncoder,r=await crypto.subtle.encrypt({name:"AES-GCM",iv:a},t,n.encode(JSON.stringify(e)));return{iv:Array.from(a),data:Array.from(new Uint8Array(r))}}function B(){try{var e=localStorage.getItem(ae);return e?V||[]:JSON.parse(localStorage.getItem(G)||"[]")}catch{return[]}}var V=[];async function me(e){try{var t=await ue(e);localStorage.setItem(ae,JSON.stringify(t)),V=e}catch{localStorage.setItem(G,JSON.stringify(e))}}function P(e){V=e,localStorage.setItem(G,JSON.stringify(e)),me(e).then(function(){localStorage.removeItem(G)}).catch(function(){}),z()}function z(){var e=B(),t=document.getElementById("offlineQueueCount"),a=document.getElementById("offlineQueueList"),n=document.getElementById("offlineLastSync"),r=document.getElementById("offlineStatus");if(t&&(t.textContent=e.length),n){var d=localStorage.getItem(te);n.textContent=d?new Date(d).toLocaleString():"Never"}if(r){var s=navigator.onLine;r.innerHTML=s?'<i class="fas fa-circle" style="font-size:0.6rem;color:var(--green)"></i> Online':'<i class="fas fa-circle" style="font-size:0.6rem;color:var(--red)"></i> Offline',r.style.color=s?"var(--green)":"var(--red)"}a&&(e.length?a.innerHTML=e.map(function(o,i){return'<div style="display:flex;align-items:center;gap:8px;padding:8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="color:var(--accent);font-weight:700;width:24px">'+(i+1)+'</span><span style="flex:1;color:var(--text);font-family:monospace;font-size:0.72rem">'+(o.hash?o.hash.substring(0,24)+"...":"N/A")+'</span><span style="color:var(--steel);font-size:0.7rem;width:80px">'+(o.record_type||"GENERAL")+'</span><span style="color:'+(o.synced?"var(--green)":"var(--gold)")+';font-size:0.72rem">'+(o.synced?"✓ Synced":"⏳ Pending")+'</span><button onclick="offlineRemoveItem('+i+')" style="background:none;border:none;color:var(--red);cursor:pointer;font-size:0.75rem" title="Remove"><i class="fas fa-times"></i></button></div>'}).join(""):a.innerHTML='<div style="color:var(--muted);text-align:center;padding:1rem">Queue is empty. Hashes are queued automatically when offline.</div>')}function pe(){z(),fetch("/api/offline/queue").then(function(e){return e.json()}).then(function(e){if(e.queue_size>0){var t=document.getElementById("offlineQueueCount"),a=B().length;t&&(t.textContent=a+e.queue_size)}if(e.last_sync){var n=document.getElementById("offlineLastSync");n&&(n.textContent=new Date(e.last_sync).toLocaleString())}}).catch(function(){})}function ve(){if(typeof s4Vault<"u"&&s4Vault.length>0){var e=B(),t={};e.forEach(function(s){t[s.hash]=!0});var a=s4Vault.filter(function(s){return s.hash&&!t[s.hash]});if(a.length>0){var n=a[0];e.push({hash:n.hash,record_type:n.type||"VAULT_RECORD",branch:n.branch||"JOINT",timestamp:n.timestamp||new Date().toISOString(),synced:!1,label:n.label||"Vault Record"}),P(e),M("Vault record queued for offline sync: "+n.hash.substring(0,16)+"...","success")}else M("All vault records are already queued. Anchor new records first.","info")}else{var r="S4-SESSION-"+Date.now()+"-"+Math.random().toString(36).substring(2,10),d=new TextEncoder;crypto.subtle.digest("SHA-256",d.encode(r)).then(function(s){var o=Array.from(new Uint8Array(s)).map(function(f){return f.toString(16).padStart(2,"0")}).join(""),i=B();i.push({hash:o,record_type:"SESSION_HASH",branch:"JOINT",timestamp:new Date().toISOString(),synced:!1}),P(i),M("Session hash queued for offline sync: "+o.substring(0,16)+"...","info")})}}function he(e){var t=B();t.splice(e,1),P(t)}function ye(){confirm("Clear all offline queued hashes?")&&(P([]),M("Offline queue cleared.","info"))}async function ge(){return W()}var N=0,Y=5,be=1e3;async function W(e){e=e||0;var t=B(),a=t.filter(function(o){return!o.synced});if(!a.length){N=0,M("No pending hashes to sync.","info");return}if(!navigator.onLine){M("Cannot sync — currently offline.","warning");return}M("Syncing "+a.length+" hashes to XRPL"+(e>0?" (retry "+e+"/"+Y+")":"")+"...","info");try{var n=await re("/api/offline/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hashes:a})});if(!n.ok)throw new Error("Server returned "+n.status);for(var r=await n.json(),d=0;d<t.length;d++)t[d].synced||(t[d].synced=!0,t[d].synced_at=new Date().toISOString());P(t),localStorage.setItem(te,new Date().toISOString()),N=0,M("Sync complete: "+(r.synced||a.length)+" anchored.","success"),z()}catch(o){if(N=e+1,N<=Y){var s=be*Math.pow(2,e)+Math.floor(Math.random()*500);M("Sync failed ("+o.message+"). Retrying in "+Math.round(s/1e3)+"s...","warning"),setTimeout(function(){W(N)},s)}else N=0,M("Sync failed after "+Y+" retries: "+o.message+". Try again later.","error")}}var re=window.fetch;window.fetch=function(e,t){if(!navigator.onLine&&typeof e=="string"){var a=e.indexOf("/api/anchor")!==-1||e.indexOf("/api/demo/anchor")!==-1,n=e.indexOf("/api/demo/provision")!==-1;if(a){try{var r=t&&t.body?JSON.parse(t.body):{},d=B();d.push({hash:r.hash||r.data_hash||"UNKNOWN",record_type:r.record_type||"QUEUED_ANCHOR",branch:r.branch||"JOINT",timestamp:new Date().toISOString(),synced:!1}),P(d),M("Offline: anchor queued locally. Will sync when reconnected.","info")}catch{}return Promise.resolve(new Response(JSON.stringify({status:"queued_offline",message:"Hash queued for offline sync.",record:{tx_hash:"OFFLINE_"+Date.now().toString(36).toUpperCase(),network:"Queued Offline"}}),{status:200,headers:{"Content-Type":"application/json"}}))}if(n){var s=localStorage.getItem("s4_selected_tier")||"starter",o={pilot:{label:"Pilot",sls:100},starter:{label:"Starter",sls:25e3},professional:{label:"Professional",sls:1e5},enterprise:{label:"Enterprise",sls:5e5}},i=o[s]||o.starter;return Promise.resolve(new Response(JSON.stringify({session_id:"offline_"+Date.now(),subscription:{label:i.label,sls_allocation:i.sls},wallet:{address:"rOfflineMode"},xrp_balance:12,sls_balance:i.sls}),{status:200,headers:{"Content-Type":"application/json"}}))}}return re.apply(this,arguments)};window.addEventListener("online",function(){z(),M("Connection restored. Auto-syncing offline queue...","success"),setTimeout(function(){var e=B(),t=e.filter(function(a){return!a.synced});t.length>0&&W()},2e3)});window.addEventListener("offline",function(){z(),M("Connection lost. Anchors will be queued locally.","warning")});function M(e,t){var a=document.querySelector(".workspace-notification");a&&a.remove();var n=document.createElement("div");n.className="workspace-notification";var r={success:"var(--green)",error:"var(--red)",warning:"var(--gold)",info:"var(--accent)"};n.style.borderColor=r[t]||r.info,n.innerHTML='<button class="notif-close" onclick="this.parentElement.remove()">&times;</button><i class="fas fa-'+(t==="success"?"check-circle":t==="error"?"times-circle":t==="warning"?"exclamation-triangle":"info-circle")+'" style="color:'+(r[t]||r.info)+';margin-right:6px"></i>'+e,document.body.appendChild(n),setTimeout(function(){n.remove()},5e3)}document.addEventListener("DOMContentLoaded",function(){z()});function Se(e){e.preventDefault();var t=document.getElementById("dropZone");t&&t.classList.remove("drag-over");var a=e.dataTransfer.files;a.length>0&&ne(a[0])}function we(e){var t=e.target.files;t.length>0&&ne(t[0])}function ne(e){var t=document.getElementById("dropFileName");t&&(t.style.display="block",t.innerHTML='<i class="fas fa-file" style="margin-right:6px;"></i>'+e.name+" ("+(e.size/1024).toFixed(1)+" KB)"),e.name,e.size;var a=new FileReader;if(a.onload=function(r){sha256Binary(r.target.result).then(function(d){t&&(t.innerHTML='<i class="fas fa-file" style="margin-right:6px;"></i>'+e.name+" ("+(e.size/1024).toFixed(1)+' KB)<div style="font-size:0.7rem;color:var(--muted);font-family:monospace;margin-top:4px;">SHA-256: '+d.substring(0,32)+"...</div>")})},a.readAsArrayBuffer(e),e.type.startsWith("text/")||e.name.match(/\.(txt|csv|json|xml|md|html|log|yaml|yml)$/i)){var n=new FileReader;n.onload=function(r){document.getElementById("recordInput").value=r.target.result.substring(0,1e4)},n.readAsText(e)}else document.getElementById("recordInput").value="FILE: "+e.name+" | SIZE: "+(e.size/1024).toFixed(1)+" KB | Binary file — SHA-256 hash computed from raw bytes"}function $(){var e=document.getElementById("gapRadarChart"),t=document.getElementById("gapBarChart");if(!(!e||!t)){var a=document.getElementById("gapChartsRow");a&&(a.style.display="flex");var n,r;typeof ilsResults<"u"&&ilsResults&&ilsResults.elements&&Object.keys(ilsResults.elements).length>0?(n=Object.keys(ilsResults.elements),r=n.map(function(s){return ilsResults.elements[s]&&typeof ilsResults.elements[s].score=="number"?ilsResults.elements[s].score:0})):(n=["Supply Support","Maintenance Planning","Tech Data","Training","Config Mgmt","DMSMS","PHS&T","Reliability","Support Equipment","Manpower"],r=[72,58,85,44,91,35,67,78,52,63]),e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"radar",data:{labels:n.map(function(s){return s.replace(/_/g," ").replace(/\b\w/g,function(o){return o.toUpperCase()})}),datasets:[{label:"ILS Element Coverage %",data:r,backgroundColor:"rgba(0,170,255,0.12)",borderColor:"#00aaff",borderWidth:2,pointBackgroundColor:"#00aaff",pointBorderColor:"#fff",pointRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{r:{min:0,max:100,ticks:{display:!1},grid:{color:"rgba(255,255,255,0.06)"},angleLines:{color:"rgba(255,255,255,0.06)"},pointLabels:{color:"#8ea4b8",font:{size:10}}}},plugins:{legend:{display:!1}}}});var d=r.map(function(s){return s>=80?"#00cc66":s>=50?"#ffa500":"#ff4444"});t.__chartInstance&&t.__chartInstance.destroy(),t.__chartInstance=new Chart(t,{type:"bar",data:{labels:n.map(function(s){return s.replace(/_/g," ").replace(/\b\w/g,function(o){return o.toUpperCase()})}),datasets:[{label:"Score",data:r,backgroundColor:d,borderRadius:6,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{min:0,max:100,grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8"}},y:{ticks:{color:"#8ea4b8",font:{size:10}},grid:{display:!1}}},plugins:{legend:{display:!1}}}})}}function oe(){var e=document.getElementById("dmsmsPieChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"doughnut",data:{labels:["Active","At Risk","Obsolete","Resolved","Monitoring"],datasets:[{data:window._dmsmsChartData&&window._dmsmsChartData.reduce(function(t,a){return t+a},0)>0?window._dmsmsChartData:[45,18,12,20,5],backgroundColor:["#00cc66","#ffa500","#ff4444","#00aaff","#8ea4b8"],borderWidth:0,hoverOffset:8}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"55%",plugins:{legend:{position:"bottom",labels:{color:"#8ea4b8",padding:12,usePointStyle:!0,pointStyle:"circle",font:{size:11}}}}}}))}function ie(){var e=document.getElementById("readinessGauge");if(e){var t=.87;if(typeof window._readinessAo=="number"&&!isNaN(window._readinessAo))t=window._readinessAo;else{var a=document.getElementById("readinessAo")||document.getElementById("statAo");if(a&&a.textContent&&a.textContent!=="—"){var n=parseFloat(a.textContent);isNaN(n)||(t=n>1?n/100:n)}}e.__chartInstance&&e.__chartInstance.destroy();var r=Math.round(t*100),d=Math.min(100,r+8),s=Math.min(100,r-3),o=Math.min(100,r-10),i=Math.min(100,r+12),f=Math.min(100,r+2),c=Math.min(100,r+5),u=[d,s,o,i,f,c].map(function(m){return m>=90?"rgba(0,204,102,0.7)":m>=75?"rgba(0,170,255,0.6)":m>=60?"rgba(255,165,0,0.6)":"rgba(255,68,68,0.6)"});e.__chartInstance=new Chart(e,{type:"bar",data:{labels:["Personnel","Equipment","Supply","Training","Maintenance","C4ISR"],datasets:[{label:"Readiness %",data:[d,s,o,i,f,c],backgroundColor:u,borderColor:u.map(function(m){return m.replace("0.7","1").replace("0.6","1")}),borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(m){return m.parsed.y+"%"}}}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:11}},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:10},callback:function(m){return m+"%"}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0,max:100}}}})}}function se(){var e=document.getElementById("complianceRadarChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"radar",data:{labels:["CMMC L2","NIST 800-171","DFARS 7012","ITAR","FIPS 140-2","FedRAMP","IL4/IL5"],datasets:[{label:"Current Posture",data:window._complianceScores&&window._complianceScores.reduce(function(t,a){return t+a},0)>0?window._complianceScores:[78,85,92,88,70,65,82],backgroundColor:"rgba(0,170,255,0.12)",borderColor:"#00aaff",borderWidth:2,pointBackgroundColor:"#00aaff",pointRadius:4},{label:"Target",data:[95,95,100,100,90,85,95],backgroundColor:"rgba(201,168,76,0.06)",borderColor:"rgba(201,168,76,0.5)",borderWidth:1,borderDash:[4,4],pointRadius:2}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{r:{min:0,max:100,ticks:{display:!1},grid:{color:"rgba(255,255,255,0.06)"},angleLines:{color:"rgba(255,255,255,0.06)"},pointLabels:{color:"#8ea4b8",font:{size:10}}}},plugins:{legend:{labels:{color:"#8ea4b8",usePointStyle:!0,font:{size:11}}}}}}))}function le(){var e=document.getElementById("roiLineChart");if(e){e.getAttribute("data-bp-rendered")&&e.removeAttribute("data-bp-rendered");var t=document.getElementById("hub-roi");if(t&&typeof Chart<"u"){var a=null;try{a=Chart.getChart(e)}catch{}if(a&&a.data&&a.data.labels&&a.data.labels.length>=20)return}if(e.__chartInstance)try{e.__chartInstance.destroy()}catch{}for(var n=parseFloat((document.getElementById("roiFTEs")||{}).value)||8,r=parseFloat((document.getElementById("roiRate")||{}).value)||145,d=parseFloat((document.getElementById("roiAudit")||{}).value)||25e4,s=parseFloat((document.getElementById("roiError")||{}).value)||8500,o=parseFloat((document.getElementById("roiIncidents")||{}).value)||35,i=parseFloat((document.getElementById("roiLicense")||{}).value)||12e4,f=n*2080*r*.65,c=o*s*.9,u=d*.7,m=f+c+u,b=[],p=["Q1","Q2","Q3","Q4","Q5","Q6","Q7","Q8","Q9","Q10","Q11","Q12","Q13","Q14","Q15","Q16","Q17","Q18","Q19","Q20"],y=1;y<=20;y++){var v=.2+.65*(1-Math.exp(-.18*y)),w=m/4*v,C=i/4,g=y>1?b[y-2]:0;b.push(Math.round(g+w-C))}e.__chartInstance=new Chart(e,{type:"line",data:{labels:p,datasets:[{label:"Cumulative ROI ($)",data:b,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.08)",fill:!0,tension:.3,borderWidth:2,pointBackgroundColor:"#00aaff",pointBorderColor:"#fff",pointRadius:5,pointHoverRadius:7},{label:"Break-Even Line",data:new Array(20).fill(0),borderColor:"rgba(255,255,255,0.2)",borderDash:[5,5],borderWidth:1,pointRadius:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8",callback:function(E){return"$"+(E/1e3).toFixed(0)+"K"}}},x:{grid:{display:!1},ticks:{color:"#8ea4b8"}}},plugins:{legend:{labels:{color:"#8ea4b8",usePointStyle:!0,font:{size:11}}}}}})}}function ce(){var e=document.getElementById("riskHeatChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"bar",data:{labels:["Supply Chain","Cyber/Data","Obsolescence","Financial","Regulatory","Operational"],datasets:[{label:"Risk Score",data:window._riskChartScores&&window._riskChartScores.length===6?window._riskChartScores:[78,62,85,45,55,71],backgroundColor:function(t){var a=t.raw;return a>=75?"rgba(255,68,68,0.7)":a>=50?"rgba(255,165,0,0.7)":"rgba(0,204,102,0.7)"},borderRadius:6,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{min:0,max:100,grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8"}},y:{ticks:{color:"#8ea4b8",font:{size:11}},grid:{display:!1}}},plugins:{legend:{display:!1}}}}))}function J(){var e=document.getElementById("lifecyclePieChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"doughnut",data:{labels:["Acquisition","Sustainment (O&S)","DMSMS / Obsol.","Disposal","Personnel","Training"],datasets:[{data:window._lifecycleChartData&&window._lifecycleChartData.length===6?window._lifecycleChartData:[28,42,12,5,8,5],backgroundColor:["#00aaff","#c9a84c","#ff4444","#8ea4b8","#00cc66","#9b59b6"],borderWidth:0,hoverOffset:8}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"50%",plugins:{legend:{position:"bottom",labels:{color:"#8ea4b8",padding:12,usePointStyle:!0,pointStyle:"circle",font:{size:11}}}}}}))}function de(){var e={"hub-analysis":{target:"ilsResult",charts:'<div class="row mt-3" id="gapChartsRow"><div class="col-md-6"><div class="chart-container"><div class="chart-title"><i class="fas fa-chart-pie"></i> ILS Element Coverage</div><canvas id="gapRadarChart" height="240"></canvas></div></div><div class="col-md-6"><div class="chart-container"><div class="chart-title"><i class="fas fa-chart-bar"></i> Element Scores</div><canvas id="gapBarChart" height="240"></canvas></div></div></div>'},"hub-dmsms":{target:null,charts:'<div class="chart-container mt-3" id="dmsmsChartArea"><div class="chart-title"><i class="fas fa-chart-pie"></i> Obsolescence Risk Distribution</div><canvas id="dmsmsPieChart" height="200"></canvas></div>'},"hub-readiness":{target:null,charts:'<div class="chart-container mt-3" style="max-width:100%" id="readinessGaugeArea"><div class="chart-title"><i class="fas fa-gauge-high"></i> Operational Availability</div><canvas id="readinessGauge" height="300"></canvas></div>'},"hub-compliance":{target:null,charts:'<div class="chart-container mt-3" id="complianceChartArea"><div class="chart-title"><i class="fas fa-shield-halved"></i> Compliance Framework Radar</div><canvas id="complianceRadarChart" height="250"></canvas></div>'},"hub-roi":{target:null,charts:'<div class="chart-container mt-3" id="roiChartArea"><div class="chart-title"><i class="fas fa-chart-line"></i> ROI Projection — 5 Year Cumulative</div><canvas id="roiLineChart" height="220"></canvas></div>'},"hub-risk":{target:null,charts:'<div class="chart-container mt-3" id="riskChartArea"><div class="chart-title"><i class="fas fa-triangle-exclamation"></i> Risk Category Assessment</div><canvas id="riskHeatChart" height="220"></canvas></div>'},"hub-lifecycle":{target:null,charts:'<div class="chart-container mt-3" id="lifecycleChartArea"><div class="chart-title"><i class="fas fa-chart-pie"></i> Total Ownership Cost Breakdown</div><canvas id="lifecyclePieChart" height="220"></canvas></div>'}};Object.keys(e).forEach(function(t){var a=e[t],n=document.getElementById(t);if(n&&!n.getAttribute("data-charts-injected")){var r=a.charts.match(/id="([^"]+)"/);if(r&&document.getElementById(r[1])){n.setAttribute("data-charts-injected","1");return}var d=n.querySelector(".demo-card");if(d){if(a.target){var s=document.getElementById(a.target);if(s){var o=document.createElement("div");o.innerHTML=a.charts,s.parentNode.insertBefore(o.firstElementChild,s.nextSibling),n.setAttribute("data-charts-injected","1");return}}var o=document.createElement("div");o.innerHTML=a.charts,d.appendChild(o.firstElementChild),n.setAttribute("data-charts-injected","1")}}})}var Ce=openILSTool;openILSTool=function(e){Ce(e),de(),setTimeout(function(){e==="hub-analysis"&&ilsResults&&$(),e==="hub-dmsms"&&oe(),e==="hub-readiness"&&ie(),e==="hub-compliance"&&se(),e==="hub-roi"&&le(),e==="hub-risk"&&ce(),e==="hub-lifecycle"&&J()},300)};var _e=switchHubTab;switchHubTab=function(e,t){_e(e,t),de(),setTimeout(function(){e==="hub-analysis"&&typeof ilsResults<"u"&&ilsResults&&$(),e==="hub-dmsms"&&oe(),e==="hub-readiness"&&ie(),e==="hub-compliance"&&se(),e==="hub-roi"&&le(),e==="hub-risk"&&ce(),e==="hub-lifecycle"&&J()},300)};var ee=null;typeof showILSResults=="function"&&(ee=showILSResults,showILSResults=function(){ee.apply(this,arguments);var e=document.getElementById("gapChartsRow");e&&(e.style.display="flex"),setTimeout($,500)});function Ee(){var e=(document.getElementById("lifecycleProgram")||{}).value||"ddg51",t=parseFloat((document.getElementById("lcServiceLife")||{}).value)||30,a=parseFloat((document.getElementById("lcOpHours")||{}).value)||2500,n=parseFloat((document.getElementById("lcAcqCost")||{}).value)||85,r=parseFloat((document.getElementById("lcFleetSize")||{}).value)||20,d=parseFloat((document.getElementById("lcSustRate")||{}).value)||8,s=n*r,o=s*(d/100),i=o*t,f=.12+(t>25?.04:0),c=i*f,u=s*.05,m=i*.18,b=i*.08,p=s+i+c+u+m+b,y=a*r*t,v=y>0?p/y:0;function w(A){return A>=1e3?"$"+(A/1e3).toFixed(1)+"B":"$"+A.toFixed(0)+"M"}var C=function(A){return document.getElementById(A)};C("lcTotalCost")&&(C("lcTotalCost").textContent=w(p)),C("lcSustCost")&&(C("lcSustCost").textContent=w(i)),C("lcDmsmsCost")&&(C("lcDmsmsCost").textContent=w(c)),C("lcCostPerHr")&&(C("lcCostPerHr").textContent="$"+v.toFixed(0)+"/hr");var g=Math.round(s/p*100),E=Math.round(i/p*100),O=Math.round(c/p*100),l=Math.round(u/p*100),h=Math.round(m/p*100),_=Math.round(b/p*100);window._lifecycleChartData=[g,E,O,l,h,_];var x=C("lifecycleOutput");if(x){var R=window.S4_PLATFORMS&&S4_PLATFORMS[e]?S4_PLATFORMS[e].n:e.toUpperCase();x.innerHTML='<div style="background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:20px;margin-top:12px"><div class="section-label"><i class="fas fa-clock"></i> LIFECYCLE COST BREAKDOWN — '+R+'</div><div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;font-size:0.85rem;margin-bottom:16px"><div><span style="color:var(--steel)">Acquisition ('+g+'%)</span><br><strong style="color:#00aaff">'+w(s)+'</strong></div><div><span style="color:var(--steel)">Sustainment ('+E+'%)</span><br><strong style="color:#c9a84c">'+w(i)+'</strong></div><div><span style="color:var(--steel)">DMSMS/Obsol ('+O+'%)</span><br><strong style="color:#ff4444">'+w(c)+'</strong></div><div><span style="color:var(--steel)">Disposal ('+l+'%)</span><br><strong style="color:#8ea4b8">'+w(u)+'</strong></div><div><span style="color:var(--steel)">Personnel ('+h+'%)</span><br><strong style="color:#00cc66">'+w(m)+'</strong></div><div><span style="color:var(--steel)">Training ('+_+'%)</span><br><strong style="color:#9b59b6">'+w(b)+'</strong></div></div><hr style="border-color:var(--border);margin:12px 0"><div style="display:flex;justify-content:space-between;align-items:center"><div><span style="color:var(--steel);font-size:0.82rem">Total Ownership Cost</span><br><span style="font-size:1.5rem;font-weight:800;color:#00aaff">'+w(p)+'</span></div><div><span style="color:var(--steel);font-size:0.82rem">Cost per Op Hour</span><br><span style="font-size:1.1rem;font-weight:700;color:var(--accent)">$'+v.toFixed(0)+'/hr</span></div><div><span style="color:var(--steel);font-size:0.82rem">Fleet Size</span><br><span style="font-size:1.1rem;font-weight:700;color:#fff">'+r+" units × "+t+" yrs</span></div></div></div>"}typeof J=="function"&&setTimeout(J,300),typeof generateLifecycleActions=="function"&&generateLifecycleActions(e,p,c,i)}function xe(){var e=(document.getElementById("lifecycleProgram")||{}).value||"ddg51",t=window.S4_PLATFORMS&&S4_PLATFORMS[e]?S4_PLATFORMS[e].n:e.toUpperCase(),a=parseFloat((document.getElementById("lcServiceLife")||{}).value)||30,n=parseFloat((document.getElementById("lcAcqCost")||{}).value)||85,r=parseFloat((document.getElementById("lcFleetSize")||{}).value)||20,d=parseFloat((document.getElementById("lcSustRate")||{}).value)||8,s=n*r,o=s*(d/100)*a,i=o*(.12+(a>25?.04:0)),f=s+o+i+s*.05+o*.18+o*.08,c=`S4 LEDGER — LIFECYCLE COST REPORT
================================

Platform: `+t+`
Fleet Size: `+r+` units
Service Life: `+a+` years
Sustainment Rate: `+d+`%

Acquisition: $`+s.toFixed(0)+`M
Sustainment: $`+o.toFixed(0)+`M
DMSMS/Obsolescence: $`+i.toFixed(0)+`M
Total Ownership Cost: $`+f.toFixed(0)+`M

Generated: `+new Date().toISOString()+`
`,u=new Blob([c],{type:"text/plain"}),m=document.createElement("a");m.href=URL.createObjectURL(u),m.download="S4_Lifecycle_"+t.replace(/\s+/g,"_")+"_"+new Date().toISOString().substring(0,10)+".txt",m.click(),URL.revokeObjectURL(m.href),typeof s4Notify=="function"&&s4Notify("Exported","Lifecycle cost report downloaded.","success")}async function Ie(){var e=(document.getElementById("lifecycleProgram")||{}).value||"ddg51",t=window.S4_PLATFORMS&&S4_PLATFORMS[e]?S4_PLATFORMS[e].n:e.toUpperCase(),a=parseFloat((document.getElementById("lcServiceLife")||{}).value)||30,n=parseFloat((document.getElementById("lcAcqCost")||{}).value)||85,r=parseFloat((document.getElementById("lcFleetSize")||{}).value)||20,d=parseFloat((document.getElementById("lcSustRate")||{}).value)||8,s=n*r,o=s*(d/100)*a,i=o*(.12+(a>25?.04:0)),f=s+o+i+s*.05+o*.18+o*.08,c="Lifecycle Cost | Program: "+t+" | Fleet: "+r+" | TOC: $"+f.toFixed(0)+"M | Date: "+new Date().toISOString(),u=await sha256(c);showAnchorAnimation(u,"Lifecycle Cost Report","CUI"),window._s4Stats&&(window._s4Stats.anchored++,window._s4Stats.types.add("LIFECYCLE_COST"),window._s4Stats.slsFees=Math.round((window._s4Stats.slsFees+.01)*100)/100),typeof updateStats=="function"&&updateStats(),typeof saveStats=="function"&&saveStats();var m=await _anchorToXRPL(u,"LIFECYCLE_COST",c.substring(0,100)),b={hash:u,type:"LIFECYCLE_COST",branch:"JOINT",timestamp:new Date().toISOString(),label:"Lifecycle Cost — "+t,txHash:m.txHash};sessionRecords.push(b),saveLocalRecord({hash:u,record_type:"LIFECYCLE_COST",record_label:"Lifecycle Cost — "+t,branch:"JOINT",timestamp:new Date().toISOString(),timestamp_display:new Date().toISOString().replace("T"," ").substring(0,19)+" UTC",fee:.01,tx_hash:m.txHash,system:"Lifecycle Cost Estimator",explorer_url:m.explorerUrl,network:m.network}),addToVault({hash:u,txHash:m.txHash,type:"LIFECYCLE_COST",label:"Lifecycle Cost — "+t,branch:"JOINT",icon:'<i class="fas fa-clock"></i>',content:c.substring(0,100),encrypted:!1,timestamp:new Date().toISOString(),source:"Lifecycle Cost Estimator",fee:.01,explorerUrl:m.explorerUrl,network:m.network}),updateTxLog(),_updateDemoSlsBalance(),setTimeout(function(){document.getElementById("animStatus").innerHTML='<i class="fas fa-check-circle" style="color:var(--accent)"></i> Lifecycle report anchored!',document.getElementById("animStatus").style.color="#00aaff"},2200),await new Promise(function(p){setTimeout(p,3200)}),hideAnchorAnimation(),typeof s4Notify=="function"&&s4Notify("Anchored","Lifecycle cost report anchored to XRPL.","success")}(function(){function e(n){var r=document.getElementById(n);if(!(!r||r.dataset.uxDone)){r.dataset.uxDone="1",r.querySelectorAll("details").forEach(function(l){l.removeAttribute("style")}),r.querySelectorAll("details summary").forEach(function(l){l.removeAttribute("style")}),r.querySelectorAll("details > div").forEach(function(l){l.removeAttribute("style")}),r.querySelectorAll("h3 > i[style], h4 > i[style]").forEach(function(l){l.removeAttribute("style")});var d=r.querySelectorAll(".demo-card");d.forEach(function(l){var h=l.querySelector("h3, h4");if(h){var _=h.nextElementSibling,x=l.querySelector(".hub-tool-header");x&&(_=x.nextElementSibling),_&&_.tagName==="P"&&_.getAttribute("style")&&_.removeAttribute("style")}}),r.querySelectorAll("button[style]").forEach(function(l){if(!(l.closest(".ils-dropzone")||l.closest(".post-actions")||l.closest(".post-action-btn"))&&l.style.display!=="none"){var h=l.textContent.toLowerCase(),_=h.includes("anchor")||h.includes("xrpl"),x=h.includes("export")||h.includes("download")||h.includes("generate"),R=h.includes("run ")||h.includes("analyze")||h.includes("calculate"),A=h.includes("clear")||h.includes("delete");A||(l.innerHTML,l.getAttribute("onclick"),_||R?(l.removeAttribute("style"),l.className="btn-anchor"):x&&(l.removeAttribute("style"),l.className="btn-export"))}}),r.querySelectorAll("div[style]").forEach(function(l){var h=l.getAttribute("style")||"";if(h.includes("display:flex")&&h.includes("gap:10")&&h.includes("flex-wrap:wrap")&&!l.classList.contains("ils-dropzone")&&!l.querySelector(".ils-dropzone")&&!l.closest(".post-actions")){var _=l.querySelectorAll("button");_.length>0&&(l.className="tool-actions-bar",l.removeAttribute("style"))}}),d.forEach(function(l){l.querySelectorAll(":scope > label, :scope > .row > .col-md-6 > label");var h=l.querySelector(":scope > label");if(h&&!h.previousElementSibling?.classList?.contains("section-label")){var _=document.createElement("div");_.className="section-label",_.innerHTML='<i class="fas fa-sliders"></i> CONFIGURATION';var x=document.createElement("hr");x.className="section-divider",h.parentNode.insertBefore(x,h),h.parentNode.insertBefore(_,x)}var R=l.querySelector('[id$="Results"], [id$="Output"], [id$="result"], [id$="Result"]');if(R&&!R.previousElementSibling?.classList?.contains("section-label")){var A=document.createElement("div");A.className="section-label",A.innerHTML='<i class="fas fa-chart-bar"></i> RESULTS';var q=document.createElement("hr");q.className="section-divider",R.parentNode.insertBefore(q,R),R.parentNode.insertBefore(A,q)}var S=l.querySelector(".tool-actions-bar");if(S&&!S.previousElementSibling?.classList?.contains("section-label")){var L=document.createElement("div");L.className="section-label",L.innerHTML='<i class="fas fa-bolt"></i> ACTIONS',S.parentNode.insertBefore(L,S)}});var s=r.querySelector(".demo-card");if(s){var o=n==="hub-analysis"||n==="hub-actions";if(!o){for(var i=s.querySelectorAll(":scope > .row"),f=null,c=0;c<i.length;c++){var u=i[c];if(u.querySelectorAll(".stat-mini").length>=3){f=u;break}}if(f){var m=s.querySelector(".hub-tool-header")||s.querySelector("h3, h4");if(m){var b=m;f.style.cssText="",f.classList.add("mb-3"),b.parentNode.insertBefore(f,b.nextSibling)}}}if(n==="hub-actions"){var p=s.querySelector(".col-lg-8");if(p){var y=p.querySelector(".demo-card");if(y){for(var v=null,w=y.querySelectorAll(":scope > .row"),C=0;C<w.length;C++)if(w[C].querySelectorAll(".stat-mini").length>=3){v=w[C];break}if(v){var g=y.querySelector("h3");g&&(v.style.cssText="",v.classList.add("mb-3"),g.parentNode.insertBefore(v,g.nextSibling))}}}}r.querySelectorAll("input[style], select[style]").forEach(function(l){l.type==="file"||l.type==="hidden"||l.style.display!=="none"&&l.removeAttribute("style")});var E=r.querySelectorAll(".chart-container");E.forEach(function(l){l.style.display="block"});var O=r.querySelector("#gapChartsRow");O&&(O.style.display="flex")}}}var t=openILSTool;openILSTool=function(n){t(n),setTimeout(function(){e(n)},100)};var a=switchHubTab;switchHubTab=function(n,r){a(n,r),setTimeout(function(){e(n)},100)},document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){document.querySelectorAll('.ils-hub-panel.active, .ils-hub-panel[style*="display:block"], .ils-hub-panel[style*="display: block"]').forEach(function(n){e(n.id)})},2500)})})();document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector('a[href="#tabILS"]');e&&e.addEventListener("shown.bs.tab",function(){updateAiContext(currentHubPanel||"hub-analysis")})});var I,T;(function(){var t=new Date;I=t.getFullYear(),T=t.getMonth()})();function Te(e){T+=e,T>11&&(T=0,I++),T<0&&(T=11,I--),j()}function j(){var e=document.getElementById("actionCalendarGrid"),t=document.getElementById("calMonthLabel");if(!(!e||!t)){if(typeof I>"u"||I===void 0||I===null){var a=new Date;I=a.getFullYear(),T=a.getMonth()}var n=["January","February","March","April","May","June","July","August","September","October","November","December"];t.textContent=n[T]+" "+I;var r=new Date(I,T,1).getDay(),d=new Date(I,T+1,0).getDate(),s=new Date,o=s.getFullYear()===I&&s.getMonth()===T,i={};try{var f=typeof s4ActionItems<"u"&&s4ActionItems.length>0?s4ActionItems:JSON.parse(localStorage.getItem("s4ActionItems")||"[]");f.forEach(function(g){var E=g.due||g.schedule||"";if(E){var O=new Date(E);if(!isNaN(O.getTime())&&O.getFullYear()===I&&O.getMonth()===T){var l=O.getDate();i[l]||(i[l]=[]),i[l].push(g)}}})}catch{}if(Object.keys(i).length===0){var c=[{day:3,title:"DMSMS Review — AN/SPS-49 Radar",severity:"critical"},{day:7,title:"ILS Gap Analysis — DDG-51 FY25",severity:"warning"},{day:10,title:"Parts Order Deadline — CVN-78",severity:"critical"},{day:12,title:"Compliance Audit Prep",severity:"info"},{day:15,title:"Warranty Expiry — GE LM2500",severity:"warning"},{day:18,title:"Lifecycle Cost Review",severity:"info"},{day:21,title:"Risk Assessment Update",severity:"warning"},{day:24,title:"Readiness Report Due",severity:"critical"},{day:27,title:"Obsolescence Check — MIL-STD-1553",severity:"info"}];c.forEach(function(g){g.day<=d&&(i[g.day]||(i[g.day]=[]),i[g.day].push(g))})}var u="";["Su","Mo","Tu","We","Th","Fr","Sa"].forEach(function(g){u+='<div style="padding:4px;font-weight:700;color:var(--steel);font-size:0.7rem">'+g+"</div>"});for(var m=0;m<r;m++)u+='<div style="padding:6px"></div>';for(var b=1;b<=d;b++){var p=o&&b===s.getDate(),y=i[b],v=p?"rgba(0,170,255,0.2)":y?"rgba(0,170,255,0.06)":"var(--surface)",w=p?"1px solid var(--accent)":y?"1px solid rgba(0,170,255,0.15)":"1px solid var(--border)",C="";y&&y.forEach(function(g){var E=g.severity==="critical"?"#ff3333":g.severity==="warning"?"#ffa500":"#00aaff";C+='<span style="display:inline-block;width:4px;height:4px;border-radius:50%;background:'+E+';margin:0 1px"></span>'}),u+='<div onclick="showCalDay('+b+')" style="padding:4px 2px;background:'+v+";border:"+w+";border-radius:4px;cursor:"+(y?"pointer":"default")+';min-height:32px"><div style="color:'+(p?"#00aaff":"#fff")+";font-weight:"+(p?"800":"400")+'">'+b+"</div>"+(C?'<div style="margin-top:2px">'+C+"</div>":"")+"</div>"}e.innerHTML=u}}function Ae(e){var t=document.getElementById("calDayDetail");if(t){var a={};try{var r=typeof s4ActionItems<"u"&&s4ActionItems.length>0?s4ActionItems:JSON.parse(localStorage.getItem("s4ActionItems")||"[]");r.forEach(function(i){var f=i.due||i.schedule||"";if(f){var c=new Date(f);if(!isNaN(c.getTime())&&c.getFullYear()===I&&c.getMonth()===T){var u=c.getDate();a[u]||(a[u]=[]),a[u].push(i)}}})}catch{}var n={3:[{title:"DMSMS Review — AN/SPS-49 Radar",severity:"critical",owner:"NAVSEA 04"}],7:[{title:"ILS Gap Analysis — DDG-51 FY25",severity:"warning",owner:"PMS 400"}],10:[{title:"Parts Order Deadline — CVN-78",severity:"critical",owner:"PMS 312"}],12:[{title:"Compliance Audit Prep",severity:"info",owner:"ILS Manager"}],15:[{title:"Warranty Expiry — GE LM2500",severity:"warning",owner:"PMS 300"}],18:[{title:"Lifecycle Cost Review",severity:"info",owner:"CAPE"}],21:[{title:"Risk Assessment Update",severity:"warning",owner:"PMS 400"}],24:[{title:"Readiness Report Due",severity:"critical",owner:"TYCOM"}],27:[{title:"Obsolescence Check — MIL-STD-1553",severity:"info",owner:"NAVSEA 04"}]},r=a[e]||n[e]||[];if(r.length===0){t.style.display="none";return}var d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s='<div style="font-weight:700;color:#fff;margin-bottom:6px"><i class="fas fa-calendar-day" style="color:var(--accent);margin-right:4px"></i>'+d[T]+" "+e+", "+I+"</div>";r.forEach(function(o){var i=o.severity==="critical"?"#ff3333":o.severity==="warning"?"#ffa500":"#00aaff";s+='<div style="padding:6px 8px;background:rgba(0,0,0,0.2);border-left:3px solid '+i+';border-radius:4px;margin-bottom:4px"><div style="font-weight:600;color:#fff;font-size:0.8rem">'+(o.title||"Action Item")+"</div>"+(o.owner?'<div style="font-size:0.72rem;color:var(--steel)">Owner: '+o.owner+"</div>":"")+"</div>"}),t.innerHTML=s,t.style.display="block"}}function K(){var e=document.getElementById("actionCalendarGrid"),t=document.getElementById("calMonthLabel");if(!e||!t){setTimeout(K,500);return}j(),(!e.innerHTML||e.innerHTML.trim()==="")&&setTimeout(j,300)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){setTimeout(K,800)}):setTimeout(K,800);(function(){var e=new MutationObserver(function(a){a.forEach(function(n){if(n.type==="attributes"&&n.attributeName==="style"){var r=n.target;r.id==="hub-actions"&&r.style.display!=="none"&&setTimeout(j,150)}})}),t=document.getElementById("hub-actions");t?e.observe(t,{attributes:!0,attributeFilter:["style"]}):document.addEventListener("DOMContentLoaded",function(){var a=document.getElementById("hub-actions");a&&e.observe(a,{attributes:!0,attributeFilter:["style"]})})})();window.anchorLifecycle=Ie;window.calcLifecycle=Ee;window.changeCalMonth=Te;window.exportLifecycle=xe;window.handleFileSelect=we;window.loadPerformanceMetrics=U;window.offlineClearQueue=ye;window.offlineQueueHash=ve;window.offlineRemoveItem=he;window.handleFileDrop=Se;window.offlineSyncAll=ge;window.showCalDay=Ae;(function(){var e={lcp:null,fid:null,cls:0,inp:null,ttfb:null,entries:[]},t=window.S4=window.S4||{};t.vitals=e;function a(f,c){e.entries.push({name:f,value:Math.round(c*100)/100,ts:Date.now()})}try{var n=performance.getEntriesByType("navigation");n&&n[0]&&(e.ttfb=Math.round(n[0].responseStart),a("TTFB",e.ttfb))}catch{}try{if("PerformanceObserver"in window){var r=new PerformanceObserver(function(f){var c=f.getEntries(),u=c[c.length-1];u&&(e.lcp=Math.round(u.startTime),a("LCP",e.lcp))});r.observe({type:"largest-contentful-paint",buffered:!0})}}catch{}try{if("PerformanceObserver"in window){var d=new PerformanceObserver(function(f){var c=f.getEntries();c[0]&&(e.fid=Math.round(c[0].processingStart-c[0].startTime),a("FID",e.fid),d.disconnect())});d.observe({type:"first-input",buffered:!0})}}catch{}try{if("PerformanceObserver"in window){var s=new PerformanceObserver(function(f){var c=f.getEntries();c.forEach(function(u){u.hadRecentInput||(e.cls+=u.value)}),e.cls=Math.round(e.cls*1e4)/1e4,a("CLS",e.cls)});s.observe({type:"layout-shift",buffered:!0})}}catch{}try{if("PerformanceObserver"in window){var o=new PerformanceObserver(function(f){var c=f.getEntries();c.forEach(function(u){var m=u.duration;(e.inp===null||m>e.inp)&&(e.inp=Math.round(m),a("INP",e.inp))})});o.observe({type:"event",buffered:!0,durationThreshold:40})}}catch{}t.vitals.summary=function(){return{TTFB:e.ttfb!==null?e.ttfb+"ms":"n/a",LCP:e.lcp!==null?e.lcp+"ms":"n/a",FID:e.fid!==null?e.fid+"ms":"n/a",CLS:e.cls.toFixed(4),INP:e.inp!==null?e.inp+"ms":"n/a",grade:i()}};function i(){var f=0,c=0;if(e.lcp!==null&&(f+=e.lcp<=2500?1:e.lcp<=4e3?.5:0,c++),e.fid!==null&&(f+=e.fid<=100?1:e.fid<=300?.5:0,c++),e.cls!==null&&(f+=e.cls<=.1?1:e.cls<=.25?.5:0,c++),e.inp!==null&&(f+=e.inp<=200?1:e.inp<=500?.5:0,c++),c===0)return"n/a";var u=Math.round(f/c*100);return u>=90?"Good":u>=50?"Needs Improvement":"Poor"}})();
