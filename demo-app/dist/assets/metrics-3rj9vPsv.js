var F=null,B=null;async function Q(){var e=stats.anchored||0;stats.slsFees;var t=getLocalRecords(),a={};t.forEach(function(y){var C=y.record_label||y.record_type||"Unknown";a[C]=(a[C]||0)+1});try{var n=await fetch("/api/metrics/performance"),r=await n.json(),i=function(y,C){var D=document.getElementById(y);D&&(D.textContent=C)};i("metricAnchorTime",r.avg_anchor_time_ms?(r.avg_anchor_time_ms/1e3).toFixed(2):"3.21"),i("metricAnchorsToday",r.anchors_today||(e>0?e:"—")),i("metricCostPerAnchor",r.cost_per_anchor||"0.01"),i("metricValidators",r.xrpl_validators||"35"),i("metricUptime",r.uptime_pct||"99.97"),i("metricAiAudit",r.ai_audit_entries||(e>0?Math.max(e,1):"—"));var o=[];try{o=JSON.parse(localStorage.getItem(_vaultKey())||"[]")}catch{}var s=t.length+o.length;i("metricRecordsGenerated",s>0?s:"—"),i("metricVaultSize",o.length>0?o.length:"—");var d=0;try{d=Math.round(new Blob([localStorage.getItem(_vaultKey())||""]).size/1024*10)/10}catch{}i("metricStorageUsed",d>0?d.toFixed(1):"—"),i("metricTotalTime",r.total_processing_time||(e>0?(e*3.2).toFixed(1):"—"));var f=document.getElementById("chartAnchorTimes");if(f&&typeof Chart<"u"){var c=r.recent_anchor_times||Array.from({length:20},function(){return(2.8+Math.random()*1.5).toFixed(2)});F&&F.destroy(),F=new Chart(f,{type:"line",data:{labels:c.map(function(y,C){return"#"+(C+1)}),datasets:[{label:"Anchor Time (s)",data:c,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"#00aaff"}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}})}var u=document.getElementById("chartRecordTypes");if(u&&typeof Chart<"u"){var m=r.record_type_counts||(Object.keys(a).length>0?a:{DD1149:12,DD250:8,WAWF:5,Container:14,"Supply Chain":9,Custody:7,Maintenance:6});B&&B.destroy(),B=new Chart(u,{type:"doughnut",data:{labels:Object.keys(m),datasets:[{data:Object.values(m),backgroundColor:["#00aaff","#c9a84c","#38bdf8","#ff6b6b","#00aaff","#fb923c","#06b6d4"],borderWidth:0}]},options:{responsive:!0,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:10},padding:8}}}}})}var p=document.getElementById("metricsRecentRequests");p&&r.recent_requests&&r.recent_requests.length?p.innerHTML=r.recent_requests.map(function(y){var C=(y.method||"GET")==="POST"?"#00cc66":"#00aaff";return'<div style="display:flex;align-items:center;gap:8px;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="background:'+C+"22;color:"+C+';font-weight:700;font-size:0.7rem;padding:2px 8px;border-radius:4px;min-width:42px;text-align:center">'+(y.method||"GET")+'</span><span style="color:var(--text);flex:1;font-family:monospace;font-size:0.72rem">'+(y.path||y.endpoint||"/api/anchor")+'</span><span style="color:var(--accent);font-size:0.68rem;font-weight:600">'+(y.time||y.duration||y.latency||"—")+'</span><span style="color:var(--muted);font-size:0.68rem">'+(y.timestamp||y.ts||"")+"</span></div>"}).join(""):p&&(p.innerHTML='<div style="color:var(--muted);text-align:center;padding:1rem">No recent requests. Metrics auto-refresh when data is available.</div>')}catch{var i=function(O,Z){var q=document.getElementById(O);q&&(q.textContent=Z)};i("metricAnchorTime",e>0?(2.8+Math.random()*.5).toFixed(2):"—"),i("metricAnchorsToday",e>0?e:"—"),i("metricCostPerAnchor","0.01"),i("metricValidators","35"),i("metricUptime","99.97"),i("metricAiAudit",e>0?Math.max(e,1):"—");var v=[];try{v=JSON.parse(localStorage.getItem(_vaultKey())||"[]")}catch{}var b=t.length+v.length;i("metricRecordsGenerated",b>0?b:"—"),i("metricVaultSize",v.length>0?v.length:"—");var x=0;try{x=Math.round(new Blob([localStorage.getItem(_vaultKey())||""]).size/1024*10)/10}catch{}i("metricStorageUsed",x>0?x.toFixed(1):"—"),i("metricTotalTime",e>0?(e*3.2).toFixed(1):"—");var f=document.getElementById("chartAnchorTimes");if(f&&typeof Chart<"u"){var c=Array.from({length:Math.max(e,10)},function(){return(2.8+Math.random()*1.2).toFixed(2)});typeof F<"u"&&F&&F.destroy(),F=new Chart(f,{type:"line",data:{labels:c.map(function(Z,q){return"#"+(q+1)}),datasets:[{label:"Anchor Time (s)",data:c,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"#00aaff"}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}})}var u=document.getElementById("chartRecordTypes");if(u&&typeof Chart<"u"){var m=Object.keys(a).length>0?a:{"No Records Yet":1};typeof B<"u"&&B&&B.destroy(),B=new Chart(u,{type:"doughnut",data:{labels:Object.keys(m),datasets:[{data:Object.values(m),backgroundColor:["#00aaff","#c9a84c","#38bdf8","#ff6b6b","#00aaff","#fb923c","#06b6d4"],borderWidth:0}]},options:{responsive:!0,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:10},padding:8}}}}})}var p=document.getElementById("metricsRecentRequests");if(p){for(var S=[],w=typeof getLocalRecords=="function"?getLocalRecords():[],g=w.slice(-5).reverse(),_=0;_<g.length;_++){var I=g[_],l=Math.floor((Date.now()-new Date(I.timestamp).getTime())/1e3),h=l<60?l+"s ago":l<3600?Math.floor(l/60)+"m ago":Math.floor(l/3600)+"h ago";S.push({method:"POST",path:"/api/anchor",time:(2.5+Math.random()*1.5).toFixed(1)+"s",ts:h,color:"#00cc66",detail:I.record_label||I.record_type||"Record"}),S.push({method:"GET",path:"/api/verify/"+(I.hash||"sha256").substring(0,12),time:(.3+Math.random()*.3).toFixed(1)+"s",ts:h,color:"#00aaff",detail:"Verify "+(I.record_label||"")})}var E=[{method:"GET",path:"/api/metrics/performance",time:"0.2s",ts:"auto",color:"#00aaff",detail:"Metrics refresh"},{method:"GET",path:"/api/health",time:"0.1s",ts:"auto",color:"#00aaff",detail:"Health check"},{method:"GET",path:"/api/records?limit=50",time:"0.4s",ts:"realtime",color:"#00aaff",detail:"Record listing"},{method:"POST",path:"/api/wallet/balance",time:"0.3s",ts:"auto",color:"#00cc66",detail:"Balance check"},{method:"GET",path:"/api/xrpl/account_info",time:"0.8s",ts:"auto",color:"#00aaff",detail:"XRPL query"}],L=S.length>0?S.concat(E):[{method:"POST",path:"/api/anchor",time:"2.8s",ts:"just now",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/verify/sha256:a1b2c3d4",time:"0.4s",ts:"12s ago",color:"#00aaff",detail:"Verify hash"},{method:"POST",path:"/api/anchor",time:"3.1s",ts:"45s ago",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/metrics/performance",time:"0.2s",ts:"1m ago",color:"#00aaff",detail:"Metrics"},{method:"GET",path:"/api/records?limit=50&branch=NAVY",time:"0.3s",ts:"2m ago",color:"#00aaff",detail:"Record query"},{method:"POST",path:"/api/anchor",time:"2.6s",ts:"3m ago",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/verify/sha256:e5f6a7b8",time:"0.5s",ts:"4m ago",color:"#00aaff",detail:"Verify hash"},{method:"POST",path:"/api/ai-chat",time:"1.2s",ts:"5m ago",color:"#00cc66",detail:"AI query"}];p.innerHTML=L.slice(0,12).map(function(O){return'<div style="display:flex;align-items:center;gap:8px;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="background:'+O.color+"22;color:"+O.color+';font-weight:700;font-size:0.7rem;padding:2px 8px;border-radius:4px;min-width:42px;text-align:center">'+O.method+'</span><span style="color:var(--text);flex:1;font-family:monospace;font-size:0.72rem">'+O.path+'</span><span style="color:var(--steel);font-size:0.65rem;max-width:90px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">'+O.detail+'</span><span style="color:var(--accent);font-size:0.68rem;font-weight:600">'+O.time+'</span><span style="color:var(--muted);font-size:0.68rem">'+O.ts+"</span></div>"}).join("")}}}document.addEventListener("shown.bs.tab",function(e){e.target&&e.target.getAttribute("href")==="#tabMetrics"&&Q(),e.target&&e.target.getAttribute("href")==="#tabOffline"&&me()});setInterval(function(){var e=document.getElementById("tabMetrics");e&&e.classList.contains("active")&&typeof Q=="function"&&Q()},3e4);(function(){function e(){var t=typeof stats<"u"?stats:{anchored:0,slsFees:0};typeof getLocalRecords=="function"&&getLocalRecords();var a=document.getElementById("slsBarBalance");if(a){var n=t.slsFees||0,r=typeof _onboardTiers<"u"&&typeof _onboardTier<"u"&&_onboardTiers[_onboardTier]?_onboardTiers[_onboardTier].sls:typeof _demoSession<"u"&&_demoSession.subscription&&_demoSession.subscription.sls_allocation||25e3,i=r-n;a.textContent=i.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})}var o=document.getElementById("slsBarAnchors");o&&(o.textContent=t.anchored||0);var s=document.getElementById("slsBarSpent");s&&(s.textContent=(t.slsFees||0).toFixed(2));var d=typeof _onboardTiers<"u"&&typeof _onboardTier<"u"&&_onboardTiers[_onboardTier]?_onboardTiers[_onboardTier].sls:typeof _demoSession<"u"&&_demoSession.subscription&&_demoSession.subscription.sls_allocation||25e3,f=document.getElementById("toolSlsBal");f&&(f.textContent=(d-(t.slsFees||0)).toLocaleString());var c=document.getElementById("toolSlsAnch");c&&(c.textContent=t.anchored||0);var u=document.getElementById("toolSlsSpent");u&&(u.textContent=(t.slsFees||0).toFixed(2));try{var m=JSON.parse(localStorage.getItem("s4ActionItems")||"[]"),p=m.filter(function(b){return b.status!=="Closed"&&b.status!=="Resolved"}).length,v=document.getElementById("actionItemBadge");v&&(v.textContent=p>0?p:"",v.style.display=p>0?"inline-flex":"none")}catch{}}setInterval(e,3e3),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()})();var U="s4_offline_queue",ee="s4_offline_last_sync",te="s4_offline_queue_enc",H=null;async function de(){if(H)return H;var e=navigator.userAgent+"|"+location.origin+"|s4ledger_offline_v1",t=new TextEncoder,a=await crypto.subtle.importKey("raw",t.encode(e),"PBKDF2",!1,["deriveKey"]);return H=await crypto.subtle.deriveKey({name:"PBKDF2",salt:t.encode("s4_offline_salt_v1"),iterations:1e5,hash:"SHA-256"},a,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),H}async function fe(e){var t=await de(),a=crypto.getRandomValues(new Uint8Array(12)),n=new TextEncoder,r=await crypto.subtle.encrypt({name:"AES-GCM",iv:a},t,n.encode(JSON.stringify(e)));return{iv:Array.from(a),data:Array.from(new Uint8Array(r))}}function R(){try{var e=localStorage.getItem(te);return e?V||[]:JSON.parse(localStorage.getItem(U)||"[]")}catch{return[]}}var V=[];async function ue(e){try{var t=await fe(e);localStorage.setItem(te,JSON.stringify(t)),V=e}catch{localStorage.setItem(U,JSON.stringify(e))}}function P(e){V=e,localStorage.setItem(U,JSON.stringify(e)),ue(e).then(function(){localStorage.removeItem(U)}).catch(function(){}),N()}function N(){var e=R(),t=document.getElementById("offlineQueueCount"),a=document.getElementById("offlineQueueList"),n=document.getElementById("offlineLastSync"),r=document.getElementById("offlineStatus");if(t&&(t.textContent=e.length),n){var i=localStorage.getItem(ee);n.textContent=i?new Date(i).toLocaleString():"Never"}if(r){var o=navigator.onLine;r.innerHTML=o?'<i class="fas fa-circle" style="font-size:0.6rem;color:var(--green)"></i> Online':'<i class="fas fa-circle" style="font-size:0.6rem;color:var(--red)"></i> Offline',r.style.color=o?"var(--green)":"var(--red)"}a&&(e.length?a.innerHTML=e.map(function(s,d){return'<div style="display:flex;align-items:center;gap:8px;padding:8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="color:var(--accent);font-weight:700;width:24px">'+(d+1)+'</span><span style="flex:1;color:var(--text);font-family:monospace;font-size:0.72rem">'+(s.hash?s.hash.substring(0,24)+"...":"N/A")+'</span><span style="color:var(--steel);font-size:0.7rem;width:80px">'+(s.record_type||"GENERAL")+'</span><span style="color:'+(s.synced?"var(--green)":"var(--gold)")+';font-size:0.72rem">'+(s.synced?"✓ Synced":"⏳ Pending")+'</span><button onclick="offlineRemoveItem('+d+')" style="background:none;border:none;color:var(--red);cursor:pointer;font-size:0.75rem" title="Remove"><i class="fas fa-times"></i></button></div>'}).join(""):a.innerHTML='<div style="color:var(--muted);text-align:center;padding:1rem">Queue is empty. Hashes are queued automatically when offline.</div>')}function me(){N(),fetch("/api/offline/queue").then(function(e){return e.json()}).then(function(e){if(e.queue_size>0){var t=document.getElementById("offlineQueueCount"),a=R().length;t&&(t.textContent=a+e.queue_size)}if(e.last_sync){var n=document.getElementById("offlineLastSync");n&&(n.textContent=new Date(e.last_sync).toLocaleString())}}).catch(function(){})}function pe(){if(typeof s4Vault<"u"&&s4Vault.length>0){var e=R(),t={};e.forEach(function(o){t[o.hash]=!0});var a=s4Vault.filter(function(o){return o.hash&&!t[o.hash]});if(a.length>0){var n=a[0];e.push({hash:n.hash,record_type:n.type||"VAULT_RECORD",branch:n.branch||"JOINT",timestamp:n.timestamp||new Date().toISOString(),synced:!1,label:n.label||"Vault Record"}),P(e),M("Vault record queued for offline sync: "+n.hash.substring(0,16)+"...","success")}else M("All vault records are already queued. Anchor new records first.","info")}else{var r="S4-SESSION-"+Date.now()+"-"+Math.random().toString(36).substring(2,10),i=new TextEncoder;crypto.subtle.digest("SHA-256",i.encode(r)).then(function(o){var s=Array.from(new Uint8Array(o)).map(function(f){return f.toString(16).padStart(2,"0")}).join(""),d=R();d.push({hash:s,record_type:"SESSION_HASH",branch:"JOINT",timestamp:new Date().toISOString(),synced:!1}),P(d),M("Session hash queued for offline sync: "+s.substring(0,16)+"...","info")})}}function ve(e){var t=R();t.splice(e,1),P(t)}function he(){confirm("Clear all offline queued hashes?")&&(P([]),M("Offline queue cleared.","info"))}async function ye(){return W()}var k=0,Y=5,ge=1e3;async function W(e){e=e||0;var t=R(),a=t.filter(function(s){return!s.synced});if(!a.length){k=0,M("No pending hashes to sync.","info");return}if(!navigator.onLine){M("Cannot sync — currently offline.","warning");return}M("Syncing "+a.length+" hashes to XRPL"+(e>0?" (retry "+e+"/"+Y+")":"")+"...","info");try{var n=await ae("/api/offline/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hashes:a})});if(!n.ok)throw new Error("Server returned "+n.status);for(var r=await n.json(),i=0;i<t.length;i++)t[i].synced||(t[i].synced=!0,t[i].synced_at=new Date().toISOString());P(t),localStorage.setItem(ee,new Date().toISOString()),k=0,M("Sync complete: "+(r.synced||a.length)+" anchored.","success"),N()}catch(s){if(k=e+1,k<=Y){var o=ge*Math.pow(2,e)+Math.floor(Math.random()*500);M("Sync failed ("+s.message+"). Retrying in "+Math.round(o/1e3)+"s...","warning"),setTimeout(function(){W(k)},o)}else k=0,M("Sync failed after "+Y+" retries: "+s.message+". Try again later.","error")}}var ae=window.fetch;window.fetch=function(e,t){if(!navigator.onLine&&typeof e=="string"){var a=e.indexOf("/api/anchor")!==-1||e.indexOf("/api/demo/anchor")!==-1,n=e.indexOf("/api/demo/provision")!==-1;if(a){try{var r=t&&t.body?JSON.parse(t.body):{},i=R();i.push({hash:r.hash||r.data_hash||"UNKNOWN",record_type:r.record_type||"QUEUED_ANCHOR",branch:r.branch||"JOINT",timestamp:new Date().toISOString(),synced:!1}),P(i),M("Offline: anchor queued locally. Will sync when reconnected.","info")}catch{}return Promise.resolve(new Response(JSON.stringify({status:"queued_offline",message:"Hash queued for offline sync.",record:{tx_hash:"OFFLINE_"+Date.now().toString(36).toUpperCase(),network:"Queued Offline"}}),{status:200,headers:{"Content-Type":"application/json"}}))}if(n){var o=localStorage.getItem("s4_selected_tier")||"starter",s={pilot:{label:"Pilot",sls:100},starter:{label:"Starter",sls:25e3},professional:{label:"Professional",sls:1e5},enterprise:{label:"Enterprise",sls:5e5}},d=s[o]||s.starter;return Promise.resolve(new Response(JSON.stringify({session_id:"offline_"+Date.now(),subscription:{label:d.label,sls_allocation:d.sls},wallet:{address:"rOfflineMode"},xrp_balance:12,sls_balance:d.sls}),{status:200,headers:{"Content-Type":"application/json"}}))}}return ae.apply(this,arguments)};window.addEventListener("online",function(){N(),M("Connection restored. Auto-syncing offline queue...","success"),setTimeout(function(){var e=R(),t=e.filter(function(a){return!a.synced});t.length>0&&W()},2e3)});window.addEventListener("offline",function(){N(),M("Connection lost. Anchors will be queued locally.","warning")});function M(e,t){var a=document.querySelector(".workspace-notification");a&&a.remove();var n=document.createElement("div");n.className="workspace-notification";var r={success:"var(--green)",error:"var(--red)",warning:"var(--gold)",info:"var(--accent)"};n.style.borderColor=r[t]||r.info,n.innerHTML='<button class="notif-close" onclick="this.parentElement.remove()">&times;</button><i class="fas fa-'+(t==="success"?"check-circle":t==="error"?"times-circle":t==="warning"?"exclamation-triangle":"info-circle")+'" style="color:'+(r[t]||r.info)+';margin-right:6px"></i>'+e,document.body.appendChild(n),setTimeout(function(){n.remove()},5e3)}document.addEventListener("DOMContentLoaded",function(){N()});function be(e){e.preventDefault();var t=document.getElementById("dropZone");t&&t.classList.remove("drag-over");var a=e.dataTransfer.files;a.length>0&&re(a[0])}function Se(e){var t=e.target.files;t.length>0&&re(t[0])}function re(e){var t=document.getElementById("dropFileName");t&&(t.style.display="block",t.innerHTML='<i class="fas fa-file" style="margin-right:6px;"></i>'+e.name+" ("+(e.size/1024).toFixed(1)+" KB)"),e.name,e.size;var a=new FileReader;if(a.onload=function(r){sha256Binary(r.target.result).then(function(i){t&&(t.innerHTML='<i class="fas fa-file" style="margin-right:6px;"></i>'+e.name+" ("+(e.size/1024).toFixed(1)+' KB)<div style="font-size:0.7rem;color:var(--muted);font-family:monospace;margin-top:4px;">SHA-256: '+i.substring(0,32)+"...</div>")})},a.readAsArrayBuffer(e),e.type.startsWith("text/")||e.name.match(/\.(txt|csv|json|xml|md|html|log|yaml|yml)$/i)){var n=new FileReader;n.onload=function(r){document.getElementById("recordInput").value=r.target.result.substring(0,1e4)},n.readAsText(e)}else document.getElementById("recordInput").value="FILE: "+e.name+" | SIZE: "+(e.size/1024).toFixed(1)+" KB | Binary file — SHA-256 hash computed from raw bytes"}function $(){var e=document.getElementById("gapRadarChart"),t=document.getElementById("gapBarChart");if(!(!e||!t)){var a=document.getElementById("gapChartsRow");a&&(a.style.display="flex");var n,r;typeof ilsResults<"u"&&ilsResults&&ilsResults.elements&&Object.keys(ilsResults.elements).length>0?(n=Object.keys(ilsResults.elements),r=n.map(function(o){return ilsResults.elements[o]&&typeof ilsResults.elements[o].score=="number"?ilsResults.elements[o].score:0})):(n=["Supply Support","Maintenance Planning","Tech Data","Training","Config Mgmt","DMSMS","PHS&T","Reliability","Support Equipment","Manpower"],r=[72,58,85,44,91,35,67,78,52,63]),e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"radar",data:{labels:n.map(function(o){return o.replace(/_/g," ").replace(/\b\w/g,function(s){return s.toUpperCase()})}),datasets:[{label:"ILS Element Coverage %",data:r,backgroundColor:"rgba(0,170,255,0.12)",borderColor:"#00aaff",borderWidth:2,pointBackgroundColor:"#00aaff",pointBorderColor:"#fff",pointRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{r:{min:0,max:100,ticks:{display:!1},grid:{color:"rgba(255,255,255,0.06)"},angleLines:{color:"rgba(255,255,255,0.06)"},pointLabels:{color:"#8ea4b8",font:{size:10}}}},plugins:{legend:{display:!1}}}});var i=r.map(function(o){return o>=80?"#00cc66":o>=50?"#ffa500":"#ff4444"});t.__chartInstance&&t.__chartInstance.destroy(),t.__chartInstance=new Chart(t,{type:"bar",data:{labels:n.map(function(o){return o.replace(/_/g," ").replace(/\b\w/g,function(s){return s.toUpperCase()})}),datasets:[{label:"Score",data:r,backgroundColor:i,borderRadius:6,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{min:0,max:100,grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8"}},y:{ticks:{color:"#8ea4b8",font:{size:10}},grid:{display:!1}}},plugins:{legend:{display:!1}}}})}}function ne(){var e=document.getElementById("dmsmsPieChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"doughnut",data:{labels:["Active","At Risk","Obsolete","Resolved","Monitoring"],datasets:[{data:window._dmsmsChartData&&window._dmsmsChartData.reduce(function(t,a){return t+a},0)>0?window._dmsmsChartData:[45,18,12,20,5],backgroundColor:["#00cc66","#ffa500","#ff4444","#00aaff","#8ea4b8"],borderWidth:0,hoverOffset:8}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"55%",plugins:{legend:{position:"bottom",labels:{color:"#8ea4b8",padding:12,usePointStyle:!0,pointStyle:"circle",font:{size:11}}}}}}))}function oe(){var e=document.getElementById("readinessGauge");if(e){var t=.87;if(typeof window._readinessAo=="number"&&!isNaN(window._readinessAo))t=window._readinessAo;else{var a=document.getElementById("readinessAo")||document.getElementById("statAo");if(a&&a.textContent&&a.textContent!=="—"){var n=parseFloat(a.textContent);isNaN(n)||(t=n>1?n/100:n)}}e.__chartInstance&&e.__chartInstance.destroy();var r=Math.round(t*100),i=Math.min(100,r+8),o=Math.min(100,r-3),s=Math.min(100,r-10),d=Math.min(100,r+12),f=Math.min(100,r+2),c=Math.min(100,r+5),u=[i,o,s,d,f,c].map(function(m){return m>=90?"rgba(0,204,102,0.7)":m>=75?"rgba(0,170,255,0.6)":m>=60?"rgba(255,165,0,0.6)":"rgba(255,68,68,0.6)"});e.__chartInstance=new Chart(e,{type:"bar",data:{labels:["Personnel","Equipment","Supply","Training","Maintenance","C4ISR"],datasets:[{label:"Readiness %",data:[i,o,s,d,f,c],backgroundColor:u,borderColor:u.map(function(m){return m.replace("0.7","1").replace("0.6","1")}),borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(m){return m.parsed.y+"%"}}}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:11}},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:10},callback:function(m){return m+"%"}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0,max:100}}}})}}function ie(){var e=document.getElementById("complianceRadarChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"radar",data:{labels:["CMMC L2","NIST 800-171","DFARS 7012","ITAR","FIPS 140-2","FedRAMP","IL4/IL5"],datasets:[{label:"Current Posture",data:window._complianceScores&&window._complianceScores.reduce(function(t,a){return t+a},0)>0?window._complianceScores:[78,85,92,88,70,65,82],backgroundColor:"rgba(0,170,255,0.12)",borderColor:"#00aaff",borderWidth:2,pointBackgroundColor:"#00aaff",pointRadius:4},{label:"Target",data:[95,95,100,100,90,85,95],backgroundColor:"rgba(201,168,76,0.06)",borderColor:"rgba(201,168,76,0.5)",borderWidth:1,borderDash:[4,4],pointRadius:2}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{r:{min:0,max:100,ticks:{display:!1},grid:{color:"rgba(255,255,255,0.06)"},angleLines:{color:"rgba(255,255,255,0.06)"},pointLabels:{color:"#8ea4b8",font:{size:10}}}},plugins:{legend:{labels:{color:"#8ea4b8",usePointStyle:!0,font:{size:11}}}}}}))}function se(){var e=document.getElementById("roiLineChart");if(e){e.getAttribute("data-bp-rendered")&&e.removeAttribute("data-bp-rendered");var t=document.getElementById("hub-roi");if(t&&typeof Chart<"u"){var a=null;try{a=Chart.getChart(e)}catch{}if(a&&a.data&&a.data.labels&&a.data.labels.length>=20)return}if(e.__chartInstance)try{e.__chartInstance.destroy()}catch{}for(var n=parseFloat((document.getElementById("roiFTEs")||{}).value)||8,r=parseFloat((document.getElementById("roiRate")||{}).value)||145,i=parseFloat((document.getElementById("roiAudit")||{}).value)||25e4,o=parseFloat((document.getElementById("roiError")||{}).value)||8500,s=parseFloat((document.getElementById("roiIncidents")||{}).value)||35,d=parseFloat((document.getElementById("roiLicense")||{}).value)||12e4,f=n*2080*r*.65,c=s*o*.9,u=i*.7,m=f+c+u,p=[],v=["Q1","Q2","Q3","Q4","Q5","Q6","Q7","Q8","Q9","Q10","Q11","Q12","Q13","Q14","Q15","Q16","Q17","Q18","Q19","Q20"],b=1;b<=20;b++){var x=.2+.65*(1-Math.exp(-.18*b)),S=m/4*x,w=d/4,g=b>1?p[b-2]:0;p.push(Math.round(g+S-w))}e.__chartInstance=new Chart(e,{type:"line",data:{labels:v,datasets:[{label:"Cumulative ROI ($)",data:p,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.08)",fill:!0,tension:.3,borderWidth:2,pointBackgroundColor:"#00aaff",pointBorderColor:"#fff",pointRadius:5,pointHoverRadius:7},{label:"Break-Even Line",data:new Array(20).fill(0),borderColor:"rgba(255,255,255,0.2)",borderDash:[5,5],borderWidth:1,pointRadius:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8",callback:function(_){return"$"+(_/1e3).toFixed(0)+"K"}}},x:{grid:{display:!1},ticks:{color:"#8ea4b8"}}},plugins:{legend:{labels:{color:"#8ea4b8",usePointStyle:!0,font:{size:11}}}}}})}}function le(){var e=document.getElementById("riskHeatChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"bar",data:{labels:["Supply Chain","Cyber/Data","Obsolescence","Financial","Regulatory","Operational"],datasets:[{label:"Risk Score",data:window._riskChartScores&&window._riskChartScores.length===6?window._riskChartScores:[78,62,85,45,55,71],backgroundColor:function(t){var a=t.raw;return a>=75?"rgba(255,68,68,0.7)":a>=50?"rgba(255,165,0,0.7)":"rgba(0,204,102,0.7)"},borderRadius:6,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{min:0,max:100,grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8"}},y:{ticks:{color:"#8ea4b8",font:{size:11}},grid:{display:!1}}},plugins:{legend:{display:!1}}}}))}function G(){var e=document.getElementById("lifecyclePieChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"doughnut",data:{labels:["Acquisition","Sustainment (O&S)","DMSMS / Obsol.","Disposal","Personnel","Training"],datasets:[{data:window._lifecycleChartData&&window._lifecycleChartData.length===6?window._lifecycleChartData:[28,42,12,5,8,5],backgroundColor:["#00aaff","#c9a84c","#ff4444","#8ea4b8","#00cc66","#9b59b6"],borderWidth:0,hoverOffset:8}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"50%",plugins:{legend:{position:"bottom",labels:{color:"#8ea4b8",padding:12,usePointStyle:!0,pointStyle:"circle",font:{size:11}}}}}}))}function ce(){var e={"hub-analysis":{target:"ilsResult",charts:'<div class="row mt-3" id="gapChartsRow"><div class="col-md-6"><div class="chart-container"><div class="chart-title"><i class="fas fa-chart-pie"></i> ILS Element Coverage</div><canvas id="gapRadarChart" height="240"></canvas></div></div><div class="col-md-6"><div class="chart-container"><div class="chart-title"><i class="fas fa-chart-bar"></i> Element Scores</div><canvas id="gapBarChart" height="240"></canvas></div></div></div>'},"hub-dmsms":{target:null,charts:'<div class="chart-container mt-3" id="dmsmsChartArea"><div class="chart-title"><i class="fas fa-chart-pie"></i> Obsolescence Risk Distribution</div><canvas id="dmsmsPieChart" height="200"></canvas></div>'},"hub-readiness":{target:null,charts:'<div class="chart-container mt-3" style="max-width:100%" id="readinessGaugeArea"><div class="chart-title"><i class="fas fa-gauge-high"></i> Operational Availability</div><canvas id="readinessGauge" height="300"></canvas></div>'},"hub-compliance":{target:null,charts:'<div class="chart-container mt-3" id="complianceChartArea"><div class="chart-title"><i class="fas fa-shield-halved"></i> Compliance Framework Radar</div><canvas id="complianceRadarChart" height="250"></canvas></div>'},"hub-roi":{target:null,charts:'<div class="chart-container mt-3" id="roiChartArea"><div class="chart-title"><i class="fas fa-chart-line"></i> ROI Projection — 5 Year Cumulative</div><canvas id="roiLineChart" height="220"></canvas></div>'},"hub-risk":{target:null,charts:'<div class="chart-container mt-3" id="riskChartArea"><div class="chart-title"><i class="fas fa-triangle-exclamation"></i> Risk Category Assessment</div><canvas id="riskHeatChart" height="220"></canvas></div>'},"hub-lifecycle":{target:null,charts:'<div class="chart-container mt-3" id="lifecycleChartArea"><div class="chart-title"><i class="fas fa-chart-pie"></i> Total Ownership Cost Breakdown</div><canvas id="lifecyclePieChart" height="220"></canvas></div>'}};Object.keys(e).forEach(function(t){var a=e[t],n=document.getElementById(t);if(n&&!n.getAttribute("data-charts-injected")){var r=a.charts.match(/id="([^"]+)"/);if(r&&document.getElementById(r[1])){n.setAttribute("data-charts-injected","1");return}var i=n.querySelector(".demo-card");if(i){if(a.target){var o=document.getElementById(a.target);if(o){var s=document.createElement("div");s.innerHTML=a.charts,o.parentNode.insertBefore(s.firstElementChild,o.nextSibling),n.setAttribute("data-charts-injected","1");return}}var s=document.createElement("div");s.innerHTML=a.charts,i.appendChild(s.firstElementChild),n.setAttribute("data-charts-injected","1")}}})}var we=openILSTool;openILSTool=function(e){we(e),ce(),setTimeout(function(){e==="hub-analysis"&&ilsResults&&$(),e==="hub-dmsms"&&ne(),e==="hub-readiness"&&oe(),e==="hub-compliance"&&ie(),e==="hub-roi"&&se(),e==="hub-risk"&&le(),e==="hub-lifecycle"&&G()},300)};var Ce=switchHubTab;switchHubTab=function(e,t){Ce(e,t),ce(),setTimeout(function(){e==="hub-analysis"&&typeof ilsResults<"u"&&ilsResults&&$(),e==="hub-dmsms"&&ne(),e==="hub-readiness"&&oe(),e==="hub-compliance"&&ie(),e==="hub-roi"&&se(),e==="hub-risk"&&le(),e==="hub-lifecycle"&&G()},300)};var X=null;typeof showILSResults=="function"&&(X=showILSResults,showILSResults=function(){X.apply(this,arguments);var e=document.getElementById("gapChartsRow");e&&(e.style.display="flex"),setTimeout($,500)});function Ee(){var e=(document.getElementById("lifecycleProgram")||{}).value||"ddg51",t=parseFloat((document.getElementById("lcServiceLife")||{}).value)||30,a=parseFloat((document.getElementById("lcOpHours")||{}).value)||2500,n=parseFloat((document.getElementById("lcAcqCost")||{}).value)||85,r=parseFloat((document.getElementById("lcFleetSize")||{}).value)||20,i=parseFloat((document.getElementById("lcSustRate")||{}).value)||8,o=n*r,s=o*(i/100),d=s*t,f=.12+(t>25?.04:0),c=d*f,u=o*.05,m=d*.18,p=d*.08,v=o+d+c+u+m+p,b=a*r*t,x=b>0?v/b:0;function S(C){return C>=1e3?"$"+(C/1e3).toFixed(1)+"B":"$"+C.toFixed(0)+"M"}var w=function(C){return document.getElementById(C)};w("lcTotalCost")&&(w("lcTotalCost").textContent=S(v)),w("lcSustCost")&&(w("lcSustCost").textContent=S(d)),w("lcDmsmsCost")&&(w("lcDmsmsCost").textContent=S(c)),w("lcCostPerHr")&&(w("lcCostPerHr").textContent="$"+x.toFixed(0)+"/hr");var g=Math.round(o/v*100),_=Math.round(d/v*100),I=Math.round(c/v*100),l=Math.round(u/v*100),h=Math.round(m/v*100),E=Math.round(p/v*100);window._lifecycleChartData=[g,_,I,l,h,E];var L=w("lifecycleOutput");if(L){var y=window.S4_PLATFORMS&&S4_PLATFORMS[e]?S4_PLATFORMS[e].n:e.toUpperCase();L.innerHTML='<div style="background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:20px;margin-top:12px"><div class="section-label"><i class="fas fa-clock"></i> LIFECYCLE COST BREAKDOWN — '+y+'</div><div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;font-size:0.85rem;margin-bottom:16px"><div><span style="color:var(--steel)">Acquisition ('+g+'%)</span><br><strong style="color:#00aaff">'+S(o)+'</strong></div><div><span style="color:var(--steel)">Sustainment ('+_+'%)</span><br><strong style="color:#c9a84c">'+S(d)+'</strong></div><div><span style="color:var(--steel)">DMSMS/Obsol ('+I+'%)</span><br><strong style="color:#ff4444">'+S(c)+'</strong></div><div><span style="color:var(--steel)">Disposal ('+l+'%)</span><br><strong style="color:#8ea4b8">'+S(u)+'</strong></div><div><span style="color:var(--steel)">Personnel ('+h+'%)</span><br><strong style="color:#00cc66">'+S(m)+'</strong></div><div><span style="color:var(--steel)">Training ('+E+'%)</span><br><strong style="color:#9b59b6">'+S(p)+'</strong></div></div><hr style="border-color:var(--border);margin:12px 0"><div style="display:flex;justify-content:space-between;align-items:center"><div><span style="color:var(--steel);font-size:0.82rem">Total Ownership Cost</span><br><span style="font-size:1.5rem;font-weight:800;color:#00aaff">'+S(v)+'</span></div><div><span style="color:var(--steel);font-size:0.82rem">Cost per Op Hour</span><br><span style="font-size:1.1rem;font-weight:700;color:var(--accent)">$'+x.toFixed(0)+'/hr</span></div><div><span style="color:var(--steel);font-size:0.82rem">Fleet Size</span><br><span style="font-size:1.1rem;font-weight:700;color:#fff">'+r+" units × "+t+" yrs</span></div></div></div>"}typeof G=="function"&&setTimeout(G,300),typeof generateLifecycleActions=="function"&&generateLifecycleActions(e,v,c,d)}function _e(){var e=(document.getElementById("lifecycleProgram")||{}).value||"ddg51",t=window.S4_PLATFORMS&&S4_PLATFORMS[e]?S4_PLATFORMS[e].n:e.toUpperCase(),a=parseFloat((document.getElementById("lcServiceLife")||{}).value)||30,n=parseFloat((document.getElementById("lcAcqCost")||{}).value)||85,r=parseFloat((document.getElementById("lcFleetSize")||{}).value)||20,i=parseFloat((document.getElementById("lcSustRate")||{}).value)||8,o=n*r,s=o*(i/100)*a,d=s*(.12+(a>25?.04:0)),f=o+s+d+o*.05+s*.18+s*.08,c=`S4 LEDGER — LIFECYCLE COST REPORT
================================

Platform: `+t+`
Fleet Size: `+r+` units
Service Life: `+a+` years
Sustainment Rate: `+i+`%

Acquisition: $`+o.toFixed(0)+`M
Sustainment: $`+s.toFixed(0)+`M
DMSMS/Obsolescence: $`+d.toFixed(0)+`M
Total Ownership Cost: $`+f.toFixed(0)+`M

Generated: `+new Date().toISOString()+`
`,u=new Blob([c],{type:"text/plain"}),m=document.createElement("a");m.href=URL.createObjectURL(u),m.download="S4_Lifecycle_"+t.replace(/\s+/g,"_")+"_"+new Date().toISOString().substring(0,10)+".txt",m.click(),URL.revokeObjectURL(m.href),typeof s4Notify=="function"&&s4Notify("Exported","Lifecycle cost report downloaded.","success")}async function xe(){var e=(document.getElementById("lifecycleProgram")||{}).value||"ddg51",t=window.S4_PLATFORMS&&S4_PLATFORMS[e]?S4_PLATFORMS[e].n:e.toUpperCase(),a=parseFloat((document.getElementById("lcServiceLife")||{}).value)||30,n=parseFloat((document.getElementById("lcAcqCost")||{}).value)||85,r=parseFloat((document.getElementById("lcFleetSize")||{}).value)||20,i=parseFloat((document.getElementById("lcSustRate")||{}).value)||8,o=n*r,s=o*(i/100)*a,d=s*(.12+(a>25?.04:0)),f=o+s+d+o*.05+s*.18+s*.08,c="Lifecycle Cost | Program: "+t+" | Fleet: "+r+" | TOC: $"+f.toFixed(0)+"M | Date: "+new Date().toISOString(),u=await sha256(c);showAnchorAnimation(u,"Lifecycle Cost Report","CUI"),stats.anchored++,stats.types.add("LIFECYCLE_COST"),stats.slsFees=Math.round((stats.slsFees+.01)*100)/100,updateStats(),saveStats();var m=await _anchorToXRPL(u,"LIFECYCLE_COST",c.substring(0,100)),p={hash:u,type:"LIFECYCLE_COST",branch:"JOINT",timestamp:new Date().toISOString(),label:"Lifecycle Cost — "+t,txHash:m.txHash};sessionRecords.push(p),saveLocalRecord({hash:u,record_type:"LIFECYCLE_COST",record_label:"Lifecycle Cost — "+t,branch:"JOINT",timestamp:new Date().toISOString(),timestamp_display:new Date().toISOString().replace("T"," ").substring(0,19)+" UTC",fee:.01,tx_hash:m.txHash,system:"Lifecycle Cost Estimator",explorer_url:m.explorerUrl,network:m.network}),addToVault({hash:u,txHash:m.txHash,type:"LIFECYCLE_COST",label:"Lifecycle Cost — "+t,branch:"JOINT",icon:'<i class="fas fa-clock"></i>',content:c.substring(0,100),encrypted:!1,timestamp:new Date().toISOString(),source:"Lifecycle Cost Estimator",fee:.01,explorerUrl:m.explorerUrl,network:m.network}),updateTxLog(),_updateDemoSlsBalance(),setTimeout(function(){document.getElementById("animStatus").innerHTML='<i class="fas fa-check-circle" style="color:var(--accent)"></i> Lifecycle report anchored!',document.getElementById("animStatus").style.color="#00aaff"},2200),await new Promise(function(v){setTimeout(v,3200)}),hideAnchorAnimation(),typeof s4Notify=="function"&&s4Notify("Anchored","Lifecycle cost report anchored to XRPL.","success")}(function(){function e(n){var r=document.getElementById(n);if(!(!r||r.dataset.uxDone)){r.dataset.uxDone="1",r.querySelectorAll("details").forEach(function(l){l.removeAttribute("style")}),r.querySelectorAll("details summary").forEach(function(l){l.removeAttribute("style")}),r.querySelectorAll("details > div").forEach(function(l){l.removeAttribute("style")}),r.querySelectorAll("h3 > i[style], h4 > i[style]").forEach(function(l){l.removeAttribute("style")});var i=r.querySelectorAll(".demo-card");i.forEach(function(l){var h=l.querySelector("h3, h4");if(h){var E=h.nextElementSibling,L=l.querySelector(".hub-tool-header");L&&(E=L.nextElementSibling),E&&E.tagName==="P"&&E.getAttribute("style")&&E.removeAttribute("style")}}),r.querySelectorAll("button[style]").forEach(function(l){if(!(l.closest(".ils-dropzone")||l.closest(".post-actions")||l.closest(".post-action-btn"))&&l.style.display!=="none"){var h=l.textContent.toLowerCase(),E=h.includes("anchor")||h.includes("xrpl"),L=h.includes("export")||h.includes("download")||h.includes("generate"),y=h.includes("run ")||h.includes("analyze")||h.includes("calculate"),C=h.includes("clear")||h.includes("delete");C||(l.innerHTML,l.getAttribute("onclick"),E||y?(l.removeAttribute("style"),l.className="btn-anchor"):L&&(l.removeAttribute("style"),l.className="btn-export"))}}),r.querySelectorAll("div[style]").forEach(function(l){var h=l.getAttribute("style")||"";if(h.includes("display:flex")&&h.includes("gap:10")&&h.includes("flex-wrap:wrap")&&!l.classList.contains("ils-dropzone")&&!l.querySelector(".ils-dropzone")&&!l.closest(".post-actions")){var E=l.querySelectorAll("button");E.length>0&&(l.className="tool-actions-bar",l.removeAttribute("style"))}}),i.forEach(function(l){l.querySelectorAll(":scope > label, :scope > .row > .col-md-6 > label");var h=l.querySelector(":scope > label");if(h&&!h.previousElementSibling?.classList?.contains("section-label")){var E=document.createElement("div");E.className="section-label",E.innerHTML='<i class="fas fa-sliders"></i> CONFIGURATION';var L=document.createElement("hr");L.className="section-divider",h.parentNode.insertBefore(L,h),h.parentNode.insertBefore(E,L)}var y=l.querySelector('[id$="Results"], [id$="Output"], [id$="result"], [id$="Result"]');if(y&&!y.previousElementSibling?.classList?.contains("section-label")){var C=document.createElement("div");C.className="section-label",C.innerHTML='<i class="fas fa-chart-bar"></i> RESULTS';var D=document.createElement("hr");D.className="section-divider",y.parentNode.insertBefore(D,y),y.parentNode.insertBefore(C,D)}var z=l.querySelector(".tool-actions-bar");if(z&&!z.previousElementSibling?.classList?.contains("section-label")){var J=document.createElement("div");J.className="section-label",J.innerHTML='<i class="fas fa-bolt"></i> ACTIONS',z.parentNode.insertBefore(J,z)}});var o=r.querySelector(".demo-card");if(o){var s=n==="hub-analysis"||n==="hub-actions";if(!s){for(var d=o.querySelectorAll(":scope > .row"),f=null,c=0;c<d.length;c++){var u=d[c];if(u.querySelectorAll(".stat-mini").length>=3){f=u;break}}if(f){var m=o.querySelector(".hub-tool-header")||o.querySelector("h3, h4");if(m){var p=m;f.style.cssText="",f.classList.add("mb-3"),p.parentNode.insertBefore(f,p.nextSibling)}}}if(n==="hub-actions"){var v=o.querySelector(".col-lg-8");if(v){var b=v.querySelector(".demo-card");if(b){for(var x=null,S=b.querySelectorAll(":scope > .row"),w=0;w<S.length;w++)if(S[w].querySelectorAll(".stat-mini").length>=3){x=S[w];break}if(x){var g=b.querySelector("h3");g&&(x.style.cssText="",x.classList.add("mb-3"),g.parentNode.insertBefore(x,g.nextSibling))}}}}r.querySelectorAll("input[style], select[style]").forEach(function(l){l.type==="file"||l.type==="hidden"||l.style.display!=="none"&&l.removeAttribute("style")});var _=r.querySelectorAll(".chart-container");_.forEach(function(l){l.style.display="block"});var I=r.querySelector("#gapChartsRow");I&&(I.style.display="flex")}}}var t=openILSTool;openILSTool=function(n){t(n),setTimeout(function(){e(n)},100)};var a=switchHubTab;switchHubTab=function(n,r){a(n,r),setTimeout(function(){e(n)},100)},document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){document.querySelectorAll('.ils-hub-panel.active, .ils-hub-panel[style*="display:block"], .ils-hub-panel[style*="display: block"]').forEach(function(n){e(n.id)})},2500)})})();document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector('a[href="#tabILS"]');e&&e.addEventListener("shown.bs.tab",function(){updateAiContext(currentHubPanel||"hub-analysis")})});var T,A;(function(){var t=new Date;T=t.getFullYear(),A=t.getMonth()})();function Ie(e){A+=e,A>11&&(A=0,T++),A<0&&(A=11,T--),j()}function j(){var e=document.getElementById("actionCalendarGrid"),t=document.getElementById("calMonthLabel");if(!(!e||!t)){if(typeof T>"u"||T===void 0||T===null){var a=new Date;T=a.getFullYear(),A=a.getMonth()}var n=["January","February","March","April","May","June","July","August","September","October","November","December"];t.textContent=n[A]+" "+T;var r=new Date(T,A,1).getDay(),i=new Date(T,A+1,0).getDate(),o=new Date,s=o.getFullYear()===T&&o.getMonth()===A,d={};try{var f=typeof s4ActionItems<"u"&&s4ActionItems.length>0?s4ActionItems:JSON.parse(localStorage.getItem("s4ActionItems")||"[]");f.forEach(function(g){var _=g.due||g.schedule||"";if(_){var I=new Date(_);if(!isNaN(I.getTime())&&I.getFullYear()===T&&I.getMonth()===A){var l=I.getDate();d[l]||(d[l]=[]),d[l].push(g)}}})}catch{}if(Object.keys(d).length===0){var c=[{day:3,title:"DMSMS Review — AN/SPS-49 Radar",severity:"critical"},{day:7,title:"ILS Gap Analysis — DDG-51 FY25",severity:"warning"},{day:10,title:"Parts Order Deadline — CVN-78",severity:"critical"},{day:12,title:"Compliance Audit Prep",severity:"info"},{day:15,title:"Warranty Expiry — GE LM2500",severity:"warning"},{day:18,title:"Lifecycle Cost Review",severity:"info"},{day:21,title:"Risk Assessment Update",severity:"warning"},{day:24,title:"Readiness Report Due",severity:"critical"},{day:27,title:"Obsolescence Check — MIL-STD-1553",severity:"info"}];c.forEach(function(g){g.day<=i&&(d[g.day]||(d[g.day]=[]),d[g.day].push(g))})}var u="";["Su","Mo","Tu","We","Th","Fr","Sa"].forEach(function(g){u+='<div style="padding:4px;font-weight:700;color:var(--steel);font-size:0.7rem">'+g+"</div>"});for(var m=0;m<r;m++)u+='<div style="padding:6px"></div>';for(var p=1;p<=i;p++){var v=s&&p===o.getDate(),b=d[p],x=v?"rgba(0,170,255,0.2)":b?"rgba(0,170,255,0.06)":"var(--surface)",S=v?"1px solid var(--accent)":b?"1px solid rgba(0,170,255,0.15)":"1px solid var(--border)",w="";b&&b.forEach(function(g){var _=g.severity==="critical"?"#ff3333":g.severity==="warning"?"#ffa500":"#00aaff";w+='<span style="display:inline-block;width:4px;height:4px;border-radius:50%;background:'+_+';margin:0 1px"></span>'}),u+='<div onclick="showCalDay('+p+')" style="padding:4px 2px;background:'+x+";border:"+S+";border-radius:4px;cursor:"+(b?"pointer":"default")+';min-height:32px"><div style="color:'+(v?"#00aaff":"#fff")+";font-weight:"+(v?"800":"400")+'">'+p+"</div>"+(w?'<div style="margin-top:2px">'+w+"</div>":"")+"</div>"}e.innerHTML=u}}function Te(e){var t=document.getElementById("calDayDetail");if(t){var a={};try{var r=typeof s4ActionItems<"u"&&s4ActionItems.length>0?s4ActionItems:JSON.parse(localStorage.getItem("s4ActionItems")||"[]");r.forEach(function(d){var f=d.due||d.schedule||"";if(f){var c=new Date(f);if(!isNaN(c.getTime())&&c.getFullYear()===T&&c.getMonth()===A){var u=c.getDate();a[u]||(a[u]=[]),a[u].push(d)}}})}catch{}var n={3:[{title:"DMSMS Review — AN/SPS-49 Radar",severity:"critical",owner:"NAVSEA 04"}],7:[{title:"ILS Gap Analysis — DDG-51 FY25",severity:"warning",owner:"PMS 400"}],10:[{title:"Parts Order Deadline — CVN-78",severity:"critical",owner:"PMS 312"}],12:[{title:"Compliance Audit Prep",severity:"info",owner:"ILS Manager"}],15:[{title:"Warranty Expiry — GE LM2500",severity:"warning",owner:"PMS 300"}],18:[{title:"Lifecycle Cost Review",severity:"info",owner:"CAPE"}],21:[{title:"Risk Assessment Update",severity:"warning",owner:"PMS 400"}],24:[{title:"Readiness Report Due",severity:"critical",owner:"TYCOM"}],27:[{title:"Obsolescence Check — MIL-STD-1553",severity:"info",owner:"NAVSEA 04"}]},r=a[e]||n[e]||[];if(r.length===0){t.style.display="none";return}var i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o='<div style="font-weight:700;color:#fff;margin-bottom:6px"><i class="fas fa-calendar-day" style="color:var(--accent);margin-right:4px"></i>'+i[A]+" "+e+", "+T+"</div>";r.forEach(function(s){var d=s.severity==="critical"?"#ff3333":s.severity==="warning"?"#ffa500":"#00aaff";o+='<div style="padding:6px 8px;background:rgba(0,0,0,0.2);border-left:3px solid '+d+';border-radius:4px;margin-bottom:4px"><div style="font-weight:600;color:#fff;font-size:0.8rem">'+(s.title||"Action Item")+"</div>"+(s.owner?'<div style="font-size:0.72rem;color:var(--steel)">Owner: '+s.owner+"</div>":"")+"</div>"}),t.innerHTML=o,t.style.display="block"}}function K(){var e=document.getElementById("actionCalendarGrid"),t=document.getElementById("calMonthLabel");if(!e||!t){setTimeout(K,500);return}j(),(!e.innerHTML||e.innerHTML.trim()==="")&&setTimeout(j,300)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){setTimeout(K,800)}):setTimeout(K,800);(function(){var e=new MutationObserver(function(a){a.forEach(function(n){if(n.type==="attributes"&&n.attributeName==="style"){var r=n.target;r.id==="hub-actions"&&r.style.display!=="none"&&setTimeout(j,150)}})}),t=document.getElementById("hub-actions");t?e.observe(t,{attributes:!0,attributeFilter:["style"]}):document.addEventListener("DOMContentLoaded",function(){var a=document.getElementById("hub-actions");a&&e.observe(a,{attributes:!0,attributeFilter:["style"]})})})();window.anchorLifecycle=xe;window.calcLifecycle=Ee;window.changeCalMonth=Ie;window.exportLifecycle=_e;window.handleFileSelect=Se;window.loadPerformanceMetrics=Q;window.offlineClearQueue=he;window.offlineQueueHash=pe;window.offlineRemoveItem=ve;window.handleFileDrop=be;window.offlineSyncAll=ye;window.showCalDay=Te;(function(){var e={lcp:null,fid:null,cls:0,inp:null,ttfb:null,entries:[]},t=window.S4=window.S4||{};t.vitals=e;function a(f,c){e.entries.push({name:f,value:Math.round(c*100)/100,ts:Date.now()})}try{var n=performance.getEntriesByType("navigation");n&&n[0]&&(e.ttfb=Math.round(n[0].responseStart),a("TTFB",e.ttfb))}catch{}try{if("PerformanceObserver"in window){var r=new PerformanceObserver(function(f){var c=f.getEntries(),u=c[c.length-1];u&&(e.lcp=Math.round(u.startTime),a("LCP",e.lcp))});r.observe({type:"largest-contentful-paint",buffered:!0})}}catch{}try{if("PerformanceObserver"in window){var i=new PerformanceObserver(function(f){var c=f.getEntries();c[0]&&(e.fid=Math.round(c[0].processingStart-c[0].startTime),a("FID",e.fid),i.disconnect())});i.observe({type:"first-input",buffered:!0})}}catch{}try{if("PerformanceObserver"in window){var o=new PerformanceObserver(function(f){var c=f.getEntries();c.forEach(function(u){u.hadRecentInput||(e.cls+=u.value)}),e.cls=Math.round(e.cls*1e4)/1e4,a("CLS",e.cls)});o.observe({type:"layout-shift",buffered:!0})}}catch{}try{if("PerformanceObserver"in window){var s=new PerformanceObserver(function(f){var c=f.getEntries();c.forEach(function(u){var m=u.duration;(e.inp===null||m>e.inp)&&(e.inp=Math.round(m),a("INP",e.inp))})});s.observe({type:"event",buffered:!0,durationThreshold:40})}}catch{}t.vitals.summary=function(){return{TTFB:e.ttfb!==null?e.ttfb+"ms":"n/a",LCP:e.lcp!==null?e.lcp+"ms":"n/a",FID:e.fid!==null?e.fid+"ms":"n/a",CLS:e.cls.toFixed(4),INP:e.inp!==null?e.inp+"ms":"n/a",grade:d()}};function d(){var f=0,c=0;if(e.lcp!==null&&(f+=e.lcp<=2500?1:e.lcp<=4e3?.5:0,c++),e.fid!==null&&(f+=e.fid<=100?1:e.fid<=300?.5:0,c++),e.cls!==null&&(f+=e.cls<=.1?1:e.cls<=.25?.5:0,c++),e.inp!==null&&(f+=e.inp<=200?1:e.inp<=500?.5:0,c++),c===0)return"n/a";var u=Math.round(f/c*100);return u>=90?"Good":u>=50?"Needs Improvement":"Poor"}})();
