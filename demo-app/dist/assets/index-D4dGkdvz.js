import"./engine-CoWSZTt5.js";import"./enhancements-B4X37-EE.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const u of d.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function r(o){const d={};return o.integrity&&(d.integrity=o.integrity),o.referrerPolicy&&(d.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?d.credentials="include":o.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function n(o){if(o.ep)return;o.ep=!0;const d=r(o);fetch(o.href,d)}})();document.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()},!1);document.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation()},!1);window.S4=window.S4||{version:"5.12.0",modules:{},register:function(e,t){this.modules[e]=t},getModule:function(e){return this.modules[e]||null}};S4.i18n={locale:(navigator.language||"en").split("-")[0],catalogs:{en:{"app.name":"S4 Ledger","nav.platform":"Platform","nav.useCases":"Use Cases","nav.pricing":"Pricing","nav.company":"Company","nav.docs":"Docs","nav.requestDemo":"Request Demo","anchor.title":"Anchor Channel","anchor.placeholder":"Or paste/type your defense logistics record here...","anchor.button":"Anchor Record","verify.title":"Verify Channel","verify.placeholder":"Paste the original defense record content here...","vault.title":"Audit Record Vault","vault.empty":"No anchored records yet. Records will appear here automatically as you anchor them.","vault.search":"Search records by type, hash, content...","vault.exportCSV":"Export CSV","vault.exportXLSX":"Export XLSX","vault.reverifyAll":"Re-Verify All","vault.clear":"Clear Vault","toast.missingContent":"Please enter record content.","toast.noProgram":"Please select a program first.","toast.noAnalysis":"Run analysis first.","toast.copied":"Copied to clipboard!","toast.exported":"records exported.","toast.verified":"records re-verified.","shortcuts.title":"Keyboard Shortcuts","search.placeholder":"Search records, vault, tools, documents...","search.noResults":"No results found"}},setLocale:function(e){this.locale=e},t:function(e){var t=this.catalogs[this.locale]||this.catalogs.en;return t[e]||this.catalogs.en[e]||e}};window.S4.t=S4.i18n.t.bind(S4.i18n);window.onerror=function(e,t,r,n,o){return!0};window.addEventListener("unhandledrejection",function(e){});(function(){var e=document.createElement("div");S4.sanitize=function(a){return typeof a!="string"?"":(e.textContent=a,e.innerHTML)},S4.sanitizeHTML=function(a){if(typeof a!="string")return"";var s=document.createElement("div");s.innerHTML=a;for(var i=s.querySelectorAll("script,iframe,object,embed,form"),l=i.length-1;l>=0;l--)i[l].remove();for(var c=s.querySelectorAll("*"),f=0;f<c.length;f++)for(var m=c[f].attributes,p=m.length-1;p>=0;p--)(m[p].name.startsWith("on")||m[p].value.indexOf("javascript:")===0)&&c[f].removeAttribute(m[p].name);return s.innerHTML};var t=1800*1e3,r=null,n=!1;S4.sessionTimeout=t;function o(){n||(clearTimeout(r),r=setTimeout(function(){n=!0,S4.sessionLocked=!0;var a=document.getElementById("s4SessionLockOverlay");a&&(a.style.display="flex"),typeof s4Notify=="function"&&s4Notify("Session Locked","Inactive for 30 minutes. Click to resume.","warning")},t))}S4.resumeSession=function(){n=!1,S4.sessionLocked=!1;var a=document.getElementById("s4SessionLockOverlay");a&&(a.style.display="none"),o()},["mousemove","mousedown","keydown","scroll","touchstart"].forEach(function(a){document.addEventListener(a,o,{passive:!0})}),o();var d=null;S4.crypto={_getKey:async function(){if(d)return d;var a=sessionStorage.getItem("s4_enc_key");if(a){var s=Uint8Array.from(atob(a),function(l){return l.charCodeAt(0)});return d=await crypto.subtle.importKey("raw",s,"AES-GCM",!0,["encrypt","decrypt"]),d}d=await crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);var i=await crypto.subtle.exportKey("raw",d);return sessionStorage.setItem("s4_enc_key",btoa(String.fromCharCode.apply(null,new Uint8Array(i)))),d},encrypt:async function(a){var s=await this._getKey(),i=crypto.getRandomValues(new Uint8Array(12)),l=new TextEncoder().encode(a),c=await crypto.subtle.encrypt({name:"AES-GCM",iv:i},s,l),f=new Uint8Array(i.length+c.byteLength);return f.set(i),f.set(new Uint8Array(c),i.length),btoa(String.fromCharCode.apply(null,f))},decrypt:async function(a){var s=await this._getKey(),i=Uint8Array.from(atob(a),function(m){return m.charCodeAt(0)}),l=i.slice(0,12),c=i.slice(12),f=await crypto.subtle.decrypt({name:"AES-GCM",iv:l},s,c);return new TextDecoder().decode(f)}},S4.auditChain={computeChainHash:async function(a,s){var i=(s||"0".repeat(64))+"|"+a.hash+"|"+a.timestamp,l=new TextEncoder().encode(i),c=await crypto.subtle.digest("SHA-256",l);return Array.from(new Uint8Array(c)).map(function(f){return f.toString(16).padStart(2,"0")}).join("")},verifyChain:async function(a){if(!a||a.length===0)return{valid:!0,errors:[]};for(var s=[],i="0".repeat(64),l=0;l<a.length;l++)if(a[l].chainHash){var c=await this.computeChainHash(a[l],i);a[l].chainHash!==c&&s.push({index:l,expected:c,got:a[l].chainHash,record:a[l].label||a[l].type}),i=a[l].chainHash}else i=a[l].hash||i;return{valid:s.length===0,errors:s}}};var u={};S4.rateLimit=function(a,s){s=s||30;var i=Date.now();return u[a]||(u[a]=[]),u[a]=u[a].filter(function(l){return i-l<6e4}),u[a].length>=s?!1:(u[a].push(i),!0)},S4.csrf=(function(){var a=null;function s(){var i=new Uint8Array(32);return crypto.getRandomValues(i),Array.from(i,function(l){return l.toString(16).padStart(2,"0")}).join("")}return{getToken:function(){return a||(a=s()),a},refresh:function(){return a=s(),a},validate:function(i){return i&&i===a},addToHeaders:function(i){return i=i||{},i["X-CSRF-Token"]=this.getToken(),i}}})(),S4.zkVerify=async function(a){var s=typeof s4Vault<"u"&&s4Vault.some(function(m){return m.hash===a}),i={timestamp:new Date().toISOString(),claim:"Record with hash prefix "+a.substring(0,8)+"... exists in vault",verified:s,proofHash:null},l=crypto.getRandomValues(new Uint8Array(16)),c=new TextEncoder().encode(JSON.stringify(i)+Array.from(l).join("")),f=await crypto.subtle.digest("SHA-256",c);return i.proofHash=Array.from(new Uint8Array(f)).map(function(m){return m.toString(16).padStart(2,"0")}).join(""),i},S4.register("security",{version:"1.0.0",features:["xss-sanitizer","session-timeout","encrypted-storage","audit-chain","rate-limiter","zk-verify"]})})();sessionStorage.getItem("s4_entered")==="1"&&(document.getElementById("platformLanding").style.display="none",document.querySelector(".hero").style.display="none",document.getElementById("platformWorkspace").style.display="block");document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector('a[href="#tabWallet"]');e&&e.addEventListener("shown.bs.tab",function(){var t=document.getElementById("demoPanel");t&&(t.style.display="block")}),document.querySelectorAll('.nav-link[data-bs-toggle="pill"]').forEach(function(t){t.getAttribute("href")!=="#tabWallet"&&t.addEventListener("shown.bs.tab",function(){var r=document.getElementById("demoPanel");r&&(r.style.display="none")})})});window.addEventListener("scroll",function(){var e=window.scrollY,t=document.documentElement.scrollHeight-window.innerHeight,r=document.getElementById("scrollProgress");r&&(r.style.width=(t>0?e/t*100:0)+"%");var n=document.getElementById("backToTop");n&&(e>400?(n.style.opacity="1",n.style.visibility="visible"):(n.style.opacity="0",n.style.visibility="hidden"))});var Me=new IntersectionObserver(function(e){e.forEach(function(t){t.isIntersecting&&t.target.classList.add("visible")})},{threshold:.1});document.querySelectorAll(".reveal-demo").forEach(function(e){Me.observe(e)});function fe(){const e=JSON.parse(localStorage.getItem("s4_wallet")||"null"),t=document.getElementById("walletNoWallet"),r=document.getElementById("walletCredentials");if(!e||!e.wallet){t&&(t.style.display="block"),r&&(r.style.display="none");return}t&&(t.style.display="none"),r&&(r.style.display="block"),document.getElementById("walletAddress").textContent=e.wallet.address,document.getElementById("seedRevealed").textContent=e.wallet.seed;const n=e.wallet.network==="mainnet"?"https://livenet.xrpl.org/accounts/":"https://testnet.xrpl.org/accounts/";document.getElementById("demoWalletExplorer").href=n+e.wallet.address,me(e.wallet.address)}async function me(e){try{const i=await(await fetch("/api/wallet/balance?address="+encodeURIComponent(e))).json();if(i.error){document.getElementById("walletSLSBalance").textContent="0",document.getElementById("walletAnchors").textContent="0",document.getElementById("walletXRP").textContent="0";return}document.getElementById("walletSLSBalance").textContent=parseFloat(i.sls_balance).toLocaleString(),document.getElementById("walletSLSUSD").textContent=(parseFloat(i.sls_balance)*i.sls_price_usd).toFixed(2),document.getElementById("walletAnchors").textContent=i.anchors_available.toLocaleString(),document.getElementById("walletXRP").textContent=i.xrp_balance.toFixed(2),document.getElementById("walletNetwork").textContent="XRPL "+i.network.charAt(0).toUpperCase()+i.network.slice(1)}catch{if(_demoSession&&_demoSession.subscription){var t=_demoSession.subscription.sls_allocation||25e3,r=typeof stats<"u"&&stats.slsFees||0,n=Math.round((t-r)*100)/100,o=document.getElementById("walletSLSBalance");o&&(o.textContent=n.toLocaleString(void 0,{maximumFractionDigits:2}));var d=document.getElementById("walletAnchors");d&&(d.textContent=Math.floor(n/.01).toLocaleString());var u=document.getElementById("walletXRP");u&&(u.textContent="12.00");var a=document.getElementById("walletNetwork");a&&(a.textContent="XRPL Mainnet (Demo)")}}}function Re(){const e=document.getElementById("seedMasked"),t=document.getElementById("seedRevealed"),r=document.getElementById("seedToggleBtn");t.style.display==="none"?(t.style.display="inline",e.style.display="none",r.innerHTML='<i class="fas fa-eye-slash"></i> Hide'):(t.style.display="none",e.style.display="inline",r.innerHTML='<i class="fas fa-eye"></i> Show')}function Oe(e){const t=document.getElementById(e).textContent;navigator.clipboard.writeText(t).then(()=>{const r=document.getElementById(e).parentElement.querySelector("button"),n=r.innerHTML;r.innerHTML='<i class="fas fa-check"></i>',setTimeout(()=>{r.innerHTML=n},1200)})}function Pe(e,t){document.getElementById("slsUsdInput").value=e,pe(),document.querySelectorAll(".sls-amt-btn").forEach(r=>{r.style.borderColor="var(--border)",r.style.background="var(--surface)",r.style.color="var(--steel)"}),t&&(t.style.borderColor="rgba(0,170,255,0.5)",t.style.background="rgba(0,170,255,0.08)",t.style.color="var(--accent)")}function pe(){const e=parseFloat(document.getElementById("slsUsdInput").value)||0,t=Math.round(e/.01);document.getElementById("slsPreviewTokens").textContent=t.toLocaleString()+" Credits",document.getElementById("slsPreviewAnchors").textContent=(t*100).toLocaleString()}async function Fe(){const e=JSON.parse(localStorage.getItem("s4_wallet")||"null"),t=document.getElementById("buySLSResult"),r=document.getElementById("buySLSBtn");if(!e||!e.wallet){t.style.display="block",t.style.background="rgba(255,51,51,0.08)",t.style.border="1px solid rgba(255,51,51,0.2)",t.style.color="#ff6b6b",t.innerHTML='<i class="fas fa-exclamation-circle" style="margin-right:6px"></i>Please <a href="/s4-login/" style="color:var(--accent)">create an account</a> first to get a wallet.';return}const n=parseFloat(document.getElementById("slsUsdInput").value)||0;if(n<=0){t.style.display="block",t.style.background="rgba(255,51,51,0.08)",t.style.border="1px solid rgba(255,51,51,0.2)",t.style.color="#ff6b6b",t.textContent="Please enter a valid amount.";return}r.disabled=!0,r.innerHTML='<i class="fas fa-spinner fa-spin"></i> Processing...',t.style.display="none";try{const d=await(await fetch("/api/wallet/buy-sls",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({wallet_address:e.wallet.address,usd_amount:n,payment_method:"card"})})).json();d.error?(t.style.display="block",t.style.background="rgba(255,51,51,0.08)",t.style.border="1px solid rgba(255,51,51,0.2)",t.style.color="#ff6b6b",t.innerHTML='<i class="fas fa-exclamation-circle" style="margin-right:6px"></i>'+d.error):(t.style.display="block",t.style.background="rgba(0,170,255,0.2)",t.style.border="1px solid rgba(0,170,255,0.2)",t.style.color="#00aaff",t.innerHTML='<i class="fas fa-check-circle" style="margin-right:6px"></i>Purchased '+parseFloat(d.purchase.sls_received).toLocaleString()+" Credits for $"+d.purchase.usd_paid.toFixed(2)+'! <a href="'+d.explorer_url+'" target="_blank" style="color:var(--accent);margin-left:8px">View TX <i class="fas fa-external-link-alt" style="font-size:0.7rem"></i></a>',me(e.wallet.address))}catch(o){t.style.display="block",t.style.background="rgba(255,51,51,0.08)",t.style.border="1px solid rgba(255,51,51,0.2)",t.style.color="#ff6b6b",t.innerHTML='<i class="fas fa-exclamation-circle" style="margin-right:6px"></i>Network error: '+o.message}r.disabled=!1,r.innerHTML='<i class="fas fa-credit-card" style="margin-right:6px"></i> Purchase with Card'}function De(e){document.querySelectorAll(".chart-range-btn").forEach(n=>{n.style.background="var(--surface)",n.style.border="1px solid var(--border)",n.style.color="var(--steel)",n.style.fontWeight="400"});const t=document.getElementById("chart"+e.charAt(0).toUpperCase()+e.slice(1));t&&(t.style.background="rgba(26,58,92,0.2)",t.style.border="1px solid rgba(201,168,76,0.3)",t.style.color="#00aaff",t.style.fontWeight="700");const r=document.getElementById("chartOverlay");r&&(r.querySelector("p").textContent="Showing "+e+" usage data. Chart populates as records are anchored.")}setTimeout(function(){var e=document.getElementById("platformWorkspace");e&&e.style.display==="block"&&typeof loadPerformanceMetrics=="function"&&loadPerformanceMetrics().catch(function(t){})},2e3);document.addEventListener("shown.bs.tab",function(e){e.target.getAttribute("href")==="#tabWallet"&&fe()});window.location.hash==="#tabWallet"&&document.addEventListener("DOMContentLoaded",()=>setTimeout(fe,500));window.copyWalletField=Oe;window.handleBuySLS=Fe;window.setChartRange=De;window.setSLSAmount=Pe;window.toggleSeed=Re;window.updateSLSPreview=pe;var F=0,ye=localStorage.getItem("s4_selected_tier")||"starter",G={pilot:{label:"Pilot (Free)",sls:100,price:"Free"},starter:{label:"Starter ($999/mo)",sls:25e3,price:"$999/mo"},professional:{label:"Professional ($2,499/mo)",sls:1e5,price:"$2,499/mo"},enterprise:{label:"Enterprise ($9,999/mo)",sls:5e5,price:"$9,999/mo"}};function ze(){var e=document.getElementById("onboardOverlay");e&&(e.style.display="flex",typeof _s4TrapFocus=="function"&&_s4TrapFocus(e)),F=0,he()}function ve(){var e=document.getElementById("onboardOverlay");e&&(e.style.display="none"),typeof _s4ReleaseFocusTrap=="function"&&_s4ReleaseFocusTrap(),sessionStorage.setItem("s4_onboard_done","1"),setTimeout(function(){typeof _currentRole<"u"&&!_currentRole&&typeof showRoleSelector=="function"&&showRoleSelector()},500),localStorage.setItem("s4_selected_tier",ye),_demoSession=null,typeof _initDemoSession=="function"&&_initDemoSession()}function He(){if(F++,F>4){ve();return}he(),F===1&&qe(),F===2&&Ne()}function he(){for(var e=0;e<=4;e++){var t=document.getElementById("onboardStep"+e);t&&t.classList.toggle("active",e===F)}var r=document.querySelectorAll("#onboardProgress .onboard-dot");r.forEach(function(n,o){n.classList.remove("active","done"),o===F?n.classList.add("active"):o<F&&n.classList.add("done")})}function qe(){var e=document.getElementById("onboardAcctStatus"),t=document.getElementById("onboardAcctId"),r=document.getElementById("onboardAcctDone");t&&(t.textContent="demo_"+Date.now().toString(36)),setTimeout(function(){e&&(e.innerHTML='<i class="fas fa-check-circle" style="color:var(--green)"></i> Active'),r&&(r.style.display="block")},1200)}function Ne(){for(var e=document.getElementById("onboardWalletAddr"),t=document.getElementById("onboardXrpBal"),r=document.getElementById("onboardTrustLine"),n=document.getElementById("onboardWalletDone"),o="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",d="r",u=0;u<28;u++)d+=o[Math.floor(Math.random()*o.length)];setTimeout(function(){e&&(e.textContent=d.substring(0,8)+"..."+d.slice(-4))},500),setTimeout(function(){t&&(t.textContent="12.000000 XRP")},1200),setTimeout(function(){r&&(r.innerHTML='Credits <i class="fas fa-check-circle" style="color:var(--green);margin-left:4px"></i>'),n&&(n.style.display="block")},1800)}function We(e,t){ye=t;var r=(G[t]||G.starter).sls,n=document.getElementById("demoStep3Status");n&&n.innerHTML.indexOf("Credits")!==-1&&(n.innerHTML='<i class="fas fa-check" style="color:#00aaff;margin-right:3px;"></i> '+r.toLocaleString()+" Credits");var o=document.getElementById("demoSlsBalance");o&&(o.textContent=r.toLocaleString()+" Credits"),_demoSession&&_demoSession.subscription&&(_demoSession.subscription.sls_allocation=r,_demoSession.subscription.label=(G[t]||G.starter).label),document.querySelectorAll(".onboard-tier").forEach(function(c){c.classList.remove("selected")}),e.classList.add("selected");var d=G[t],u=document.getElementById("onboardSlsBal"),a=document.getElementById("onboardSlsAnchors");u&&(u.textContent=d.sls.toLocaleString()),a&&(a.textContent=(d.sls*100).toLocaleString());var s=document.getElementById("slsBarBalance");s&&(s.textContent=d.sls.toLocaleString()+" Credits");var i=document.getElementById("toolSlsBal");i&&(i.textContent=d.sls.toLocaleString());var l=document.getElementById("sidebarSlsBal");l&&(l.textContent=d.sls.toLocaleString()+" Credits")}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("platformWorkspace");e&&e.style.display==="block"&&!sessionStorage.getItem("s4_onboard_done")&&setTimeout(ze,600)});window.closeOnboarding=ve;window.onboardNext=He;window.selectOnboardTier=We;var N=null,W=null;async function Y(){var e=stats.anchored||0;stats.slsFees;var t=getLocalRecords(),r={};t.forEach(function(b){var E=b.record_label||b.record_type||"Unknown";r[E]=(r[E]||0)+1});try{var n=await fetch("/api/metrics/performance"),o=await n.json(),d=function(b,E){var M=document.getElementById(b);M&&(M.textContent=E)};d("metricAnchorTime",o.avg_anchor_time_ms?(o.avg_anchor_time_ms/1e3).toFixed(2):"3.21"),d("metricAnchorsToday",o.anchors_today||(e>0?e:"—")),d("metricCostPerAnchor",o.cost_per_anchor||"0.01"),d("metricValidators",o.xrpl_validators||"35"),d("metricUptime",o.uptime_pct||"99.97"),d("metricAiAudit",o.ai_audit_entries||(e>0?Math.max(e,1):"—"));var u=[];try{u=JSON.parse(localStorage.getItem(_vaultKey())||"[]")}catch{}var a=t.length+u.length;d("metricRecordsGenerated",a>0?a:"—"),d("metricVaultSize",u.length>0?u.length:"—");var s=0;try{s=Math.round(new Blob([localStorage.getItem(_vaultKey())||""]).size/1024*10)/10}catch{}d("metricStorageUsed",s>0?s.toFixed(1):"—"),d("metricTotalTime",o.total_processing_time||(e>0?(e*3.2).toFixed(1):"—"));var i=document.getElementById("chartAnchorTimes");if(i&&typeof Chart<"u"){var l=o.recent_anchor_times||Array.from({length:20},function(){return(2.8+Math.random()*1.5).toFixed(2)});N&&N.destroy(),N=new Chart(i,{type:"line",data:{labels:l.map(function(b,E){return"#"+(E+1)}),datasets:[{label:"Anchor Time (s)",data:l,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"#00aaff"}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}})}var c=document.getElementById("chartRecordTypes");if(c&&typeof Chart<"u"){var f=o.record_type_counts||(Object.keys(r).length>0?r:{DD1149:12,DD250:8,WAWF:5,Container:14,"Supply Chain":9,Custody:7,Maintenance:6});W&&W.destroy(),W=new Chart(c,{type:"doughnut",data:{labels:Object.keys(f),datasets:[{data:Object.values(f),backgroundColor:["#00aaff","#c9a84c","#38bdf8","#ff6b6b","#00aaff","#fb923c","#06b6d4"],borderWidth:0}]},options:{responsive:!0,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:10},padding:8}}}}})}var m=document.getElementById("metricsRecentRequests");m&&o.recent_requests&&o.recent_requests.length?m.innerHTML=o.recent_requests.map(function(b){var E=(b.method||"GET")==="POST"?"#00cc66":"#00aaff";return'<div style="display:flex;align-items:center;gap:8px;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="background:'+E+"22;color:"+E+';font-weight:700;font-size:0.7rem;padding:2px 8px;border-radius:4px;min-width:42px;text-align:center">'+(b.method||"GET")+'</span><span style="color:var(--text);flex:1;font-family:monospace;font-size:0.72rem">'+(b.path||b.endpoint||"/api/anchor")+'</span><span style="color:var(--accent);font-size:0.68rem;font-weight:600">'+(b.time||b.duration||b.latency||"—")+'</span><span style="color:var(--muted);font-size:0.68rem">'+(b.timestamp||b.ts||"")+"</span></div>"}).join(""):m&&(m.innerHTML='<div style="color:var(--muted);text-align:center;padding:1rem">No recent requests. Metrics auto-refresh when data is available.</div>')}catch{var d=function(A,H){var q=document.getElementById(A);q&&(q.textContent=H)};d("metricAnchorTime",e>0?(2.8+Math.random()*.5).toFixed(2):"—"),d("metricAnchorsToday",e>0?e:"—"),d("metricCostPerAnchor","0.01"),d("metricValidators","35"),d("metricUptime","99.97"),d("metricAiAudit",e>0?Math.max(e,1):"—");var p=[];try{p=JSON.parse(localStorage.getItem(_vaultKey())||"[]")}catch{}var v=t.length+p.length;d("metricRecordsGenerated",v>0?v:"—"),d("metricVaultSize",p.length>0?p.length:"—");var h=0;try{h=Math.round(new Blob([localStorage.getItem(_vaultKey())||""]).size/1024*10)/10}catch{}d("metricStorageUsed",h>0?h.toFixed(1):"—"),d("metricTotalTime",e>0?(e*3.2).toFixed(1):"—");var i=document.getElementById("chartAnchorTimes");if(i&&typeof Chart<"u"){var l=Array.from({length:Math.max(e,10)},function(){return(2.8+Math.random()*1.2).toFixed(2)});typeof N<"u"&&N&&N.destroy(),N=new Chart(i,{type:"line",data:{labels:l.map(function(H,q){return"#"+(q+1)}),datasets:[{label:"Anchor Time (s)",data:l,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"#00aaff"}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}})}var c=document.getElementById("chartRecordTypes");if(c&&typeof Chart<"u"){var f=Object.keys(r).length>0?r:{"No Records Yet":1};typeof W<"u"&&W&&W.destroy(),W=new Chart(c,{type:"doughnut",data:{labels:Object.keys(f),datasets:[{data:Object.values(f),backgroundColor:["#00aaff","#c9a84c","#38bdf8","#ff6b6b","#00aaff","#fb923c","#06b6d4"],borderWidth:0}]},options:{responsive:!0,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:10},padding:8}}}}})}var m=document.getElementById("metricsRecentRequests");if(m){for(var S=[],x=typeof getLocalRecords=="function"?getLocalRecords():[],g=x.slice(-5).reverse(),C=0;C<g.length;C++){var L=g[C],y=Math.floor((Date.now()-new Date(L.timestamp).getTime())/1e3),w=y<60?y+"s ago":y<3600?Math.floor(y/60)+"m ago":Math.floor(y/3600)+"h ago";S.push({method:"POST",path:"/api/anchor",time:(2.5+Math.random()*1.5).toFixed(1)+"s",ts:w,color:"#00cc66",detail:L.record_label||L.record_type||"Record"}),S.push({method:"GET",path:"/api/verify/"+(L.hash||"sha256").substring(0,12),time:(.3+Math.random()*.3).toFixed(1)+"s",ts:w,color:"#00aaff",detail:"Verify "+(L.record_label||"")})}var I=[{method:"GET",path:"/api/metrics/performance",time:"0.2s",ts:"auto",color:"#00aaff",detail:"Metrics refresh"},{method:"GET",path:"/api/health",time:"0.1s",ts:"auto",color:"#00aaff",detail:"Health check"},{method:"GET",path:"/api/records?limit=50",time:"0.4s",ts:"realtime",color:"#00aaff",detail:"Record listing"},{method:"POST",path:"/api/wallet/balance",time:"0.3s",ts:"auto",color:"#00cc66",detail:"Balance check"},{method:"GET",path:"/api/xrpl/account_info",time:"0.8s",ts:"auto",color:"#00aaff",detail:"XRPL query"}],T=S.length>0?S.concat(I):[{method:"POST",path:"/api/anchor",time:"2.8s",ts:"just now",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/verify/sha256:a1b2c3d4",time:"0.4s",ts:"12s ago",color:"#00aaff",detail:"Verify hash"},{method:"POST",path:"/api/anchor",time:"3.1s",ts:"45s ago",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/metrics/performance",time:"0.2s",ts:"1m ago",color:"#00aaff",detail:"Metrics"},{method:"GET",path:"/api/records?limit=50&branch=NAVY",time:"0.3s",ts:"2m ago",color:"#00aaff",detail:"Record query"},{method:"POST",path:"/api/anchor",time:"2.6s",ts:"3m ago",color:"#00cc66",detail:"Anchor record"},{method:"GET",path:"/api/verify/sha256:e5f6a7b8",time:"0.5s",ts:"4m ago",color:"#00aaff",detail:"Verify hash"},{method:"POST",path:"/api/ai-chat",time:"1.2s",ts:"5m ago",color:"#00cc66",detail:"AI query"}];m.innerHTML=T.slice(0,12).map(function(A){return'<div style="display:flex;align-items:center;gap:8px;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="background:'+A.color+"22;color:"+A.color+';font-weight:700;font-size:0.7rem;padding:2px 8px;border-radius:4px;min-width:42px;text-align:center">'+A.method+'</span><span style="color:var(--text);flex:1;font-family:monospace;font-size:0.72rem">'+A.path+'</span><span style="color:var(--steel);font-size:0.65rem;max-width:90px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">'+A.detail+'</span><span style="color:var(--accent);font-size:0.68rem;font-weight:600">'+A.time+'</span><span style="color:var(--muted);font-size:0.68rem">'+A.ts+"</span></div>"}).join("")}}}document.addEventListener("shown.bs.tab",function(e){e.target&&e.target.getAttribute("href")==="#tabMetrics"&&Y(),e.target&&e.target.getAttribute("href")==="#tabOffline"&&$e()});setInterval(function(){var e=document.getElementById("tabMetrics");e&&e.classList.contains("active")&&typeof Y=="function"&&Y()},3e4);(function(){function e(){var t=typeof stats<"u"?stats:{anchored:0,slsFees:0};typeof getLocalRecords=="function"&&getLocalRecords();var r=document.getElementById("slsBarBalance");if(r){var n=t.slsFees||0,o=typeof _onboardTiers<"u"&&typeof _onboardTier<"u"&&_onboardTiers[_onboardTier]?_onboardTiers[_onboardTier].sls:typeof _demoSession<"u"&&_demoSession.subscription&&_demoSession.subscription.sls_allocation||25e3,d=o-n;r.textContent=d.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})}var u=document.getElementById("slsBarAnchors");u&&(u.textContent=t.anchored||0);var a=document.getElementById("slsBarSpent");a&&(a.textContent=(t.slsFees||0).toFixed(2));var s=typeof _onboardTiers<"u"&&typeof _onboardTier<"u"&&_onboardTiers[_onboardTier]?_onboardTiers[_onboardTier].sls:typeof _demoSession<"u"&&_demoSession.subscription&&_demoSession.subscription.sls_allocation||25e3,i=document.getElementById("toolSlsBal");i&&(i.textContent=(s-(t.slsFees||0)).toLocaleString());var l=document.getElementById("toolSlsAnch");l&&(l.textContent=t.anchored||0);var c=document.getElementById("toolSlsSpent");c&&(c.textContent=(t.slsFees||0).toFixed(2));try{var f=JSON.parse(localStorage.getItem("s4ActionItems")||"[]"),m=f.filter(function(v){return v.status!=="Closed"&&v.status!=="Resolved"}).length,p=document.getElementById("actionItemBadge");p&&(p.textContent=m>0?m:"",p.style.display=m>0?"inline-flex":"none")}catch{}}setInterval(e,3e3),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()})();var K="s4_offline_queue",ge="s4_offline_last_sync",be="s4_offline_queue_enc",J=null;async function Ue(){if(J)return J;var e=navigator.userAgent+"|"+location.origin+"|s4ledger_offline_v1",t=new TextEncoder,r=await crypto.subtle.importKey("raw",t.encode(e),"PBKDF2",!1,["deriveKey"]);return J=await crypto.subtle.deriveKey({name:"PBKDF2",salt:t.encode("s4_offline_salt_v1"),iterations:1e5,hash:"SHA-256"},r,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),J}async function Ve(e){var t=await Ue(),r=crypto.getRandomValues(new Uint8Array(12)),n=new TextEncoder,o=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},t,n.encode(JSON.stringify(e)));return{iv:Array.from(r),data:Array.from(new Uint8Array(o))}}function z(){try{var e=localStorage.getItem(be);return e?ie||[]:JSON.parse(localStorage.getItem(K)||"[]")}catch{return[]}}var ie=[];async function je(e){try{var t=await Ve(e);localStorage.setItem(be,JSON.stringify(t)),ie=e}catch{localStorage.setItem(K,JSON.stringify(e))}}function j(e){ie=e,localStorage.setItem(K,JSON.stringify(e)),je(e).then(function(){localStorage.removeItem(K)}).catch(function(){}),$()}function $(){var e=z(),t=document.getElementById("offlineQueueCount"),r=document.getElementById("offlineQueueList"),n=document.getElementById("offlineLastSync"),o=document.getElementById("offlineStatus");if(t&&(t.textContent=e.length),n){var d=localStorage.getItem(ge);n.textContent=d?new Date(d).toLocaleString():"Never"}if(o){var u=navigator.onLine;o.innerHTML=u?'<i class="fas fa-circle" style="font-size:0.6rem;color:var(--green)"></i> Online':'<i class="fas fa-circle" style="font-size:0.6rem;color:var(--red)"></i> Offline',o.style.color=u?"var(--green)":"var(--red)"}r&&(e.length?r.innerHTML=e.map(function(a,s){return'<div style="display:flex;align-items:center;gap:8px;padding:8px;border-bottom:1px solid rgba(255,255,255,0.03)"><span style="color:var(--accent);font-weight:700;width:24px">'+(s+1)+'</span><span style="flex:1;color:var(--text);font-family:monospace;font-size:0.72rem">'+(a.hash?a.hash.substring(0,24)+"...":"N/A")+'</span><span style="color:var(--steel);font-size:0.7rem;width:80px">'+(a.record_type||"GENERAL")+'</span><span style="color:'+(a.synced?"var(--green)":"var(--gold)")+';font-size:0.72rem">'+(a.synced?"✓ Synced":"⏳ Pending")+'</span><button onclick="offlineRemoveItem('+s+')" style="background:none;border:none;color:var(--red);cursor:pointer;font-size:0.75rem" title="Remove"><i class="fas fa-times"></i></button></div>'}).join(""):r.innerHTML='<div style="color:var(--muted);text-align:center;padding:1rem">Queue is empty. Hashes are queued automatically when offline.</div>')}function $e(){$(),fetch("/api/offline/queue").then(function(e){return e.json()}).then(function(e){if(e.queue_size>0){var t=document.getElementById("offlineQueueCount"),r=z().length;t&&(t.textContent=r+e.queue_size)}if(e.last_sync){var n=document.getElementById("offlineLastSync");n&&(n.textContent=new Date(e.last_sync).toLocaleString())}}).catch(function(){})}function Ge(){if(typeof s4Vault<"u"&&s4Vault.length>0){var e=z(),t={};e.forEach(function(u){t[u.hash]=!0});var r=s4Vault.filter(function(u){return u.hash&&!t[u.hash]});if(r.length>0){var n=r[0];e.push({hash:n.hash,record_type:n.type||"VAULT_RECORD",branch:n.branch||"JOINT",timestamp:n.timestamp||new Date().toISOString(),synced:!1,label:n.label||"Vault Record"}),j(e),R("Vault record queued for offline sync: "+n.hash.substring(0,16)+"...","success")}else R("All vault records are already queued. Anchor new records first.","info")}else{var o="S4-SESSION-"+Date.now()+"-"+Math.random().toString(36).substring(2,10),d=new TextEncoder;crypto.subtle.digest("SHA-256",d.encode(o)).then(function(u){var a=Array.from(new Uint8Array(u)).map(function(i){return i.toString(16).padStart(2,"0")}).join(""),s=z();s.push({hash:a,record_type:"SESSION_HASH",branch:"JOINT",timestamp:new Date().toISOString(),synced:!1}),j(s),R("Session hash queued for offline sync: "+a.substring(0,16)+"...","info")})}}function Qe(e){var t=z();t.splice(e,1),j(t)}function Je(){confirm("Clear all offline queued hashes?")&&(j([]),R("Offline queue cleared.","info"))}async function Ye(){return se()}var V=0,ae=5,Ke=1e3;async function se(e){e=e||0;var t=z(),r=t.filter(function(a){return!a.synced});if(!r.length){V=0,R("No pending hashes to sync.","info");return}if(!navigator.onLine){R("Cannot sync — currently offline.","warning");return}R("Syncing "+r.length+" hashes to XRPL"+(e>0?" (retry "+e+"/"+ae+")":"")+"...","info");try{var n=await Se("/api/offline/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hashes:r})});if(!n.ok)throw new Error("Server returned "+n.status);for(var o=await n.json(),d=0;d<t.length;d++)t[d].synced||(t[d].synced=!0,t[d].synced_at=new Date().toISOString());j(t),localStorage.setItem(ge,new Date().toISOString()),V=0,R("Sync complete: "+(o.synced||r.length)+" anchored.","success"),$()}catch(a){if(V=e+1,V<=ae){var u=Ke*Math.pow(2,e)+Math.floor(Math.random()*500);R("Sync failed ("+a.message+"). Retrying in "+Math.round(u/1e3)+"s...","warning"),setTimeout(function(){se(V)},u)}else V=0,R("Sync failed after "+ae+" retries: "+a.message+". Try again later.","error")}}var Se=window.fetch;window.fetch=function(e,t){if(!navigator.onLine&&typeof e=="string"){var r=e.indexOf("/api/anchor")!==-1||e.indexOf("/api/demo/anchor")!==-1,n=e.indexOf("/api/demo/provision")!==-1;if(r){try{var o=t&&t.body?JSON.parse(t.body):{},d=z();d.push({hash:o.hash||o.data_hash||"UNKNOWN",record_type:o.record_type||"QUEUED_ANCHOR",branch:o.branch||"JOINT",timestamp:new Date().toISOString(),synced:!1}),j(d),R("Offline: anchor queued locally. Will sync when reconnected.","info")}catch{}return Promise.resolve(new Response(JSON.stringify({status:"queued_offline",message:"Hash queued for offline sync.",record:{tx_hash:"OFFLINE_"+Date.now().toString(36).toUpperCase(),network:"Queued Offline"}}),{status:200,headers:{"Content-Type":"application/json"}}))}if(n){var u=localStorage.getItem("s4_selected_tier")||"starter",a={pilot:{label:"Pilot",sls:100},starter:{label:"Starter",sls:25e3},professional:{label:"Professional",sls:1e5},enterprise:{label:"Enterprise",sls:5e5}},s=a[u]||a.starter;return Promise.resolve(new Response(JSON.stringify({session_id:"offline_"+Date.now(),subscription:{label:s.label,sls_allocation:s.sls},wallet:{address:"rOfflineMode"},xrp_balance:12,sls_balance:s.sls}),{status:200,headers:{"Content-Type":"application/json"}}))}}return Se.apply(this,arguments)};window.addEventListener("online",function(){$(),R("Connection restored. Auto-syncing offline queue...","success"),setTimeout(function(){var e=z(),t=e.filter(function(r){return!r.synced});t.length>0&&se()},2e3)});window.addEventListener("offline",function(){$(),R("Connection lost. Anchors will be queued locally.","warning")});function R(e,t){var r=document.querySelector(".workspace-notification");r&&r.remove();var n=document.createElement("div");n.className="workspace-notification";var o={success:"var(--green)",error:"var(--red)",warning:"var(--gold)",info:"var(--accent)"};n.style.borderColor=o[t]||o.info,n.innerHTML='<button class="notif-close" onclick="this.parentElement.remove()">&times;</button><i class="fas fa-'+(t==="success"?"check-circle":t==="error"?"times-circle":t==="warning"?"exclamation-triangle":"info-circle")+'" style="color:'+(o[t]||o.info)+';margin-right:6px"></i>'+e,document.body.appendChild(n),setTimeout(function(){n.remove()},5e3)}document.addEventListener("DOMContentLoaded",function(){$()});function Xe(e){e.preventDefault();var t=document.getElementById("dropZone");t&&t.classList.remove("drag-over");var r=e.dataTransfer.files;r.length>0&&we(r[0])}function Ze(e){var t=e.target.files;t.length>0&&we(t[0])}function we(e){var t=document.getElementById("dropFileName");t&&(t.style.display="block",t.innerHTML='<i class="fas fa-file" style="margin-right:6px;"></i>'+e.name+" ("+(e.size/1024).toFixed(1)+" KB)"),e.name,e.size;var r=new FileReader;if(r.onload=function(o){sha256Binary(o.target.result).then(function(d){t&&(t.innerHTML='<i class="fas fa-file" style="margin-right:6px;"></i>'+e.name+" ("+(e.size/1024).toFixed(1)+' KB)<div style="font-size:0.7rem;color:var(--muted);font-family:monospace;margin-top:4px;">SHA-256: '+d.substring(0,32)+"...</div>")})},r.readAsArrayBuffer(e),e.type.startsWith("text/")||e.name.match(/\.(txt|csv|json|xml|md|html|log|yaml|yml)$/i)){var n=new FileReader;n.onload=function(o){document.getElementById("recordInput").value=o.target.result.substring(0,1e4)},n.readAsText(e)}else document.getElementById("recordInput").value="FILE: "+e.name+" | SIZE: "+(e.size/1024).toFixed(1)+" KB | Binary file — SHA-256 hash computed from raw bytes"}function le(){var e=document.getElementById("gapRadarChart"),t=document.getElementById("gapBarChart");if(!(!e||!t)){var r=document.getElementById("gapChartsRow");r&&(r.style.display="flex");var n,o;typeof ilsResults<"u"&&ilsResults&&ilsResults.elements&&Object.keys(ilsResults.elements).length>0?(n=Object.keys(ilsResults.elements),o=n.map(function(u){return ilsResults.elements[u]&&typeof ilsResults.elements[u].score=="number"?ilsResults.elements[u].score:0})):(n=["Supply Support","Maintenance Planning","Tech Data","Training","Config Mgmt","DMSMS","PHS&T","Reliability","Support Equipment","Manpower"],o=[72,58,85,44,91,35,67,78,52,63]),e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"radar",data:{labels:n.map(function(u){return u.replace(/_/g," ").replace(/\b\w/g,function(a){return a.toUpperCase()})}),datasets:[{label:"ILS Element Coverage %",data:o,backgroundColor:"rgba(0,170,255,0.12)",borderColor:"#00aaff",borderWidth:2,pointBackgroundColor:"#00aaff",pointBorderColor:"#fff",pointRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{r:{min:0,max:100,ticks:{display:!1},grid:{color:"rgba(255,255,255,0.06)"},angleLines:{color:"rgba(255,255,255,0.06)"},pointLabels:{color:"#8ea4b8",font:{size:10}}}},plugins:{legend:{display:!1}}}});var d=o.map(function(u){return u>=80?"#00cc66":u>=50?"#ffa500":"#ff4444"});t.__chartInstance&&t.__chartInstance.destroy(),t.__chartInstance=new Chart(t,{type:"bar",data:{labels:n.map(function(u){return u.replace(/_/g," ").replace(/\b\w/g,function(a){return a.toUpperCase()})}),datasets:[{label:"Score",data:o,backgroundColor:d,borderRadius:6,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{min:0,max:100,grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8"}},y:{ticks:{color:"#8ea4b8",font:{size:10}},grid:{display:!1}}},plugins:{legend:{display:!1}}}})}}function xe(){var e=document.getElementById("dmsmsPieChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"doughnut",data:{labels:["Active","At Risk","Obsolete","Resolved","Monitoring"],datasets:[{data:window._dmsmsChartData&&window._dmsmsChartData.reduce(function(t,r){return t+r},0)>0?window._dmsmsChartData:[45,18,12,20,5],backgroundColor:["#00cc66","#ffa500","#ff4444","#00aaff","#8ea4b8"],borderWidth:0,hoverOffset:8}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"55%",plugins:{legend:{position:"bottom",labels:{color:"#8ea4b8",padding:12,usePointStyle:!0,pointStyle:"circle",font:{size:11}}}}}}))}function Ce(){var e=document.getElementById("readinessGauge");if(e){var t=.87;if(typeof window._readinessAo=="number"&&!isNaN(window._readinessAo))t=window._readinessAo;else{var r=document.getElementById("readinessAo")||document.getElementById("statAo");if(r&&r.textContent&&r.textContent!=="—"){var n=parseFloat(r.textContent);isNaN(n)||(t=n>1?n/100:n)}}e.__chartInstance&&e.__chartInstance.destroy();var o=Math.round(t*100),d=Math.min(100,o+8),u=Math.min(100,o-3),a=Math.min(100,o-10),s=Math.min(100,o+12),i=Math.min(100,o+2),l=Math.min(100,o+5),c=[d,u,a,s,i,l].map(function(f){return f>=90?"rgba(0,204,102,0.7)":f>=75?"rgba(0,170,255,0.6)":f>=60?"rgba(255,165,0,0.6)":"rgba(255,68,68,0.6)"});e.__chartInstance=new Chart(e,{type:"bar",data:{labels:["Personnel","Equipment","Supply","Training","Maintenance","C4ISR"],datasets:[{label:"Readiness %",data:[d,u,a,s,i,l],backgroundColor:c,borderColor:c.map(function(f){return f.replace("0.7","1").replace("0.6","1")}),borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(f){return f.parsed.y+"%"}}}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:11}},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:10},callback:function(f){return f+"%"}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0,max:100}}}})}}function Ee(){var e=document.getElementById("complianceRadarChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"radar",data:{labels:["CMMC L2","NIST 800-171","DFARS 7012","ITAR","FIPS 140-2","FedRAMP","IL4/IL5"],datasets:[{label:"Current Posture",data:window._complianceScores&&window._complianceScores.reduce(function(t,r){return t+r},0)>0?window._complianceScores:[78,85,92,88,70,65,82],backgroundColor:"rgba(0,170,255,0.12)",borderColor:"#00aaff",borderWidth:2,pointBackgroundColor:"#00aaff",pointRadius:4},{label:"Target",data:[95,95,100,100,90,85,95],backgroundColor:"rgba(201,168,76,0.06)",borderColor:"rgba(201,168,76,0.5)",borderWidth:1,borderDash:[4,4],pointRadius:2}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{r:{min:0,max:100,ticks:{display:!1},grid:{color:"rgba(255,255,255,0.06)"},angleLines:{color:"rgba(255,255,255,0.06)"},pointLabels:{color:"#8ea4b8",font:{size:10}}}},plugins:{legend:{labels:{color:"#8ea4b8",usePointStyle:!0,font:{size:11}}}}}}))}function Ie(){var e=document.getElementById("roiLineChart");if(e){e.getAttribute("data-bp-rendered")&&e.removeAttribute("data-bp-rendered");var t=document.getElementById("hub-roi");if(t&&typeof Chart<"u"){var r=null;try{r=Chart.getChart(e)}catch{}if(r&&r.data&&r.data.labels&&r.data.labels.length>=20)return}if(e.__chartInstance)try{e.__chartInstance.destroy()}catch{}for(var n=parseFloat((document.getElementById("roiFTEs")||{}).value)||8,o=parseFloat((document.getElementById("roiRate")||{}).value)||145,d=parseFloat((document.getElementById("roiAudit")||{}).value)||25e4,u=parseFloat((document.getElementById("roiError")||{}).value)||8500,a=parseFloat((document.getElementById("roiIncidents")||{}).value)||35,s=parseFloat((document.getElementById("roiLicense")||{}).value)||12e4,i=n*2080*o*.65,l=a*u*.9,c=d*.7,f=i+l+c,m=[],p=["Q1","Q2","Q3","Q4","Q5","Q6","Q7","Q8","Q9","Q10","Q11","Q12","Q13","Q14","Q15","Q16","Q17","Q18","Q19","Q20"],v=1;v<=20;v++){var h=.2+.65*(1-Math.exp(-.18*v)),S=f/4*h,x=s/4,g=v>1?m[v-2]:0;m.push(Math.round(g+S-x))}e.__chartInstance=new Chart(e,{type:"line",data:{labels:p,datasets:[{label:"Cumulative ROI ($)",data:m,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.08)",fill:!0,tension:.3,borderWidth:2,pointBackgroundColor:"#00aaff",pointBorderColor:"#fff",pointRadius:5,pointHoverRadius:7},{label:"Break-Even Line",data:new Array(20).fill(0),borderColor:"rgba(255,255,255,0.2)",borderDash:[5,5],borderWidth:1,pointRadius:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8",callback:function(C){return"$"+(C/1e3).toFixed(0)+"K"}}},x:{grid:{display:!1},ticks:{color:"#8ea4b8"}}},plugins:{legend:{labels:{color:"#8ea4b8",usePointStyle:!0,font:{size:11}}}}}})}}function Le(){var e=document.getElementById("riskHeatChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"bar",data:{labels:["Supply Chain","Cyber/Data","Obsolescence","Financial","Regulatory","Operational"],datasets:[{label:"Risk Score",data:window._riskChartScores&&window._riskChartScores.length===6?window._riskChartScores:[78,62,85,45,55,71],backgroundColor:function(t){var r=t.raw;return r>=75?"rgba(255,68,68,0.7)":r>=50?"rgba(255,165,0,0.7)":"rgba(0,204,102,0.7)"},borderRadius:6,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{min:0,max:100,grid:{color:"rgba(255,255,255,0.04)"},ticks:{color:"#8ea4b8"}},y:{ticks:{color:"#8ea4b8",font:{size:11}},grid:{display:!1}}},plugins:{legend:{display:!1}}}}))}function X(){var e=document.getElementById("lifecyclePieChart");e&&(e.__chartInstance&&e.__chartInstance.destroy(),e.__chartInstance=new Chart(e,{type:"doughnut",data:{labels:["Acquisition","Sustainment (O&S)","DMSMS / Obsol.","Disposal","Personnel","Training"],datasets:[{data:window._lifecycleChartData&&window._lifecycleChartData.length===6?window._lifecycleChartData:[28,42,12,5,8,5],backgroundColor:["#00aaff","#c9a84c","#ff4444","#8ea4b8","#00cc66","#9b59b6"],borderWidth:0,hoverOffset:8}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"50%",plugins:{legend:{position:"bottom",labels:{color:"#8ea4b8",padding:12,usePointStyle:!0,pointStyle:"circle",font:{size:11}}}}}}))}function Te(){var e={"hub-analysis":{target:"ilsResult",charts:'<div class="row mt-3" id="gapChartsRow"><div class="col-md-6"><div class="chart-container"><div class="chart-title"><i class="fas fa-chart-pie"></i> ILS Element Coverage</div><canvas id="gapRadarChart" height="240"></canvas></div></div><div class="col-md-6"><div class="chart-container"><div class="chart-title"><i class="fas fa-chart-bar"></i> Element Scores</div><canvas id="gapBarChart" height="240"></canvas></div></div></div>'},"hub-dmsms":{target:null,charts:'<div class="chart-container mt-3" id="dmsmsChartArea"><div class="chart-title"><i class="fas fa-chart-pie"></i> Obsolescence Risk Distribution</div><canvas id="dmsmsPieChart" height="200"></canvas></div>'},"hub-readiness":{target:null,charts:'<div class="chart-container mt-3" style="max-width:100%" id="readinessGaugeArea"><div class="chart-title"><i class="fas fa-gauge-high"></i> Operational Availability</div><canvas id="readinessGauge" height="300"></canvas></div>'},"hub-compliance":{target:null,charts:'<div class="chart-container mt-3" id="complianceChartArea"><div class="chart-title"><i class="fas fa-shield-halved"></i> Compliance Framework Radar</div><canvas id="complianceRadarChart" height="250"></canvas></div>'},"hub-roi":{target:null,charts:'<div class="chart-container mt-3" id="roiChartArea"><div class="chart-title"><i class="fas fa-chart-line"></i> ROI Projection — 5 Year Cumulative</div><canvas id="roiLineChart" height="220"></canvas></div>'},"hub-risk":{target:null,charts:'<div class="chart-container mt-3" id="riskChartArea"><div class="chart-title"><i class="fas fa-triangle-exclamation"></i> Risk Category Assessment</div><canvas id="riskHeatChart" height="220"></canvas></div>'},"hub-lifecycle":{target:null,charts:'<div class="chart-container mt-3" id="lifecycleChartArea"><div class="chart-title"><i class="fas fa-chart-pie"></i> Total Ownership Cost Breakdown</div><canvas id="lifecyclePieChart" height="220"></canvas></div>'}};Object.keys(e).forEach(function(t){var r=e[t],n=document.getElementById(t);if(n&&!n.getAttribute("data-charts-injected")){var o=r.charts.match(/id="([^"]+)"/);if(o&&document.getElementById(o[1])){n.setAttribute("data-charts-injected","1");return}var d=n.querySelector(".demo-card");if(d){if(r.target){var u=document.getElementById(r.target);if(u){var a=document.createElement("div");a.innerHTML=r.charts,u.parentNode.insertBefore(a.firstElementChild,u.nextSibling),n.setAttribute("data-charts-injected","1");return}}var a=document.createElement("div");a.innerHTML=r.charts,d.appendChild(a.firstElementChild),n.setAttribute("data-charts-injected","1")}}})}var et=openILSTool;openILSTool=function(e){et(e),Te(),setTimeout(function(){e==="hub-analysis"&&ilsResults&&le(),e==="hub-dmsms"&&xe(),e==="hub-readiness"&&Ce(),e==="hub-compliance"&&Ee(),e==="hub-roi"&&Ie(),e==="hub-risk"&&Le(),e==="hub-lifecycle"&&X()},300)};var tt=switchHubTab;switchHubTab=function(e,t){tt(e,t),Te(),setTimeout(function(){e==="hub-analysis"&&typeof ilsResults<"u"&&ilsResults&&le(),e==="hub-dmsms"&&xe(),e==="hub-readiness"&&Ce(),e==="hub-compliance"&&Ee(),e==="hub-roi"&&Ie(),e==="hub-risk"&&Le(),e==="hub-lifecycle"&&X()},300)};var de=null;typeof showILSResults=="function"&&(de=showILSResults,showILSResults=function(){de.apply(this,arguments);var e=document.getElementById("gapChartsRow");e&&(e.style.display="flex"),setTimeout(le,500)});function at(){var e=(document.getElementById("lifecycleProgram")||{}).value||"ddg51",t=parseFloat((document.getElementById("lcServiceLife")||{}).value)||30,r=parseFloat((document.getElementById("lcOpHours")||{}).value)||2500,n=parseFloat((document.getElementById("lcAcqCost")||{}).value)||85,o=parseFloat((document.getElementById("lcFleetSize")||{}).value)||20,d=parseFloat((document.getElementById("lcSustRate")||{}).value)||8,u=n*o,a=u*(d/100),s=a*t,i=.12+(t>25?.04:0),l=s*i,c=u*.05,f=s*.18,m=s*.08,p=u+s+l+c+f+m,v=r*o*t,h=v>0?p/v:0;function S(E){return E>=1e3?"$"+(E/1e3).toFixed(1)+"B":"$"+E.toFixed(0)+"M"}var x=function(E){return document.getElementById(E)};x("lcTotalCost")&&(x("lcTotalCost").textContent=S(p)),x("lcSustCost")&&(x("lcSustCost").textContent=S(s)),x("lcDmsmsCost")&&(x("lcDmsmsCost").textContent=S(l)),x("lcCostPerHr")&&(x("lcCostPerHr").textContent="$"+h.toFixed(0)+"/hr");var g=Math.round(u/p*100),C=Math.round(s/p*100),L=Math.round(l/p*100),y=Math.round(c/p*100),w=Math.round(f/p*100),I=Math.round(m/p*100);window._lifecycleChartData=[g,C,L,y,w,I];var T=x("lifecycleOutput");if(T){var b=window.S4_PLATFORMS&&S4_PLATFORMS[e]?S4_PLATFORMS[e].n:e.toUpperCase();T.innerHTML='<div style="background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:20px;margin-top:12px"><div class="section-label"><i class="fas fa-clock"></i> LIFECYCLE COST BREAKDOWN — '+b+'</div><div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;font-size:0.85rem;margin-bottom:16px"><div><span style="color:var(--steel)">Acquisition ('+g+'%)</span><br><strong style="color:#00aaff">'+S(u)+'</strong></div><div><span style="color:var(--steel)">Sustainment ('+C+'%)</span><br><strong style="color:#c9a84c">'+S(s)+'</strong></div><div><span style="color:var(--steel)">DMSMS/Obsol ('+L+'%)</span><br><strong style="color:#ff4444">'+S(l)+'</strong></div><div><span style="color:var(--steel)">Disposal ('+y+'%)</span><br><strong style="color:#8ea4b8">'+S(c)+'</strong></div><div><span style="color:var(--steel)">Personnel ('+w+'%)</span><br><strong style="color:#00cc66">'+S(f)+'</strong></div><div><span style="color:var(--steel)">Training ('+I+'%)</span><br><strong style="color:#9b59b6">'+S(m)+'</strong></div></div><hr style="border-color:var(--border);margin:12px 0"><div style="display:flex;justify-content:space-between;align-items:center"><div><span style="color:var(--steel);font-size:0.82rem">Total Ownership Cost</span><br><span style="font-size:1.5rem;font-weight:800;color:#00aaff">'+S(p)+'</span></div><div><span style="color:var(--steel);font-size:0.82rem">Cost per Op Hour</span><br><span style="font-size:1.1rem;font-weight:700;color:var(--accent)">$'+h.toFixed(0)+'/hr</span></div><div><span style="color:var(--steel);font-size:0.82rem">Fleet Size</span><br><span style="font-size:1.1rem;font-weight:700;color:#fff">'+o+" units × "+t+" yrs</span></div></div></div>"}typeof X=="function"&&setTimeout(X,300),typeof generateLifecycleActions=="function"&&generateLifecycleActions(e,p,l,s)}function rt(){var e=(document.getElementById("lifecycleProgram")||{}).value||"ddg51",t=window.S4_PLATFORMS&&S4_PLATFORMS[e]?S4_PLATFORMS[e].n:e.toUpperCase(),r=parseFloat((document.getElementById("lcServiceLife")||{}).value)||30,n=parseFloat((document.getElementById("lcAcqCost")||{}).value)||85,o=parseFloat((document.getElementById("lcFleetSize")||{}).value)||20,d=parseFloat((document.getElementById("lcSustRate")||{}).value)||8,u=n*o,a=u*(d/100)*r,s=a*(.12+(r>25?.04:0)),i=u+a+s+u*.05+a*.18+a*.08,l=`S4 LEDGER — LIFECYCLE COST REPORT
================================

Platform: `+t+`
Fleet Size: `+o+` units
Service Life: `+r+` years
Sustainment Rate: `+d+`%

Acquisition: $`+u.toFixed(0)+`M
Sustainment: $`+a.toFixed(0)+`M
DMSMS/Obsolescence: $`+s.toFixed(0)+`M
Total Ownership Cost: $`+i.toFixed(0)+`M

Generated: `+new Date().toISOString()+`
`,c=new Blob([l],{type:"text/plain"}),f=document.createElement("a");f.href=URL.createObjectURL(c),f.download="S4_Lifecycle_"+t.replace(/\s+/g,"_")+"_"+new Date().toISOString().substring(0,10)+".txt",f.click(),URL.revokeObjectURL(f.href),typeof s4Notify=="function"&&s4Notify("Exported","Lifecycle cost report downloaded.","success")}async function nt(){var e=(document.getElementById("lifecycleProgram")||{}).value||"ddg51",t=window.S4_PLATFORMS&&S4_PLATFORMS[e]?S4_PLATFORMS[e].n:e.toUpperCase(),r=parseFloat((document.getElementById("lcServiceLife")||{}).value)||30,n=parseFloat((document.getElementById("lcAcqCost")||{}).value)||85,o=parseFloat((document.getElementById("lcFleetSize")||{}).value)||20,d=parseFloat((document.getElementById("lcSustRate")||{}).value)||8,u=n*o,a=u*(d/100)*r,s=a*(.12+(r>25?.04:0)),i=u+a+s+u*.05+a*.18+a*.08,l="Lifecycle Cost | Program: "+t+" | Fleet: "+o+" | TOC: $"+i.toFixed(0)+"M | Date: "+new Date().toISOString(),c=await sha256(l);showAnchorAnimation(c,"Lifecycle Cost Report","CUI"),stats.anchored++,stats.types.add("LIFECYCLE_COST"),stats.slsFees=Math.round((stats.slsFees+.01)*100)/100,updateStats(),saveStats();var f=await _anchorToXRPL(c,"LIFECYCLE_COST",l.substring(0,100)),m={hash:c,type:"LIFECYCLE_COST",branch:"JOINT",timestamp:new Date().toISOString(),label:"Lifecycle Cost — "+t,txHash:f.txHash};sessionRecords.push(m),saveLocalRecord({hash:c,record_type:"LIFECYCLE_COST",record_label:"Lifecycle Cost — "+t,branch:"JOINT",timestamp:new Date().toISOString(),timestamp_display:new Date().toISOString().replace("T"," ").substring(0,19)+" UTC",fee:.01,tx_hash:f.txHash,system:"Lifecycle Cost Estimator",explorer_url:f.explorerUrl,network:f.network}),addToVault({hash:c,txHash:f.txHash,type:"LIFECYCLE_COST",label:"Lifecycle Cost — "+t,branch:"JOINT",icon:'<i class="fas fa-clock"></i>',content:l.substring(0,100),encrypted:!1,timestamp:new Date().toISOString(),source:"Lifecycle Cost Estimator",fee:.01,explorerUrl:f.explorerUrl,network:f.network}),updateTxLog(),_updateDemoSlsBalance(),setTimeout(function(){document.getElementById("animStatus").innerHTML='<i class="fas fa-check-circle" style="color:var(--accent)"></i> Lifecycle report anchored!',document.getElementById("animStatus").style.color="#00aaff"},2200),await new Promise(function(p){setTimeout(p,3200)}),hideAnchorAnimation(),typeof s4Notify=="function"&&s4Notify("Anchored","Lifecycle cost report anchored to XRPL.","success")}(function(){function e(n){var o=document.getElementById(n);if(!(!o||o.dataset.uxDone)){o.dataset.uxDone="1",o.querySelectorAll("details").forEach(function(y){y.removeAttribute("style")}),o.querySelectorAll("details summary").forEach(function(y){y.removeAttribute("style")}),o.querySelectorAll("details > div").forEach(function(y){y.removeAttribute("style")}),o.querySelectorAll("h3 > i[style], h4 > i[style]").forEach(function(y){y.removeAttribute("style")});var d=o.querySelectorAll(".demo-card");d.forEach(function(y){var w=y.querySelector("h3, h4");if(w){var I=w.nextElementSibling,T=y.querySelector(".hub-tool-header");T&&(I=T.nextElementSibling),I&&I.tagName==="P"&&I.getAttribute("style")&&I.removeAttribute("style")}}),o.querySelectorAll("button[style]").forEach(function(y){if(!(y.closest(".ils-dropzone")||y.closest(".post-actions")||y.closest(".post-action-btn"))&&y.style.display!=="none"){var w=y.textContent.toLowerCase(),I=w.includes("anchor")||w.includes("xrpl"),T=w.includes("export")||w.includes("download")||w.includes("generate"),b=w.includes("run ")||w.includes("analyze")||w.includes("calculate"),E=w.includes("clear")||w.includes("delete");E||(y.innerHTML,y.getAttribute("onclick"),I||b?(y.removeAttribute("style"),y.className="btn-anchor"):T&&(y.removeAttribute("style"),y.className="btn-export"))}}),o.querySelectorAll("div[style]").forEach(function(y){var w=y.getAttribute("style")||"";if(w.includes("display:flex")&&w.includes("gap:10")&&w.includes("flex-wrap:wrap")&&!y.classList.contains("ils-dropzone")&&!y.querySelector(".ils-dropzone")&&!y.closest(".post-actions")){var I=y.querySelectorAll("button");I.length>0&&(y.className="tool-actions-bar",y.removeAttribute("style"))}}),d.forEach(function(y){y.querySelectorAll(":scope > label, :scope > .row > .col-md-6 > label");var w=y.querySelector(":scope > label");if(w&&!w.previousElementSibling?.classList?.contains("section-label")){var I=document.createElement("div");I.className="section-label",I.innerHTML='<i class="fas fa-sliders"></i> CONFIGURATION';var T=document.createElement("hr");T.className="section-divider",w.parentNode.insertBefore(T,w),w.parentNode.insertBefore(I,T)}var b=y.querySelector('[id$="Results"], [id$="Output"], [id$="result"], [id$="Result"]');if(b&&!b.previousElementSibling?.classList?.contains("section-label")){var E=document.createElement("div");E.className="section-label",E.innerHTML='<i class="fas fa-chart-bar"></i> RESULTS';var M=document.createElement("hr");M.className="section-divider",b.parentNode.insertBefore(M,b),b.parentNode.insertBefore(E,M)}var P=y.querySelector(".tool-actions-bar");if(P&&!P.previousElementSibling?.classList?.contains("section-label")){var U=document.createElement("div");U.className="section-label",U.innerHTML='<i class="fas fa-bolt"></i> ACTIONS',P.parentNode.insertBefore(U,P)}});var u=o.querySelector(".demo-card");if(u){var a=n==="hub-analysis"||n==="hub-actions";if(!a){for(var s=u.querySelectorAll(":scope > .row"),i=null,l=0;l<s.length;l++){var c=s[l];if(c.querySelectorAll(".stat-mini").length>=3){i=c;break}}if(i){var f=u.querySelector(".hub-tool-header")||u.querySelector("h3, h4");if(f){var m=f;i.style.cssText="",i.classList.add("mb-3"),m.parentNode.insertBefore(i,m.nextSibling)}}}if(n==="hub-actions"){var p=u.querySelector(".col-lg-8");if(p){var v=p.querySelector(".demo-card");if(v){for(var h=null,S=v.querySelectorAll(":scope > .row"),x=0;x<S.length;x++)if(S[x].querySelectorAll(".stat-mini").length>=3){h=S[x];break}if(h){var g=v.querySelector("h3");g&&(h.style.cssText="",h.classList.add("mb-3"),g.parentNode.insertBefore(h,g.nextSibling))}}}}o.querySelectorAll("input[style], select[style]").forEach(function(y){y.type==="file"||y.type==="hidden"||y.style.display!=="none"&&y.removeAttribute("style")});var C=o.querySelectorAll(".chart-container");C.forEach(function(y){y.style.display="block"});var L=o.querySelector("#gapChartsRow");L&&(L.style.display="flex")}}}var t=openILSTool;openILSTool=function(n){t(n),setTimeout(function(){e(n)},100)};var r=switchHubTab;switchHubTab=function(n,o){r(n,o),setTimeout(function(){e(n)},100)},document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){document.querySelectorAll('.ils-hub-panel.active, .ils-hub-panel[style*="display:block"], .ils-hub-panel[style*="display: block"]').forEach(function(n){e(n.id)})},2500)})})();document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector('a[href="#tabILS"]');e&&e.addEventListener("shown.bs.tab",function(){updateAiContext(currentHubPanel||"hub-analysis")})});var B,k;(function(){var t=new Date;B=t.getFullYear(),k=t.getMonth()})();function ot(e){k+=e,k>11&&(k=0,B++),k<0&&(k=11,B--),Z()}function Z(){var e=document.getElementById("actionCalendarGrid"),t=document.getElementById("calMonthLabel");if(!(!e||!t)){if(typeof B>"u"||B===void 0||B===null){var r=new Date;B=r.getFullYear(),k=r.getMonth()}var n=["January","February","March","April","May","June","July","August","September","October","November","December"];t.textContent=n[k]+" "+B;var o=new Date(B,k,1).getDay(),d=new Date(B,k+1,0).getDate(),u=new Date,a=u.getFullYear()===B&&u.getMonth()===k,s={};try{var i=typeof s4ActionItems<"u"&&s4ActionItems.length>0?s4ActionItems:JSON.parse(localStorage.getItem("s4ActionItems")||"[]");i.forEach(function(g){var C=g.due||g.schedule||"";if(C){var L=new Date(C);if(!isNaN(L.getTime())&&L.getFullYear()===B&&L.getMonth()===k){var y=L.getDate();s[y]||(s[y]=[]),s[y].push(g)}}})}catch{}if(Object.keys(s).length===0){var l=[{day:3,title:"DMSMS Review — AN/SPS-49 Radar",severity:"critical"},{day:7,title:"ILS Gap Analysis — DDG-51 FY25",severity:"warning"},{day:10,title:"Parts Order Deadline — CVN-78",severity:"critical"},{day:12,title:"Compliance Audit Prep",severity:"info"},{day:15,title:"Warranty Expiry — GE LM2500",severity:"warning"},{day:18,title:"Lifecycle Cost Review",severity:"info"},{day:21,title:"Risk Assessment Update",severity:"warning"},{day:24,title:"Readiness Report Due",severity:"critical"},{day:27,title:"Obsolescence Check — MIL-STD-1553",severity:"info"}];l.forEach(function(g){g.day<=d&&(s[g.day]||(s[g.day]=[]),s[g.day].push(g))})}var c="";["Su","Mo","Tu","We","Th","Fr","Sa"].forEach(function(g){c+='<div style="padding:4px;font-weight:700;color:var(--steel);font-size:0.7rem">'+g+"</div>"});for(var f=0;f<o;f++)c+='<div style="padding:6px"></div>';for(var m=1;m<=d;m++){var p=a&&m===u.getDate(),v=s[m],h=p?"rgba(0,170,255,0.2)":v?"rgba(0,170,255,0.06)":"var(--surface)",S=p?"1px solid var(--accent)":v?"1px solid rgba(0,170,255,0.15)":"1px solid var(--border)",x="";v&&v.forEach(function(g){var C=g.severity==="critical"?"#ff3333":g.severity==="warning"?"#ffa500":"#00aaff";x+='<span style="display:inline-block;width:4px;height:4px;border-radius:50%;background:'+C+';margin:0 1px"></span>'}),c+='<div onclick="showCalDay('+m+')" style="padding:4px 2px;background:'+h+";border:"+S+";border-radius:4px;cursor:"+(v?"pointer":"default")+';min-height:32px"><div style="color:'+(p?"#00aaff":"#fff")+";font-weight:"+(p?"800":"400")+'">'+m+"</div>"+(x?'<div style="margin-top:2px">'+x+"</div>":"")+"</div>"}e.innerHTML=c}}function it(e){var t=document.getElementById("calDayDetail");if(t){var r={};try{var o=typeof s4ActionItems<"u"&&s4ActionItems.length>0?s4ActionItems:JSON.parse(localStorage.getItem("s4ActionItems")||"[]");o.forEach(function(s){var i=s.due||s.schedule||"";if(i){var l=new Date(i);if(!isNaN(l.getTime())&&l.getFullYear()===B&&l.getMonth()===k){var c=l.getDate();r[c]||(r[c]=[]),r[c].push(s)}}})}catch{}var n={3:[{title:"DMSMS Review — AN/SPS-49 Radar",severity:"critical",owner:"NAVSEA 04"}],7:[{title:"ILS Gap Analysis — DDG-51 FY25",severity:"warning",owner:"PMS 400"}],10:[{title:"Parts Order Deadline — CVN-78",severity:"critical",owner:"PMS 312"}],12:[{title:"Compliance Audit Prep",severity:"info",owner:"ILS Manager"}],15:[{title:"Warranty Expiry — GE LM2500",severity:"warning",owner:"PMS 300"}],18:[{title:"Lifecycle Cost Review",severity:"info",owner:"CAPE"}],21:[{title:"Risk Assessment Update",severity:"warning",owner:"PMS 400"}],24:[{title:"Readiness Report Due",severity:"critical",owner:"TYCOM"}],27:[{title:"Obsolescence Check — MIL-STD-1553",severity:"info",owner:"NAVSEA 04"}]},o=r[e]||n[e]||[];if(o.length===0){t.style.display="none";return}var d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],u='<div style="font-weight:700;color:#fff;margin-bottom:6px"><i class="fas fa-calendar-day" style="color:var(--accent);margin-right:4px"></i>'+d[k]+" "+e+", "+B+"</div>";o.forEach(function(a){var s=a.severity==="critical"?"#ff3333":a.severity==="warning"?"#ffa500":"#00aaff";u+='<div style="padding:6px 8px;background:rgba(0,0,0,0.2);border-left:3px solid '+s+';border-radius:4px;margin-bottom:4px"><div style="font-weight:600;color:#fff;font-size:0.8rem">'+(a.title||"Action Item")+"</div>"+(a.owner?'<div style="font-size:0.72rem;color:var(--steel)">Owner: '+a.owner+"</div>":"")+"</div>"}),t.innerHTML=u,t.style.display="block"}}function re(){var e=document.getElementById("actionCalendarGrid"),t=document.getElementById("calMonthLabel");if(!e||!t){setTimeout(re,500);return}Z(),(!e.innerHTML||e.innerHTML.trim()==="")&&setTimeout(Z,300)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){setTimeout(re,800)}):setTimeout(re,800);(function(){var e=new MutationObserver(function(r){r.forEach(function(n){if(n.type==="attributes"&&n.attributeName==="style"){var o=n.target;o.id==="hub-actions"&&o.style.display!=="none"&&setTimeout(Z,150)}})}),t=document.getElementById("hub-actions");t?e.observe(t,{attributes:!0,attributeFilter:["style"]}):document.addEventListener("DOMContentLoaded",function(){var r=document.getElementById("hub-actions");r&&e.observe(r,{attributes:!0,attributeFilter:["style"]})})})();window.anchorLifecycle=nt;window.calcLifecycle=at;window.changeCalMonth=ot;window.exportLifecycle=rt;window.handleFileSelect=Ze;window.loadPerformanceMetrics=Y;window.offlineClearQueue=Je;window.offlineQueueHash=Ge;window.offlineRemoveItem=Qe;window.handleFileDrop=Xe;window.offlineSyncAll=Ye;window.showCalDay=it;var Q=null;function st(){document.querySelectorAll(".tab-pane").forEach(function(s){s.classList.remove("show","active"),s.style.display="none"});var e=document.getElementById("sectionSystems");e&&(e.style.display="none"),document.querySelectorAll(".ils-hub-panel").forEach(function(s){s.classList.remove("active"),s.style.display="none"});var t=document.getElementById("ilsToolBackBar");t&&(t.style.display="none");var r=document.getElementById("ilsSubHub");r&&(r.style.display="grid");var n=document.querySelector(".ils-hub-tabs");n&&(n.style.display="none"),Q=null;var o=document.getElementById("platformHub");o&&(o.style.display="block",o.style.animation="fadeIn 0.3s ease");var d=document.getElementById("statsRow");if(d&&(d.style.display="flex"),!sessionStorage.getItem("s4_entered")){var u=document.querySelector(".hero");u&&(u.style.display="block");var a=document.getElementById("platformLanding");a&&(a.style.display="block")}history.replaceState(null,"",window.location.pathname)}function ne(e){var t=document.getElementById("platformHub");t&&(t.style.display="none");var r=document.querySelector(".hero");r&&(r.style.display="none");var n=document.getElementById("platformLanding");n&&(n.style.display="none"),document.querySelectorAll(".tab-pane").forEach(function(c){c.classList.remove("show","active"),c.style.display="none"});var o=document.getElementById("sectionSystems");o&&(o.style.display="none");var d={sectionAnchor:"tabAnchor",sectionVerify:"tabVerify",sectionLog:"tabLog",sectionILS:"tabILS",sectionSystems:"sectionSystems",sectionMetrics:"tabMetrics",sectionOffline:"tabOffline"};if(e==="sectionSystems")o&&(o.style.display="block",o.classList.add("show","active"),o.style.animation="fadeIn 0.3s ease");else{var u=d[e]||e,a=document.getElementById(u);a&&(a.style.display="block",a.classList.add("show","active"),a.style.animation="fadeIn 0.3s ease");var s=document.querySelector('a[href="#'+u+'"]');if(s)try{new bootstrap.Tab(s).show()}catch{}}if(e==="sectionILS"){var i=document.getElementById("ilsSubHub");i&&(i.style.display="grid");var l=document.getElementById("ilsToolBackBar");l&&(l.style.display="none"),document.querySelectorAll(".ils-hub-panel").forEach(function(c){c.classList.remove("active")})}}function lt(e){var t=document.getElementById("sectionSystems");t&&(t.style.display="none");var r=document.getElementById(e);r&&(r.style.display="block",r.classList.add("show","active"),r.style.animation="fadeIn 0.3s ease")}function oe(e){var t=document.getElementById("ilsSubHub");t&&(t.style.display="none");var r=document.getElementById("ilsToolBackBar");r&&(r.style.display="block"),document.querySelectorAll(".ils-hub-panel").forEach(function(d){d.classList.remove("active"),d.style.display="none"});var n=document.getElementById(e);n&&(n.style.display="block",n.classList.add("active"),n.style.animation="fadeIn 0.3s ease");var o=document.querySelector('.ils-hub-tab[onclick*="'+e+'"]');o&&(document.querySelectorAll(".ils-hub-tab").forEach(function(d){d.classList.remove("active")}),o.classList.add("active")),e==="hub-actions"&&(typeof renderHubActions=="function"&&renderHubActions(),typeof renderActionCalendar=="function"&&(setTimeout(renderActionCalendar,200),setTimeout(renderActionCalendar,600))),e==="hub-vault"&&typeof renderVault=="function"&&renderVault(),e==="hub-docs"&&typeof renderDocLibrary=="function"&&renderDocLibrary(),e==="hub-compliance"&&typeof calcCompliance=="function"&&calcCompliance(),e==="hub-risk"&&typeof loadRiskData=="function"&&loadRiskData(),e==="hub-roi"&&typeof calcROI=="function"&&calcROI(),e==="hub-reports"&&typeof loadReportPreview=="function"&&loadReportPreview(),e==="hub-predictive"&&typeof loadPredictiveData=="function"&&loadPredictiveData(),e==="hub-submissions"&&typeof loadSubmissionHistory=="function"&&loadSubmissionHistory(),e==="hub-sbom"&&typeof loadSBOMData=="function"&&loadSBOMData(),e==="hub-dmsms"&&typeof loadDMSMSData=="function"&&loadDMSMSData(),e==="hub-readiness"&&typeof loadReadinessData=="function"&&loadReadinessData(),e==="hub-lifecycle"&&typeof calcLifecycle=="function"&&calcLifecycle(),e==="hub-analysis"&&typeof initILSChecklist=="function"&&initILSChecklist(),typeof updateAiContext=="function"&&updateAiContext(e),(function(){var d=document.getElementById(e);if(!d)return;var u=d.querySelector("details");if(!u)return;u.style.display="none";var a="s4_hiw_"+e;function s(){var c=document.querySelector(".hiw-modal-overlay");c&&c.remove();var f=u.querySelector("summary")?u.querySelector("summary").textContent.replace(/[▸▾▾]/g,"").trim():"How It Works",m="";u.querySelectorAll("p,ol,ul,li").forEach(function(v){m+=v.outerHTML}),m||(m=u.innerHTML.replace(/<summary[^>]*>.*?<\/summary>/i,""));var p=document.createElement("div");p.className="hiw-modal-overlay",p.innerHTML='<div class="hiw-modal-box"><button class="hiw-close" title="Close">&times;</button><h4><i class="fas fa-info-circle" style="margin-right:6px"></i>'+f+'</h4><div class="hiw-body">'+m+"</div></div>",p.querySelector(".hiw-close").onclick=function(){p.remove()},p.onclick=function(v){v.target===p&&p.remove()},document.body.appendChild(p)}localStorage.getItem(a)||(localStorage.setItem(a,"1"),setTimeout(s,300));var i=d.querySelector("h3");if(i&&!i.querySelector(".hiw-help-btn")){var l=document.createElement("button");l.className="hiw-help-btn",l.title="How It Works",l.textContent="?",l.style.cssText="margin-left:8px;background:rgba(0,170,255,0.12);border:1px solid rgba(0,170,255,0.3);color:#00aaff;border-radius:50%;width:22px;height:22px;font-size:0.72rem;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;vertical-align:middle;",l.onclick=function(c){c.stopPropagation(),s()},i.appendChild(l)}})(),Q=e}function ct(){document.querySelectorAll(".ils-hub-panel").forEach(function(o){o.classList.remove("active"),o.style.display="none"});var e=document.getElementById("ilsSubHub");e&&(e.style.display="grid",e.style.animation="fadeIn 0.3s ease");var t=document.getElementById("ilsToolBackBar");t&&(t.style.display="none");var r=document.querySelector(".ils-hub-tabs");if(r&&(r.style.display="none"),Q=null,_currentRole&&typeof applyTabVisibility=="function"){var n=_customVisibleTabs||(_s4Roles[_currentRole]?_s4Roles[_currentRole].tabs:_allHubTabs);applyTabVisibility(n)}}(function(){var t="s4_demo_tool_card_order";function r(){return document.getElementById("ilsSubHub")}function n(){var u=r();if(u){var a=localStorage.getItem(t);if(a)try{var s=JSON.parse(a),i=Array.from(u.querySelectorAll(".ils-tool-card")),l={};i.forEach(function(c){var f=c.getAttribute("onclick")||"",m=(f.match(/openILSTool\('([^']+)'\)/)||[])[1];m&&(l[m]=c)}),s.forEach(function(c){l[c]&&u.appendChild(l[c])})}catch{}}}function o(){var u=r();if(u){var a=u.querySelectorAll(".ils-tool-card"),s=[];a.forEach(function(i){var l=i.getAttribute("onclick")||"",c=(l.match(/openILSTool\('([^']+)'\)/)||[])[1];c&&s.push(c)}),localStorage.setItem(t,JSON.stringify(s))}}function d(){var u=r();if(u){var a=null;u.querySelectorAll(".ils-tool-card").forEach(function(s){s.setAttribute("draggable","true"),s.addEventListener("dragstart",function(m){a=this,this.classList.add("dragging"),m.dataTransfer.effectAllowed="move",m.dataTransfer.setData("text/plain","")}),s.addEventListener("dragend",function(){this.classList.remove("dragging"),u.querySelectorAll(".ils-tool-card").forEach(function(m){m.classList.remove("drag-over")})}),s.addEventListener("dragover",function(m){m.preventDefault(),m.dataTransfer.dropEffect="move",this!==a&&this.classList.add("drag-over")}),s.addEventListener("dragleave",function(){this.classList.remove("drag-over")}),s.addEventListener("drop",function(m){if(m.preventDefault(),this.classList.remove("drag-over"),a&&a!==this){var p=Array.from(u.querySelectorAll(".ils-tool-card")),v=p.indexOf(a),h=p.indexOf(this);v<h?u.insertBefore(a,this.nextSibling):u.insertBefore(a,this),o(),d()}a=null});var i=null,l=!1,c=null,f=null;s.addEventListener("touchstart",function(m){var p=this;i=setTimeout(function(){l=!0,f=p,p.classList.add("dragging"),c=p.cloneNode(!0),c.style.position="fixed",c.style.pointerEvents="none",c.style.opacity="0.85",c.style.zIndex="9999",c.style.width=p.offsetWidth+"px",c.style.transform="scale(1.05)",c.style.boxShadow="0 8px 32px rgba(0,170,255,0.3)",document.body.appendChild(c)},500)},{passive:!0}),s.addEventListener("touchmove",function(m){if(!(!l||!c)){m.preventDefault();var p=m.touches[0];c.style.left=p.clientX-c.offsetWidth/2+"px",c.style.top=p.clientY-c.offsetHeight/2+"px",u.querySelectorAll(".ils-tool-card").forEach(function(S){S.classList.remove("drag-over")});var v=document.elementFromPoint(p.clientX,p.clientY);if(v){var h=v.closest(".ils-tool-card");h&&h!==f&&h.classList.add("drag-over")}}},{passive:!1}),s.addEventListener("touchend",function(m){if(clearTimeout(i),l&&f){var p=m.changedTouches[0],v=document.elementFromPoint(p.clientX,p.clientY),h=v?v.closest(".ils-tool-card"):null;if(h&&h!==f){var S=Array.from(u.querySelectorAll(".ils-tool-card")),x=S.indexOf(f),g=S.indexOf(h);x<g?u.insertBefore(f,h.nextSibling):u.insertBefore(f,h),o(),d()}f.classList.remove("dragging"),u.querySelectorAll(".ils-tool-card").forEach(function(C){C.classList.remove("drag-over")})}c&&c.parentNode&&c.parentNode.removeChild(c),l=!1,c=null,f=null}),s.addEventListener("touchcancel",function(){clearTimeout(i),c&&c.parentNode&&c.parentNode.removeChild(c),f&&f.classList.remove("dragging"),u.querySelectorAll(".ils-tool-card").forEach(function(m){m.classList.remove("drag-over")}),l=!1,c=null,f=null})})}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){n(),d()}):(n(),d())})();function dt(){var e=document.getElementById("walletSidebar"),t=document.getElementById("walletOverlay");e&&e.classList.add("open"),t&&t.classList.add("show");var r=document.getElementById("walletSidebarBody"),n=document.getElementById("tabWallet");r&&n&&!r.dataset.loaded&&(r.innerHTML=n.innerHTML,r.dataset.loaded="true",typeof loadWalletData=="function"&&loadWalletData(),ut(r)),Ae()}function ut(e){var t=e.querySelector("#slsToggleBtn");if(t){t.removeAttribute("onclick");var r=document.createElement("div");r.id="sidebarFlowPanel",r.style.cssText="display:none;margin-top:12px;background:linear-gradient(135deg,rgba(0,170,255,0.06),rgba(201,168,76,0.04));border:1px solid rgba(0,170,255,0.25);border-radius:3px;padding:16px 18px;",r.innerHTML='<div style="position:relative"><div style="position:absolute;top:-4px;right:0;background:linear-gradient(135deg,#00aaff,#c9a84c);padding:3px 12px;border-radius:0 10px 0 8px;font-size:0.62rem;font-weight:700;color:#050810;letter-spacing:0.5px">LIVE PREVIEW</div><h4 style="margin:0 0 4px;font-size:0.95rem;color:#fff"><i class="fas fa-flask" style="color:#00aaff;margin-right:6px"></i>Credit Economic Flow</h4><p style="color:#8ea4b8;font-size:0.72rem;margin:0 0 12px">See how the Credits token economy works. <strong style="color:#c9a84c">Every anchor costs 0.01 Credits.</strong></p><div style="display:grid;grid-template-columns:1fr 1fr;gap:8px"><div style="background:rgba(0,170,255,0.08);border:1px solid rgba(0,170,255,0.2);border-radius:3px;padding:10px;text-align:center"><div style="width:28px;height:28px;border-radius:50%;background:rgba(0,170,255,0.15);display:inline-flex;align-items:center;justify-content:center;margin-bottom:6px"><i class="fas fa-user-plus" style="color:#00aaff;font-size:0.75rem"></i></div><div style="font-size:0.68rem;font-weight:700;color:#fff">1. Account</div><div style="font-size:0.62rem;color:#8ea4b8">Created &amp; provisioned</div></div><div style="background:rgba(0,170,255,0.08);border:1px solid rgba(0,170,255,0.2);border-radius:3px;padding:10px;text-align:center"><div style="width:28px;height:28px;border-radius:50%;background:rgba(0,170,255,0.15);display:inline-flex;align-items:center;justify-content:center;margin-bottom:6px"><i class="fas fa-wallet" style="color:#00aaff;font-size:0.75rem"></i></div><div style="font-size:0.68rem;font-weight:700;color:#fff">2. Wallet Funded</div><div style="font-size:0.62rem;color:#8ea4b8">12 XRP reserve</div></div><div style="background:rgba(201,168,76,0.08);border:1px solid rgba(201,168,76,0.2);border-radius:3px;padding:10px;text-align:center"><div style="width:28px;height:28px;border-radius:50%;background:rgba(201,168,76,0.15);display:inline-flex;align-items:center;justify-content:center;margin-bottom:6px"><i class="fas fa-coins" style="color:#c9a84c;font-size:0.75rem"></i></div><div style="font-size:0.68rem;font-weight:700;color:#fff">3. Credits Allocated</div><div style="font-size:0.62rem;color:#8ea4b8">Based on plan tier</div></div><div style="background:rgba(0,170,255,0.08);border:1px solid rgba(0,170,255,0.2);border-radius:3px;padding:10px;text-align:center"><div style="width:28px;height:28px;border-radius:50%;background:rgba(0,170,255,0.15);display:inline-flex;align-items:center;justify-content:center;margin-bottom:6px"><i class="fas fa-arrow-right" style="color:#00aaff;font-size:0.75rem"></i></div><div style="font-size:0.68rem;font-weight:700;color:#fff">4. 0.01 Credits &rarr; Treasury</div><div style="font-size:0.62rem;color:#8ea4b8">Per anchor fee</div></div></div><div style="margin-top:10px;padding:8px 12px;background:rgba(0,0,0,0.25);border-radius:3px;font-size:0.7rem"><div style="display:flex;justify-content:space-between;flex-wrap:wrap;gap:6px"><div><span style="color:#8ea4b8">Wallet:</span> <span style="color:#00aaff;font-family:monospace" id="sidebarWalletAddr">rMLmk...f1KLqJ</span></div><div><span style="color:#8ea4b8">Balance:</span> <span style="color:#c9a84c;font-weight:700" id="sidebarSlsBal">'+(document.getElementById("slsBarBalance")?document.getElementById("slsBarBalance").textContent:"25,000")+" Credits</span></div></div></div></div>";var n=e.querySelector("#slsBalanceBar");n?n.parentNode.insertBefore(r,n.nextSibling):e.insertBefore(r,e.firstChild?e.firstChild.nextSibling:null);var o=!1;t.addEventListener("click",function(){o=!o,r.style.display=o?"block":"none",t.innerHTML=o?'<i class="fas fa-chevron-up" style="margin-right:4px"></i>Hide Flow Details':'<i class="fas fa-chart-simple" style="margin-right:4px"></i>Show Flow Details'})}}function ft(){var e=document.getElementById("walletSidebar"),t=document.getElementById("walletOverlay");e&&e.classList.remove("open"),t&&t.classList.remove("show")}function Ae(){var e=document.getElementById("slsBarBalance"),t=document.getElementById("walletTriggerBal");e&&t&&(t.textContent=e.textContent||"--")}document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){var e=document.getElementById("platformHub");e&&(e.style.display="block"),document.querySelectorAll(".tab-pane").forEach(function(r){r.classList.remove("show","active"),r.style.display="none"});var t=document.getElementById("demoPanel");t&&(t.style.display="none")},100)});document.addEventListener("shown.bs.tab",function(e){Ae()});(function(){function e(){var r=document.getElementById("actionItemBadge");if(r){var n=0;typeof s4ActionItems<"u"&&Array.isArray(s4ActionItems)&&(n=s4ActionItems.filter(function(o){return!o.done}).length),n>0?(r.textContent=n,r.style.display="inline-flex"):r.style.display="none"}}setInterval(e,3e3),document.addEventListener("DOMContentLoaded",function(){setTimeout(e,2e3)});var t=ne;ne=function(r){t(r),setTimeout(e,500)}})();(function(){function e(){var r=document.getElementById("slsBarBalance"),n=document.getElementById("slsBarAnchors"),o=document.getElementById("slsBarSpent"),d=document.getElementById("toolSlsBal"),u=document.getElementById("toolSlsAnch"),a=document.getElementById("toolSlsSpent");d&&r&&(d.textContent=r.textContent.replace(" Credits","")),u&&n&&(u.textContent=n.textContent),a&&o&&(a.textContent=o.textContent.replace(" Credits",""))}setInterval(e,2e3);var t=oe;oe=function(r){t(r),setTimeout(e,200)}})();(function(){var e=hideAnchorAnimation;hideAnchorAnimation=function(){if(e(),Q){var t=document.getElementById(Q);if(!t)return;var r=t.querySelector(".anchor-confirm-banner");r&&r.remove();var n=s4Vault.length>0?s4Vault[0]:null;if(!n)return;var o=document.createElement("div");o.className="anchor-confirm-banner",o.style.cssText="background:linear-gradient(135deg,rgba(0,204,102,0.08),rgba(0,170,255,0.06));border:1px solid rgba(0,204,102,0.2);border-radius:3px;padding:16px 20px;margin-bottom:16px;animation:panelSlideIn 0.4s ease;position:relative",o.innerHTML='<button onclick="this.parentElement.remove()" style="position:absolute;top:8px;right:12px;background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.85rem">&times;</button><div style="display:flex;align-items:center;gap:8px;margin-bottom:8px"><i class="fas fa-check-circle" style="color:#00cc66;font-size:1.1rem"></i><strong style="color:#fff;font-size:0.9rem">Record Anchored Successfully</strong></div><div style="font-size:0.78rem;color:var(--steel);display:grid;grid-template-columns:80px 1fr;gap:4px 12px"><span style="color:var(--muted)">Type:</span><span>'+(n.label||n.type)+'</span><span style="color:var(--muted)">Hash:</span><span style="font-family:monospace;color:var(--accent);font-size:0.72rem;word-break:break-all">'+(n.hash||"").substring(0,32)+'...</span><span style="color:var(--muted)">TX:</span><span>'+(n.txHash?'<a href="'+(n.explorerUrl||"#")+'" target="_blank" style="color:var(--accent);text-decoration:none">'+n.txHash.substring(0,16)+'... <i class="fas fa-external-link-alt" style="font-size:0.6rem"></i></a>':"Pending")+'</span><span style="color:var(--muted)">Fee:</span><span style="color:#c9a84c">0.01 Credits</span><span style="color:var(--muted)">Time:</span><span>'+new Date().toLocaleTimeString()+"</span></div>";var d=t.querySelector(".demo-card");d&&d.insertBefore(o,d.firstChild),setTimeout(function(){o.parentElement&&o.remove()},15e3)}}})();window.closeILSTool=ct;window.closeWalletSidebar=ft;window.openILSTool=oe;window.openWalletSidebar=dt;window.showHub=st;window.showSection=ne;window.showSystemsSub=lt;var O={ils_manager:{label:"ILS Manager",icon:"fa-clipboard-list",desc:"Full ILS tool suite access",tabs:["hub-analysis","hub-dmsms","hub-readiness","hub-compliance","hub-risk","hub-actions","hub-predictive","hub-lifecycle","hub-roi","hub-vault","hub-docs","hub-reports","hub-submissions","hub-sbom","hub-gfp","hub-cdrl","hub-contract","hub-provenance","hub-analytics","hub-team"]},dmsms_analyst:{label:"DMSMS Analyst",icon:"fa-microchip",desc:"DMSMS tracking and obsolescence management",tabs:["hub-dmsms","hub-risk","hub-lifecycle","hub-actions","hub-vault","hub-docs","hub-reports"]},auditor:{label:"Auditor / Compliance",icon:"fa-shield-halved",desc:"Compliance scorecard and audit vault",tabs:["hub-compliance","hub-vault","hub-actions","hub-docs","hub-reports","hub-submissions"]},contracts:{label:"Contract Specialist",icon:"fa-file-contract",desc:"ROI, submissions, and document management",tabs:["hub-roi","hub-vault","hub-docs","hub-reports","hub-submissions","hub-actions","hub-cdrl","hub-contract"]},supply_chain:{label:"Supply Chain / Provisioning",icon:"fa-truck",desc:"Supply, readiness, and provisioning tools",tabs:["hub-readiness","hub-risk","hub-lifecycle","hub-actions","hub-vault","hub-docs","hub-submissions"]},admin:{label:"Full Access Admin",icon:"fa-user-shield",desc:"All tools visible — unrestricted access",tabs:["hub-analysis","hub-dmsms","hub-readiness","hub-compliance","hub-risk","hub-actions","hub-predictive","hub-lifecycle","hub-roi","hub-vault","hub-docs","hub-reports","hub-submissions","hub-sbom","hub-gfp","hub-cdrl","hub-contract","hub-provenance","hub-analytics","hub-team"]}},ce=["hub-analysis","hub-dmsms","hub-readiness","hub-compliance","hub-risk","hub-actions","hub-predictive","hub-lifecycle","hub-roi","hub-vault","hub-docs","hub-reports","hub-submissions","hub-sbom","hub-gfp","hub-cdrl","hub-contract","hub-provenance","hub-analytics","hub-team"],mt={"hub-analysis":"Gap Analysis","hub-dmsms":"DMSMS Tracker","hub-readiness":"Readiness Calc","hub-compliance":"Compliance","hub-risk":"Supply Chain Risk","hub-actions":"Action Items","hub-predictive":"Predictive Maint","hub-lifecycle":"Lifecycle Cost","hub-roi":"ROI Calculator","hub-vault":"Audit Vault","hub-docs":"Document Library","hub-reports":"Report Gen","hub-submissions":"Submissions & PTD","hub-sbom":"SBOM Viewer","hub-gfp":"GFP Tracker","hub-cdrl":"CDRL Validator","hub-contract":"Contract Extractor","hub-provenance":"Provenance Chain","hub-analytics":"Cross-Program Analytics","hub-team":"Team Management"},_=sessionStorage.getItem("s4_user_role")||"",ee=sessionStorage.getItem("s4_user_title")||"",D=JSON.parse(sessionStorage.getItem("s4_visible_tabs")||"null");function _e(){var e=document.createElement("div");e.id="roleModal",e.style.cssText="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:10000;display:flex;align-items:center;justify-content:center;animation:fadeIn 0.3s ease";var t='<div style="background:var(--card);border:1px solid var(--border);border-radius:3px;padding:32px;max-width:620px;width:95%;max-height:85vh;overflow-y:auto"><h3 style="color:#fff;margin:0 0 4px"><i class="fas fa-user-cog" style="color:var(--accent);margin-right:8px"></i>Configure Your Role</h3><p style="color:var(--steel);font-size:0.85rem;margin-bottom:20px">Select your role to see relevant tools. You can customize visible tools and your displayed title.</p><div style="margin-bottom:16px"><label style="color:var(--steel);font-size:0.8rem;font-weight:600">Your Display Title</label><input id="roleTitle" value="'+(ee||"")+'" style="background:#0a0e1a;color:#fff;border:1px solid rgba(255,255,255,0.15);border-radius:3px;padding:10px;width:100%;margin-top:4px" placeholder="e.g., ILS Analyst, Logistics Specialist, Contract Manager"></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px">';Object.keys(O).forEach(function(r){var n=O[r],o=_===r?"border-color:var(--accent);background:rgba(0,170,255,0.08)":"";t+=`<div class="role-card" onclick="selectRolePreset('`+r+`')" style="border:2px solid `+(o?"var(--accent)":"var(--border)")+";border-radius:3px;padding:14px;cursor:pointer;transition:all 0.2s;"+(o?"background:rgba(0,170,255,0.08)":"")+'" data-role="'+r+'"><div style="display:flex;align-items:center;gap:8px;margin-bottom:6px"><i class="fas '+n.icon+'" style="color:var(--accent);font-size:1.1rem"></i><strong style="color:#fff;font-size:0.9rem">'+n.label+'</strong></div><div style="color:var(--steel);font-size:0.78rem">'+n.desc+'</div><div style="color:var(--muted);font-size:0.72rem;margin-top:4px">'+n.tabs.length+" tools</div></div>"}),t+='</div><details style="margin-bottom:20px;background:rgba(0,170,255,0.03);border:1px solid rgba(0,170,255,0.12);border-radius:3px;padding:0 16px"><summary style="cursor:pointer;color:var(--accent);font-weight:600;font-size:0.85rem;padding:12px 0;list-style:none;display:flex;align-items:center;gap:8px"><i class="fas fa-sliders-h"></i> Customize Visible Tools <i class="fas fa-chevron-down" style="font-size:0.7rem;margin-left:auto;opacity:0.5"></i></summary><div id="roleToolChecks" style="display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:0 0 16px">',ce.forEach(function(r){var n=D?D.indexOf(r)>=0:_?(O[_]?.tabs||[]).indexOf(r)>=0:!0;t+='<label style="display:flex;align-items:center;gap:8px;font-size:0.82rem;color:var(--steel);cursor:pointer;padding:6px 10px;border-radius:3px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);transition:all 0.2s"><input type="checkbox" data-tab="'+r+'" '+(n?"checked":"")+' onchange="onRoleToolToggle()" style="accent-color:#00aaff;width:16px;height:16px;flex-shrink:0"> <span>'+(mt[r]||r)+"</span></label>"}),t+=`</div></details><div style="display:flex;gap:10px;justify-content:flex-end"><button onclick="document.getElementById('roleModal').remove()" style="background:rgba(255,255,255,0.06);color:var(--steel);border:1px solid var(--border);border-radius:3px;padding:8px 20px;cursor:pointer">Cancel</button><button onclick="applyRole()" style="background:var(--accent);color:#fff;border:none;border-radius:3px;padding:8px 24px;cursor:pointer;font-weight:600">Apply Role</button></div></div>`,e.innerHTML=t,document.body.appendChild(e)}function pt(e){_=e,document.querySelectorAll(".role-card").forEach(function(o){o.style.borderColor="var(--border)",o.style.background=""});var t=document.querySelector('.role-card[data-role="'+e+'"]');t&&(t.style.borderColor="var(--accent)",t.style.background="rgba(0,170,255,0.08)");var r=O[e].tabs;document.querySelectorAll('#roleToolChecks input[type="checkbox"]').forEach(function(o){o.checked=r.indexOf(o.dataset.tab)>=0});var n=document.getElementById("roleTitle");n&&!n.value&&(n.value=O[e].label)}function yt(){D=[],document.querySelectorAll('#roleToolChecks input[type="checkbox"]').forEach(function(e){e.checked&&D.push(e.dataset.tab)})}function vt(){var e=document.getElementById("roleTitle")?.value?.trim()||"";ee=e,sessionStorage.setItem("s4_user_role",_),sessionStorage.setItem("s4_user_title",ee);var t;D?(t=D,sessionStorage.setItem("s4_visible_tabs",JSON.stringify(D))):_&&O[_]?(t=O[_].tabs,sessionStorage.removeItem("s4_visible_tabs")):t=ce,Be(t),ke(),typeof reloadVaultForRole=="function"&&reloadVaultForRole(),document.getElementById("roleModal")?.remove(),s4Notify("Role Applied",(e||O[_]?.label||"Custom")+" — "+t.length+" tools active","success")}function Be(e){document.querySelectorAll(".ils-hub-tab").forEach(function(t){var r=t.getAttribute("onclick")||"",n=r.match(/switchHubTab\('([^']+)'/);if(n){var o=n[1];t.style.display=e.indexOf(o)>=0?"":"none"}}),document.querySelectorAll(".ils-tool-card[onclick]").forEach(function(t){var r=t.getAttribute("onclick")||"",n=r.match(/openILSTool\('([^']+)'/);n&&(t.style.display=e.indexOf(n[1])>=0?"":"none")})}function ke(){var e=document.getElementById("roleBadge");if(!e){var t=document.querySelector(".ils-hub-tabs")?.previousElementSibling;if(!t)return;var r=t.querySelector("div:last-child");if(!r)return;e=document.createElement("span"),e.id="roleBadge",e.style.cssText="display:inline-flex;align-items:center;gap:6px;padding:5px 12px;border-radius:3px;font-size:0.75rem;font-weight:600;background:rgba(0,170,255,0.1);border:1px solid rgba(0,170,255,0.25);color:#00aaff;cursor:pointer;transition:all 0.2s;hover:background:rgba(0,170,255,0.2)",e.title="Click to change your role",e.onclick=_e,r.appendChild(e)}var n=_?O[_]?.icon||"fa-user":"fa-user-cog",o=ee||(_?O[_]?.label:"Set Role");e.innerHTML='<i class="fas '+n+'"></i> '+o+' <i class="fas fa-gear" style="font-size:0.6rem;opacity:0.6"></i>'}function ue(){if(_){var e=D||(O[_]?O[_].tabs:ce);Be(e),typeof reloadVaultForRole=="function"&&reloadVaultForRole()}ke(),_||setTimeout(function(){var t=document.getElementById("platformWorkspace");t&&t.style.display==="block"&&sessionStorage.getItem("s4_onboard_done")&&_e()},2500)}(function(){function e(a){return Math.round(a).toString().replace(/\B(?=(?:\d{3})+(?!\d))/g,",")}function t(){try{var a=function(A){var H=document.getElementById(A);return H&&parseFloat(H.value)||0},s=a("roiPrograms"),i=a("roiRecords"),l=a("roiFTEs"),c=a("roiRate"),f=a("roiAudit"),m=a("roiError"),p=a("roiIncidents"),v=a("roiLicense"),h=s*i,S=1+Math.sqrt(Math.max(0,h))/50,x=l*2080,g=x*c,C=g*.65*S,L=p*m*.9,y=f*.7*Math.max(1,s/5),w=h>0?C/12/h:0,I=C+L+y,T=I-v,b=v>0?T/v*100:0,E=I>0?Math.ceil(v/I*12):0,M=I*5-v*5,P=function(A,H,q){var te=document.getElementById(A);te&&(te.textContent=H,q&&(te.style.color=q))};P("roiSavings","$"+e(T),T>0?"#00cc66":"#ff4444"),P("roiPercent",b.toFixed(0)+"%",b>0?"#00cc66":"#ff4444"),P("roiPayback",E+" mo",null),P("roi5Year","$"+e(M),M>0?"#00cc66":"#ff4444");var U=document.getElementById("roiOutput");U&&(U.innerHTML='<div style="background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:20px;margin-top:12px"><div class="section-label"><i class="fas fa-chart-line"></i> ROI BREAKDOWN</div><div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;font-size:0.85rem;margin-bottom:16px"><div><span style="color:var(--steel)">Labor Automation (65%)</span><br><strong style="color:#00cc66">$'+e(C)+'</strong></div><div><span style="color:var(--steel)">Error Reduction (90%)</span><br><strong style="color:#00cc66">$'+e(L)+'</strong></div><div><span style="color:var(--steel)">Audit Cost Reduction (70%)</span><br><strong style="color:#00cc66">$'+e(y)+'</strong></div><div><span style="color:var(--steel)">S4 Ledger License</span><br><strong style="color:#ff6b6b">-$'+e(v)+'</strong></div></div><hr style="border-color:var(--border);margin:12px 0"><div style="display:flex;justify-content:space-between;align-items:center"><div><span style="color:var(--steel);font-size:0.82rem">Net Annual Savings</span><br><span style="font-size:1.5rem;font-weight:800;color:'+(T>0?"#00cc66":"#ff4444")+'">$'+e(T)+'</span></div><div><span style="color:var(--steel);font-size:0.82rem">Per-Record Savings</span><br><span style="font-size:1.1rem;font-weight:700;color:var(--accent)">$'+w.toFixed(2)+'/record</span></div><div><span style="color:var(--steel);font-size:0.82rem">Volume Multiplier</span><br><span style="font-size:1.1rem;font-weight:700;color:var(--accent)">'+S.toFixed(2)+"x</span></div></div></div>");try{typeof renderROICharts=="function"&&renderROICharts()}catch{}}catch{}}function r(){var a=["roiPrograms","roiRecords","roiFTEs","roiRate","roiAudit","roiError","roiIncidents","roiLicense"],s=0;return a.forEach(function(i){var l=document.getElementById(i);l&&(l.removeAttribute("oninput"),l.addEventListener("input",t),s++)}),s>0&&t(),s}function n(){var a={};try{var s=document.querySelectorAll('#ilsCoverage input[type="checkbox"], .ils-checklist input[type="checkbox"]'),i=0,l=s.length||1;s.forEach(function(m){m.checked&&i++}),a.ilsPct=Math.round(i/l*100)}catch{a.ilsPct=0}var c=["pctCMMC","pctNIST","pctDFARS","pctFAR","pctILS","pctDMSMSmgmt"];a.comp=c.map(function(m){var p=document.getElementById(m);return p&&parseInt(p.textContent)||0}),a.vault=typeof s4Vault<"u"?s4Vault.length:typeof getLocalRecords=="function"?getLocalRecords().length:0,a.actions=typeof s4ActionItems<"u"?s4ActionItems.length:0,a.actionsDone=0,typeof s4ActionItems<"u"&&s4ActionItems.forEach(function(m){m.status==="done"&&a.actionsDone++});var f=function(m){var p=document.getElementById(m);return p&&parseFloat(p.value)||0};return a.roiPrograms=f("roiPrograms"),a.roiRecords=f("roiRecords"),a.roiFTEs=f("roiFTEs"),a.roiRate=f("roiRate"),a.roiLicense=f("roiLicense"),a.roiAudit=f("roiAudit"),a.stats=typeof stats<"u"?stats:{anchored:0,slsFees:0},a.dmsmsItems=typeof dmsmsItems<"u"?dmsmsItems:[],a.riskItems=typeof riskItems<"u"?riskItems:[],a}var o={gapRadarChart:function(){var a=n(),s=Math.min(100,20+a.vault*3),i=Math.min(100,15+a.vault*4),l=Math.min(100,a.comp[0]||10),c=Math.min(100,10+(a.dmsmsItems.length||0)*8),f=Math.min(100,15+(a.riskItems.length||0)*5),m=Math.min(100,20+a.ilsPct*.6),p=[s,i,l,c,f,m].map(function(v){return Math.min(100,v+30+Math.random()*5|0)});return{type:"radar",data:{labels:["Tracking","Audit","Compliance","Obsolescence","Risk","Budget"],datasets:[{label:"Current (Manual)",data:[s,i,l,c,f,m],borderColor:"#ff6b6b",backgroundColor:"rgba(255,107,107,0.1)",pointBackgroundColor:"#ff6b6b"},{label:"With S4 Ledger",data:p,borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",pointBackgroundColor:"#00aaff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"#8ea4b8",font:{size:10}}}},scales:{r:{grid:{color:"rgba(255,255,255,0.06)"},angleLines:{color:"rgba(255,255,255,0.06)"},pointLabels:{color:"#8ea4b8",font:{size:9}},ticks:{display:!1}}}}}},gapBarChart:function(){var a=n(),s=Math.max(0,100-(20+a.vault*3)),i=Math.max(0,100-(15+a.vault*4)),l=Math.max(0,100-(a.comp[0]||10)),c=Math.max(0,100-(10+(a.dmsmsItems.length||0)*8)),f=Math.max(0,100-(15+(a.riskItems.length||0)*5)),m=Math.max(0,100-(20+a.ilsPct*.6));return{type:"bar",data:{labels:["Tracking","Audit","Compliance","Obsolescence","Risk","Budget"],datasets:[{label:"Gap %",data:[s,i,l,c,f,m],backgroundColor:["#ff6b6b","#fb923c","#c9a84c","#00aaff","#38bdf8","#06b6d4"],borderWidth:0,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},max:100},y:{ticks:{color:"#8ea4b8",font:{size:9}},grid:{display:!1}}}}}},dmsmsPieChart:function(){var a=n(),s=a.dmsmsItems,i=0,l=0,c=0,f=0,m=0;return s.length>0?s.forEach(function(p){var v=(p.status||"").toLowerCase();v.indexOf("obsolete")>=0?c++:v.indexOf("risk")>=0||v.indexOf("diminish")>=0?l++:v.indexOf("discontin")>=0?f++:v.indexOf("eol")>=0||v.indexOf("last")>=0?m++:i++}):(i=45,l=20,c=15,f=10,m=10),{type:"doughnut",data:{labels:["Active","At Risk","Obsolete","Discontinued","EOL Planned"],datasets:[{data:[i,l,c,f,m],backgroundColor:["#00aaff","#c9a84c","#ff6b6b","#00aaff","#6b7d93"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:9},padding:6}}}}}},readinessGauge:function(){var a=n(),s=Math.max(30,a.ilsPct),i=Math.min(100,s+15+(a.vault>5?10:0)),l=Math.min(100,s+(a.dmsmsItems.length>0?-5:8)),c=Math.min(100,s-12+a.vault*2),f=Math.min(100,s+20),m=Math.min(100,s+6+a.actionsDone*3),p=Math.min(100,s+12);return{type:"bar",data:{labels:["Personnel","Equipment","Supply","Training","Maintenance","C4ISR"],datasets:[{label:"Readiness %",data:[i,l,c,f,m,p],backgroundColor:"rgba(0,170,255,0.6)",borderColor:"#00aaff",borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:9}},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0,max:100}}}}},complianceRadarChart:function(){var a=n(),s=a.comp[2]||30,i=Math.min(100,40+a.vault*4),l=a.comp[1]||25,c=a.comp[0]||20,f=Math.min(100,30+a.ilsPct*.5),m=Math.min(100,35+a.vault*3);return{type:"polarArea",data:{labels:["DFARS","ITAR","NIST 800-171","CMMC","ISO 27001","SOX"],datasets:[{data:[s,i,l,c,f,m],backgroundColor:["rgba(0,170,255,0.5)","rgba(201,168,76,0.5)","rgba(56,189,248,0.5)","rgba(255,107,107,0.5)","rgba(0,170,255,0.5)","rgba(6,182,212,0.5)"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{color:"#8ea4b8",font:{size:9},padding:6}}},scales:{r:{grid:{color:"rgba(255,255,255,0.06)"},ticks:{display:!1}}}}}},roiLineChart:function(){var a=n(),s=a.roiPrograms*a.roiRecords,i=1+Math.sqrt(Math.max(0,s))/50,l=a.roiFTEs*2080*a.roiRate,c=l*.65*i,f=a.roiAudit*.7*Math.max(1,a.roiPrograms/5),m=c+f,p=a.roiLicense||1,v=[],h=[],S=a.roiPrograms>0||a.roiFTEs>0||a.roiLicense>0;if(S)for(var x=0,g=1;g<=5;g++)for(var C=1;C<=4;C++){v.push("Y"+g+"-Q"+C);var L=(g-1)*4+C,y=.2+.65*(1-Math.exp(-.18*L)),w=m/4*y,I=p/4;x+=w-I;var T=p>0?x/p*100:0;h.push(Math.round(T))}if(!S||h.length===0||h.every(function(M){return M===0})){v=[],h=[];for(var b=1;b<=5;b++)for(var E=1;E<=4;E++){v.push("Y"+b+"-Q"+E);var L=(b-1)*4+E;h.push(Math.round(-15+3.5*L+.8*Math.pow(L,1.45)))}}return{type:"line",data:{labels:v,datasets:[{label:"Cumulative ROI %",data:h,borderColor:"#00cc66",backgroundColor:"rgba(0,204,102,0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"#00cc66"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"5-Year Cumulative ROI",color:"#8ea4b8",font:{size:11}}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:8},maxRotation:45},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:9},callback:function(M){return M+"%"}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}}},riskHeatChart:function(){var a=n(),s=[];if(a.riskItems.length>0)a.riskItems.forEach(function(f){s.push({x:f.likelihood||Math.ceil(Math.random()*9),y:f.impact||Math.ceil(Math.random()*9)})});else for(var i=Math.max(3,Math.min(12,3+a.vault+a.actions)),l=0;l<i;l++)s.push({x:1+Math.floor(Math.random()*9),y:1+Math.floor(Math.random()*9)});var c=s.map(function(f){var m=f.x*f.y;return m>=50?"rgba(255,70,70,0.8)":m>=25?"rgba(255,165,0,0.7)":m>=10?"rgba(201,168,76,0.6)":"rgba(0,170,255,0.5)"});return{type:"scatter",data:{datasets:[{label:"Risk Items",data:s,backgroundColor:c,borderColor:c,pointRadius:7}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:s.length+" Risk Items Mapped",color:"#8ea4b8",font:{size:11}}},scales:{x:{title:{display:!0,text:"Likelihood →",color:"#8ea4b8",font:{size:9}},ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},min:0,max:10},y:{title:{display:!0,text:"Impact →",color:"#8ea4b8",font:{size:9}},ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},min:0,max:10}}}}},lifecyclePieChart:function(){var a=n(),s=Math.min(30,(a.dmsmsItems.length||0)*5),i=Math.min(15,a.ilsPct*.15);return{type:"line",data:{labels:["Intro","Growth","Maturity","Sustain","Phase Out","Disposal"],datasets:[{label:"Availability %",data:[95-s*.1,92-s*.2+i,88-s*.4+i,75-s*.6+i*2,50-s*.3+i,20+i*.5].map(function(l){return Math.round(Math.max(5,Math.min(100,l)))}),borderColor:"#00aaff",backgroundColor:"rgba(0,170,255,0.1)",fill:!0,tension:.3},{label:"Cost Index",data:[30,25+s*.3,35+s*.5,55+s*.8-i,70+s-i*2,90+s*.5-i].map(function(l){return Math.round(Math.max(5,Math.min(100,l)))}),borderColor:"#ff6b6b",backgroundColor:"rgba(255,107,107,0.05)",fill:!0,tension:.3}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"#8ea4b8",font:{size:10}}}},scales:{x:{ticks:{color:"#8ea4b8",font:{size:9}},grid:{display:!1}},y:{ticks:{color:"#6b7d93",font:{size:9}},grid:{color:"rgba(255,255,255,0.04)"},beginAtZero:!0}}}}}};window._bpRenderInPanel=d;function d(a){if(!(typeof Chart>"u")){if(typeof injectChartContainers=="function")try{injectChartContainers()}catch{}var s=a.querySelectorAll("canvas");s.length!==0&&s.forEach(function(i){if(!i.getAttribute("data-bp-rendered")){var l=o[i.id];if(l)try{var c=Chart.getChart(i);c&&c.destroy(),!i.style.height&&!i.getAttribute("height")&&(i.style.height="220px"),i.style.width="100%",i.style.display="block";var f=i.closest(".chart-container");f&&(f.style.display="block",f.style.visibility="visible"),new Chart(i,l()),i.setAttribute("data-bp-rendered","1"),i.setAttribute("data-bp-ts",Date.now())}catch{}}})}}function u(){if(r()===0&&(setTimeout(r,2e3),setTimeout(r,5e3)),window.calcROI=t,typeof window.openILSTool=="function"){var a=window.openILSTool;window.openILSTool=function(i){a(i),setTimeout(function(){var l=document.getElementById(i);l&&d(l)},300),setTimeout(function(){var l=document.getElementById(i);l&&d(l)},800),setTimeout(function(){var l=document.getElementById(i);l&&d(l)},2e3)}}if(typeof window.switchHubTab=="function"){var s=window.switchHubTab;window.switchHubTab=function(i,l){s(i,l),setTimeout(function(){var c=document.getElementById(i);c&&d(c)},400)}}document.querySelectorAll(".ils-hub-panel").forEach(function(i){var l=new MutationObserver(function(c){c.forEach(function(f){f.target.classList&&f.target.classList.contains("active")&&setTimeout(function(){d(f.target)},400)})});l.observe(i,{attributes:!0,attributeFilter:["class","style"]})}),setTimeout(function(){document.querySelectorAll(".ils-hub-panel.active").forEach(function(i){d(i)})},2e3),setTimeout(function(){if(typeof loadPerformanceMetrics=="function")try{loadPerformanceMetrics()}catch{}},1500),setTimeout(r,3e3),typeof ue=="function"&&ue()}window._s4RefreshCharts=function(){document.querySelectorAll("canvas[data-bp-rendered]").forEach(function(s){s.removeAttribute("data-bp-rendered")});var a=document.querySelector(".ils-hub-panel.active");a&&d(a)},document.readyState==="loading"?document.addEventListener("DOMContentLoaded",u):u()})();window.applyRole=vt;window.onRoleToolToggle=yt;window.selectRolePreset=pt;(function(){var e={lcp:null,fid:null,cls:0,inp:null,ttfb:null,entries:[]},t=window.S4=window.S4||{};t.vitals=e;function r(i,l){e.entries.push({name:i,value:Math.round(l*100)/100,ts:Date.now()})}try{var n=performance.getEntriesByType("navigation");n&&n[0]&&(e.ttfb=Math.round(n[0].responseStart),r("TTFB",e.ttfb))}catch{}try{if("PerformanceObserver"in window){var o=new PerformanceObserver(function(i){var l=i.getEntries(),c=l[l.length-1];c&&(e.lcp=Math.round(c.startTime),r("LCP",e.lcp))});o.observe({type:"largest-contentful-paint",buffered:!0})}}catch{}try{if("PerformanceObserver"in window){var d=new PerformanceObserver(function(i){var l=i.getEntries();l[0]&&(e.fid=Math.round(l[0].processingStart-l[0].startTime),r("FID",e.fid),d.disconnect())});d.observe({type:"first-input",buffered:!0})}}catch{}try{if("PerformanceObserver"in window){var u=new PerformanceObserver(function(i){var l=i.getEntries();l.forEach(function(c){c.hadRecentInput||(e.cls+=c.value)}),e.cls=Math.round(e.cls*1e4)/1e4,r("CLS",e.cls)});u.observe({type:"layout-shift",buffered:!0})}}catch{}try{if("PerformanceObserver"in window){var a=new PerformanceObserver(function(i){var l=i.getEntries();l.forEach(function(c){var f=c.duration;(e.inp===null||f>e.inp)&&(e.inp=Math.round(f),r("INP",e.inp))})});a.observe({type:"event",buffered:!0,durationThreshold:40})}}catch{}t.vitals.summary=function(){return{TTFB:e.ttfb!==null?e.ttfb+"ms":"n/a",LCP:e.lcp!==null?e.lcp+"ms":"n/a",FID:e.fid!==null?e.fid+"ms":"n/a",CLS:e.cls.toFixed(4),INP:e.inp!==null?e.inp+"ms":"n/a",grade:s()}};function s(){var i=0,l=0;if(e.lcp!==null&&(i+=e.lcp<=2500?1:e.lcp<=4e3?.5:0,l++),e.fid!==null&&(i+=e.fid<=100?1:e.fid<=300?.5:0,l++),e.cls!==null&&(i+=e.cls<=.1?1:e.cls<=.25?.5:0,l++),e.inp!==null&&(i+=e.inp<=200?1:e.inp<=500?.5:0,l++),l===0)return"n/a";var c=Math.round(i/l*100);return c>=90?"Good":c>=50?"Needs Improvement":"Poor"}})();
