<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0a0f">
    <meta name="description" content="Solus Protocol - Decentralized Healthcare Data Wallet on XRPL">
    <!-- Open Graph / Social -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://solusprotocol.vercel.app/demo-app/">
    <meta property="og:title" content="Solus Protocol | Healthcare Data Wallet">
    <meta property="og:description" content="Decentralized healthcare data wallet powered by XRPL. Anchor, verify, and share medical records with zero-knowledge privacy.">
    <meta property="og:image" content="https://raw.githubusercontent.com/solusprotocol1/solus-protocol/main/logo.png">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@Solus_Protocol">
    <meta name="twitter:title" content="Solus Protocol | Healthcare Data Wallet">
    <meta name="twitter:description" content="Decentralized healthcare data wallet powered by XRPL. Anchor, verify, and share medical records with zero-knowledge privacy.">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/solusprotocol1/solus-protocol/main/logo.png">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/solusprotocol1/solus-protocol/main/logo.png">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/solusprotocol1/solus-protocol/main/logo.png">
    <title>Solus Protocol | Healthcare Data Wallet</title>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script src="https://unpkg.com/xrpl@4.1.0/build/xrpl-latest-min.js"></script>
    <style>
        :root {
            --primary: #0a0a0f;
            --secondary: #9945FF;
            --accent: #14F195;
            --accent2: #00C2FF;
            --dark: #12121a;
            --card: rgba(20, 20, 35, 0.95);
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
            --text: #ffffff;
            --text-muted: #8892b0;
            --success: #14F195;
            --warning: #ffd700;
            --danger: #ff4757;
            --provider: #9945FF;
            --ehr: #ffd700;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: var(--primary);
            color: var(--text);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            overflow-x: hidden;
        }

        html {
            height: -webkit-fill-available;
        }

        /* App Container */
        .app-container {
            max-width: 430px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
        }

        /* Screens */
        .screen {
            display: none;
            min-height: 100vh;
            padding-bottom: 90px;
            animation: fadeIn 0.3s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(20, 241, 149, 0.3); }
            50% { box-shadow: 0 0 40px rgba(20, 241, 149, 0.5); }
        }

        /* Login Screen */
        #loginScreen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px 24px;
            background: radial-gradient(ellipse at top, rgba(153, 69, 255, 0.15) 0%, transparent 50%),
                        radial-gradient(ellipse at bottom, rgba(20, 241, 149, 0.1) 0%, transparent 50%),
                        var(--primary);
        }

        .login-logo {
            font-size: 4rem;
            margin-bottom: 16px;
            animation: float 3s ease-in-out infinite;
        }

        .login-title {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .login-subtitle {
            color: var(--text-muted);
            font-size: 0.95rem;
            margin-bottom: 40px;
        }

        .role-selector {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: 100%;
            max-width: 320px;
            margin-bottom: 32px;
        }

        .role-card {
            background: var(--card);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .role-card:hover {
            transform: translateY(-2px);
            border-color: var(--accent);
        }

        .role-card.selected {
            border-color: var(--accent);
            background: rgba(20, 241, 149, 0.1);
        }

        .role-card.provider.selected {
            border-color: var(--provider);
            background: rgba(153, 69, 255, 0.1);
        }

        .role-card.ehr.selected {
            border-color: var(--ehr);
            background: rgba(255, 215, 0, 0.1);
        }

        .role-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .role-icon.patient { background: rgba(20, 241, 149, 0.2); color: var(--accent); }
        .role-icon.provider { background: rgba(153, 69, 255, 0.2); color: var(--provider); }
        .role-icon.ehr { background: rgba(255, 215, 0, 0.2); color: var(--ehr); }

        .role-info h3 {
            font-size: 1.1rem;
            margin-bottom: 4px;
        }

        .role-info p {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .login-form {
            width: 100%;
            max-width: 320px;
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            display: block;
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-bottom: 8px;
        }

        .input-group input {
            width: 100%;
            padding: 16px;
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(20, 241, 149, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            border: none;
            border-radius: 12px;
            color: var(--primary);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 8px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(20, 241, 149, 0.3);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .demo-hint {
            color: var(--text-muted);
            font-size: 0.8rem;
            text-align: center;
            margin-top: 24px;
        }

        /* Header */
        .app-header {
            padding: 20px 20px 16px;
            background: linear-gradient(180deg, rgba(10, 10, 15, 0.98) 0%, transparent 100%);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .user-greeting h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .user-greeting p {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .user-avatar:hover {
            transform: scale(1.05);
        }

        .user-avatar.provider {
            background: linear-gradient(135deg, var(--provider), #c77dff);
        }

        .user-avatar.ehr {
            background: linear-gradient(135deg, var(--ehr), #ffaa00);
        }

        /* Status Bar */
        .status-bar {
            display: flex;
            gap: 12px;
            padding: 12px 16px;
            background: var(--card);
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent);
            animation: pulse 2s infinite;
        }

        .status-dot.warning { background: var(--warning); }

        /* Content */
        .content {
            padding: 0 20px;
        }

        /* Section */
        .section {
            margin-bottom: 28px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .section-action {
            color: var(--accent);
            font-size: 0.9rem;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        .section-action:hover {
            opacity: 0.8;
        }

        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .stat-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            border-color: var(--accent);
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Action Grid */
        .action-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .action-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px 16px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .action-card:hover {
            transform: translateY(-3px);
            border-color: var(--accent);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .action-card:active {
            transform: scale(0.98);
        }

        .action-icon {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin: 0 auto 12px;
            transition: transform 0.3s;
        }

        .action-card:hover .action-icon {
            transform: scale(1.1);
        }

        .action-icon.green { background: rgba(20, 241, 149, 0.15); color: var(--accent); }
        .action-icon.purple { background: rgba(153, 69, 255, 0.15); color: var(--provider); }
        .action-icon.blue { background: rgba(0, 194, 255, 0.15); color: var(--accent2); }
        .action-icon.gold { background: rgba(255, 215, 0, 0.15); color: var(--ehr); }

        .action-title {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .action-desc {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Records List */
        .records-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .record-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 14px;
            cursor: pointer;
            transition: all 0.3s;
            animation: slideIn 0.3s ease backwards;
        }

        .record-card:nth-child(1) { animation-delay: 0.05s; }
        .record-card:nth-child(2) { animation-delay: 0.1s; }
        .record-card:nth-child(3) { animation-delay: 0.15s; }
        .record-card:nth-child(4) { animation-delay: 0.2s; }

        .record-card:hover {
            transform: translateX(4px);
            border-color: var(--accent);
        }

        .record-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .record-icon.vitals { background: rgba(255, 107, 107, 0.15); color: #ff6b6b; }
        .record-icon.lab { background: rgba(78, 205, 196, 0.15); color: #4ecdc4; }
        .record-icon.imaging { background: rgba(69, 170, 242, 0.15); color: #45aaf2; }
        .record-icon.rx { background: rgba(255, 165, 2, 0.15); color: #ffa502; }
        .record-icon.visit { background: rgba(165, 94, 234, 0.15); color: #a55eea; }

        .record-info {
            flex: 1;
            min-width: 0;
        }

        .record-title {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .record-meta {
            display: flex;
            gap: 12px;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .record-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .record-badge.verified {
            background: rgba(20, 241, 149, 0.15);
            color: var(--accent);
        }

        .record-badge.pending {
            background: rgba(255, 215, 0, 0.15);
            color: var(--warning);
        }

        .record-arrow {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 430px;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 12px 0 calc(24px + env(safe-area-inset-bottom, 0px));
            z-index: 1000;
        }

        /* Ensure screen content doesn't hide behind safe-area nav */
        .screen {
            padding-bottom: calc(90px + env(safe-area-inset-bottom, 0px));
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            color: var(--text-muted);
            transition: all 0.3s;
            padding: 8px 16px;
            border-radius: 12px;
        }

        .nav-item:hover {
            color: var(--text);
        }

        .nav-item.active {
            color: var(--accent);
        }

        .nav-item.active .nav-icon {
            transform: scale(1.1);
        }

        .nav-icon {
            font-size: 1.3rem;
            transition: transform 0.3s;
        }

        .nav-label {
            font-size: 0.7rem;
            font-weight: 500;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: flex-end;
            justify-content: center;
            z-index: 2000;
        }

        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.2s ease;
        }

        .modal {
            background: var(--dark);
            width: 100%;
            max-width: 430px;
            border-radius: 24px 24px 0 0;
            padding: 24px;
            max-height: 85vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        .modal-handle {
            width: 40px;
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            margin: 0 auto 20px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--glass);
            border: none;
            color: var(--text);
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: var(--border);
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 3000;
            transition: transform 0.3s ease;
            max-width: 90%;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .toast.success {
            border-color: var(--accent);
        }

        .toast.success .toast-icon {
            color: var(--accent);
        }

        .toast.error {
            border-color: var(--danger);
        }

        .toast.error .toast-icon {
            color: var(--danger);
        }

        .toast-icon {
            font-size: 1.2rem;
        }

        .toast-message {
            font-size: 0.9rem;
        }

        /* Activity Feed */
        .activity-feed {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .activity-item {
            display: flex;
            gap: 12px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-top: 5px;
            flex-shrink: 0;
        }

        .activity-dot.green { background: var(--accent); }
        .activity-dot.purple { background: var(--provider); }
        .activity-dot.blue { background: var(--accent2); }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            font-size: 0.9rem;
            margin-bottom: 4px;
        }

        .activity-time {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Charts placeholder */
        .chart-container {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            height: 200px;
            display: flex;
            flex-direction: column;
        }

        .chart-bars {
            flex: 1;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            gap: 8px;
            padding-top: 20px;
        }

        .chart-bar {
            flex: 1;
            background: linear-gradient(180deg, var(--accent), rgba(20, 241, 149, 0.3));
            border-radius: 4px 4px 0 0;
            min-height: 20px;
            transition: all 0.5s ease;
        }

        .chart-labels {
            display: flex;
            justify-content: space-around;
            margin-top: 12px;
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        textarea.form-input {
            min-height: 100px;
            resize: none;
        }

        .form-select {
            width: 100%;
            padding: 14px 16px;
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 1rem;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%238892b0' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
        }

        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            color: var(--primary);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(20, 241, 149, 0.3);
        }

        .btn-secondary {
            background: var(--glass);
            border: 1px solid var(--border);
            color: var(--text);
        }

        .btn-secondary:hover {
            border-color: var(--accent);
        }

        .btn-full {
            width: 100%;
        }

        /* Provider specific */
        .patient-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .patient-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .patient-card:hover {
            border-color: var(--provider);
        }

        .patient-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .patient-info {
            flex: 1;
        }

        .patient-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .patient-meta {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* EHR Dashboard */
        .api-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .api-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .api-title {
            font-weight: 600;
        }

        .api-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .api-status.active {
            background: rgba(20, 241, 149, 0.15);
            color: var(--accent);
        }

        .api-key {
            font-family: monospace;
            background: var(--glass);
            padding: 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            color: var(--text-muted);
            word-break: break-all;
        }

        /* Loading spinner */
        .spinner {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Scan animation */
        .scan-animation {
            width: 200px;
            height: 200px;
            margin: 40px auto;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scan-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 2px solid var(--accent);
            border-radius: 50%;
            animation: scanPulse 2s ease-out infinite;
        }

        .scan-ring:nth-child(2) { animation-delay: 0.4s; }
        .scan-ring:nth-child(3) { animation-delay: 0.8s; }

        @keyframes scanPulse {
            0% { transform: scale(0.5); opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }

        .scan-icon {
            font-size: 3rem;
            color: var(--accent);
            z-index: 1;
        }

        /* Progress bar */
        .progress-bar {
            height: 8px;
            background: var(--glass);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--accent2));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* Notification badge */
        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 18px;
            height: 18px;
            background: var(--danger);
            border-radius: 50%;
            font-size: 0.65rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        /* Settings list */
        .settings-list {
            display: flex;
            flex-direction: column;
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: opacity 0.3s;
        }

        .settings-item:hover {
            opacity: 0.8;
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-left {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .settings-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--glass);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent);
        }

        .settings-icon.danger {
            color: var(--danger);
        }

        .toggle {
            width: 50px;
            height: 28px;
            background: var(--glass);
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle.active {
            background: var(--accent);
        }

        .toggle::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            transition: transform 0.3s;
        }

        .toggle.active::after {
            transform: translateX(22px);
        }

        /* ===== PARTICLES & MESH BACKGROUND ===== */
        #app-particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; pointer-events: none; }
        .app-mesh-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; }
        .app-mesh-bg .g-orb { position: absolute; border-radius: 50%; filter: blur(100px); opacity: 0.3; transition: transform 0.1s ease-out; }
        .app-mesh-bg .g-orb-1 { width: 350px; height: 350px; background: var(--accent); top: -120px; right: -120px; animation: orb-drift-1 8s ease-in-out infinite; }
        .app-mesh-bg .g-orb-2 { width: 250px; height: 250px; background: var(--secondary); bottom: -80px; left: -80px; animation: orb-drift-2 10s ease-in-out infinite; }
        .app-mesh-bg .g-orb-3 { width: 200px; height: 200px; background: linear-gradient(135deg, var(--accent), var(--secondary)); top: 50%; left: 50%; transform: translate(-50%, -50%); animation: orb-drift-3 12s ease-in-out infinite; }

        @keyframes orb-drift-1 { 0%, 100% { transform: translate(0, 0); } 33% { transform: translate(25px, 35px); } 66% { transform: translate(-10px, 15px); } }
        @keyframes orb-drift-2 { 0%, 100% { transform: translate(0, 0); } 33% { transform: translate(-20px, -25px); } 66% { transform: translate(15px, -10px); } }
        @keyframes orb-drift-3 { 0%, 100% { transform: translate(-50%, -50%) scale(1); } 33% { transform: translate(calc(-50% + 15px), calc(-50% + 20px)) scale(1.05); } 66% { transform: translate(calc(-50% - 10px), calc(-50% - 15px)) scale(0.95); } }

        /* ===== CARD STAGGER ENTRANCE ===== */
        @keyframes card-cascade { from { opacity: 0; transform: translateY(24px); } to { opacity: 1; transform: translateY(0); } }
        .screen.active .section { animation: card-cascade 0.45s ease-out backwards; }
        .screen.active .section:nth-child(1) { animation-delay: 0s; }
        .screen.active .section:nth-child(2) { animation-delay: 0.07s; }
        .screen.active .section:nth-child(3) { animation-delay: 0.14s; }
        .screen.active .section:nth-child(4) { animation-delay: 0.21s; }
        .screen.active .section:nth-child(5) { animation-delay: 0.28s; }
        .screen.active .section:nth-child(6) { animation-delay: 0.35s; }
        .screen.active .section:nth-child(7) { animation-delay: 0.42s; }

        /* ===== FLOATING ACTION BUTTON ===== */
        .fab { position: fixed; bottom: calc(80px + env(safe-area-inset-bottom, 0px)); right: 20px; width: 56px; height: 56px; border-radius: 50%; background: linear-gradient(135deg, var(--accent), var(--secondary)); border: none; color: #fff; font-size: 1.5rem; display: none; align-items: center; justify-content: center; box-shadow: 0 4px 24px rgba(20, 241, 149, 0.4), 0 0 0 0 rgba(20, 241, 149, 0.2); z-index: 500; cursor: pointer; transition: all 0.3s; animation: fab-pulse 3s ease-in-out infinite; }
        .fab.visible { display: flex; }
        .fab:active { transform: scale(0.9); }
        @keyframes fab-pulse { 0%, 100% { box-shadow: 0 4px 24px rgba(20, 241, 149, 0.4), 0 0 0 0 rgba(20, 241, 149, 0.2); } 50% { box-shadow: 0 4px 24px rgba(20, 241, 149, 0.4), 0 0 0 12px rgba(20, 241, 149, 0); } }

        /* ===== GRADIENT TEXT HEADER ===== */
        .gradient-text { background: linear-gradient(135deg, var(--accent), var(--accent2), var(--secondary), var(--accent)); background-size: 300% 300%; -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; animation: gradient-text-flow 4s ease infinite; }
        @keyframes gradient-text-flow { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }

        /* ===== SWIPE DISMISS MODAL ===== */
        .modal.swiping { transition: none !important; }
        .modal-overlay.dismissing { animation: fadeOut 0.2s ease forwards; }
        @keyframes fadeOut { to { opacity: 0; } }

        /* ===== SKELETON SHIMMER (loading placeholder) ===== */
        .skeleton {
            background: linear-gradient(90deg, var(--glass) 25%, rgba(255,255,255,0.08) 50%, var(--glass) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 8px;
            min-height: 20px;
        }
        .skeleton-card { height: 80px; margin-bottom: 12px; border-radius: 16px; }
        .skeleton-stat { height: 70px; border-radius: 16px; }
        .skeleton-text { height: 14px; margin-bottom: 8px; width: 60%; }
        .skeleton-text.wide { width: 90%; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        /* ===== SCROLL TO TOP ===== */
        .scroll-top-btn {
            position: fixed; bottom: calc(80px + env(safe-area-inset-bottom, 0px)); left: 20px;
            width: 40px; height: 40px; border-radius: 50%; background: var(--glass);
            border: 1px solid var(--border); color: var(--text); font-size: 1rem;
            display: none; align-items: center; justify-content: center;
            z-index: 500; cursor: pointer; transition: all 0.3s; backdrop-filter: blur(10px);
        }
        .scroll-top-btn.visible { display: flex; }
        .scroll-top-btn:active { transform: scale(0.9); }

        /* ===== LONG PRESS CONTEXT MENU ===== */
        .context-menu {
            position: fixed; background: var(--dark); border: 1px solid var(--border);
            border-radius: 16px; padding: 8px 0; z-index: 9000; display: none;
            min-width: 180px; box-shadow: 0 12px 40px rgba(0,0,0,0.6); backdrop-filter: blur(20px);
            animation: scaleIn 0.15s ease-out;
        }
        .context-menu.active { display: block; }
        .context-menu-item {
            display: flex; align-items: center; gap: 12px; padding: 12px 20px;
            font-size: 0.9rem; color: var(--text); cursor: pointer; transition: background 0.15s;
        }
        .context-menu-item:hover { background: rgba(255,255,255,0.05); }
        .context-menu-item i { width: 18px; text-align: center; color: var(--text-muted); }
        .context-menu-item.danger { color: var(--danger); }
        .context-menu-item.danger i { color: var(--danger); }
        @keyframes scaleIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        /* ===== LIVE CLOCK ===== */
        .header-clock { font-size: 0.75rem; color: var(--text-muted); font-variant-numeric: tabular-nums; }

        /* ===== ENHANCED ANIMATIONS ===== */
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(20, 241, 149, 0.3), 0 0 20px rgba(20, 241, 149, 0.1); }
            50% { box-shadow: 0 0 20px rgba(20, 241, 149, 0.5), 0 0 40px rgba(20, 241, 149, 0.2); }
        }
        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .fade-in-up { opacity: 0; transform: translateY(20px); transition: opacity 0.5s ease, transform 0.5s ease; }
        .fade-in-up.visible { opacity: 1; transform: translateY(0); }

        /* ===== ACTION HELP ICONS ===== */
        .action-help-btn { color: var(--text-muted); font-size: 0.95rem; cursor: pointer; transition: color 0.2s; padding: 4px; }
        .action-help-btn:hover { color: var(--accent); }
        .action-help-tooltip {
            display: none; background: var(--card); border: 1px solid var(--accent); border-radius: 16px;
            padding: 20px; margin-bottom: 16px; animation: slideUp 0.3s ease; z-index: 10;
        }
        .action-help-tooltip.show { display: block; }
        .action-help-close { float: right; cursor: pointer; color: var(--text-muted); font-size: 1.2rem; line-height: 1; }
        .action-help-close:hover { color: var(--text); }
        .help-action-item { display: flex; gap: 12px; padding: 10px 0; border-bottom: 1px solid var(--border); align-items: flex-start; }
        .help-action-item:last-child { border-bottom: none; }
        .help-action-item i { margin-top: 3px; font-size: 1.1rem; width: 20px; text-align: center; flex-shrink: 0; }
        .help-action-item strong { display: block; margin-bottom: 2px; font-size: 0.9rem; }
        .help-action-item p { margin: 0; font-size: 0.8rem; color: var(--text-muted); }

        /* ===== ABOUT SCREEN ===== */
        .about-card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 20px; margin-bottom: 16px; }
        .about-card h3 { font-size: 1.1rem; margin-bottom: 12px; color: var(--accent); }
        .about-card p { color: var(--text-muted); font-size: 0.9rem; line-height: 1.6; margin-bottom: 12px; }
        .about-card p:last-child { margin-bottom: 0; }
        .how-step { display: flex; gap: 16px; align-items: flex-start; padding: 12px 0; border-bottom: 1px solid var(--border); }
        .how-step:last-child { border-bottom: none; }
        .step-num { width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(135deg, var(--accent), var(--secondary)); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.9rem; color: #000; flex-shrink: 0; }
        .how-step h4 { font-size: 0.95rem; margin-bottom: 2px; }
        .how-step p { font-size: 0.8rem; color: var(--text-muted); margin: 0; }
        .feature-item { display: flex; gap: 12px; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--border); font-size: 0.9rem; }
        .feature-item:last-child { border-bottom: none; }
        .feature-item i { width: 20px; text-align: center; }

        /* ===== CONTACT SCREEN ===== */
        .contact-card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 20px; margin-bottom: 16px; }
        .contact-card h3 { font-size: 1.1rem; margin-bottom: 16px; }
        .contact-item { display: flex; gap: 12px; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border); }
        .contact-item:last-child { border-bottom: none; }
        .contact-item a { color: var(--text); text-decoration: none; font-size: 0.9rem; }
        .contact-item a:hover { color: var(--accent); }
        .social-btn { display: flex; align-items: center; gap: 10px; padding: 14px 16px; background: var(--glass); border: 1px solid var(--border); border-radius: 12px; color: var(--text); text-decoration: none; font-size: 0.9rem; transition: all 0.3s; }
        .social-btn:hover { border-color: var(--accent); background: rgba(20, 241, 149, 0.1); color: var(--accent); }

        /* ===== TRADE SCREEN ===== */
        .trade-balance-card { background: linear-gradient(135deg, rgba(20, 241, 149, 0.15), rgba(153, 69, 255, 0.15)); border: 1px solid var(--accent); border-radius: 20px; padding: 24px; text-align: center; }
        .trade-balance-amount { font-size: 2.2rem; font-weight: 700; background: linear-gradient(135deg, var(--accent), var(--accent2)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 4px 0; }
        .trade-balance-usd { color: var(--text-muted); font-size: 0.9rem; }
        .trade-convert-card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 20px; }
        .convert-input-group { position: relative; }
        .convert-currency { position: absolute; right: 16px; top: 50%; transform: translateY(-50%); color: var(--accent); font-weight: 600; font-size: 0.85rem; }
        .exchange-card { display: flex; align-items: center; gap: 14px; padding: 16px; background: var(--card); border: 1px solid var(--border); border-radius: 16px; margin-bottom: 12px; text-decoration: none; color: var(--text); transition: all 0.3s; }
        .exchange-card:hover { border-color: var(--accent); transform: translateX(4px); color: var(--text); }
        .exchange-icon { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; flex-shrink: 0; }
        .exchange-name { font-weight: 600; font-size: 0.95rem; }
        .exchange-desc { font-size: 0.8rem; color: var(--text-muted); }
        .trade-tx-list { display: flex; flex-direction: column; gap: 12px; }
        .trade-tx-item { display: flex; align-items: center; gap: 14px; padding: 14px; background: var(--card); border: 1px solid var(--border); border-radius: 12px; }
        .trade-tx-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; flex-shrink: 0; }
        .trade-tx-info { flex: 1; }
        .trade-tx-title { font-weight: 600; font-size: 0.9rem; }
        .trade-tx-date { font-size: 0.75rem; color: var(--text-muted); }
        .trade-tx-amount { font-weight: 600; font-size: 0.9rem; white-space: nowrap; }
        .trade-tx-amount.positive { color: var(--accent); }
        .trade-tx-amount.negative { color: var(--danger); }

        /* ===== METRICS SCREEN ===== */
        .metrics-type-list { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 16px; }
        .metrics-type-item { display: flex; align-items: center; gap: 12px; padding: 10px 0; border-bottom: 1px solid var(--border); }
        .metrics-type-item:last-child { border-bottom: none; }
        .metrics-type-label { display: flex; align-items: center; gap: 8px; min-width: 100px; font-size: 0.85rem; }
        .metrics-type-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
        .metrics-type-bar-container { flex: 1; height: 8px; background: var(--glass); border-radius: 4px; overflow: hidden; }
        .metrics-type-bar { height: 100%; border-radius: 4px; transition: width 1s ease; }
        .metrics-type-pct { font-size: 0.8rem; color: var(--text-muted); min-width: 35px; text-align: right; }
        .metrics-live-feed { display: flex; flex-direction: column; gap: 8px; }
        .metrics-live-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--card); border: 1px solid var(--border); border-radius: 12px; animation: slideIn 0.4s ease backwards; font-size: 0.85rem; }
        .metrics-live-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; animation: pulse 2s infinite; }
        .metrics-live-time { font-size: 0.75rem; color: var(--text-muted); margin-left: auto; white-space: nowrap; }

        /* ===== MORE SCREEN ===== */
        .more-item { cursor: pointer; }

        /* ===== DARK/LIGHT MODE ===== */
        .app-container.light-mode {
            background: transparent;
        }
        .light-mode ~ .app-mesh-bg .g-orb { opacity: 0.12; }
        body.light-body { background: linear-gradient(180deg, #f0f2f5 0%, #e4e6eb 100%); }
        .light-mode .screen { color: #1a1a2e; }
        .light-mode .app-header { background: linear-gradient(180deg, rgba(240, 242, 245, 0.98) 0%, transparent 100%); }
        .light-mode .stat-card,
        .light-mode .action-card,
        .light-mode .record-card,
        .light-mode .api-card,
        .light-mode .about-card,
        .light-mode .contact-card,
        .light-mode .trade-balance-card,
        .light-mode .trade-convert-card,
        .light-mode .exchange-card,
        .light-mode .trade-tx-list,
        .light-mode .metrics-type-list,
        .light-mode .metrics-live-item,
        .light-mode .settings-list,
        .light-mode .patient-card,
        .light-mode .faq-item { background: rgba(255, 255, 255, 0.95); border-color: rgba(0, 0, 0, 0.08); }
        .light-mode .status-bar { background: rgba(255, 255, 255, 0.9); border-color: rgba(0, 0, 0, 0.08); }
        .light-mode .modal { background: #ffffff; border-color: rgba(0, 0, 0, 0.08); }
        .light-mode .form-input,
        .light-mode .form-select { background: rgba(0, 0, 0, 0.04); border-color: rgba(0, 0, 0, 0.1); color: #1a1a2e; }
        .light-mode .user-greeting h1,
        .light-mode .section-title,
        .light-mode h2, .light-mode h3, .light-mode h4,
        .light-mode .action-title,
        .light-mode .record-title,
        .light-mode .patient-name,
        .light-mode .trade-tx-title,
        .light-mode .exchange-name,
        .light-mode .settings-item span { color: #1a1a2e; }
        .light-mode .user-greeting p,
        .light-mode .action-desc,
        .light-mode .record-meta span,
        .light-mode .stat-label,
        .light-mode .patient-meta,
        .light-mode .trade-tx-date,
        .light-mode .exchange-desc { color: #6b7280; }
        .light-mode .how-step { background: rgba(0, 0, 0, 0.03); }
        .light-mode .chart-container { background: rgba(255, 255, 255, 0.95); border-color: rgba(0, 0, 0, 0.08); }
        .light-mode #loginScreen { background: radial-gradient(ellipse at top, rgba(153, 69, 255, 0.08) 0%, transparent 50%), radial-gradient(ellipse at bottom, rgba(20, 241, 149, 0.06) 0%, transparent 50%), #f0f2f5; }
        .light-mode .login-subtitle { color: #6b7280; }
        .light-mode .role-card { background: rgba(255, 255, 255, 0.95); border-color: rgba(0, 0, 0, 0.08); }
        .light-mode .role-info p { color: #6b7280; }
        .light-mode .input-group input { background: rgba(0, 0, 0, 0.04); border-color: rgba(0, 0, 0, 0.1); color: #1a1a2e; }
        .light-mode .input-group label { color: #6b7280; }
        .light-mode .demo-hint { color: #9ca3af; }
        .light-mode .bottom-nav { background: rgba(255, 255, 255, 0.95); border-color: rgba(0, 0, 0, 0.08); }
        .light-mode .nav-label { color: #6b7280; }
        .light-mode .nav-icon { color: #6b7280; }
        .light-mode .nav-item.active .nav-icon,
        .light-mode .nav-item.active .nav-label { color: var(--accent); -webkit-text-fill-color: var(--accent); }
        .light-mode .toast { background: rgba(255, 255, 255, 0.98); color: #1a1a2e; }
        .light-mode .record-badge.verified { background: rgba(20, 241, 149, 0.15); color: #059669; }
        .light-mode .modal-overlay { background: rgba(0, 0, 0, 0.3); }
        .light-mode .search-bar input { background: rgba(0, 0, 0, 0.04); border-color: rgba(0, 0, 0, 0.1); color: #1a1a2e; }
        .light-mode .onboarding-overlay { background: rgba(0, 0, 0, 0.7); }
        .light-mode p { color: #374151; }

        .theme-toggle-btn {
            width: 44px; height: 44px; border-radius: 12px; border: 1px solid var(--border);
            background: var(--glass); display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 1.2rem; color: var(--text); transition: all 0.3s;
        }
        .theme-toggle-btn:hover { border-color: var(--accent); }

        /* ===== BIOMETRIC AUTH ANIMATION ===== */
        .biometric-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 10000;
            background: rgba(10, 10, 15, 0.97); display: flex; flex-direction: column;
            align-items: center; justify-content: center; opacity: 0; pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .biometric-overlay.active { opacity: 1; pointer-events: all; }
        .biometric-ring-container { position: relative; width: 120px; height: 120px; margin-bottom: 24px; }
        .biometric-ring {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            border: 3px solid rgba(20, 241, 149, 0.3); border-radius: 50%;
        }
        .biometric-ring.scanning { animation: biometricScan 1.5s ease-in-out; }
        .biometric-ring.ring-2 { width: 85%; height: 85%; top: 7.5%; left: 7.5%; animation-delay: 0.2s; }
        .biometric-ring.ring-3 { width: 70%; height: 70%; top: 15%; left: 15%; animation-delay: 0.4s; }
        .biometric-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2.5rem; color: var(--accent); }
        @keyframes biometricScan {
            0% { border-color: rgba(20, 241, 149, 0.3); transform: scale(1); }
            50% { border-color: rgba(20, 241, 149, 0.8); transform: scale(1.05); }
            100% { border-color: rgba(20, 241, 149, 1); transform: scale(1); }
        }
        @keyframes biometricSuccess {
            0% { color: var(--accent); transform: translate(-50%, -50%) scale(1); }
            50% { color: var(--accent); transform: translate(-50%, -50%) scale(1.3); }
            100% { color: var(--accent); transform: translate(-50%, -50%) scale(1); }
        }
        .biometric-text { font-size: 1.1rem; color: var(--text); font-weight: 500; }
        .biometric-subtext { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }

        /* ===== SEARCH BAR (Records) ===== */
        .search-bar { margin-bottom: 16px; position: relative; }
        .search-bar input {
            width: 100%; padding: 14px 16px 14px 44px; background: var(--glass);
            border: 1px solid var(--border); border-radius: 12px; color: var(--text);
            font-size: 0.95rem; transition: all 0.3s;
        }
        .search-bar input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(20, 241, 149, 0.1); }
        .search-bar input::placeholder { color: var(--text-muted); }
        .search-bar .search-icon { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--text-muted); font-size: 0.95rem; }
        .record-filter-tabs { display: flex; gap: 8px; margin-bottom: 16px; overflow-x: auto; -webkit-overflow-scrolling: touch; padding-bottom: 4px; }
        .record-filter-tabs::-webkit-scrollbar { display: none; }
        .filter-tab {
            padding: 8px 16px; border-radius: 20px; border: 1px solid var(--border);
            background: var(--glass); color: var(--text-muted); font-size: 0.8rem;
            cursor: pointer; white-space: nowrap; transition: all 0.3s;
        }
        .filter-tab.active { background: rgba(20, 241, 149, 0.15); border-color: var(--accent); color: var(--accent); }

        /* ===== ONBOARDING OVERLAY ===== */
        .onboarding-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 9999;
            background: rgba(10, 10, 15, 0.95); display: flex; flex-direction: column;
            align-items: center; justify-content: center; opacity: 0; pointer-events: none;
            transition: opacity 0.4s ease; padding: 24px;
        }
        .onboarding-overlay.active { opacity: 1; pointer-events: all; }
        .onboarding-card {
            max-width: 380px; width: 100%; text-align: center; animation: slideUp 0.5s ease backwards;
        }
        .onboarding-step-icon {
            width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 24px;
            display: flex; align-items: center; justify-content: center; font-size: 2.5rem;
            background: rgba(20, 241, 149, 0.15);
        }
        .onboarding-step-icon.purple { background: rgba(153, 69, 255, 0.15); }
        .onboarding-step-icon.blue { background: rgba(0, 194, 255, 0.15); }
        .onboarding-step-icon.gold { background: rgba(255, 215, 0, 0.15); }
        .onboarding-step-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 12px; }
        .onboarding-step-desc { color: var(--text-muted); font-size: 0.95rem; line-height: 1.6; margin-bottom: 32px; }
        .onboarding-dots { display: flex; gap: 8px; justify-content: center; margin-bottom: 24px; }
        .onboarding-dot { width: 10px; height: 10px; border-radius: 50%; background: var(--glass); transition: all 0.3s; }
        .onboarding-dot.active { background: var(--accent); width: 28px; border-radius: 5px; }
        .onboarding-nav { display: flex; gap: 12px; width: 100%; }
        .onboarding-skip { padding: 14px 24px; background: transparent; border: 1px solid var(--border); border-radius: 12px; color: var(--text-muted); font-size: 0.95rem; cursor: pointer; flex: 1; transition: all 0.3s; }
        .onboarding-skip:hover { border-color: var(--accent); color: var(--text); }
        .onboarding-next { padding: 14px 24px; background: linear-gradient(135deg, var(--accent), var(--accent2)); border: none; border-radius: 12px; color: var(--primary); font-size: 0.95rem; font-weight: 600; cursor: pointer; flex: 2; transition: all 0.3s; }
        .onboarding-next:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(20, 241, 149, 0.3); }

        /* ===== FAQ ACCORDION ===== */
        .faq-item { background: var(--card); border: 1px solid var(--border); border-radius: 12px; margin-bottom: 8px; overflow: hidden; }
        .faq-question {
            display: flex; align-items: center; justify-content: space-between; padding: 16px;
            cursor: pointer; font-size: 0.9rem; font-weight: 500; transition: all 0.3s;
        }
        .faq-question:hover { color: var(--accent); }
        .faq-question i { transition: transform 0.3s; color: var(--text-muted); font-size: 0.8rem; }
        .faq-item.open .faq-question i { transform: rotate(180deg); color: var(--accent); }
        .faq-answer { max-height: 0; overflow: hidden; transition: max-height 0.3s ease, padding 0.3s ease; }
        .faq-item.open .faq-answer { max-height: 200px; padding: 0 16px 16px; }
        .faq-answer p { font-size: 0.85rem; color: var(--text-muted); line-height: 1.5; }

        /* ===== TRADE EXPORT ===== */
        .export-btn {
            display: flex; align-items: center; justify-content: center; gap: 8px;
            padding: 12px 20px; background: var(--glass); border: 1px solid var(--border);
            border-radius: 12px; color: var(--text); font-size: 0.85rem; cursor: pointer;
            transition: all 0.3s; width: 100%; margin-top: 12px;
        }
        .export-btn:hover { border-color: var(--accent); color: var(--accent); }

        /* ===== METRICS API LOADING ===== */
        .metrics-loading { text-align: center; padding: 40px 0; color: var(--text-muted); }
        .metrics-loading .spinner { width: 32px; height: 32px; border: 3px solid var(--glass); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 12px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .metrics-error { text-align: center; padding: 20px; color: var(--danger); font-size: 0.85rem; }
        .metrics-api-badge {
            display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px;
            background: rgba(20, 241, 149, 0.1); border-radius: 20px; font-size: 0.7rem;
            color: var(--accent); margin-top: 4px;
        }

        /* ===== SPLASH SCREEN ===== */
        .splash-screen {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 99999;
            background: var(--primary); display: flex; flex-direction: column;
            align-items: center; justify-content: center; transition: opacity 0.5s ease;
        }
        .splash-screen.fade-out { opacity: 0; pointer-events: none; }
        .splash-logo { width: 80px; height: 80px; border-radius: 20px; animation: float 2s ease-in-out infinite; margin-bottom: 20px; }
        .splash-title {
            font-size: 1.6rem; font-weight: 700;
            background: linear-gradient(135deg, var(--accent), var(--secondary));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }
        .splash-sub { color: var(--text-muted); font-size: 0.85rem; margin-bottom: 32px; }
        .splash-spinner {
            width: 28px; height: 28px; border: 2px solid var(--border);
            border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite;
        }

        /* ===== OFFLINE BANNER ===== */
        .offline-banner {
            position: fixed; top: 0; left: 50%; transform: translateX(-50%) translateY(-60px);
            max-width: 430px; width: 100%; z-index: 10001; padding: 12px 20px;
            background: rgba(255, 71, 87, 0.95); backdrop-filter: blur(10px);
            display: flex; align-items: center; justify-content: center; gap: 10px;
            font-size: 0.85rem; font-weight: 500; transition: transform 0.4s ease;
        }
        .offline-banner.show { transform: translateX(-50%) translateY(0); }
        .offline-banner.online { background: rgba(20, 241, 149, 0.9); color: var(--primary); }

        /* ===== PAGE TRANSITIONS ===== */
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .screen.slide-right { animation: slideInRight 0.3s ease; }
        .screen.slide-left { animation: slideInLeft 0.3s ease; }

        /* ===== COPY HASH BUTTON ===== */
        .copy-hash-btn {
            display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px;
            background: var(--glass); border: 1px solid var(--border); border-radius: 8px;
            color: var(--text-muted); font-size: 0.75rem; cursor: pointer;
            transition: all 0.3s; margin-top: 8px;
        }
        .copy-hash-btn:hover { border-color: var(--accent); color: var(--accent); }
        .copy-hash-btn.copied { border-color: var(--accent); color: var(--accent); }

        /* ===== SESSION TIMEOUT MODAL ===== */
        .timeout-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 10002;
            background: rgba(0, 0, 0, 0.85); display: none; align-items: center; justify-content: center;
        }
        .timeout-overlay.active { display: flex; }
        .timeout-card {
            background: var(--dark); border: 1px solid var(--border); border-radius: 20px;
            padding: 32px; text-align: center; max-width: 320px; width: 90%; animation: slideUp 0.3s ease;
        }
        .timeout-card h3 { margin-bottom: 8px; font-size: 1.2rem; }
        .timeout-card p { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 24px; }
        .timeout-countdown {
            font-size: 2rem; font-weight: 700; color: var(--warning); margin-bottom: 24px;
        }
        .timeout-actions { display: flex; gap: 12px; }
        .timeout-actions .btn { flex: 1; }

        /* ===== RIPPLE TAP EFFECT ===== */
        .ripple-container { position: relative; overflow: hidden; }
        .ripple-effect {
            position: absolute; border-radius: 50%; background: rgba(20, 241, 149, 0.25);
            transform: scale(0); animation: rippleAnim 0.6s ease-out; pointer-events: none;
        }
        @keyframes rippleAnim {
            to { transform: scale(4); opacity: 0; }
        }

        /* ===== ANIMATED GRADIENT BORDER (Trade Balance) ===== */
        .trade-balance-card {
            background: linear-gradient(135deg, rgba(20, 241, 149, 0.15), rgba(153, 69, 255, 0.15));
            border: 2px solid transparent; border-radius: 20px; padding: 24px; text-align: center;
            background-clip: padding-box; position: relative;
        }
        .trade-balance-card::before {
            content: ''; position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px;
            border-radius: 22px; z-index: -1;
            background: linear-gradient(135deg, var(--accent), var(--secondary), var(--accent2), var(--accent));
            background-size: 300% 300%;
            animation: gradientBorder 4s ease infinite;
        }
        @keyframes gradientBorder {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* ===== PULL TO REFRESH ===== */
        .pull-indicator {
            text-align: center; overflow: hidden; height: 0;
            transition: height 0.2s ease; color: var(--accent);
        }
        .pull-indicator .spinner {
            width: 24px; height: 24px; border: 2px solid var(--border);
            border-top-color: var(--accent); border-radius: 50%;
            margin: 8px auto; animation: spin 0.8s linear infinite;
        }
        .pull-indicator i { font-size: 1.2rem; padding: 10px 0; }

        /* ===== BLOCKCHAIN ANCHORING ANIMATION ===== */
        .anchor-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 10003;
            background: rgba(10, 10, 15, 0.97); display: none; flex-direction: column;
            align-items: center; justify-content: center; padding: 24px;
        }
        .anchor-overlay.active { display: flex; }
        .anchor-steps { width: 100%; max-width: 320px; }
        .anchor-step {
            display: flex; align-items: center; gap: 16px; padding: 16px 0;
            border-bottom: 1px solid var(--border); opacity: 0.3; transition: all 0.5s ease;
        }
        .anchor-step:last-child { border-bottom: none; }
        .anchor-step.active { opacity: 1; }
        .anchor-step.done { opacity: 1; }
        .anchor-step-icon {
            width: 44px; height: 44px; border-radius: 50%; display: flex;
            align-items: center; justify-content: center; font-size: 1.1rem;
            background: var(--glass); border: 2px solid var(--border); flex-shrink: 0;
            transition: all 0.5s ease;
        }
        .anchor-step.active .anchor-step-icon { border-color: var(--accent); color: var(--accent); }
        .anchor-step.done .anchor-step-icon { background: var(--accent); color: var(--primary); border-color: var(--accent); }
        .anchor-step-text h4 { font-size: 0.95rem; margin-bottom: 2px; }
        .anchor-step-text p { font-size: 0.8rem; color: var(--text-muted); }
        .anchor-hash-display {
            font-family: monospace; font-size: 0.7rem; color: var(--accent);
            background: var(--glass); padding: 8px 12px; border-radius: 8px;
            margin-top: 12px; word-break: break-all; overflow: hidden;
        }

        /* ===== CONFETTI ===== */
        .confetti-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 10004; overflow: hidden;
        }
        .confetti-piece {
            position: absolute; width: 10px; height: 10px; top: -10px;
            animation: confettiFall 3s ease-in forwards;
        }
        @keyframes confettiFall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        /* ===== VERIFY TYPEWRITER ===== */
        .verify-typewriter {
            font-family: monospace; font-size: 0.8rem; color: var(--accent);
            background: var(--glass); padding: 12px; border-radius: 8px;
            margin-top: 12px; min-height: 40px; border: 1px solid var(--border);
        }
        .verify-typewriter .cursor {
            display: inline-block; width: 2px; height: 14px; background: var(--accent);
            margin-left: 2px; animation: blink 0.7s infinite;
        }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* ===== XRPL EXPLORER LINK ===== */
        .xrpl-explorer-link {
            display: flex; align-items: center; gap: 8px; padding: 10px 14px;
            background: rgba(20, 241, 149, 0.08); border: 1px solid rgba(20, 241, 149, 0.2);
            border-radius: 10px; color: var(--accent); text-decoration: none;
            font-size: 0.8rem; transition: all 0.3s; margin-top: 12px;
        }
        .xrpl-explorer-link:hover { background: rgba(20, 241, 149, 0.15); border-color: var(--accent); }

        /* ===== ROLE SWITCHER (in-app) ===== */
        .role-switcher-bar {
            display: flex; gap: 8px; margin-top: 12px; padding: 4px;
            background: var(--glass); border-radius: 14px; border: 1px solid var(--border);
        }
        .role-switch-btn {
            flex: 1; padding: 10px 6px; border: none; border-radius: 10px;
            background: transparent; color: var(--text-muted); font-size: 0.75rem;
            font-weight: 600; cursor: pointer; transition: all 0.3s ease;
            display: flex; flex-direction: column; align-items: center; gap: 4px;
        }
        .role-switch-btn i { font-size: 1rem; }
        .role-switch-btn.active {
            background: rgba(20, 241, 149, 0.15); color: var(--accent);
            box-shadow: 0 2px 8px rgba(20, 241, 149, 0.2);
        }
        .role-switch-btn.active.provider-active { background: rgba(153, 69, 255, 0.15); color: var(--secondary); box-shadow: 0 2px 8px rgba(153, 69, 255, 0.2); }
        .role-switch-btn.active.ehr-active { background: rgba(255, 215, 0, 0.15); color: var(--ehr); box-shadow: 0 2px 8px rgba(255, 215, 0, 0.2); }
        .role-switch-anim {
            animation: roleSwitchPulse 0.5s ease;
        }
        @keyframes roleSwitchPulse {
            0% { transform: scale(1); }
            50% { transform: scale(0.96); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* ===== TOOLTIPS ===== */
        .term-tooltip {
            position: relative; display: inline-flex; align-items: center; gap: 3px;
            border-bottom: 1px dashed rgba(20, 241, 149, 0.4); cursor: help;
            color: var(--accent);
        }
        .term-tooltip .tooltip-icon {
            font-size: 0.6rem; opacity: 0.6; vertical-align: super;
        }
        .tooltip-bubble {
            position: fixed; z-index: 10010; max-width: 280px; padding: 14px 16px;
            background: var(--dark); border: 1px solid var(--accent);
            border-radius: 12px; font-size: 0.8rem; color: var(--text);
            box-shadow: 0 8px 32px rgba(0,0,0,0.5); pointer-events: auto;
            animation: tooltipIn 0.25s ease;
            line-height: 1.5;
        }
        .tooltip-bubble::after {
            content: ''; position: absolute; bottom: -6px; left: 20px;
            width: 12px; height: 12px; background: var(--dark);
            border-right: 1px solid var(--accent); border-bottom: 1px solid var(--accent);
            transform: rotate(45deg);
        }
        .tooltip-bubble.above::after { bottom: auto; top: -6px; transform: rotate(225deg); }
        .tooltip-bubble h4 { color: var(--accent); font-size: 0.85rem; margin-bottom: 6px; }
        @keyframes tooltipIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
        .tooltip-backdrop {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 10009;
            background: transparent;
        }

        /* ===== AI INSIGHTS PANEL ===== */
        .ai-insights-card {
            background: linear-gradient(135deg, rgba(0, 194, 255, 0.08), rgba(153, 69, 255, 0.08));
            border: 1px solid rgba(0, 194, 255, 0.2); border-radius: 16px;
            padding: 20px; margin-top: 8px;
        }
        .ai-badge {
            display: inline-flex; align-items: center; gap: 6px;
            background: linear-gradient(135deg, var(--accent2), var(--secondary));
            color: #fff; font-size: 0.7rem; font-weight: 700; padding: 4px 10px;
            border-radius: 20px; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .ai-badge i { font-size: 0.7rem; }
        .ai-finding {
            display: flex; align-items: flex-start; gap: 12px; padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }
        .ai-finding:last-child { border-bottom: none; padding-bottom: 0; }
        .ai-finding-icon {
            width: 36px; height: 36px; border-radius: 10px; display: flex;
            align-items: center; justify-content: center; font-size: 0.9rem; flex-shrink: 0;
        }
        .ai-finding-icon.warning { background: rgba(255, 215, 0, 0.15); color: var(--warning); }
        .ai-finding-icon.alert { background: rgba(255, 71, 87, 0.15); color: var(--danger); }
        .ai-finding-icon.info { background: rgba(0, 194, 255, 0.15); color: var(--accent2); }
        .ai-finding-icon.ok { background: rgba(20, 241, 149, 0.15); color: var(--accent); }
        .ai-finding-text h4 { font-size: 0.85rem; margin-bottom: 2px; }
        .ai-finding-text p { font-size: 0.78rem; color: var(--text-muted); line-height: 1.4; }
        .ai-finding-text .ai-tag {
            display: inline-block; font-size: 0.65rem; padding: 2px 8px;
            border-radius: 6px; margin-top: 4px; font-weight: 600;
        }
        .ai-tag.high { background: rgba(255, 71, 87, 0.15); color: var(--danger); }
        .ai-tag.medium { background: rgba(255, 215, 0, 0.15); color: var(--warning); }
        .ai-tag.low { background: rgba(20, 241, 149, 0.15); color: var(--accent); }
        .ai-summary-box {
            background: var(--glass); border: 1px solid var(--border); border-radius: 12px;
            padding: 16px; margin-top: 8px;
        }
        .ai-summary-box h4 { font-size: 0.9rem; margin-bottom: 8px; color: var(--accent2); }
        .ai-summary-box p { font-size: 0.82rem; color: var(--text-muted); line-height: 1.6; }
        .ai-summary-box ul { list-style: none; padding: 0; margin: 8px 0 0; }
        .ai-summary-box ul li {
            font-size: 0.8rem; color: var(--text); padding: 6px 0;
            border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 8px;
        }
        .ai-summary-box ul li:last-child { border-bottom: none; }
        .ai-summary-box ul li i { color: var(--accent); font-size: 0.7rem; }
        .ai-scan-animation {
            display: flex; align-items: center; gap: 8px; padding: 12px;
            color: var(--accent2); font-size: 0.85rem;
        }
        .ai-scan-animation .ai-spinner {
            width: 18px; height: 18px; border: 2px solid var(--border);
            border-top-color: var(--accent2); border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        .ai-scan-progress {
            height: 3px; background: var(--glass); border-radius: 2px;
            overflow: hidden; margin-top: 8px;
        }
        .ai-scan-progress-bar {
            height: 100%; width: 0; border-radius: 2px;
            background: linear-gradient(90deg, var(--accent2), var(--secondary));
            transition: width 0.3s ease;
        }

        /* ===== STATUS INDICATOR DOT ===== */
        .status-pulse {
            display: inline-block; width: 8px; height: 8px; border-radius: 50%;
            background: var(--accent); margin-right: 6px;
            animation: statusPulse 2s infinite;
        }
        .status-pulse.warning { background: var(--warning); }
        .status-pulse.danger { background: var(--danger); }
        @keyframes statusPulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 currentColor; }
            50% { opacity: 0.7; box-shadow: 0 0 0 4px transparent; }
        }

        /* ===== DATA HEALTH SCORE ===== */
        .health-score-ring {
            width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 12px;
            background: conic-gradient(var(--score-color, var(--accent)) 0deg, var(--score-color, var(--accent)) calc(var(--score) * 3.6deg), var(--glass) calc(var(--score) * 3.6deg));
            display: flex; align-items: center; justify-content: center;
            position: relative;
        }
        .health-score-ring::before {
            content: ''; position: absolute; width: 80px; height: 80px;
            border-radius: 50%; background: var(--dark);
        }
        .health-score-value {
            position: relative; z-index: 1; font-size: 1.5rem;
            font-weight: 800; color: var(--accent);
        }

        /* ===== v2.8.0  Emergency ICE Card ===== */
        .ice-card {
            background: linear-gradient(135deg, rgba(255, 71, 87, 0.15), rgba(255, 71, 87, 0.05));
            border: 1px solid rgba(255, 71, 87, 0.3);
            border-radius: 16px; padding: 20px; position: relative; overflow: hidden;
        }
        .ice-card::before {
            content: ''; position: absolute; top: -30px; right: -30px;
            width: 100px; height: 100px; border-radius: 50%;
            background: rgba(255, 71, 87, 0.1); pointer-events: none;
        }
        .ice-header { display: flex; align-items: center; gap: 10px; margin-bottom: 16px; }
        .ice-badge {
            background: linear-gradient(135deg, #ff4757, #ff6b81); color: #fff;
            padding: 4px 10px; border-radius: 20px; font-size: 0.7rem;
            font-weight: 700; letter-spacing: 0.5px; text-transform: uppercase;
        }
        .ice-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .ice-item { font-size: 0.82rem; }
        .ice-item-label { color: var(--text-muted); font-size: 0.72rem; margin-bottom: 2px; }
        .ice-item-value { font-weight: 600; color: var(--text); }
        .ice-item-value.danger { color: var(--danger); }
        .ice-actions { display: flex; gap: 8px; margin-top: 16px; }
        .ice-btn {
            flex: 1; padding: 10px; border: none; border-radius: 10px;
            font-size: 0.8rem; font-weight: 600; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 6px;
        }
        .ice-btn-share { background: rgba(255, 71, 87, 0.2); color: var(--danger); }
        .ice-btn-qr { background: rgba(20, 241, 149, 0.15); color: var(--accent); }

        /* ===== Consent & Access Manager ===== */
        .access-list { display: flex; flex-direction: column; gap: 10px; }
        .access-item {
            display: flex; align-items: center; gap: 12px;
            background: var(--glass); border: 1px solid var(--border);
            border-radius: 12px; padding: 12px 14px;
        }
        .access-avatar {
            width: 38px; height: 38px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.75rem; font-weight: 700; color: #fff; flex-shrink: 0;
        }
        .access-info { flex: 1; min-width: 0; }
        .access-name { font-weight: 600; font-size: 0.88rem; }
        .access-meta { font-size: 0.72rem; color: var(--text-muted); }
        .access-revoke {
            background: rgba(255, 71, 87, 0.15); border: 1px solid rgba(255, 71, 87, 0.3);
            color: var(--danger); padding: 6px 12px; border-radius: 8px;
            font-size: 0.72rem; font-weight: 600; cursor: pointer;
            transition: all 0.2s;
        }
        .access-revoke:hover { background: rgba(255, 71, 87, 0.3); }
        .access-revoke.revoked {
            background: var(--glass); color: var(--text-muted);
            border-color: var(--border); pointer-events: none;
        }

        /* ===== Record Favorites ===== */
        .record-fav {
            position: absolute; top: 12px; right: 12px;
            background: none; border: none; cursor: pointer;
            color: var(--text-muted); font-size: 1rem;
            transition: all 0.2s; z-index: 2;
        }
        .record-fav.active { color: var(--warning); text-shadow: 0 0 8px rgba(255, 215, 0, 0.4); }
        .record-fav:active { transform: scale(1.3); }
        .fav-section-badge {
            display: inline-flex; align-items: center; gap: 4px;
            background: rgba(255, 215, 0, 0.12); color: var(--warning);
            padding: 2px 8px; border-radius: 8px; font-size: 0.7rem; font-weight: 600;
        }

        /* ===== Activity Heatmap ===== */
        .heatmap-container { padding: 4px 0; }
        .heatmap-grid {
            display: grid; grid-template-columns: repeat(7, 1fr);
            gap: 4px; margin-bottom: 8px;
        }
        .heatmap-cell {
            aspect-ratio: 1; border-radius: 4px;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.2s; position: relative;
        }
        .heatmap-cell.level-1 { background: rgba(20, 241, 149, 0.15); }
        .heatmap-cell.level-2 { background: rgba(20, 241, 149, 0.3); }
        .heatmap-cell.level-3 { background: rgba(20, 241, 149, 0.5); }
        .heatmap-cell.level-4 { background: rgba(20, 241, 149, 0.75); }
        .heatmap-labels {
            display: flex; justify-content: space-between;
            font-size: 0.65rem; color: var(--text-muted);
        }
        .heatmap-legend {
            display: flex; align-items: center; gap: 4px;
            font-size: 0.65rem; color: var(--text-muted);
            margin-top: 8px; justify-content: flex-end;
        }
        .heatmap-legend-cell {
            width: 12px; height: 12px; border-radius: 3px;
        }

        /* ===== Keyboard Shortcuts ===== */
        .shortcuts-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(8px);
            z-index: 9999; display: none; align-items: center;
            justify-content: center; animation: fadeIn 0.2s ease;
        }
        .shortcuts-overlay.active { display: flex; }
        .shortcuts-card {
            background: var(--card); border: 1px solid var(--border);
            border-radius: 20px; padding: 24px; width: 90%;
            max-width: 380px; max-height: 80vh; overflow-y: auto;
        }
        .shortcut-row {
            display: flex; justify-content: space-between;
            align-items: center; padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }
        .shortcut-row:last-child { border-bottom: none; }
        .shortcut-label { font-size: 0.85rem; color: var(--text-muted); }
        .shortcut-keys { display: flex; gap: 4px; }
        .kbd {
            background: rgba(255,255,255,0.08); border: 1px solid var(--border);
            border-radius: 6px; padding: 3px 8px; font-size: 0.75rem;
            font-family: 'SF Mono', monospace; font-weight: 600;
            color: var(--text); min-width: 24px; text-align: center;
        }

        /* ===== v2.9.0  SDK Playground ===== */
        .playground-banner {
            background: linear-gradient(135deg, rgba(20, 241, 149, 0.12), rgba(153, 69, 255, 0.12));
            border: 1px solid rgba(20, 241, 149, 0.25);
            border-radius: 16px; padding: 16px; cursor: pointer;
            transition: all 0.3s; position: relative; overflow: hidden;
        }
        .playground-banner:active { transform: scale(0.98); }
        .playground-banner::after {
            content: ''; position: absolute; top: -20px; right: -20px;
            width: 80px; height: 80px; border-radius: 50%;
            background: rgba(20, 241, 149, 0.1); pointer-events: none;
        }
        .playground-badge {
            display: inline-flex; align-items: center; gap: 4px;
            background: linear-gradient(135deg, var(--accent), var(--secondary));
            color: #fff; padding: 3px 10px; border-radius: 12px;
            font-size: 0.65rem; font-weight: 700; letter-spacing: 0.5px;
            text-transform: uppercase; margin-bottom: 8px;
        }
        .pg-section-title { font-size: 0.82rem; font-weight: 700; margin-bottom: 12px; color: var(--text); }
        .template-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .template-card {
            background: var(--glass); border: 1px solid var(--border);
            border-radius: 12px; padding: 12px; cursor: pointer;
            transition: all 0.2s; text-align: center;
        }
        .template-card:active { transform: scale(0.96); }
        .template-card.selected { border-color: var(--accent); background: rgba(20, 241, 149, 0.08); }
        .template-card-icon { font-size: 1.3rem; margin-bottom: 6px; }
        .template-card-name { font-size: 0.78rem; font-weight: 600; }
        .template-card-type { font-size: 0.65rem; color: var(--text-muted); margin-top: 2px; }
        .pg-editor {
            width: 100%; min-height: 120px; background: rgba(0,0,0,0.3);
            border: 1px solid var(--border); border-radius: 12px;
            padding: 12px; color: var(--text); font-family: 'SF Mono', monospace;
            font-size: 0.78rem; resize: vertical; outline: none;
            transition: border-color 0.2s; line-height: 1.5;
        }
        .pg-editor:focus { border-color: var(--accent); }
        .pg-hash-preview {
            background: rgba(0,0,0,0.3); border: 1px solid var(--border);
            border-radius: 10px; padding: 10px 12px; font-family: 'SF Mono', monospace;
            font-size: 0.72rem; color: var(--accent); word-break: break-all;
            min-height: 36px; transition: all 0.3s;
        }
        .pg-hash-label { font-size: 0.7rem; color: var(--text-muted); margin-bottom: 4px; font-weight: 600; }
        .anchor-btn {
            width: 100%; padding: 14px; border: none; border-radius: 12px;
            font-size: 0.95rem; font-weight: 700; cursor: pointer;
            background: linear-gradient(135deg, var(--accent), #0ba968);
            color: #000; display: flex; align-items: center;
            justify-content: center; gap: 8px; transition: all 0.3s;
            position: relative; overflow: hidden;
        }
        .anchor-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .anchor-btn:active:not(:disabled) { transform: scale(0.98); }
        .anchor-btn .btn-ripple {
            position: absolute; background: rgba(255,255,255,0.3);
            border-radius: 50%; transform: scale(0);
            animation: ripple 0.6s linear;
        }
        .pg-progress { margin: 16px 0; }
        .pg-step {
            display: flex; align-items: center; gap: 10px;
            padding: 8px 0; opacity: 0.3; transition: all 0.4s;
        }
        .pg-step.active { opacity: 1; }
        .pg-step.done { opacity: 0.7; }
        .pg-step.done .pg-step-icon { color: var(--accent); }
        .pg-step-icon { width: 28px; text-align: center; font-size: 0.9rem; }
        .pg-step-text h4 { font-size: 0.82rem; font-weight: 600; }
        .pg-step-text p { font-size: 0.72rem; color: var(--text-muted); }
        .pg-result {
            background: linear-gradient(135deg, rgba(20, 241, 149, 0.1), rgba(0, 194, 255, 0.05));
            border: 1px solid rgba(20, 241, 149, 0.3);
            border-radius: 14px; padding: 16px; display: none;
        }
        .pg-result.show { display: block; animation: fadeUp 0.4s ease; }
        .pg-result-label { font-size: 0.7rem; color: var(--text-muted); margin-bottom: 2px; }
        .pg-result-value { font-family: 'SF Mono', monospace; font-size: 0.75rem; word-break: break-all; margin-bottom: 10px; }
        .pg-result-actions { display: flex; gap: 8px; margin-top: 12px; }
        .pg-result-btn {
            flex: 1; padding: 8px; border: 1px solid var(--border);
            border-radius: 8px; background: var(--glass);
            color: var(--text); font-size: 0.75rem; font-weight: 600;
            cursor: pointer; text-align: center; transition: all 0.2s;
        }
        .pg-result-btn:active { transform: scale(0.96); }
        .pg-session-counter {
            display: flex; align-items: center; gap: 8px;
            background: rgba(20, 241, 149, 0.08); border-radius: 10px;
            padding: 8px 12px; font-size: 0.8rem;
        }
        .pg-session-count {
            font-weight: 800; font-size: 1.1rem; color: var(--accent);
        }
        .pg-history-item {
            display: flex; align-items: center; gap: 10px;
            padding: 10px; background: var(--glass); border-radius: 10px;
            margin-bottom: 6px; font-size: 0.78rem;
        }
        .pg-history-icon { width: 30px; height: 30px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            background: rgba(20, 241, 149, 0.15); color: var(--accent); flex-shrink: 0;
        }
        .pg-history-hash { font-family: 'SF Mono', monospace; font-size: 0.68rem; color: var(--text-muted); }
        .pg-tutorial-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
            z-index: 9998; display: none; align-items: center;
            justify-content: center; padding: 20px;
        }
        .pg-tutorial-overlay.active { display: flex; }
        .pg-tutorial-card {
            background: var(--card); border: 1px solid var(--border);
            border-radius: 20px; padding: 24px; width: 100%;
            max-width: 380px; max-height: 85vh; overflow-y: auto;
        }
        .pg-tutorial-step {
            display: flex; gap: 12px; padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }
        .pg-tutorial-step:last-child { border-bottom: none; }
        .pg-tutorial-num {
            width: 28px; height: 28px; border-radius: 50%; flex-shrink: 0;
            background: linear-gradient(135deg, var(--accent), var(--secondary));
            color: #000; font-weight: 800; font-size: 0.78rem;
            display: flex; align-items: center; justify-content: center;
        }
        .pg-tutorial-text h4 { font-size: 0.85rem; font-weight: 600; margin-bottom: 2px; }
        .pg-tutorial-text p { font-size: 0.78rem; color: var(--text-muted); line-height: 1.4; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
        .pg-testnet-badge {
            display: inline-flex; align-items: center; gap: 4px;
            background: rgba(255, 215, 0, 0.12); color: var(--warning);
            padding: 3px 8px; border-radius: 8px; font-size: 0.68rem; font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- Particles Background -->
    <div id="app-particles"></div>
    <div class="app-mesh-bg">
        <div class="g-orb g-orb-1" id="orb1"></div>
        <div class="g-orb g-orb-2" id="orb2"></div>
        <div class="g-orb g-orb-3" id="orb3"></div>
    </div>

    <!-- Keyboard Shortcuts Overlay -->
    <div class="shortcuts-overlay" id="shortcutsOverlay" onclick="if(event.target===this)this.classList.remove('active')">
        <div class="shortcuts-card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="font-size: 1rem;"><i class="fas fa-keyboard" style="color: var(--accent); margin-right: 6px;"></i> Keyboard Shortcuts</h3>
                <button style="background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 1.2rem;" onclick="document.getElementById('shortcutsOverlay').classList.remove('active')">&times;</button>
            </div>
            <div class="shortcut-row"><span class="shortcut-label">Show shortcuts</span><div class="shortcut-keys"><span class="kbd">?</span></div></div>
            <div class="shortcut-row"><span class="shortcut-label">Home</span><div class="shortcut-keys"><span class="kbd">H</span></div></div>
            <div class="shortcut-row"><span class="shortcut-label">Records</span><div class="shortcut-keys"><span class="kbd">R</span></div></div>
            <div class="shortcut-row"><span class="shortcut-label">Trade / Wallet</span><div class="shortcut-keys"><span class="kbd">T</span></div></div>
            <div class="shortcut-row"><span class="shortcut-label">Activity</span><div class="shortcut-keys"><span class="kbd">A</span></div></div>
            <div class="shortcut-row"><span class="shortcut-label">Metrics</span><div class="shortcut-keys"><span class="kbd">M</span></div></div>
            <div class="shortcut-row"><span class="shortcut-label">New Record</span><div class="shortcut-keys"><span class="kbd">N</span></div></div>
            <div class="shortcut-row"><span class="shortcut-label">Toggle Theme</span><div class="shortcut-keys"><span class="kbd">D</span></div></div>
            <div class="shortcut-row"><span class="shortcut-label">Search Records</span><div class="shortcut-keys"><span class="kbd">/</span></div></div>
            <div class="shortcut-row"><span class="shortcut-label">Sign Out</span><div class="shortcut-keys"><span class="kbd">Esc</span></div></div>
        </div>
    </div>

    <!-- Scroll To Top -->
    <button class="scroll-top-btn" id="scrollTopBtn" onclick="window.scrollTo({top:0,behavior:'smooth'}); haptic();" aria-label="Scroll to top">
        <i class="fas fa-chevron-up"></i>
    </button>

    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" onclick="contextAction('verify')"><i class="fas fa-certificate"></i> Verify Record</div>
        <div class="context-menu-item" onclick="contextAction('share')"><i class="fas fa-share"></i> Share</div>
        <div class="context-menu-item" onclick="contextAction('copy')"><i class="fas fa-copy"></i> Copy Hash</div>
        <div class="context-menu-item" onclick="contextAction('explorer')"><i class="fas fa-external-link-alt"></i> View on XRPL</div>
        <div class="context-menu-item danger" onclick="contextAction('revoke')"><i class="fas fa-ban"></i> Revoke Access</div>
    </div>

    <!-- Floating Action Button -->
    <button class="fab" id="fab" onclick="openModal('addRecordModal'); haptic();" aria-label="Anchor new record">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Splash Screen -->
    <div class="splash-screen" id="splashScreen">
        <img class="splash-logo" src="https://raw.githubusercontent.com/solusprotocol1/solus-protocol/main/logo.png" alt="Solus Protocol">
        <div class="splash-title">Solus Protocol</div>
        <div class="splash-sub">Healthcare Data Wallet</div>
        <div class="splash-spinner"></div>
    </div>

    <!-- Offline Banner -->
    <div class="offline-banner" id="offlineBanner">
        <i class="fas fa-wifi-slash" id="offlineIcon"></i>
        <span id="offlineText">You're offline</span>
    </div>

    <!-- Session Timeout Modal -->
    <div class="timeout-overlay" id="timeoutOverlay">
        <div class="timeout-card">
            <i class="fas fa-clock" style="font-size: 2.5rem; color: var(--warning); margin-bottom: 16px;"></i>
            <h3>Session Expiring</h3>
            <p>You'll be signed out due to inactivity</p>
            <div class="timeout-countdown" id="timeoutCountdown">30</div>
            <div class="timeout-actions">
                <button class="btn btn-secondary" onclick="sessionLogout()">Sign Out</button>
                <button class="btn btn-primary" onclick="extendSession()">Stay Signed In</button>
            </div>
        </div>
    </div>

    <!-- Blockchain Anchoring Animation -->
    <div class="anchor-overlay" id="anchorOverlay">
        <div style="text-align: center; margin-bottom: 32px;">
            <i class="fas fa-link" style="font-size: 2.5rem; color: var(--accent); margin-bottom: 12px;"></i>
            <h2 style="font-size: 1.3rem;"><span class="term-tooltip" onclick="showTermTooltip(event, 'anchoring')">Anchoring <i class="fas fa-info-circle tooltip-icon"></i></span> to XRPL</h2>
            <p style="color: var(--text-muted); font-size: 0.9rem;">Securing your record on the blockchain</p>
        </div>
        <div class="anchor-steps" id="anchorSteps">
            <div class="anchor-step" id="anchorStep1">
                <div class="anchor-step-icon"><i class="fas fa-file-medical"></i></div>
                <div class="anchor-step-text"><h4>Preparing Record</h4><p>Extracting document data...</p></div>
            </div>
            <div class="anchor-step" id="anchorStep2">
                <div class="anchor-step-icon"><i class="fas fa-hashtag"></i></div>
                <div class="anchor-step-text"><h4>Generating <span class="term-tooltip" onclick="showTermTooltip(event, 'sha256')">SHA-256 <i class="fas fa-info-circle tooltip-icon"></i></span> Hash</h4><p id="anchorHashText">Computing cryptographic fingerprint...</p></div>
            </div>
            <div class="anchor-step" id="anchorStep3">
                <div class="anchor-step-icon"><i class="fas fa-paper-plane"></i></div>
                <div class="anchor-step-text"><h4>Submitting to XRPL</h4><p>Broadcasting transaction to ledger...</p></div>
            </div>
            <div class="anchor-step" id="anchorStep4">
                <div class="anchor-step-icon"><i class="fas fa-check-circle"></i></div>
                <div class="anchor-step-text"><h4>Confirmed on Ledger</h4><p>Record anchored immutably</p></div>
            </div>
        </div>
        <div class="anchor-hash-display" id="anchorHashDisplay" style="display: none;"></div>
    </div>

    <!-- Confetti Container -->
    <div class="confetti-container" id="confettiContainer"></div>

    <!-- Biometric Auth Overlay -->
    <div class="biometric-overlay" id="biometricOverlay">
        <div class="biometric-ring-container">
            <div class="biometric-ring ring-1" id="bioRing1"></div>
            <div class="biometric-ring ring-2" id="bioRing2"></div>
            <div class="biometric-ring ring-3" id="bioRing3"></div>
            <i class="fas fa-fingerprint biometric-icon" id="bioIcon"></i>
        </div>
        <div class="biometric-text" id="bioText">Authenticating...</div>
        <div class="biometric-subtext" id="bioSubtext">Verifying biometric identity</div>
    </div>

    <!-- Onboarding Overlay -->
    <div class="onboarding-overlay" id="onboardingOverlay">
        <div class="onboarding-card" id="onboardingCard"></div>
    </div>

    <div class="app-container" id="appContainer">
        <!-- Login Screen -->
        <div id="loginScreen" class="screen active">
            <img src="https://raw.githubusercontent.com/solusprotocol1/solus-protocol/main/logo.png" alt="Solus Protocol" style="width: 80px; height: 80px; border-radius: 20px; margin-bottom: 16px; animation: float 3s ease-in-out infinite;">
            <h1 class="login-title gradient-text">Solus Protocol</h1>
            <p class="login-subtitle">Your <span class="term-tooltip" onclick="showTermTooltip(event, 'zeroKnowledge')">Zero-Knowledge <i class="fas fa-info-circle tooltip-icon"></i></span> Healthcare Data Wallet</p>
            
            <div class="role-selector">
                <div class="role-card selected" data-role="patient" onclick="selectRole('patient')">
                    <div class="role-icon patient"><i class="fas fa-user"></i></div>
                    <div class="role-info">
                        <h3>Patient</h3>
                        <p>Manage your health records</p>
                    </div>
                </div>
                <div class="role-card provider" data-role="provider" onclick="selectRole('provider')">
                    <div class="role-icon provider"><i class="fas fa-stethoscope"></i></div>
                    <div class="role-info">
                        <h3>Provider</h3>
                        <p>Access patient records</p>
                    </div>
                </div>
                <div class="role-card ehr" data-role="ehr" onclick="selectRole('ehr')">
                    <div class="role-icon ehr"><i class="fas fa-hospital"></i></div>
                    <div class="role-info">
                        <h3>EHR System</h3>
                        <p>Enterprise integration</p>
                    </div>
                </div>
            </div>
            
            <div class="login-form">
                <div class="input-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter password" value="demo123" aria-label="Password">
                </div>
                <button class="login-btn" onclick="login()" aria-label="Sign in to Solus Protocol">
                    <i class="fas fa-fingerprint"></i> Sign In
                </button>
            </div>
            
            <p class="demo-hint">Demo password: demo123</p>
        </div>

        <!-- Home Screen -->
        <div id="homeScreen" class="screen">
            <div class="pull-indicator" id="pullIndicator">
                <i class="fas fa-arrow-down"></i>
            </div>
            <div class="app-header">
                <div class="header-top">
                    <div class="user-greeting">
                        <h1 id="greetingText">Good morning</h1>
                        <p id="userName">Alex Johnson</p>
                    </div>
                    <div style="text-align: right; display: flex; flex-direction: column; align-items: flex-end; gap: 4px;">
                        <div class="header-clock" id="headerClock"></div>
                        <div class="user-avatar" id="userAvatar" onclick="showScreen('profileScreen')">AJ</div>
                    </div>
                </div>
                <div class="status-bar">
                    <div class="status-item" onclick="showTermTooltip(event, 'blockchain')">
                        <div class="status-dot"></div>
                        <span class="term-tooltip">Blockchain Synced <i class="fas fa-info-circle tooltip-icon"></i></span>
                    </div>
                    <div class="status-item" onclick="showTermTooltip(event, 'hipaa')">
                        <i class="fas fa-shield-halved" style="color: var(--accent);"></i>
                        <span class="term-tooltip">HIPAA Secured <i class="fas fa-info-circle tooltip-icon"></i></span>
                    </div>
                </div>
            </div>

            <div class="content">
                <!-- Patient View -->
                <div id="patientHomeContent">
                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">Health Overview</span>
                        </div>
                        <div class="quick-stats">
                            <div class="stat-card">
                                <div class="stat-number" id="statRecords">12</div>
                                <div class="stat-label">Records</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="statShared">3</div>
                                <div class="stat-label">Shared</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="statVerified">12</div>
                                <div class="stat-label">Verified</div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">Quick Actions</span>
                            <span class="action-help-btn" onclick="toggleActionHelp('patientActionsHelp')"><i class="fas fa-question-circle"></i></span>
                        </div>
                        <div class="action-help-tooltip" id="patientActionsHelp">
                            <span class="action-help-close" onclick="this.parentElement.classList.remove('show')">&times;</span>
                            <h4 style="color: var(--accent); margin-bottom: 12px;">Quick Actions Help</h4>
                            <div class="help-action-item"><i class="fas fa-qrcode" style="color: var(--accent);"></i><div><strong>Scan QR</strong><p>Point your camera at a provider's QR code to instantly share or receive records.</p></div></div>
                            <div class="help-action-item"><i class="fas fa-share-nodes" style="color: var(--provider);"></i><div><strong>Share Record</strong><p>Grant a provider temporary, secure access to view your medical records.</p></div></div>
                            <div class="help-action-item"><i class="fas fa-plus" style="color: var(--accent2);"></i><div><strong>Add Record</strong><p>Upload a new medical record and anchor its hash to the XRPL blockchain.</p></div></div>
                            <div class="help-action-item"><i class="fas fa-certificate" style="color: var(--ehr);"></i><div><strong>Verify</strong><p>Check if a record has been tampered with by verifying its hash against XRPL.</p></div></div>
                        </div>
                        <div class="action-grid">
                            <div class="action-card" onclick="openModal('scanModal')">
                                <div class="action-icon green"><i class="fas fa-qrcode"></i></div>
                                <div class="action-title">Scan QR</div>
                                <div class="action-desc">Quick share access</div>
                            </div>
                            <div class="action-card" onclick="openModal('shareModal')">
                                <div class="action-icon purple"><i class="fas fa-share-nodes"></i></div>
                                <div class="action-title">Share Record</div>
                                <div class="action-desc">With provider</div>
                            </div>
                            <div class="action-card" onclick="openModal('addRecordModal')">
                                <div class="action-icon blue"><i class="fas fa-plus"></i></div>
                                <div class="action-title">Add Record</div>
                                <div class="action-desc">Upload new</div>
                            </div>
                            <div class="action-card" onclick="openModal('verifyModal')">
                                <div class="action-icon gold"><i class="fas fa-certificate"></i></div>
                                <div class="action-title">Verify</div>
                                <div class="action-desc">Check integrity</div>
                            </div>
                        </div>
                    </div>

                    <!-- SDK Playground Banner -->
                    <div class="section">
                        <div class="playground-banner" onclick="navigateToScreen('sdkPlaygroundScreen'); initPlaygroundTemplates();">
                            <div class="playground-badge"><i class="fas fa-terminal"></i> New</div>
                            <h3 style="font-size: 0.95rem; font-weight: 700; margin-bottom: 4px;">SDK Playground</h3>
                            <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 8px;">Anchor real medical records to the XRPL blockchain  directly from your browser. No setup required.</p>
                            <div style="display: flex; align-items: center; gap: 6px; font-size: 0.78rem; color: var(--accent);">
                                <span>Try it now</span> <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">Recent Records</span>
                            <span class="section-action" onclick="showScreen('recordsScreen')">See All</span>
                        </div>
                        <div class="records-list" id="recentRecordsList">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- AI Insights Section -->
                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">Solus Protocol AI Engine</span>
                            <span class="section-action" onclick="runAIScan()"><i class="fas fa-wand-magic-sparkles"></i> Scan</span>
                        </div>
                        <div class="ai-insights-card" id="aiInsightsCard">
                            <div class="ai-badge"><i class="fas fa-brain"></i> Solus Protocol AI Engine  Patient</div>
                            <div id="aiInsightsContent">
                                <p style="color: var(--text-muted); font-size: 0.85rem; text-align: center; padding: 16px 0;">
                                    <i class="fas fa-wand-magic-sparkles" style="font-size: 1.5rem; opacity: 0.3; display: block; margin-bottom: 8px;"></i>
                                    Tap <strong>"Scan"</strong> to analyze your health records for anomalies, drug interactions, and trends.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Data Health Score -->
                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">Data Health Score</span>
                            <span class="term-tooltip" onclick="showTermTooltip(event, 'healthScore')">
                                <i class="fas fa-info-circle tooltip-icon"></i>
                            </span>
                        </div>
                        <div class="ai-summary-box" style="text-align: center;">
                            <div class="health-score-ring" style="--score: 94;">
                                <span class="health-score-value">94</span>
                            </div>
                            <h4 style="color: var(--accent); margin-bottom: 4px;">Excellent</h4>
                            <p style="font-size: 0.8rem; color: var(--text-muted);">All records anchored & verified on XRPL</p>
                            <div style="display: flex; gap: 12px; margin-top: 16px; text-align: left;">
                                <div style="flex: 1; font-size: 0.78rem;">
                                    <div style="color: var(--accent); font-weight: 600;"><i class="fas fa-check-circle"></i> 12/12</div>
                                    <div style="color: var(--text-muted);">Records Verified</div>
                                </div>
                                <div style="flex: 1; font-size: 0.78rem;">
                                    <div style="color: var(--accent); font-weight: 600;"><i class="fas fa-shield-halved"></i> AES-256</div>
                                    <div style="color: var(--text-muted);">Encryption</div>
                                </div>
                                <div style="flex: 1; font-size: 0.78rem;">
                                    <div style="color: var(--warning); font-weight: 600;"><i class="fas fa-clock"></i> 28d</div>
                                    <div style="color: var(--text-muted);">Since Last Visit</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Emergency ICE Card -->
                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">Emergency ICE Card</span>
                            <span class="ice-badge"><i class="fas fa-heart-pulse"></i> ICE</span>
                        </div>
                        <div class="ice-card">
                            <div class="ice-header">
                                <i class="fas fa-kit-medical" style="color: var(--danger); font-size: 1.2rem;"></i>
                                <div>
                                    <div style="font-weight: 700; font-size: 0.95rem;">Alex Johnson</div>
                                    <div style="font-size: 0.72rem; color: var(--text-muted);">DOB: Mar 15, 1988  37 years old</div>
                                </div>
                            </div>
                            <div class="ice-grid">
                                <div class="ice-item">
                                    <div class="ice-item-label">Blood Type</div>
                                    <div class="ice-item-value">O+</div>
                                </div>
                                <div class="ice-item">
                                    <div class="ice-item-label">Emergency Contact</div>
                                    <div class="ice-item-value">Maria Johnson</div>
                                </div>
                                <div class="ice-item">
                                    <div class="ice-item-label">Allergies</div>
                                    <div class="ice-item-value danger">Penicillin, Sulfa</div>
                                </div>
                                <div class="ice-item">
                                    <div class="ice-item-label">Contact Phone</div>
                                    <div class="ice-item-value">(555) 867-5309</div>
                                </div>
                                <div class="ice-item" style="grid-column: span 2;">
                                    <div class="ice-item-label">Active Medications</div>
                                    <div class="ice-item-value">Lisinopril 10mg, Metformin 500mg</div>
                                </div>
                                <div class="ice-item" style="grid-column: span 2;">
                                    <div class="ice-item-label">Conditions</div>
                                    <div class="ice-item-value">Type 2 Diabetes, Stage 1 Hypertension</div>
                                </div>
                            </div>
                            <div class="ice-actions">
                                <button class="ice-btn ice-btn-share" onclick="shareICECard()">
                                    <i class="fas fa-share-nodes"></i> Share
                                </button>
                                <button class="ice-btn ice-btn-qr" onclick="showICEQR()">
                                    <i class="fas fa-qrcode"></i> QR Code
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Consent & Access Manager -->
                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">Who Has Access</span>
                            <span class="section-action" onclick="openModal('consentModal')">Manage</span>
                        </div>
                        <div class="access-list" id="accessList">
                            <div class="access-item">
                                <div class="access-avatar" style="background: linear-gradient(135deg, var(--accent), var(--accent2));">DS</div>
                                <div class="access-info">
                                    <div class="access-name">Dr. Smith</div>
                                    <div class="access-meta">Full access  Since Jan 2026</div>
                                </div>
                                <button class="access-revoke" onclick="revokeAccess(this, 'Dr. Smith')">Revoke</button>
                            </div>
                            <div class="access-item">
                                <div class="access-avatar" style="background: linear-gradient(135deg, var(--secondary), #c77dff);">QD</div>
                                <div class="access-info">
                                    <div class="access-name">Quest Diagnostics</div>
                                    <div class="access-meta">Lab results only  Since Dec 2025</div>
                                </div>
                                <button class="access-revoke" onclick="revokeAccess(this, 'Quest Diagnostics')">Revoke</button>
                            </div>
                            <div class="access-item">
                                <div class="access-avatar" style="background: linear-gradient(135deg, var(--ehr), #ffaa00);">CH</div>
                                <div class="access-info">
                                    <div class="access-name">City Hospital</div>
                                    <div class="access-meta">Imaging only  Since Nov 2025</div>
                                </div>
                                <button class="access-revoke" onclick="revokeAccess(this, 'City Hospital')">Revoke</button>
                            </div>
                        </div>
                    </div>

                    <!-- Anchoring Activity Heatmap -->
                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">Anchoring Activity</span>
                            <span style="font-size: 0.75rem; color: var(--text-muted);">Last 4 weeks</span>
                        </div>
                        <div class="heatmap-container">
                            <div class="heatmap-grid" id="heatmapGrid">
                                <!-- Populated by JS -->
                            </div>
                            <div class="heatmap-labels">
                                <span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span><span>Sun</span>
                            </div>
                            <div class="heatmap-legend">
                                <span>Less</span>
                                <div class="heatmap-legend-cell" style="background: rgba(255,255,255,0.05);"></div>
                                <div class="heatmap-legend-cell" style="background: rgba(20,241,149,0.15);"></div>
                                <div class="heatmap-legend-cell" style="background: rgba(20,241,149,0.3);"></div>
                                <div class="heatmap-legend-cell" style="background: rgba(20,241,149,0.5);"></div>
                                <div class="heatmap-legend-cell" style="background: rgba(20,241,149,0.75);"></div>
                                <span>More</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Provider View -->
                <div id="providerHomeContent" style="display: none;">
                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">Today's Overview</span>
                        </div>
                        <div class="quick-stats">
                            <div class="stat-card">
                                <div class="stat-number">8</div>
                                <div class="stat-label">Patients</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">24</div>
                                <div class="stat-label">Records</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">3</div>
                                <div class="stat-label">Pending</div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">Quick Actions</span>
                            <span class="action-help-btn" onclick="toggleActionHelp('providerActionsHelp')"><i class="fas fa-question-circle"></i></span>
                        </div>
                        <div class="action-help-tooltip" id="providerActionsHelp">
                            <span class="action-help-close" onclick="this.parentElement.classList.remove('show')">&times;</span>
                            <h4 style="color: var(--provider); margin-bottom: 12px;">Provider Actions Help</h4>
                            <div class="help-action-item"><i class="fas fa-search" style="color: var(--accent);"></i><div><strong>Find Patient</strong><p>Search for patients by name, DOB, or ID to look up their shared records.</p></div></div>
                            <div class="help-action-item"><i class="fas fa-key" style="color: var(--provider);"></i><div><strong>Request Access</strong><p>Send a request to a patient to grant you access to their medical records.</p></div></div>
                            <div class="help-action-item"><i class="fas fa-user-check" style="color: var(--accent2);"></i><div><strong>Verify Record</strong><p>Verify the authenticity of a patient record against its XRPL hash anchor.</p></div></div>
                            <div class="help-action-item"><i class="fas fa-qrcode" style="color: var(--ehr);"></i><div><strong>Scan QR</strong><p>Scan a patient's QR code for instant access to their shared records.</p></div></div>
                        </div>
                        <div class="action-grid">
                            <div class="action-card" onclick="openModal('patientLookupModal')">
                                <div class="action-icon green"><i class="fas fa-search"></i></div>
                                <div class="action-title">Find Patient</div>
                                <div class="action-desc">Look up records</div>
                            </div>
                            <div class="action-card" onclick="openModal('requestAccessModal')">
                                <div class="action-icon purple"><i class="fas fa-key"></i></div>
                                <div class="action-title">Request Access</div>
                                <div class="action-desc">Get authorization</div>
                            </div>
                            <div class="action-card" onclick="openModal('verifyPatientModal')">
                                <div class="action-icon blue"><i class="fas fa-user-check"></i></div>
                                <div class="action-title">Verify Record</div>
                                <div class="action-desc">Check authenticity</div>
                            </div>
                            <div class="action-card" onclick="openModal('scanModal')">
                                <div class="action-icon gold"><i class="fas fa-qrcode"></i></div>
                                <div class="action-title">Scan QR</div>
                                <div class="action-desc">Quick access</div>
                            </div>
                        </div>
                    </div>

                    <!-- SDK Playground Banner -->
                    <div class="section">
                        <div class="playground-banner" onclick="navigateToScreen('sdkPlaygroundScreen'); initPlaygroundTemplates();" style="border-color: rgba(153, 69, 255, 0.25); background: linear-gradient(135deg, rgba(153, 69, 255, 0.12), rgba(0, 194, 255, 0.08));">
                            <div class="playground-badge" style="background: linear-gradient(135deg, var(--secondary), var(--accent2));"><i class="fas fa-terminal"></i> New</div>
                            <h3 style="font-size: 0.95rem; font-weight: 700; margin-bottom: 4px;">SDK Playground</h3>
                            <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 8px;">Anchor clinical records, test cross-patient scenarios, and verify data integrity  all on XRPL Testnet.</p>
                            <div style="display: flex; align-items: center; gap: 6px; font-size: 0.78rem; color: var(--secondary);">
                                <span>Open Playground</span> <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">Recent Patients</span>
                            <span class="section-action">See All</span>
                        </div>
                        <div class="patient-list">
                            <div class="patient-card" onclick="openModal('patientDetailModal')">
                                <div class="patient-avatar">SJ</div>
                                <div class="patient-info">
                                    <div class="patient-name">Sarah Johnson</div>
                                    <div class="patient-meta">Last visit: Today  5 records shared</div>
                                </div>
                                <i class="fas fa-chevron-right" style="color: var(--text-muted);"></i>
                            </div>
                            <div class="patient-card">
                                <div class="patient-avatar" style="background: linear-gradient(135deg, var(--provider), #c77dff);">MR</div>
                                <div class="patient-info">
                                    <div class="patient-name">Michael Roberts</div>
                                    <div class="patient-meta">Last visit: Yesterday  3 records shared</div>
                                </div>
                                <i class="fas fa-chevron-right" style="color: var(--text-muted);"></i>
                            </div>
                            <div class="patient-card">
                                <div class="patient-avatar" style="background: linear-gradient(135deg, var(--ehr), #ffaa00);">EW</div>
                                <div class="patient-info">
                                    <div class="patient-name">Emily Watson</div>
                                    <div class="patient-meta">Last visit: 2 days ago  8 records shared</div>
                                </div>
                                <i class="fas fa-chevron-right" style="color: var(--text-muted);"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Provider AI Insights -->
                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">Solus Protocol AI Engine</span>
                            <span class="section-action" onclick="runProviderAIScan()"><i class="fas fa-wand-magic-sparkles"></i> Scan</span>
                        </div>
                        <div class="ai-insights-card" style="border-color: rgba(153, 69, 255, 0.2); background: linear-gradient(135deg, rgba(153, 69, 255, 0.08), rgba(0, 194, 255, 0.08));">
                            <div class="ai-badge" style="background: linear-gradient(135deg, var(--secondary), var(--accent2));"><i class="fas fa-brain"></i> Solus Protocol AI Engine  Provider</div>
                            <div id="providerAIContent">
                                <p style="color: var(--text-muted); font-size: 0.85rem; text-align: center; padding: 16px 0;">
                                    <i class="fas fa-user-md" style="font-size: 1.5rem; opacity: 0.3; display: block; margin-bottom: 8px;"></i>
                                    Tap <strong>"Scan"</strong> to analyze patient records for cross-patient trends, missed follow-ups, and clinical decision support.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Provider Data Health Score -->
                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">Practice Health Score</span>
                            <span class="term-tooltip" onclick="showTermTooltip(event, 'providerHealthScore')">
                                <i class="fas fa-info-circle tooltip-icon"></i>
                            </span>
                        </div>
                        <div class="ai-summary-box" style="text-align: center;">
                            <div class="health-score-ring" style="--score: 88; --score-color: #9945FF; margin: 0 auto 12px;">
                                <span class="health-score-value" style="color: var(--secondary);">88</span>
                            </div>
                            <h4 style="color: var(--secondary); margin-bottom: 4px;">Very Good</h4>
                            <p style="font-size: 0.8rem; color: var(--text-muted);">Practice-wide data integrity assessment</p>
                            <div style="display: flex; gap: 12px; margin-top: 16px; text-align: left;">
                                <div style="flex: 1; font-size: 0.78rem;">
                                    <div style="color: var(--accent); font-weight: 600;"><i class="fas fa-user-check"></i> 8/8</div>
                                    <div style="color: var(--text-muted);">Patients Verified</div>
                                </div>
                                <div style="flex: 1; font-size: 0.78rem;">
                                    <div style="color: var(--secondary); font-weight: 600;"><i class="fas fa-file-medical"></i> 24</div>
                                    <div style="color: var(--text-muted);">Records Today</div>
                                </div>
                                <div style="flex: 1; font-size: 0.78rem;">
                                    <div style="color: var(--warning); font-weight: 600;"><i class="fas fa-exclamation-triangle"></i> 3</div>
                                    <div style="color: var(--text-muted);">Pending Reviews</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- EHR View -->
                <div id="ehrHomeContent" style="display: none;">
                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">System Overview</span>
                        </div>
                        <div class="quick-stats">
                            <div class="stat-card">
                                <div class="stat-number">2.4M</div>
                                <div class="stat-label">Anchored</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">99.9%</div>
                                <div class="stat-label">Uptime</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">47</div>
                                <div class="stat-label">Integrations</div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">Quick Actions</span>
                            <span class="action-help-btn" onclick="toggleActionHelp('ehrActionsHelp')"><i class="fas fa-question-circle"></i></span>
                        </div>
                        <div class="action-help-tooltip" id="ehrActionsHelp">
                            <span class="action-help-close" onclick="this.parentElement.classList.remove('show')">&times;</span>
                            <h4 style="color: var(--ehr); margin-bottom: 12px;">EHR Actions Help</h4>
                            <div class="help-action-item"><i class="fas fa-layer-group" style="color: var(--accent);"></i><div><strong>Bulk Anchor</strong><p>Anchor multiple patient records to XRPL in a single batch for efficiency.</p></div></div>
                            <div class="help-action-item"><i class="fas fa-key" style="color: var(--provider);"></i><div><strong>API Keys</strong><p>Manage your integration API keys for production and test environments.</p></div></div>
                            <div class="help-action-item"><i class="fas fa-bolt" style="color: var(--accent2);"></i><div><strong>Webhooks</strong><p>Configure event-driven notifications for anchoring and verification events.</p></div></div>
                            <div class="help-action-item"><i class="fas fa-clipboard-list" style="color: var(--ehr);"></i><div><strong>Audit Log</strong><p>View HIPAA-compliant audit trail of all anchoring and access operations.</p></div></div>
                        </div>
                        <div class="action-grid">
                            <div class="action-card" onclick="openModal('bulkAnchorModal')">
                                <div class="action-icon green"><i class="fas fa-layer-group"></i></div>
                                <div class="action-title">Bulk Anchor</div>
                                <div class="action-desc">Batch records</div>
                            </div>
                            <div class="action-card" onclick="openModal('apiKeysModal')">
                                <div class="action-icon purple"><i class="fas fa-key"></i></div>
                                <div class="action-title">API Keys</div>
                                <div class="action-desc">Manage access</div>
                            </div>
                            <div class="action-card" onclick="openModal('webhooksModal')">
                                <div class="action-icon blue"><i class="fas fa-bolt"></i></div>
                                <div class="action-title">Webhooks</div>
                                <div class="action-desc">Configure events</div>
                            </div>
                            <div class="action-card" onclick="openModal('auditModal')">
                                <div class="action-icon gold"><i class="fas fa-clipboard-list"></i></div>
                                <div class="action-title">Audit Log</div>
                                <div class="action-desc">View activity</div>
                            </div>
                        </div>
                    </div>

                    <!-- SDK Playground Banner -->
                    <div class="section">
                        <div class="playground-banner" onclick="navigateToScreen('sdkPlaygroundScreen'); initPlaygroundTemplates();" style="border-color: rgba(255, 215, 0, 0.25); background: linear-gradient(135deg, rgba(255, 215, 0, 0.12), rgba(0, 194, 255, 0.08));">
                            <div class="playground-badge" style="background: linear-gradient(135deg, var(--ehr), #ff8c00);"><i class="fas fa-terminal"></i> New</div>
                            <h3 style="font-size: 0.95rem; font-weight: 700; margin-bottom: 4px;">SDK Playground</h3>
                            <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 8px;">Test bulk anchoring, API integration logging, and compliance audit scenarios on XRPL Testnet.</p>
                            <div style="display: flex; align-items: center; gap: 6px; font-size: 0.78rem; color: var(--ehr);">
                                <span>Open Playground</span> <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">API Performance</span>
                        </div>
                        <div class="chart-container">
                            <div class="chart-bars">
                                <div class="chart-bar" style="height: 60%;"></div>
                                <div class="chart-bar" style="height: 80%;"></div>
                                <div class="chart-bar" style="height: 45%;"></div>
                                <div class="chart-bar" style="height: 90%;"></div>
                                <div class="chart-bar" style="height: 70%;"></div>
                                <div class="chart-bar" style="height: 85%;"></div>
                                <div class="chart-bar" style="height: 75%;"></div>
                            </div>
                            <div class="chart-labels">
                                <span>Mon</span>
                                <span>Tue</span>
                                <span>Wed</span>
                                <span>Thu</span>
                                <span>Fri</span>
                                <span>Sat</span>
                                <span>Sun</span>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">Active API Keys</span>
                        </div>
                        <div class="api-card">
                            <div class="api-header">
                                <span class="api-title">Production Key</span>
                                <span class="api-status active">Active</span>
                            </div>
                            <div class="api-key">solus_live_3f7a</div>
                        </div>
                        <div class="api-card">
                            <div class="api-header">
                                <span class="api-title">Test Key</span>
                                <span class="api-status active">Active</span>
                            </div>
                            <div class="api-key">solus_test_9b2c</div>
                        </div>
                    </div>

                    <!-- EHR AI Insights -->
                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">Solus Protocol AI Engine</span>
                            <span class="section-action" onclick="runEHRAIScan()"><i class="fas fa-wand-magic-sparkles"></i> Scan</span>
                        </div>
                        <div class="ai-insights-card" style="border-color: rgba(255, 215, 0, 0.2); background: linear-gradient(135deg, rgba(255, 215, 0, 0.08), rgba(0, 194, 255, 0.08));">
                            <div class="ai-badge" style="background: linear-gradient(135deg, var(--ehr), #ff8c00);"><i class="fas fa-brain"></i> Solus Protocol AI Engine  EHR</div>
                            <div id="ehrAIContent">
                                <p style="color: var(--text-muted); font-size: 0.85rem; text-align: center; padding: 16px 0;">
                                    <i class="fas fa-hospital" style="font-size: 1.5rem; opacity: 0.3; display: block; margin-bottom: 8px;"></i>
                                    Tap <strong>"Scan"</strong> to run system-wide data integrity audits, detect anchoring failures, and identify HIPAA compliance gaps.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- EHR System Health Score -->
                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">System Health Score</span>
                            <span class="term-tooltip" onclick="showTermTooltip(event, 'ehrHealthScore')">
                                <i class="fas fa-info-circle tooltip-icon"></i>
                            </span>
                        </div>
                        <div class="ai-summary-box" style="text-align: center;">
                            <div class="health-score-ring" style="--score: 97; --score-color: #ffd700; margin: 0 auto 12px;">
                                <span class="health-score-value" style="color: var(--ehr);">97</span>
                            </div>
                            <h4 style="color: var(--ehr); margin-bottom: 4px;">Excellent</h4>
                            <p style="font-size: 0.8rem; color: var(--text-muted);">Enterprise-wide anchoring infrastructure health</p>
                            <div style="display: flex; gap: 12px; margin-top: 16px; text-align: left;">
                                <div style="flex: 1; font-size: 0.78rem;">
                                    <div style="color: var(--accent); font-weight: 600;"><i class="fas fa-check-circle"></i> 99.9%</div>
                                    <div style="color: var(--text-muted);">Uptime</div>
                                </div>
                                <div style="flex: 1; font-size: 0.78rem;">
                                    <div style="color: var(--ehr); font-weight: 600;"><i class="fas fa-layer-group"></i> 2.4M</div>
                                    <div style="color: var(--text-muted);">Anchored</div>
                                </div>
                                <div style="flex: 1; font-size: 0.78rem;">
                                    <div style="color: var(--accent); font-weight: 600;"><i class="fas fa-shield-halved"></i> 0</div>
                                    <div style="color: var(--text-muted);">HIPAA Violations</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Records Screen -->
        <div id="recordsScreen" class="screen">
            <div class="app-header">
                <div class="header-top">
                    <div class="user-greeting">
                        <h1>My Records</h1>
                        <p id="recordsCount">12 records on blockchain</p>
                    </div>
                    <button class="modal-close" onclick="openModal('addRecordModal')">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="section">
                    <div class="search-bar">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="recordSearchInput" placeholder="Search records..." oninput="filterRecords()">
                    </div>
                    <div class="record-filter-tabs" id="recordFilterTabs">
                        <div class="filter-tab active" onclick="setRecordFilter('all', this)">All</div>
                        <div class="filter-tab" onclick="setRecordFilter('visit', this)">Visits</div>
                        <div class="filter-tab" onclick="setRecordFilter('lab', this)">Lab Results</div>
                        <div class="filter-tab" onclick="setRecordFilter('imaging', this)">Imaging</div>
                        <div class="filter-tab" onclick="setRecordFilter('rx', this)">Prescriptions</div>
                        <div class="filter-tab" onclick="setRecordFilter('vitals', this)">Vitals</div>
                    </div>
                    <div class="records-list" id="allRecordsList">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Activity Screen -->
        <div id="activityScreen" class="screen">
            <div class="app-header">
                <div class="header-top">
                    <div class="user-greeting">
                        <h1>Activity</h1>
                        <p>Recent blockchain transactions</p>
                    </div>
                </div>
            </div>
            <div class="content">
                <div class="section">
                    <div class="activity-feed" id="activityFeed">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Screen -->
        <div id="profileScreen" class="screen">
            <div class="app-header">
                <div class="header-top">
                    <div class="user-greeting">
                        <h1>Profile</h1>
                        <p>Account settings</p>
                    </div>
                </div>
            </div>
            <div class="content">
                <div style="text-align: center; padding: 20px 0 30px;">
                    <div class="user-avatar" id="profileAvatar" style="width: 80px; height: 80px; font-size: 2rem; margin: 0 auto 16px;">AJ</div>
                    <h2 id="profileName">Alex Johnson</h2>
                    <p style="color: var(--text-muted);" id="profileRole">Patient Account</p>
                    <p style="color: var(--accent); font-size: 0.85rem; margin-top: 8px;">
                        <i class="fas fa-check-circle"></i> Verified Identity
                    </p>
                    <!-- Role Switcher -->
                    <div class="role-switcher-bar" id="roleSwitcherBar">
                        <button class="role-switch-btn active" id="rsPatient" onclick="switchRoleLive('patient')">
                            <i class="fas fa-user"></i> Patient
                        </button>
                        <button class="role-switch-btn" id="rsProvider" onclick="switchRoleLive('provider')">
                            <i class="fas fa-stethoscope"></i> Provider
                        </button>
                        <button class="role-switch-btn" id="rsEhr" onclick="switchRoleLive('ehr')">
                            <i class="fas fa-hospital"></i> EHR
                        </button>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">
                        <span class="section-title">Wallet</span>
                    </div>
                    <div class="api-card">
                        <div class="api-header">
                            <span class="api-title">XRP Address</span>
                            <span class="api-status active">Connected</span>
                        </div>
                        <div class="api-key">rHb9CJAWyB4rj91VRWn96DkukG4bwdtyTh</div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">
                        <span class="section-title">Settings</span>
                    </div>
                    <div class="settings-list">
                        <div class="settings-item" onclick="toggleTheme()">
                            <div class="settings-left">
                                <div class="settings-icon"><i class="fas fa-moon" id="themeIcon"></i></div>
                                <span id="themeLabel">Dark Mode</span>
                            </div>
                            <div class="toggle active" id="themeToggle"></div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-left">
                                <div class="settings-icon"><i class="fas fa-bell"></i></div>
                                <span>Notifications</span>
                            </div>
                            <div class="toggle active" onclick="this.classList.toggle('active')"></div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-left">
                                <div class="settings-icon"><i class="fas fa-fingerprint"></i></div>
                                <span>Biometric Login</span>
                            </div>
                            <div class="toggle active" onclick="this.classList.toggle('active')"></div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-left">
                                <div class="settings-icon"><i class="fas fa-shield-halved"></i></div>
                                <span>Two-Factor Auth</span>
                            </div>
                            <div class="toggle" onclick="this.classList.toggle('active')"></div>
                        </div>
                        <div class="settings-item" onclick="openModal('exportModal')">
                            <div class="settings-left">
                                <div class="settings-icon"><i class="fas fa-download"></i></div>
                                <span>Export Data</span>
                            </div>
                            <i class="fas fa-chevron-right" style="color: var(--text-muted);"></i>
                        </div>
                        <div class="settings-item" onclick="logout()">
                            <div class="settings-left">
                                <div class="settings-icon danger"><i class="fas fa-sign-out-alt"></i></div>
                                <span style="color: var(--danger);">Sign Out</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; padding: 20px; color: var(--text-muted); font-size: 0.8rem;">
                    <p>Solus Protocol v2.9.0</p>
                    <p style="margin-top: 4px;">Build Feb 2026  Powered by XRP Ledger</p>
                    <p style="margin-top: 4px; font-size: 0.7rem; opacity: 0.6;">Demo Environment  Testnet</p>
                </div>
            </div>
        </div>

        <!-- ===== ABOUT SCREEN ===== -->
        <div id="aboutScreen" class="screen">
            <div class="app-header">
                <div class="header-top">
                    <div class="user-greeting">
                        <h1>About</h1>
                        <p>Learn about Solus Protocol</p>
                    </div>
                </div>
            </div>
            <div class="content">
                <div class="section" style="text-align: center; padding: 10px 0 0;">
                    <img src="https://raw.githubusercontent.com/solusprotocol1/solus-protocol/main/logo.png" alt="Solus Protocol" style="width: 72px; height: 72px; border-radius: 18px; margin-bottom: 12px; animation: float 3s ease-in-out infinite;">
                    <h2 style="font-size: 1.4rem; margin-bottom: 4px;">Solus Protocol</h2>
                    <p style="color: var(--accent); font-size: 0.85rem;">Decentralized Medical Data Integrity on XRPL</p>
                </div>
                <div class="section">
                    <div class="about-card">
                        <h3>What is Solus Protocol?</h3>
                        <p>Solus Protocol is a decentralized medical data integrity platform built on the XRP Ledger. We enable patients and providers to securely hash, verify, and share medical records without exposing Protected Health Information (PHI) on-chain.</p>
                        <p>The Solus Protocol app is your personal healthcare data wallet  giving you full control over your medical records, who can access them, and how they're verified.</p>
                    </div>
                </div>
                <div class="section">
                    <div class="about-card">
                        <h3>Why "Solus"?</h3>
                        <p>We chose 'Solus' from the Latin word meaning 'alone' or 'only' because our protocol empowers patients to have sole control over the integrity of their medical data. In a fragmented healthcare system full of intermediaries, Solus Protocol creates a single, unbreakable source of truth on the XRPL  unique, independent, and patient-centered. It's not about storing data; it's about making each record's authenticity stand alone, verifiable by anyone, forever.</p>
                    </div>
                </div>
                <div class="section">
                    <div class="about-card">
                        <h3>How It Works</h3>
                        <div class="how-step"><div class="step-num">1</div><div><h4>Patient Record</h4><p>Patient enters or uploads medical record</p></div></div>
                        <div class="how-step"><div class="step-num">2</div><div><h4>Hash & Encrypt</h4><p>SHA-256 hash generated, PHI stays off-chain</p></div></div>
                        <div class="how-step"><div class="step-num">3</div><div><h4>Anchor on XRPL</h4><p>Hash stored immutably on XRP Ledger</p></div></div>
                        <div class="how-step"><div class="step-num">4</div><div><h4>Verify & Share</h4><p>Providers verify authenticity instantly</p></div></div>
                    </div>
                </div>
                <div class="section">
                    <div class="about-card">
                        <h3>Our Mission</h3>
                        <p>To empower patients with true ownership and control over their medical data while enabling healthcare providers to access accurate, verifiable records in a compliant, efficient, and tamper-proof manner  beginning with a focused rollout in South Carolina before expanding nationally.</p>
                    </div>
                </div>
                <div class="section">
                    <div class="about-card">
                        <h3>Key Features</h3>
                        <div class="feature-item"><i class="fas fa-lock" style="color: var(--accent);"></i><span>Zero-Knowledge Privacy  PHI never touches the blockchain</span></div>
                        <div class="feature-item"><i class="fas fa-bolt" style="color: var(--accent);"></i><span>~$0.001 per verification on XRPL</span></div>
                        <div class="feature-item"><i class="fas fa-shield-halved" style="color: var(--accent);"></i><span>HIPAA-aligned architecture</span></div>
                        <div class="feature-item"><i class="fas fa-link" style="color: var(--accent);"></i><span>Immutable hash anchoring on XRP Ledger</span></div>
                        <div class="feature-item"><i class="fas fa-coins" style="color: var(--accent);"></i><span>$SLS utility token for fees & rebates</span></div>
                    </div>
                </div>
                <div class="section">
                    <div class="about-card" style="text-align: center;">
                        <h3>Founder</h3>
                        <img src="https://raw.githubusercontent.com/solusprotocol1/solus-protocol/main/profilepic.png" alt="Nick Frankfort" style="width: 90px; height: 90px; border-radius: 50%; border: 3px solid var(--accent); margin: 12px 0;">
                        <h4 style="margin-bottom: 4px;">Nick Frankfort</h4>
                        <p style="color: var(--accent); margin: 0;">Founder & Lead Developer</p>
                    </div>
                </div>
                <div class="section">
                    <div class="section-header"><span class="section-title">FAQ</span></div>
                    <div class="faq-item" onclick="this.classList.toggle('open')">
                        <div class="faq-question"><span>What is hash anchoring?</span><i class="fas fa-chevron-down"></i></div>
                        <div class="faq-answer"><p>Hash anchoring creates a SHA-256 fingerprint of your medical record and stores that hash on the XRP Ledger blockchain. The actual data never goes on-chain  only a unique proof that the record existed in its exact form at a specific time.</p></div>
                    </div>
                    <div class="faq-item" onclick="this.classList.toggle('open')">
                        <div class="faq-question"><span>Is my health data stored on the blockchain?</span><i class="fas fa-chevron-down"></i></div>
                        <div class="faq-answer"><p>No. Solus Protocol uses zero-knowledge privacy  your Protected Health Information (PHI) never touches the blockchain. Only a cryptographic hash is stored, making it HIPAA-aligned by design.</p></div>
                    </div>
                    <div class="faq-item" onclick="this.classList.toggle('open')">
                        <div class="faq-question"><span>What is $SLS used for?</span><i class="fas fa-chevron-down"></i></div>
                        <div class="faq-answer"><p>$SLS is the utility token on the XRPL that powers anchoring fees (~$0.001 per record), provider verification payments, and patient rebates. It can be traded on exchanges like xMagnetic, Sologenic, and xpmarket.</p></div>
                    </div>
                    <div class="faq-item" onclick="this.classList.toggle('open')">
                        <div class="faq-question"><span>Can I use this without crypto knowledge?</span><i class="fas fa-chevron-down"></i></div>
                        <div class="faq-answer"><p>Yes! The SDK abstracts blockchain complexity entirely. Providers and patients can use fiat (USD) payments through the standard subscription tier, while $SLS powers the backend automatically.</p></div>
                    </div>
                    <div class="faq-item" onclick="this.classList.toggle('open')">
                        <div class="faq-question"><span>How do I verify a record?</span><i class="fas fa-chevron-down"></i></div>
                        <div class="faq-answer"><p>Go to the Verify action from the home screen, paste a record hash or transaction ID, and the app checks it against the XRPL. If it matches, the record is confirmed authentic and untampered.</p></div>
                    </div>
                </div>
                <div style="text-align: center; padding: 10px 0 20px;">
                    <a href="https://solusprotocol.com" target="_blank" style="color: var(--accent); text-decoration: none; font-size: 0.9rem;">Visit solusprotocol.com </a>
                </div>
            </div>
        </div>

        <!-- ===== CONTACT SCREEN ===== -->
        <div id="contactScreen" class="screen">
            <div class="app-header">
                <div class="header-top">
                    <div class="user-greeting">
                        <h1>Contact</h1>
                        <p>Get in touch with us</p>
                    </div>
                </div>
            </div>
            <div class="content">
                <div class="section">
                    <div class="contact-card">
                        <h3>Send Us a Message</h3>
                        <div class="form-group">
                            <label class="form-label">Your Name</label>
                            <input type="text" class="form-input" id="appContactName" placeholder="John Doe">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Your Email</label>
                            <input type="email" class="form-input" id="appContactEmail" placeholder="john@example.com">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Subject</label>
                            <select class="form-select" id="appContactSubject">
                                <option value="">Select a topic...</option>
                                <option value="Partnership Inquiry">Partnership Inquiry</option>
                                <option value="Pilot Program">Pilot Program</option>
                                <option value="SDK Integration">SDK Integration Support</option>
                                <option value="Investor Relations">Investor Relations</option>
                                <option value="General Question">General Question</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Message</label>
                            <textarea class="form-input" id="appContactMessage" placeholder="Tell us more about your inquiry..."></textarea>
                        </div>
                        <button class="btn btn-primary btn-full" onclick="sendAppContact()">
                            <i class="fas fa-paper-plane"></i> Send Message
                        </button>
                    </div>
                </div>
                <div class="section">
                    <div class="contact-card">
                        <h3>Other Ways to Reach Us</h3>
                        <div class="contact-item">
                            <i class="fas fa-globe" style="color: var(--accent);"></i>
                            <a href="https://solusprotocol.com" target="_blank">solusprotocol.com</a>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-envelope" style="color: var(--accent);"></i>
                            <a href="mailto:support@solusprotocol.com">support@solusprotocol.com</a>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-briefcase" style="color: var(--accent);"></i>
                            <a href="mailto:support@solusprotocol.com">Investor Relations</a>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-shield-halved" style="color: var(--accent);"></i>
                            <a href="mailto:security@solusprotocol.com">Security Reports</a>
                        </div>
                    </div>
                </div>
                <div class="section">
                    <div class="contact-card">
                        <h3>Follow Us</h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <a href="https://x.com/Solus_Protocol" target="_blank" class="social-btn">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                                @Solus_Protocol
                            </a>
                            <a href="https://t.me/solus_protocol" target="_blank" class="social-btn">
                                <i class="fab fa-telegram"></i> Telegram
                            </a>
                            <a href="https://www.linkedin.com/company/solusprotocol/" target="_blank" class="social-btn">
                                <i class="fab fa-linkedin"></i> LinkedIn
                            </a>
                            <a href="https://github.com/solusprotocol1/solus-protocol" target="_blank" class="social-btn">
                                <i class="fab fa-github"></i> GitHub
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== TRADE SCREEN ===== -->
        <div id="tradeScreen" class="screen">
            <div class="app-header">
                <div class="header-top">
                    <div class="user-greeting">
                        <h1>$SLS Wallet</h1>
                        <p>Buy, sell & manage $SLS</p>
                    </div>
                </div>
            </div>
            <div class="content">
                <div class="section">
                    <div class="trade-balance-card">
                        <p style="color: var(--text-muted); font-size: 0.85rem; margin-bottom: 4px;">Total Balance</p>
                        <div class="trade-balance-amount" id="tradeBalance">150.75 $SLS</div>
                        <div class="trade-balance-usd" id="tradeBalanceUSD"> $7.54 USD</div>
                        <div style="display: flex; gap: 12px; margin-top: 20px;">
                            <button class="btn btn-primary" style="flex: 1;" onclick="tradeDeposit()">
                                <i class="fas fa-arrow-down"></i> Deposit
                            </button>
                            <button class="btn btn-secondary" style="flex: 1;" onclick="tradeWithdraw()">
                                <i class="fas fa-arrow-up"></i> Withdraw
                            </button>
                        </div>
                    </div>
                </div>
                <div class="section">
                    <div class="section-header"><span class="section-title">Convert</span></div>
                    <div class="trade-convert-card">
                        <div style="margin-bottom: 8px;">
                            <label class="form-label" style="margin-bottom: 4px;">From</label>
                            <div class="convert-input-group">
                                <input type="number" class="form-input" id="convertFromAmount" value="100" oninput="updateConversion()" style="margin-bottom: 0; text-align: right; padding-right: 60px;">
                                <span class="convert-currency">$SLS</span>
                            </div>
                        </div>
                        <div style="text-align: center; padding: 4px 0;">
                            <i class="fas fa-exchange-alt" style="color: var(--accent); font-size: 1.1rem; transform: rotate(90deg);"></i>
                        </div>
                        <div style="margin-bottom: 12px;">
                            <label class="form-label" style="margin-bottom: 4px;">To</label>
                            <div class="convert-input-group">
                                <input type="number" class="form-input" id="convertToAmount" value="5.00" readonly style="margin-bottom: 0; text-align: right; padding-right: 60px; opacity: 0.7;">
                                <span class="convert-currency">USD</span>
                            </div>
                        </div>
                        <p style="text-align: center; color: var(--text-muted); font-size: 0.8rem; margin-bottom: 12px;">Rate: 1 $SLS  $0.05 USD (demo)</p>
                        <button class="btn btn-primary btn-full" onclick="showToast('Conversion simulated  $' + document.getElementById('convertToAmount').value + ' USD', 'success')">
                            <i class="fas fa-sync-alt"></i> Convert
                        </button>
                    </div>
                </div>
                <div class="section">
                    <div class="section-header"><span class="section-title">Buy & Trade $SLS</span></div>
                    <a href="https://xmagnetic.org/tokens/r95GyZac4butvVcsTWUPpxzekmyzaHsTA5+534C5300000000000000000000000000000000000000" target="_blank" class="exchange-card">
                        <div class="exchange-icon" style="background: rgba(20, 241, 149, 0.15);"><i class="fas fa-chart-line" style="color: var(--accent);"></i></div>
                        <div><div class="exchange-name">xMagnetic</div><div class="exchange-desc">XRPL DEX Trading</div></div>
                        <i class="fas fa-external-link-alt" style="color: var(--text-muted); margin-left: auto;"></i>
                    </a>
                    <a href="https://sologenic.org/trade?market=SLS%2Br95GyZac4butvVcsTWUPpxzekmyzaHsTA5%2FXRP" target="_blank" class="exchange-card">
                        <div class="exchange-icon" style="background: rgba(153, 69, 255, 0.15);"><i class="fas fa-exchange-alt" style="color: var(--provider);"></i></div>
                        <div><div class="exchange-name">Sologenic DEX</div><div class="exchange-desc">Trade SLS/XRP</div></div>
                        <i class="fas fa-external-link-alt" style="color: var(--text-muted); margin-left: auto;"></i>
                    </a>
                    <a href="https://xaman.app" target="_blank" class="exchange-card">
                        <div class="exchange-icon" style="background: rgba(0, 194, 255, 0.15);"><i class="fas fa-wallet" style="color: var(--accent2);"></i></div>
                        <div><div class="exchange-name">Xaman Wallet</div><div class="exchange-desc">XRPL Wallet</div></div>
                        <i class="fas fa-external-link-alt" style="color: var(--text-muted); margin-left: auto;"></i>
                    </a>
                    <a href="https://xpmarket.com/token/SLS-r95GyZac4butvVcsTWUPpxzekmyzaHsTA5" target="_blank" class="exchange-card">
                        <div class="exchange-icon" style="background: rgba(255, 215, 0, 0.15);"><i class="fas fa-coins" style="color: var(--ehr);"></i></div>
                        <div><div class="exchange-name">xpmarket</div><div class="exchange-desc">Token Marketplace</div></div>
                        <i class="fas fa-external-link-alt" style="color: var(--text-muted); margin-left: auto;"></i>
                    </a>
                </div>
                <div class="section">
                    <div class="section-header"><span class="section-title">Recent Transactions</span></div>
                    <div class="trade-tx-list">
                        <div class="trade-tx-item">
                            <div class="trade-tx-icon" style="background: rgba(20, 241, 149, 0.15); color: var(--accent);"><i class="fas fa-arrow-down"></i></div>
                            <div class="trade-tx-info"><div class="trade-tx-title">Deposit</div><div class="trade-tx-date">Feb 5, 2026</div></div>
                            <div class="trade-tx-amount positive">+50.00 $SLS</div>
                        </div>
                        <div class="trade-tx-item">
                            <div class="trade-tx-icon" style="background: rgba(255, 71, 87, 0.15); color: var(--danger);"><i class="fas fa-link"></i></div>
                            <div class="trade-tx-info"><div class="trade-tx-title">Hash Anchoring Fee</div><div class="trade-tx-date">Feb 4, 2026</div></div>
                            <div class="trade-tx-amount negative">-0.01 $SLS</div>
                        </div>
                        <div class="trade-tx-item">
                            <div class="trade-tx-icon" style="background: rgba(20, 241, 149, 0.15); color: var(--accent);"><i class="fas fa-gift"></i></div>
                            <div class="trade-tx-info"><div class="trade-tx-title">Verification Rebate</div><div class="trade-tx-date">Feb 3, 2026</div></div>
                            <div class="trade-tx-amount positive">+0.005 $SLS</div>
                        </div>
                        <div class="trade-tx-item">
                            <div class="trade-tx-icon" style="background: rgba(153, 69, 255, 0.15); color: var(--provider);"><i class="fas fa-arrow-up"></i></div>
                            <div class="trade-tx-info"><div class="trade-tx-title">Withdrawal to USD</div><div class="trade-tx-date">Feb 1, 2026</div></div>
                            <div class="trade-tx-amount negative">-20.00 $SLS</div>
                        </div>
                    </div>
                    <button class="export-btn" onclick="exportTradeCSV()">
                        <i class="fas fa-file-csv"></i> Export Transaction History (CSV)
                    </button>
                </div>
            </div>
        </div>

        <!-- ===== METRICS SCREEN (Real API) ===== -->
        <div id="metricsScreen" class="screen">
            <div class="app-header">
                <div class="header-top">
                    <div class="user-greeting">
                        <h1>Network Activity</h1>
                        <p>Real-time protocol metrics</p>
                        <div class="metrics-api-badge"><div class="status-dot" style="width: 6px; height: 6px;"></div> Live from XRPL Testnet</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; background: rgba(20, 241, 149, 0.1); border-radius: 20px; font-size: 0.8rem;">
                        <div class="status-dot"></div>
                        <span id="metricsStatusText">Loading...</span>
                    </div>
                </div>
            </div>
            <div class="content">
                <!-- Loading state -->
                <div class="metrics-loading" id="metricsLoading">
                    <div class="spinner"></div>
                    <p>Fetching live data from XRPL...</p>
                </div>
                <!-- Error state -->
                <div class="metrics-error" id="metricsError" style="display: none;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 1.5rem; margin-bottom: 8px;"></i>
                    <p id="metricsErrorText">Failed to load metrics</p>
                    <button class="btn btn-secondary" style="margin-top: 12px; padding: 10px 20px;" onclick="loadMetricsAPI()">
                        <i class="fas fa-refresh"></i> Retry
                    </button>
                </div>
                <!-- Data content (hidden until loaded) -->
                <div id="metricsContent" style="display: none;">
                    <div class="section">
                        <div class="quick-stats" style="grid-template-columns: repeat(2, 1fr);">
                            <div class="stat-card"><div class="stat-number" id="metricTotalRecords"></div><div class="stat-label">Records Anchored</div></div>
                            <div class="stat-card"><div class="stat-number" id="metricRecordTypes"></div><div class="stat-label">Record Types</div></div>
                            <div class="stat-card"><div class="stat-number" id="metricTotalFees"></div><div class="stat-label">Total $SLS Fees</div></div>
                            <div class="stat-card"><div class="stat-number" id="metricToday"></div><div class="stat-label">Anchored Today</div></div>
                        </div>
                    </div>
                    <div class="section">
                        <div class="section-header"><span class="section-title">Record Type Distribution</span></div>
                        <div class="metrics-type-list" id="metricsTypeList">
                            <!-- Populated by API -->
                        </div>
                    </div>
                    <div class="section">
                        <div class="section-header">
                            <span class="section-title">Live Activity Feed</span>
                            <span style="display: flex; align-items: center; gap: 6px; font-size: 0.8rem; color: var(--text-muted);"><div class="status-dot"></div>Real-time</span>
                        </div>
                        <div class="metrics-live-feed" id="metricsLiveFeed">
                            <!-- Populated by API -->
                        </div>
                    </div>
                    <div class="section">
                        <div class="section-header"><span class="section-title">XRPL Network</span></div>
                        <div style="background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 16px;">
                            <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border);"><span style="color: var(--text-muted);">Network</span><span style="color: var(--accent); font-weight: 600;">XRPL Testnet</span></div>
                            <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border);"><span style="color: var(--text-muted);">Account</span><span style="font-family: monospace; font-size: 0.75rem;" id="metricAccount">rJPqcx...rqJA</span></div>
                            <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border);"><span style="color: var(--text-muted);">Avg. Fee</span><span style="color: var(--accent); font-weight: 600;">~$0.001</span></div>
                            <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border);"><span style="color: var(--text-muted);">Total $SLS Fees</span><span style="font-weight: 600;" id="metricFeesSummary"></span></div>
                            <div style="display: flex; justify-content: space-between; padding: 12px 0;"><span style="color: var(--text-muted);">Last Hash</span><span style="font-family: monospace; font-size: 0.7rem; max-width: 160px; overflow: hidden; text-overflow: ellipsis;" id="metricLastHash"></span></div>
                        </div>
                    </div>
                    <div style="text-align: center; padding: 10px 0 20px;">
                        <a href="https://solusprotocol.com/metrics.html" target="_blank" style="color: var(--accent); text-decoration: none; font-size: 0.9rem;"><i class="fas fa-external-link-alt"></i> Full Metrics Dashboard</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== SDK PLAYGROUND SCREEN ===== -->
        <div id="sdkPlaygroundScreen" class="screen">
            <div class="app-header">
                <div class="header-top">
                    <div class="user-greeting">
                        <h1><i class="fas fa-terminal" style="color: var(--accent); margin-right: 6px;"></i> SDK Playground</h1>
                        <p>Anchor real records to XRPL Testnet</p>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button style="background: var(--glass); border: 1px solid var(--border); color: var(--accent); width: 36px; height: 36px; border-radius: 10px; cursor: pointer; font-size: 0.85rem;" onclick="showPlaygroundTutorial()" aria-label="Tutorial"><i class="fas fa-graduation-cap"></i></button>
                        <button style="background: var(--glass); border: 1px solid var(--border); color: var(--text-muted); width: 36px; height: 36px; border-radius: 10px; cursor: pointer; font-size: 0.85rem;" onclick="navigateTo('home', document.querySelector('.nav-item'))" aria-label="Back"><i class="fas fa-times"></i></button>
                    </div>
                </div>
            </div>
            <div class="content">
                <!-- Session Counter -->
                <div class="section">
                    <div class="pg-session-counter">
                        <i class="fas fa-link" style="color: var(--accent);"></i>
                        <div>
                            <span class="pg-session-count" id="pgSessionCount">0</span>
                            <span style="color: var(--text-muted); font-size: 0.78rem;"> records anchored this session</span>
                        </div>
                        <div style="margin-left: auto;">
                            <span class="pg-testnet-badge"><i class="fas fa-flask"></i> Testnet</span>
                        </div>
                    </div>
                </div>

                <!-- Step 1: Choose Template -->
                <div class="section">
                    <div class="pg-section-title"><span style="color: var(--accent);">1.</span> Choose a Record Template</div>
                    <div class="template-grid" id="pgTemplateGrid">
                        <!-- Populated by JS based on role -->
                    </div>
                </div>

                <!-- Step 2: Edit Record -->
                <div class="section">
                    <div class="pg-section-title"><span style="color: var(--accent);">2.</span> Review & Edit Record Data</div>
                    <textarea class="pg-editor" id="pgRecordEditor" placeholder="Select a template above, or type your own medical record data here..." oninput="updatePgHashPreview()"></textarea>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px;">
                        <div id="pgRecordType" style="font-size: 0.72rem; color: var(--text-muted);">Type: <span id="pgRecordTypeLabel"></span></div>
                        <div id="pgCharCount" style="font-size: 0.72rem; color: var(--text-muted);">0 characters</div>
                    </div>
                </div>

                <!-- Step 3: Hash Preview -->
                <div class="section">
                    <div class="pg-section-title"><span style="color: var(--accent);">3.</span> Live SHA-256 Hash Preview</div>
                    <div class="pg-hash-label">SHA-256 Fingerprint (computed in real-time)</div>
                    <div class="pg-hash-preview" id="pgHashPreview">Enter record data above to see the live hash...</div>
                </div>

                <!-- Step 4: Anchor -->
                <div class="section">
                    <div class="pg-section-title"><span style="color: var(--accent);">4.</span> Anchor to XRPL Blockchain</div>
                    <button class="anchor-btn" id="pgAnchorBtn" onclick="anchorFromPlayground()" disabled>
                        <i class="fas fa-link"></i> Anchor Record to XRPL Testnet
                    </button>
                    <p style="font-size: 0.7rem; color: var(--text-muted); margin-top: 8px; text-align: center;">
                        <i class="fas fa-info-circle"></i> Submits an on-chain transaction to the XRP Ledger Testnet. Your record data is never stored on-chain  only its SHA-256 hash.
                    </p>

                    <!-- Progress Steps -->
                    <div class="pg-progress" id="pgProgress" style="display: none;">
                        <div class="pg-step" id="pgStep1">
                            <div class="pg-step-icon"><i class="fas fa-wifi"></i></div>
                            <div class="pg-step-text"><h4>Connecting to XRPL</h4><p>Establishing WebSocket to testnet...</p></div>
                        </div>
                        <div class="pg-step" id="pgStep2">
                            <div class="pg-step-icon"><i class="fas fa-hashtag"></i></div>
                            <div class="pg-step-text"><h4>Computing SHA-256 Hash</h4><p id="pgStepHashText">Generating cryptographic fingerprint...</p></div>
                        </div>
                        <div class="pg-step" id="pgStep3">
                            <div class="pg-step-icon"><i class="fas fa-paper-plane"></i></div>
                            <div class="pg-step-text"><h4>Submitting Transaction</h4><p>Broadcasting to XRPL validators...</p></div>
                        </div>
                        <div class="pg-step" id="pgStep4">
                            <div class="pg-step-icon"><i class="fas fa-check-circle"></i></div>
                            <div class="pg-step-text"><h4>Confirmed on Ledger</h4><p id="pgStepLedgerText">Waiting for ledger inclusion...</p></div>
                        </div>
                    </div>

                    <!-- Result -->
                    <div class="pg-result" id="pgResult">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                            <i class="fas fa-check-circle" style="color: var(--accent); font-size: 1.2rem;"></i>
                            <h4 style="font-size: 0.9rem;">Record Anchored Successfully!</h4>
                        </div>
                        <div class="pg-result-label">SHA-256 Hash</div>
                        <div class="pg-result-value" id="pgResultHash" style="color: var(--accent);"></div>
                        <div class="pg-result-label">Transaction Hash</div>
                        <div class="pg-result-value" id="pgResultTxHash" style="color: var(--accent2);"></div>
                        <div class="pg-result-label">Ledger Index</div>
                        <div class="pg-result-value" id="pgResultLedger" style="color: var(--text);"></div>
                        <div class="pg-result-label">Record Type</div>
                        <div class="pg-result-value" id="pgResultType" style="color: var(--secondary);"></div>
                        <div class="pg-result-actions">
                            <button class="pg-result-btn" onclick="copyPgHash()"><i class="fas fa-copy"></i> Copy Hash</button>
                            <button class="pg-result-btn" id="pgExplorerBtn" onclick="openPgExplorer()"><i class="fas fa-external-link-alt"></i> XRPL Explorer</button>
                            <button class="pg-result-btn" onclick="navigateToScreen('metricsScreen')"><i class="fas fa-chart-bar"></i> Metrics</button>
                        </div>
                    </div>
                </div>

                <!-- Session History -->
                <div class="section" id="pgHistorySection" style="display: none;">
                    <div class="pg-section-title"><i class="fas fa-history" style="color: var(--accent2);"></i> Session History</div>
                    <div id="pgHistoryList">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Info footer -->
                <div class="section">
                    <div style="background: var(--glass); border: 1px solid var(--border); border-radius: 12px; padding: 14px; font-size: 0.75rem; color: var(--text-muted); line-height: 1.5;">
                        <p><i class="fas fa-shield-halved" style="color: var(--accent);"></i> <strong>Privacy:</strong> Your record data never leaves your browser. Only the irreversible SHA-256 hash is submitted to the XRPL  the original data cannot be reconstructed from the hash.</p>
                        <p style="margin-top: 8px;"><i class="fas fa-coins" style="color: var(--warning);"></i> <strong>Fees:</strong> Each anchoring transaction costs ~0.000012 XRP (~$0.000003). The testnet account has unlimited free XRP.</p>
                        <p style="margin-top: 8px;"><i class="fas fa-chart-bar" style="color: var(--accent2);"></i> <strong>Metrics:</strong> Your anchored records appear in the live metrics dashboard within 60 seconds  on both the demo app and the main website.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- SDK Playground Tutorial Overlay -->
        <div class="pg-tutorial-overlay" id="pgTutorialOverlay" onclick="if(event.target===this)this.classList.remove('active')">
            <div class="pg-tutorial-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <h3 style="font-size: 1rem;"><i class="fas fa-graduation-cap" style="color: var(--accent); margin-right: 6px;"></i> How It Works</h3>
                    <button style="background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 1.2rem;" onclick="document.getElementById('pgTutorialOverlay').classList.remove('active')">&times;</button>
                </div>
                <p style="font-size: 0.82rem; color: var(--text-muted); margin-bottom: 16px; line-height: 1.5;">
                    The SDK Playground lets you anchor real medical records to the <strong style="color: var(--accent);">XRP Ledger Testnet</strong> directly from your browser. Here's how:
                </p>
                <div class="pg-tutorial-step">
                    <div class="pg-tutorial-num">1</div>
                    <div class="pg-tutorial-text">
                        <h4>Choose a Template</h4>
                        <p>Select a pre-built record template that matches your role  vitals, lab results, surgery reports, EHR integration logs, and more. Templates are role-specific (Patient, Provider, EHR).</p>
                    </div>
                </div>
                <div class="pg-tutorial-step">
                    <div class="pg-tutorial-num">2</div>
                    <div class="pg-tutorial-text">
                        <h4>Review & Customize</h4>
                        <p>Edit the record data in the text editor. You can modify patient names, values, dates  or write something entirely custom. The SHA-256 hash updates in real-time as you type.</p>
                    </div>
                </div>
                <div class="pg-tutorial-step">
                    <div class="pg-tutorial-num">3</div>
                    <div class="pg-tutorial-text">
                        <h4>Anchor to XRPL</h4>
                        <p>Click the anchor button to submit a real on-chain transaction. The app connects to the XRPL Testnet via WebSocket, computes the SHA-256 hash, signs the transaction, and submits it to validators.</p>
                    </div>
                </div>
                <div class="pg-tutorial-step">
                    <div class="pg-tutorial-num">4</div>
                    <div class="pg-tutorial-text">
                        <h4>Verify on Explorer</h4>
                        <p>Once confirmed, you get a transaction hash and direct link to the XRPL Testnet Explorer where you can verify the on-chain anchoring. The hash is stored in the transaction memo.</p>
                    </div>
                </div>
                <div class="pg-tutorial-step">
                    <div class="pg-tutorial-num">5</div>
                    <div class="pg-tutorial-text">
                        <h4>See It in Metrics</h4>
                        <p>Your anchored record immediately appears in the live metrics dashboard  both on this app and on <strong>solusprotocol.com</strong>. Record type, timestamp, and hash are all tracked.</p>
                    </div>
                </div>
                <div style="margin-top: 16px; padding: 12px; background: rgba(255, 215, 0, 0.08); border: 1px solid rgba(255, 215, 0, 0.2); border-radius: 10px; font-size: 0.78rem; color: var(--warning);">
                    <i class="fas fa-flask"></i> <strong>Testnet Only:</strong> This playground uses the XRPL Testnet  no real money or tokens are involved. All transactions are for demonstration purposes.
                </div>
                <button class="btn btn-primary btn-full" style="margin-top: 16px;" onclick="document.getElementById('pgTutorialOverlay').classList.remove('active')">
                    <i class="fas fa-rocket"></i> Got It  Let's Anchor!
                </button>
            </div>
        </div>

        <!-- ===== MORE SCREEN ===== -->
        <div id="moreScreen" class="screen">
            <div class="app-header">
                <div class="header-top">
                    <div class="user-greeting">
                        <h1>More</h1>
                        <p>Additional features & settings</p>
                    </div>
                </div>
            </div>
            <div class="content">
                <div class="section">
                    <div class="settings-list">
                        <div class="settings-item" onclick="navigateToScreen('aboutScreen')">
                            <div class="settings-left"><div class="settings-icon"><i class="fas fa-info-circle"></i></div><span>About Solus Protocol</span></div>
                            <i class="fas fa-chevron-right" style="color: var(--text-muted);"></i>
                        </div>
                        <div class="settings-item" onclick="navigateToScreen('contactScreen')">
                            <div class="settings-left"><div class="settings-icon"><i class="fas fa-envelope"></i></div><span>Contact Us</span></div>
                            <i class="fas fa-chevron-right" style="color: var(--text-muted);"></i>
                        </div>
                        <div class="settings-item" onclick="navigateToScreen('sdkPlaygroundScreen'); initPlaygroundTemplates();">
                            <div class="settings-left"><div class="settings-icon" style="background: linear-gradient(135deg, var(--accent), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"><i class="fas fa-terminal"></i></div><span>SDK Playground</span></div>
                            <span class="playground-badge" style="font-size: 0.6rem; padding: 2px 6px;"><i class="fas fa-bolt"></i> Live</span>
                        </div>
                        <div class="settings-item" onclick="navigateToScreen('metricsScreen')">
                            <div class="settings-left"><div class="settings-icon"><i class="fas fa-chart-bar"></i></div><span>Network Metrics</span></div>
                            <i class="fas fa-chevron-right" style="color: var(--text-muted);"></i>
                        </div>
                        <div class="settings-item" onclick="navigateToScreen('profileScreen')">
                            <div class="settings-left"><div class="settings-icon"><i class="fas fa-user"></i></div><span>Profile & Settings</span></div>
                            <i class="fas fa-chevron-right" style="color: var(--text-muted);"></i>
                        </div>
                    </div>
                </div>
                <div class="section">
                    <div class="section-header"><span class="section-title">Links</span></div>
                    <div class="settings-list">
                        <a href="https://solusprotocol.com" target="_blank" style="text-decoration: none; color: var(--text);">
                            <div class="settings-item">
                                <div class="settings-left"><div class="settings-icon"><i class="fas fa-globe"></i></div><span>Website</span></div>
                                <i class="fas fa-external-link-alt" style="color: var(--text-muted);"></i>
                            </div>
                        </a>
                        <a href="https://github.com/solusprotocol1/solus-protocol/blob/dec022ee9ca6c9b1117abc2bc63d36b537318a36/Solus%20Protocol%20Whitepaper%20Version%203.0%20(January%202026).pdf" target="_blank" style="text-decoration: none; color: var(--text);">
                            <div class="settings-item">
                                <div class="settings-left"><div class="settings-icon"><i class="fas fa-file-pdf"></i></div><span>Whitepaper</span></div>
                                <i class="fas fa-external-link-alt" style="color: var(--text-muted);"></i>
                            </div>
                        </a>
                        <a href="https://github.com/solusprotocol1/solus-protocol" target="_blank" style="text-decoration: none; color: var(--text);">
                            <div class="settings-item">
                                <div class="settings-left"><div class="settings-icon"><i class="fab fa-github"></i></div><span>GitHub</span></div>
                                <i class="fas fa-external-link-alt" style="color: var(--text-muted);"></i>
                            </div>
                        </a>
                    </div>
                </div>
                <div style="text-align: center; padding: 20px; color: var(--text-muted); font-size: 0.8rem;">
                    <p>Solus Protocol v2.9.0</p>
                    <p style="margin-top: 4px;">Build Feb 2026  Powered by XRP Ledger</p>
                    <p style="margin-top: 4px; font-size: 0.7rem; opacity: 0.6;">Demo Environment  Testnet</p>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav" id="bottomNav" style="display: none;" role="navigation" aria-label="Main navigation">
            <div class="nav-item active" onclick="navigateTo('home', this)" role="tab" aria-label="Home">
                <i class="nav-icon fas fa-home"></i>
                <span class="nav-label">Home</span>
            </div>
            <div class="nav-item" onclick="navigateTo('records', this)" role="tab" aria-label="Records">
                <i class="nav-icon fas fa-folder-open"></i>
                <span class="nav-label">Records</span>
            </div>
            <div class="nav-item" onclick="navigateTo('trade', this)" role="tab" aria-label="Trade">
                <i class="nav-icon fas fa-coins"></i>
                <span class="nav-label">Trade</span>
            </div>
            <div class="nav-item" onclick="navigateTo('activity', this)" style="position: relative;" role="tab" aria-label="Activity notifications">
                <i class="nav-icon fas fa-bell"></i>
                <span class="nav-label">Activity</span>
                <div class="notification-badge" id="activityBadge" aria-live="polite">3</div>
            </div>
            <div class="nav-item" onclick="navigateTo('more', this)" role="tab" aria-label="More options">
                <i class="nav-icon fas fa-ellipsis-h"></i>
                <span class="nav-label">More</span>
            </div>
        </nav>

        <!-- Modals -->
        <!-- Scan Modal -->
        <div class="modal-overlay" id="scanModal">
            <div class="modal">
                <div class="modal-handle"></div>
                <div class="modal-header">
                    <h2 class="modal-title">Scan QR Code</h2>
                    <button class="modal-close" onclick="closeModal('scanModal')"><i class="fas fa-times"></i></button>
                </div>
                <div class="scan-animation">
                    <div class="scan-ring"></div>
                    <div class="scan-ring"></div>
                    <div class="scan-ring"></div>
                    <i class="scan-icon fas fa-qrcode"></i>
                </div>
                <p style="text-align: center; color: var(--text-muted); margin-bottom: 24px;">
                    Point your camera at a Solus Protocol QR code to quickly share or receive records
                </p>
                <button class="btn btn-primary btn-full" onclick="simulateScan()">
                    <i class="fas fa-camera"></i> Open Camera
                </button>
            </div>
        </div>

        <!-- Share Modal -->
        <div class="modal-overlay" id="shareModal">
            <div class="modal">
                <div class="modal-handle"></div>
                <div class="modal-header">
                    <h2 class="modal-title">Share Record</h2>
                    <button class="modal-close" onclick="closeModal('shareModal')"><i class="fas fa-times"></i></button>
                </div>
                <div class="form-group">
                    <label class="form-label">Select Record</label>
                    <select class="form-select">
                        <option>Annual Physical - Jan 2026</option>
                        <option>Blood Work Results - Dec 2025</option>
                        <option>Vaccination Record - Nov 2025</option>
                        <option>Chest X-Ray - Oct 2025</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Provider Address or Email</label>
                    <input type="text" class="form-input" placeholder="Enter wallet address or email">
                </div>
                <div class="form-group">
                    <label class="form-label">Access Duration</label>
                    <select class="form-select">
                        <option>24 hours</option>
                        <option>7 days</option>
                        <option>30 days</option>
                        <option>Until revoked</option>
                    </select>
                </div>
                <button class="btn btn-primary btn-full" onclick="simulateShare()">
                    <i class="fas fa-share"></i> Share Securely
                </button>
            </div>
        </div>

        <!-- Add Record Modal -->
        <div class="modal-overlay" id="addRecordModal">
            <div class="modal">
                <div class="modal-handle"></div>
                <div class="modal-header">
                    <h2 class="modal-title">Add New Record</h2>
                    <button class="modal-close" onclick="closeModal('addRecordModal')"><i class="fas fa-times"></i></button>
                </div>
                <div class="form-group">
                    <label class="form-label">Record Type</label>
                    <select class="form-select">
                        <option>Lab Results</option>
                        <option>Imaging</option>
                        <option>Prescription</option>
                        <option>Visit Summary</option>
                        <option>Vaccination</option>
                        <option>Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input type="text" class="form-input" placeholder="e.g., Annual Blood Work">
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-input" placeholder="Add notes about this record..."></textarea>
                </div>
                <div style="background: var(--glass); border: 2px dashed var(--border); border-radius: 12px; padding: 40px; text-align: center; margin-bottom: 20px; cursor: pointer;" onclick="showToast('File upload simulated', 'success')">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: var(--accent); margin-bottom: 12px;"></i>
                    <p style="color: var(--text-muted);">Tap to upload document or image</p>
                </div>
                <button class="btn btn-primary btn-full" onclick="simulateAddRecord()">
                    <i class="fas fa-link"></i> Anchor to Blockchain
                </button>
            </div>
        </div>

        <!-- Verify Modal -->
        <div class="modal-overlay" id="verifyModal">
            <div class="modal">
                <div class="modal-handle"></div>
                <div class="modal-header">
                    <h2 class="modal-title">Verify Record</h2>
                    <button class="modal-close" onclick="closeModal('verifyModal')"><i class="fas fa-times"></i></button>
                </div>
                <div class="form-group">
                    <label class="form-label">Record Hash or Transaction ID</label>
                    <input type="text" class="form-input" placeholder="Enter hash to verify..." id="verifyHashInput">
                </div>
                <button class="btn btn-primary btn-full" onclick="simulateVerify()" style="margin-bottom: 24px;">
                    <i class="fas fa-search"></i> Verify on XRPL
                </button>
                <div id="verifyProgress" style="display: none;">
                    <div class="verify-typewriter" id="verifyTypewriter"></div>
                </div>
                <div id="verifyResult" style="display: none;">
                    <div style="background: rgba(20, 241, 149, 0.1); border: 1px solid var(--accent); border-radius: 12px; padding: 20px; text-align: center;">
                        <i class="fas fa-check-circle" style="font-size: 3rem; color: var(--accent); margin-bottom: 12px;"></i>
                        <h3 style="color: var(--accent); margin-bottom: 8px;">Record Verified</h3>
                        <p style="color: var(--text-muted); font-size: 0.9rem;">This record exists on the XRP Ledger and has not been tampered with.</p>
                        <div style="margin-top: 16px; padding: 12px; background: var(--glass); border-radius: 8px;">
                            <p style="font-size: 0.8rem; color: var(--text-muted);">Anchored on</p>
                            <p style="font-weight: 600;">Feb 7, 2026 at 2:34 PM</p>
                        </div>
                        <a href="https://testnet.xrpl.org/accounts/rJPqcx8wUBM58ajPUoz1dReKkTT6hqrqJA" target="_blank" class="xrpl-explorer-link" style="margin-top: 16px; justify-content: center;">
                            <i class="fas fa-external-link-alt"></i> View on XRPL Explorer
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Patient Lookup Modal (Provider) -->
        <div class="modal-overlay" id="patientLookupModal">
            <div class="modal">
                <div class="modal-handle"></div>
                <div class="modal-header">
                    <h2 class="modal-title">Find Patient</h2>
                    <button class="modal-close" onclick="closeModal('patientLookupModal')"><i class="fas fa-times"></i></button>
                </div>
                <div class="form-group">
                    <label class="form-label">Search by Name, DOB, or ID</label>
                    <input type="text" class="form-input" placeholder="Enter patient info...">
                </div>
                <button class="btn btn-primary btn-full" style="margin-bottom: 24px;">
                    <i class="fas fa-search"></i> Search Patients
                </button>
                <div class="patient-list">
                    <div class="patient-card" onclick="closeModal('patientLookupModal'); showToast('Patient selected', 'success')">
                        <div class="patient-avatar">SJ</div>
                        <div class="patient-info">
                            <div class="patient-name">Sarah Johnson</div>
                            <div class="patient-meta">DOB: 05/12/1985  ID: P-4821</div>
                        </div>
                    </div>
                    <div class="patient-card">
                        <div class="patient-avatar" style="background: linear-gradient(135deg, #ff6b6b, #ffa502);">SJ</div>
                        <div class="patient-info">
                            <div class="patient-name">Samuel Jackson</div>
                            <div class="patient-meta">DOB: 08/22/1990  ID: P-7392</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Request Access Modal (Provider) -->
        <div class="modal-overlay" id="requestAccessModal">
            <div class="modal">
                <div class="modal-handle"></div>
                <div class="modal-header">
                    <h2 class="modal-title">Request Access</h2>
                    <button class="modal-close" onclick="closeModal('requestAccessModal')"><i class="fas fa-times"></i></button>
                </div>
                <div class="form-group">
                    <label class="form-label">Patient Wallet or Email</label>
                    <input type="text" class="form-input" placeholder="Enter patient identifier...">
                </div>
                <div class="form-group">
                    <label class="form-label">Records Needed</label>
                    <select class="form-select">
                        <option>All Medical Records</option>
                        <option>Lab Results Only</option>
                        <option>Imaging Only</option>
                        <option>Prescriptions Only</option>
                        <option>Specific Record</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Reason for Request</label>
                    <textarea class="form-input" placeholder="Explain why you need access..."></textarea>
                </div>
                <button class="btn btn-primary btn-full" onclick="closeModal('requestAccessModal'); showToast('Access request sent to patient', 'success')">
                    <i class="fas fa-paper-plane"></i> Send Request
                </button>
            </div>
        </div>

        <!-- Bulk Anchor Modal (EHR) -->
        <div class="modal-overlay" id="bulkAnchorModal">
            <div class="modal">
                <div class="modal-handle"></div>
                <div class="modal-header">
                    <h2 class="modal-title">Bulk Anchor</h2>
                    <button class="modal-close" onclick="closeModal('bulkAnchorModal')"><i class="fas fa-times"></i></button>
                </div>
                <div style="background: var(--glass); border: 2px dashed var(--border); border-radius: 12px; padding: 40px; text-align: center; margin-bottom: 20px;">
                    <i class="fas fa-file-csv" style="font-size: 2rem; color: var(--accent); margin-bottom: 12px;"></i>
                    <p style="color: var(--text-muted);">Drop CSV or JSON file with records</p>
                    <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 8px;">Max 10,000 records per batch</p>
                </div>
                <div style="background: var(--card); border-radius: 12px; padding: 16px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                        <span>Records to process</span>
                        <span style="color: var(--accent); font-weight: 600;">2,847</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                        <span>Estimated cost</span>
                        <span style="color: var(--accent); font-weight: 600;">$0.71 USD</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Estimated time</span>
                        <span style="color: var(--accent); font-weight: 600;">~4 minutes</span>
                    </div>
                </div>
                <button class="btn btn-primary btn-full" onclick="simulateBulkAnchor()">
                    <i class="fas fa-rocket"></i> Start Batch Anchor
                </button>
            </div>
        </div>

        <!-- API Keys Modal (EHR) -->
        <div class="modal-overlay" id="apiKeysModal">
            <div class="modal">
                <div class="modal-handle"></div>
                <div class="modal-header">
                    <h2 class="modal-title">API Keys</h2>
                    <button class="modal-close" onclick="closeModal('apiKeysModal')"><i class="fas fa-times"></i></button>
                </div>
                <div class="api-card">
                    <div class="api-header">
                        <span class="api-title">Production Key</span>
                        <span class="api-status active">Active</span>
                    </div>
                    <div class="api-key">solus_live_7f8a9b2c3d4e5f6g7h8i9j0k</div>
                    <div style="display: flex; gap: 8px; margin-top: 12px;">
                        <button class="btn btn-secondary" style="flex: 1; padding: 10px;" onclick="showToast('Key copied to clipboard', 'success')">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                        <button class="btn btn-secondary" style="flex: 1; padding: 10px;">
                            <i class="fas fa-refresh"></i> Rotate
                        </button>
                    </div>
                </div>
                <div class="api-card">
                    <div class="api-header">
                        <span class="api-title">Test Key</span>
                        <span class="api-status active">Active</span>
                    </div>
                    <div class="api-key">solus_test_1a2b3c4d5e6f7g8h9i0j1k2l</div>
                    <div style="display: flex; gap: 8px; margin-top: 12px;">
                        <button class="btn btn-secondary" style="flex: 1; padding: 10px;" onclick="showToast('Key copied to clipboard', 'success')">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                        <button class="btn btn-secondary" style="flex: 1; padding: 10px;">
                            <i class="fas fa-refresh"></i> Rotate
                        </button>
                    </div>
                </div>
                <button class="btn btn-primary btn-full" style="margin-top: 16px;">
                    <i class="fas fa-plus"></i> Generate New Key
                </button>
            </div>
        </div>

        <!-- Export Modal -->
        <div class="modal-overlay" id="exportModal">
            <div class="modal">
                <div class="modal-handle"></div>
                <div class="modal-header">
                    <h2 class="modal-title">Export Data</h2>
                    <button class="modal-close" onclick="closeModal('exportModal')"><i class="fas fa-times"></i></button>
                </div>
                <p style="color: var(--text-muted); margin-bottom: 20px;">Download all your health records in a portable format.</p>
                <div class="form-group">
                    <label class="form-label">Export Format</label>
                    <select class="form-select">
                        <option>FHIR R4 (JSON)</option>
                        <option>PDF Bundle</option>
                        <option>CSV</option>
                        <option>HL7 v2</option>
                    </select>
                </div>
                <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid var(--warning); border-radius: 12px; padding: 16px; margin-bottom: 20px;">
                    <p style="color: var(--warning); font-size: 0.9rem;">
                        <i class="fas fa-lock"></i> Your export will be encrypted with your wallet key
                    </p>
                </div>
                <button class="btn btn-primary btn-full" onclick="closeModal('exportModal'); showToast('Export started - check your downloads', 'success')">
                    <i class="fas fa-download"></i> Download All Records
                </button>
            </div>
        </div>

        <!-- Record Detail Modal -->
        <div class="modal-overlay" id="recordDetailModal">
            <div class="modal">
                <div class="modal-handle"></div>
                <div class="modal-header">
                    <h2 class="modal-title" id="recordDetailTitle">Record Details</h2>
                    <button class="modal-close" onclick="closeModal('recordDetailModal')"><i class="fas fa-times"></i></button>
                </div>
                <div id="recordDetailContent">
                    <!-- Populated dynamically -->
                </div>
            </div>
        </div>

        <!-- Toast -->
        <div class="toast" id="toast" role="alert" aria-live="assertive">
            <i class="toast-icon fas fa-check-circle" id="toastIcon"></i>
            <span class="toast-message" id="toastMessage">Success!</span>
        </div>
    </div>

    <script>
        // ===== APP STATE =====
        let currentRole = 'patient';
        let currentScreen = 'login';
        let isDarkMode = true;
        let metricsAPIData = null;
        let metricsRefreshInterval = null;
        const METRICS_API_URL = 'https://solusprotocol.onrender.com/metrics';

        // Mock Data
        const mockRecords = [
            { id: 1, type: 'visit', icon: 'stethoscope', title: 'Annual Physical Exam', date: 'Feb 7, 2026', provider: 'Dr. Smith', status: 'verified' },
            { id: 2, type: 'lab', icon: 'vial', title: 'Complete Blood Count', date: 'Feb 5, 2026', provider: 'Quest Diagnostics', status: 'verified' },
            { id: 3, type: 'imaging', icon: 'x-ray', title: 'Chest X-Ray', date: 'Jan 28, 2026', provider: 'City Hospital', status: 'verified' },
            { id: 4, type: 'rx', icon: 'pills', title: 'Lisinopril 10mg', date: 'Jan 15, 2026', provider: 'Dr. Johnson', status: 'verified' },
            { id: 5, type: 'vitals', icon: 'heartbeat', title: 'Blood Pressure Check', date: 'Jan 10, 2026', provider: 'CVS MinuteClinic', status: 'verified' },
            { id: 6, type: 'lab', icon: 'vial', title: 'Lipid Panel', date: 'Dec 20, 2025', provider: 'LabCorp', status: 'verified' },
            { id: 7, type: 'visit', icon: 'stethoscope', title: 'Follow-up Visit', date: 'Dec 15, 2025', provider: 'Dr. Smith', status: 'verified' },
            { id: 8, type: 'imaging', icon: 'x-ray', title: 'MRI - Lower Back', date: 'Nov 30, 2025', provider: 'Radiology Partners', status: 'verified' },
            { id: 9, type: 'rx', icon: 'pills', title: 'Metformin 500mg', date: 'Nov 20, 2025', provider: 'Dr. Johnson', status: 'verified' },
            { id: 10, type: 'vitals', icon: 'heartbeat', title: 'Glucose Monitoring', date: 'Nov 15, 2025', provider: 'Home Test', status: 'verified' },
            { id: 11, type: 'lab', icon: 'vial', title: 'A1C Test', date: 'Nov 10, 2025', provider: 'Quest Diagnostics', status: 'verified' },
            { id: 12, type: 'visit', icon: 'stethoscope', title: 'Diabetes Consult', date: 'Oct 25, 2025', provider: 'Dr. Williams', status: 'verified' }
        ];

        const mockActivity = [
            { color: 'green', text: 'Blood work results anchored to XRPL', time: '2 hours ago' },
            { color: 'purple', text: 'Dr. Smith accessed your records', time: '5 hours ago' },
            { color: 'blue', text: 'New prescription added', time: 'Yesterday' },
            { color: 'green', text: 'Record verified by City Hospital', time: '2 days ago' },
            { color: 'purple', text: 'Access request from Dr. Johnson', time: '3 days ago' },
            { color: 'green', text: 'Annual physical anchored', time: '1 week ago' },
            { color: 'blue', text: 'Shared records with LabCorp', time: '1 week ago' },
            { color: 'green', text: 'MRI results verified', time: '2 weeks ago' }
        ];

        // ===== INITIALIZE =====
        document.addEventListener('DOMContentLoaded', function() {
            updateGreeting();
            renderRecords();
            renderActivity();

            // Check if first visit  show onboarding
            if (!localStorage.getItem('solus_onboarded')) {
                // Will show after login
            }
        });

        // ===== ROLE SELECTION =====
        function selectRole(role) {
            currentRole = role;
            document.querySelectorAll('.role-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`.role-card[data-role="${role}"]`).classList.add('selected');
        }

        // ===== BIOMETRIC AUTH =====
        function showBiometricAuth(callback) {
            const overlay = document.getElementById('biometricOverlay');
            const icon = document.getElementById('bioIcon');
            const text = document.getElementById('bioText');
            const subtext = document.getElementById('bioSubtext');
            overlay.classList.add('active');

            // Start scanning animation
            document.querySelectorAll('.biometric-ring').forEach(r => r.classList.add('scanning'));
            text.textContent = 'Authenticating...';
            subtext.textContent = 'Verifying biometric identity';
            icon.className = 'fas fa-fingerprint biometric-icon';

            setTimeout(() => {
                // Success state
                icon.className = 'fas fa-check-circle biometric-icon';
                icon.style.animation = 'biometricSuccess 0.6s ease';
                text.textContent = 'Identity Verified';
                subtext.textContent = 'Welcome back';
                document.querySelectorAll('.biometric-ring').forEach(r => {
                    r.style.borderColor = 'rgba(20, 241, 149, 1)';
                });

                setTimeout(() => {
                    overlay.classList.remove('active');
                    icon.style.animation = '';
                    document.querySelectorAll('.biometric-ring').forEach(r => {
                        r.classList.remove('scanning');
                        r.style.borderColor = '';
                    });
                    if (callback) callback();
                }, 800);
            }, 1500);
        }

        // ===== LOGIN =====
        function login() {
            const password = document.getElementById('loginPassword').value;
            if (password === 'demo123') {
                showBiometricAuth(() => {
                    document.getElementById('loginScreen').classList.remove('active');
                    document.getElementById('homeScreen').classList.add('active');
                    document.getElementById('bottomNav').style.display = 'flex';
                    currentScreen = 'home';

                    updateUIForRole();
                    showToast('Welcome to Solus Protocol', 'success');

                    // Animate stat counters on first load
                    setTimeout(() => animateHomeStats(), 300);

                    // Start session timeout timer
                    resetSessionTimer();

                    // Show onboarding for first-time users
                    if (!localStorage.getItem('solus_onboarded')) {
                        setTimeout(() => showOnboarding(), 500);
                    }

                    // Increment notification badge on new activity
                    startNotificationSystem();
                });
            } else {
                showToast('Invalid password', 'error');
            }
        }

        // ===== ONBOARDING =====
        const onboardingSteps = [
            {
                icon: 'fa-shield-halved', iconClass: '', color: 'var(--accent)',
                title: 'Your Data, Your Control',
                desc: 'Solus Protocol gives you complete ownership of your medical records. Every record is cryptographically hashed and anchored to the <strong>XRP Ledger</strong>  only you decide who can access it.'
            },
            {
                icon: 'fa-link', iconClass: 'purple', color: 'var(--secondary)',
                title: 'Blockchain-Verified Records',
                desc: 'Each record gets a unique <strong>SHA-256 hash</strong>  a one-way digital fingerprint stored on the XRPL. Your actual health data <em>never</em> goes on-chain. Only the fingerprint does, proving authenticity forever.'
            },
            {
                icon: 'fa-users', iconClass: 'blue', color: 'var(--accent2)',
                title: 'Three Roles, One Platform',
                desc: '<strong>Patients</strong> manage and share records. <strong>Providers</strong> verify and access patient data. <strong>EHR Systems</strong> integrate with bulk anchoring and API access. Switch roles anytime from your profile.'
            },
            {
                icon: 'fa-coins', iconClass: 'gold', color: 'var(--ehr)',
                title: '$SLS Powers Everything',
                desc: 'The <strong>$SLS utility token</strong> handles anchoring fees (~$0.001 per record), provider payments, and patient rebates. Trade it on xMagnetic, Sologenic, and more  or use USD through our subscription tier.'
            }
        ];
        let onboardingStep = 0;

        function showOnboarding() {
            onboardingStep = 0;
            renderOnboardingStep();
            document.getElementById('onboardingOverlay').classList.add('active');
        }

        function renderOnboardingStep() {
            const step = onboardingSteps[onboardingStep];
            const isLast = onboardingStep === onboardingSteps.length - 1;
            const card = document.getElementById('onboardingCard');
            card.innerHTML = `
                <div class="onboarding-step-icon ${step.iconClass}">
                    <i class="fas ${step.icon}" style="color: ${step.color};"></i>
                </div>
                <h2 class="onboarding-step-title">${step.title}</h2>
                <p class="onboarding-step-desc">${step.desc}</p>
                <div class="onboarding-dots">
                    ${onboardingSteps.map((_, i) => `<div class="onboarding-dot ${i === onboardingStep ? 'active' : ''}"></div>`).join('')}
                </div>
                <div class="onboarding-nav">
                    <button class="onboarding-skip" onclick="closeOnboarding()">Skip</button>
                    <button class="onboarding-next" onclick="${isLast ? 'closeOnboarding()' : 'nextOnboardingStep()'}">
                        ${isLast ? 'Get Started' : 'Next'} <i class="fas fa-arrow-right" style="margin-left: 6px;"></i>
                    </button>
                </div>
            `;
            // Re-trigger animation
            card.style.animation = 'none';
            card.offsetHeight;
            card.style.animation = '';
        }

        function nextOnboardingStep() {
            if (onboardingStep < onboardingSteps.length - 1) {
                onboardingStep++;
                renderOnboardingStep();
            }
        }

        function closeOnboarding() {
            document.getElementById('onboardingOverlay').classList.remove('active');
            localStorage.setItem('solus_onboarded', 'true');
        }

        // ===== UPDATE UI FOR ROLE =====
        function updateUIForRole() {
            const names = { patient: 'Alex Johnson', provider: 'Dr. Sarah Chen', ehr: 'MedTech Systems' };
            const initials = { patient: 'AJ', provider: 'SC', ehr: 'MT' };
            const roles = { patient: 'Patient Account', provider: 'Healthcare Provider', ehr: 'EHR Administrator' };

            document.getElementById('userName').textContent = names[currentRole];
            document.getElementById('profileName').textContent = names[currentRole];
            document.getElementById('profileRole').textContent = roles[currentRole];
            document.getElementById('userAvatar').textContent = initials[currentRole];
            document.getElementById('profileAvatar').textContent = initials[currentRole];

            document.getElementById('patientHomeContent').style.display = currentRole === 'patient' ? 'block' : 'none';
            document.getElementById('providerHomeContent').style.display = currentRole === 'provider' ? 'block' : 'none';
            document.getElementById('ehrHomeContent').style.display = currentRole === 'ehr' ? 'block' : 'none';

            const avatar = document.getElementById('userAvatar');
            const profileAvatar = document.getElementById('profileAvatar');
            avatar.className = 'user-avatar';
            profileAvatar.className = 'user-avatar';
            if (currentRole === 'provider') {
                avatar.classList.add('provider');
                profileAvatar.classList.add('provider');
            } else if (currentRole === 'ehr') {
                avatar.classList.add('ehr');
                profileAvatar.classList.add('ehr');
            }

            // Update role switcher buttons
            document.querySelectorAll('.role-switch-btn').forEach(b => b.classList.remove('active', 'provider-active', 'ehr-active'));
            const activeBtn = document.getElementById(currentRole === 'patient' ? 'rsPatient' : currentRole === 'provider' ? 'rsProvider' : 'rsEhr');
            if (activeBtn) {
                activeBtn.classList.add('active');
                if (currentRole === 'provider') activeBtn.classList.add('provider-active');
                if (currentRole === 'ehr') activeBtn.classList.add('ehr-active');
            }
        }

        // ===== LOGOUT =====
        function logout() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('loginScreen').classList.add('active');
            document.getElementById('bottomNav').style.display = 'none';
            currentScreen = 'login';
            if (metricsRefreshInterval) clearInterval(metricsRefreshInterval);
            clearTimeout(sessionTimer);
            clearInterval(countdownTimer);
            showToast('Signed out successfully', 'success');
        }

        // ===== NAVIGATION =====
        function navigateTo(screen, el) {
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            if (el) el.classList.add('active');

            const screenMap = {
                'home': 'homeScreen',
                'records': 'recordsScreen',
                'trade': 'tradeScreen',
                'activity': 'activityScreen',
                'more': 'moreScreen'
            };

            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenMap[screen]).classList.add('active');
            currentScreen = screen;

            if (screen === 'activity') {
                document.getElementById('activityBadge').style.display = 'none';
                notificationCount = 0;
            }
            if (screen === 'trade') { updateTradeBalance(); }
        }

        function navigateToScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            if (screenId === 'metricsScreen') loadMetricsAPI();
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        // ===== GREETING =====
        function updateGreeting() {
            const hour = new Date().getHours();
            let greeting = 'Good evening';
            if (hour < 12) greeting = 'Good morning';
            else if (hour < 17) greeting = 'Good afternoon';
            document.getElementById('greetingText').textContent = greeting;
        }

        // ===== RECORDS RENDERING =====
        let currentRecordFilter = 'all';

        function buildRecordCardInline(record) {
            const isFav = (typeof favoriteRecords !== 'undefined') && favoriteRecords.includes(record.id);
            return `
                <div class="record-card" style="position: relative;" onclick="openRecordDetail(${record.id})" data-record-id="${record.id}">
                    <button class="record-fav ${isFav ? 'active' : ''}" onclick="toggleFavorite(${record.id}, event)" aria-label="Toggle favorite">
                        <i class="fas fa-star"></i>
                    </button>
                    <div class="record-icon ${record.type}">
                        <i class="fas fa-${record.icon}"></i>
                    </div>
                    <div class="record-info">
                        <div class="record-title">${record.title}</div>
                        <div class="record-meta">
                            <span>${record.date}</span>
                            <span>${record.provider}</span>
                        </div>
                    </div>
                    <span class="record-badge ${record.status}">${record.status}</span>
                    <i class="record-arrow fas fa-chevron-right"></i>
                </div>
            `;
        }

        function renderRecords(filter, searchTerm) {
            filter = filter || currentRecordFilter;
            searchTerm = searchTerm || '';
            let records = mockRecords;
            if (filter && filter !== 'all') { records = records.filter(r => r.type === filter); }
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                records = records.filter(r => r.title.toLowerCase().includes(term) || r.provider.toLowerCase().includes(term) || r.type.toLowerCase().includes(term) || r.date.toLowerCase().includes(term));
            }

            const recentList = document.getElementById('recentRecordsList');
            const allList = document.getElementById('allRecordsList');

            // Favorites pinning
            const favs = (typeof favoriteRecords !== 'undefined') ? records.filter(r => favoriteRecords.includes(r.id)) : [];
            const rest = (typeof favoriteRecords !== 'undefined') ? records.filter(r => !favoriteRecords.includes(r.id)) : records;

            if (recentList) recentList.innerHTML = mockRecords.slice(0, 4).map(buildRecordCardInline).join('');
            if (allList) {
                if (records.length === 0) {
                    allList.innerHTML = '<div style="text-align: center; padding: 40px 0; color: var(--text-muted);"><i class="fas fa-search" style="font-size: 2rem; opacity: 0.3; margin-bottom: 12px;"></i><p>No records found</p></div>';
                } else {
                    let html = '';
                    if (favs.length > 0 && !searchTerm && filter === 'all') {
                        html += '<div style="margin-bottom: 8px;"><span class="fav-section-badge"><i class="fas fa-star"></i> Pinned</span></div>';
                        html += favs.map(buildRecordCardInline).join('');
                        html += '<div style="height: 1px; background: var(--border); margin: 12px 0;"></div>';
                        html += rest.map(buildRecordCardInline).join('');
                    } else {
                        html = records.map(buildRecordCardInline).join('');
                    }
                    allList.innerHTML = html;
                }
            }
        }

        function filterRecords() {
            const search = document.getElementById('recordSearchInput').value;
            renderRecords(currentRecordFilter, search);
        }

        function setRecordFilter(filter, el) {
            currentRecordFilter = filter;
            document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            filterRecords();
        }

        // ===== ACTIVITY =====
        function renderActivity() {
            const feed = document.getElementById('activityFeed');
            feed.innerHTML = mockActivity.map(item => `
                <div class="activity-item">
                    <div class="activity-dot ${item.color}"></div>
                    <div class="activity-content">
                        <div class="activity-text">${item.text}</div>
                        <div class="activity-time">${item.time}</div>
                    </div>
                </div>
            `).join('');
        }

        // ===== NOTIFICATION SYSTEM =====
        let notificationCount = 0;
        let notificationInterval = null;

        function startNotificationSystem() {
            if (notificationInterval) clearInterval(notificationInterval);
            notificationInterval = setInterval(() => {
                if (currentScreen !== 'activity') {
                    notificationCount++;
                    const badge = document.getElementById('activityBadge');
                    badge.textContent = notificationCount > 9 ? '9+' : notificationCount;
                    badge.style.display = 'flex';

                    // Add new activity item
                    const newEvents = [
                        { color: 'green', text: 'New record anchored to XRPL', time: 'Just now' },
                        { color: 'purple', text: 'Provider verified a record', time: 'Just now' },
                        { color: 'blue', text: 'Access request received', time: 'Just now' },
                        { color: 'green', text: 'Record hash verified on-chain', time: 'Just now' }
                    ];
                    const evt = newEvents[Math.floor(Math.random() * newEvents.length)];
                    mockActivity.unshift(evt);
                    if (mockActivity.length > 20) mockActivity.pop();
                    renderActivity();
                }
            }, 15000); // Every 15 seconds
        }

        // ===== RECORD DETAIL =====
        function openRecordDetail(id) {
            const record = mockRecords.find(r => r.id === id);
            if (record) {
                const fakeHash = '0x7f8a9b2c3d4e5f6a' + record.id.toString(16).padStart(4, '0') + 'k1l2m3n4o5p6q7r8s';
                const fakeTxHash = 'A1B2C3D4E5F6' + record.id.toString(16).toUpperCase().padStart(4, '0') + '7890ABCDEF1234567890ABCDEF12345678';
                document.getElementById('recordDetailTitle').textContent = record.title;
                document.getElementById('recordDetailContent').innerHTML = `
                    <div style="text-align: center; margin-bottom: 24px;">
                        <div class="record-icon ${record.type}" style="width: 80px; height: 80px; margin: 0 auto 16px; font-size: 2rem;">
                            <i class="fas fa-${record.icon}"></i>
                        </div>
                        <span class="record-badge ${record.status}" style="font-size: 0.85rem; padding: 6px 16px;">${record.status}</span>
                    </div>
                    <div class="api-card">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                            <span style="color: var(--text-muted);">Date</span><span>${record.date}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                            <span style="color: var(--text-muted);">Provider</span><span>${record.provider}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                            <span style="color: var(--text-muted);">Type</span><span>${record.type.charAt(0).toUpperCase() + record.type.slice(1)}</span>
                        </div>
                        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border);">
                            <span style="color: var(--text-muted); font-size: 0.85rem;">Blockchain Hash <span class="term-tooltip" onclick="event.stopPropagation(); showTermTooltip(event, 'sha256')"><i class="fas fa-info-circle tooltip-icon"></i></span></span>
                            <div class="api-key" style="margin-top: 8px; font-size: 0.75rem;" id="recordHash_${record.id}">${fakeHash}</div>
                            <button class="copy-hash-btn" onclick="copyHash('recordHash_${record.id}', this)">
                                <i class="fas fa-copy"></i> <span>Copy Hash</span>
                            </button>
                        </div>
                        <a href="https://testnet.xrpl.org/accounts/rJPqcx8wUBM58ajPUoz1dReKkTT6hqrqJA" target="_blank" class="xrpl-explorer-link">
                            <i class="fas fa-external-link-alt"></i>
                            <span>View on XRPL Testnet Explorer</span>
                            <i class="fas fa-chevron-right" style="margin-left: auto; font-size: 0.7rem; opacity: 0.5;"></i>
                        </a>
                    </div>
                    <div style="display: flex; gap: 12px; margin-top: 20px;">
                        <button class="btn btn-secondary" style="flex: 1;" onclick="shareRecord(${record.id})">
                            <i class="fas fa-share"></i> Share
                        </button>
                        <button class="btn btn-primary" style="flex: 1;" onclick="showToast('Downloading record...', 'success')">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>
                    <button class="btn" id="aiSummaryBtn" style="width: 100%; margin-top: 12px; background: linear-gradient(135deg, rgba(0,194,255,0.15), rgba(153,69,255,0.15)); border: 1px solid rgba(0,194,255,0.3); color: var(--accent2);" onclick="generateAISummary(${record.id})">
                        <i class="fas fa-brain"></i> Solus Protocol AI Summary
                    </button>
                    <div id="aiSummaryContainer"></div>
                `;
                openModal('recordDetailModal');
            }
        }

        // ===== COPY HASH =====
        function copyHash(elementId, btn) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {
                btn.classList.add('copied');
                btn.querySelector('span').textContent = 'Copied!';
                btn.querySelector('i').className = 'fas fa-check';
                showToast('Hash copied to clipboard', 'success');
                setTimeout(() => {
                    btn.classList.remove('copied');
                    btn.querySelector('span').textContent = 'Copy Hash';
                    btn.querySelector('i').className = 'fas fa-copy';
                }, 2000);
            }).catch(() => {
                showToast('Copy failed  tap and hold to copy manually', 'error');
            });
        }

        // ===== WEB SHARE API =====
        function shareRecord(id) {
            const record = mockRecords.find(r => r.id === id);
            if (!record) return;
            const shareData = {
                title: record.title + '  Solus Protocol',
                text: 'Verified medical record: ' + record.title + ' (' + record.date + ')  anchored on XRPL via Solus Protocol.',
                url: 'https://solusprotocol.vercel.app/demo-app/'
            };
            if (navigator.share && navigator.canShare && navigator.canShare(shareData)) {
                navigator.share(shareData).catch(() => {});
            } else {
                // Fallback: open share modal
                closeModal('recordDetailModal');
                openModal('shareModal');
            }
        }

        // ===== MODAL FUNCTIONS =====
        function openModal(modalId) {
            const overlay = document.getElementById(modalId);
            overlay.classList.add('active');
            // Setup swipe-to-dismiss
            const modal = overlay.querySelector('.modal');
            if (modal) {
                let startY = 0, currentY = 0, isDragging = false;
                const handle = modal.querySelector('.modal-handle');
                const dragTarget = handle || modal;
                dragTarget.addEventListener('touchstart', function(e) {
                    startY = e.touches[0].clientY;
                    isDragging = true;
                    modal.classList.add('swiping');
                }, { passive: true });
                dragTarget.addEventListener('touchmove', function(e) {
                    if (!isDragging) return;
                    currentY = e.touches[0].clientY;
                    const diff = currentY - startY;
                    if (diff > 0) {
                        modal.style.transform = 'translateY(' + diff + 'px)';
                        overlay.style.background = 'rgba(0,0,0,' + Math.max(0, 0.8 - diff / 500) + ')';
                    }
                }, { passive: true });
                dragTarget.addEventListener('touchend', function() {
                    if (!isDragging) return;
                    isDragging = false;
                    modal.classList.remove('swiping');
                    const diff = currentY - startY;
                    if (diff > 120) {
                        modal.style.transform = 'translateY(100%)';
                        haptic();
                        setTimeout(() => {
                            overlay.classList.remove('active');
                            modal.style.transform = '';
                            overlay.style.background = '';
                        }, 200);
                    } else {
                        modal.style.transition = 'transform 0.3s ease';
                        modal.style.transform = '';
                        overlay.style.background = '';
                        setTimeout(() => { modal.style.transition = ''; }, 300);
                    }
                }, { passive: true });
            }
        }
        function closeModal(modalId) { const o = document.getElementById(modalId); o.classList.remove('active'); const m = o.querySelector('.modal'); if (m) { m.style.transform = ''; } o.style.background = ''; }
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', function(e) { if (e.target === this) this.classList.remove('active'); });
        });

        // ===== TOAST =====
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = document.getElementById('toastIcon');
            toastMessage.textContent = message;
            toastIcon.className = 'toast-icon fas ' + (type === 'error' ? 'fa-exclamation-circle' : 'fa-check-circle');
            toast.className = 'toast ' + type;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // ===== SIMULATED ACTIONS =====
        function simulateScan() { haptic(); closeModal('scanModal'); setTimeout(() => showToast('QR Code scanned - Access granted', 'success'), 500); }
        function simulateShare() { haptic(); closeModal('shareModal'); showToast('Record shared securely', 'success'); }

        function simulateAddRecord() {
            closeModal('addRecordModal');
            haptic();
            showAnchorAnimation();
        }

        function simulateVerify() {
            haptic();
            document.getElementById('verifyResult').style.display = 'none';
            document.getElementById('verifyProgress').style.display = 'block';
            const typewriter = document.getElementById('verifyTypewriter');

            const lines = [
                'Initializing XRPL connection...',
                'Connecting to wss://s.altnet.rippletest.net:51233',
                'Connected to XRPL Testnet',
                'Looking up account: rJPqcx8wUBM58ajPUoz1dReKkTT6hqrqJA',
                'Scanning transaction memos...',
                'Hash found in ledger: 0x7f8a9b2c3d4e...',
                'Verifying SHA-256 integrity...',
                ' MATCH CONFIRMED  record is authentic'
            ];

            let lineIndex = 0;
            typewriter.innerHTML = '';

            function typeLine() {
                if (lineIndex >= lines.length) {
                    setTimeout(() => {
                        document.getElementById('verifyProgress').style.display = 'none';
                        document.getElementById('verifyResult').style.display = 'block';
                        haptic();
                    }, 500);
                    return;
                }
                const line = lines[lineIndex];
                const isLast = lineIndex === lines.length - 1;
                const lineEl = document.createElement('div');
                lineEl.style.color = isLast ? 'var(--accent)' : 'var(--text-muted)';
                lineEl.style.fontWeight = isLast ? '600' : '400';
                lineEl.style.marginBottom = '4px';
                typewriter.appendChild(lineEl);

                let charIndex = 0;
                function typeChar() {
                    if (charIndex < line.length) {
                        lineEl.textContent = line.substring(0, charIndex + 1);
                        charIndex++;
                        setTimeout(typeChar, 15 + Math.random() * 20);
                    } else {
                        lineIndex++;
                        setTimeout(typeLine, 200 + Math.random() * 300);
                    }
                }
                typeChar();
                typewriter.scrollTop = typewriter.scrollHeight;
            }
            typeLine();
        }

        function simulateBulkAnchor() { haptic(); closeModal('bulkAnchorModal'); showToast('Batch anchoring started - 2,847 records', 'success'); }
        document.getElementById('loginPassword').addEventListener('keypress', function(e) { if (e.key === 'Enter') login(); });

        // ===== ACTION HELP TOGGLE =====
        function toggleActionHelp(helpId) {
            const tooltip = document.getElementById(helpId);
            const isShown = tooltip.classList.contains('show');
            document.querySelectorAll('.action-help-tooltip').forEach(t => t.classList.remove('show'));
            if (!isShown) tooltip.classList.add('show');
        }

        // ===== DARK/LIGHT MODE =====
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            const container = document.getElementById('appContainer');
            const icon = document.getElementById('themeIcon');
            const label = document.getElementById('themeLabel');
            const toggle = document.getElementById('themeToggle');
            const themeMeta = document.querySelector('meta[name="theme-color"]');

            if (isDarkMode) {
                container.classList.remove('light-mode');
                document.body.classList.remove('light-body');
                icon.className = 'fas fa-moon';
                label.textContent = 'Dark Mode';
                toggle.classList.add('active');
                if (themeMeta) themeMeta.content = '#0a0a0f';
            } else {
                container.classList.add('light-mode');
                document.body.classList.add('light-body');
                icon.className = 'fas fa-sun';
                label.textContent = 'Light Mode';
                toggle.classList.remove('active');
                if (themeMeta) themeMeta.content = '#f0f2f5';
            }
            showToast(isDarkMode ? 'Dark mode enabled' : 'Light mode enabled', 'success');
        }

        // ===== TRADE FUNCTIONS =====
        let tradeBalanceVal = 150.75;
        const SLS_RATE = 0.05;
        const tradeHistory = [
            { type: 'Deposit', date: 'Feb 5, 2026', amount: 50.00, direction: '+' },
            { type: 'Hash Anchoring Fee', date: 'Feb 4, 2026', amount: 0.01, direction: '-' },
            { type: 'Verification Rebate', date: 'Feb 3, 2026', amount: 0.005, direction: '+' },
            { type: 'Withdrawal to USD', date: 'Feb 1, 2026', amount: 20.00, direction: '-' }
        ];

        function updateTradeBalance() {
            const balEl = document.getElementById('tradeBalance');
            const usdEl = document.getElementById('tradeBalanceUSD');
            if (balEl) {
                balEl.textContent = tradeBalanceVal.toFixed(2) + ' $SLS';
                usdEl.textContent = ' $' + (tradeBalanceVal * SLS_RATE).toFixed(2) + ' USD';
            }
        }

        function updateConversion() {
            const from = parseFloat(document.getElementById('convertFromAmount').value) || 0;
            document.getElementById('convertToAmount').value = (from * SLS_RATE).toFixed(2);
        }

        function tradeDeposit() {
            tradeBalanceVal += 50;
            updateTradeBalance();
            tradeHistory.unshift({ type: 'Deposit', date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }), amount: 50, direction: '+' });
            showToast('Deposited 50 $SLS (simulated)', 'success');
        }

        function tradeWithdraw() {
            if (tradeBalanceVal < 10) { showToast('Insufficient balance for withdrawal', 'error'); return; }
            tradeBalanceVal -= 10;
            updateTradeBalance();
            tradeHistory.unshift({ type: 'Withdrawal', date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }), amount: 10, direction: '-' });
            showToast('Withdrew 10 $SLS  $0.50 USD (simulated)', 'success');
        }

        function exportTradeCSV() {
            const headers = ['Date', 'Type', 'Amount ($SLS)', 'USD Value', 'Direction'];
            const rows = [headers.join(',')];
            tradeHistory.forEach(tx => {
                rows.push([
                    '"' + tx.date + '"',
                    '"' + tx.type + '"',
                    tx.amount.toFixed(4),
                    (tx.amount * SLS_RATE).toFixed(4),
                    tx.direction === '+' ? 'Credit' : 'Debit'
                ].join(','));
            });
            const blob = new Blob([rows.join('\n')], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'solus_trade_history_' + new Date().toISOString().split('T')[0] + '.csv';
            link.click();
            showToast('Transaction history exported', 'success');
        }

        // ===== METRICS API (Real Data from metrics_api.py) =====
        const typeColors = {
            'Vitals': '#14F195', 'Lab Results': '#9945FF', 'Imaging': '#00C2FF',
            'Surgery': '#ff6b6b', 'Prescription': '#ffa502', 'Immunization': '#2ed573',
            'Clinical Notes': '#70a1ff', 'Discharge': '#ff4757', 'Emergency': '#ff3f34',
            'Mental Health': '#a29bfe', 'Referral': '#fd79a8', 'Care Plan': '#55efc4',
            'Consent': '#ffeaa7', 'EHR Integration': '#dfe6e9', 'Telemedicine': '#74b9ff',
            'Pediatric': '#fab1a0', 'Post-Op': '#e17055', 'Chronic Care': '#00cec9',
            'Preventive': '#81ecec', 'Patient Message': '#6c5ce7', 'Other': '#636e72',
            'Allergies': '#e84393', 'Administrative': '#b2bec3'
        };

        async function loadMetricsAPI() {
            const loading = document.getElementById('metricsLoading');
            const error = document.getElementById('metricsError');
            const content = document.getElementById('metricsContent');
            const statusText = document.getElementById('metricsStatusText');

            loading.style.display = 'block';
            error.style.display = 'none';
            content.style.display = 'none';
            statusText.textContent = 'Loading...';

            try {
                const response = await fetch(METRICS_API_URL);
                if (!response.ok) throw new Error('API returned ' + response.status);
                metricsAPIData = await response.json();

                // Populate stats
                document.getElementById('metricTotalRecords').textContent = (metricsAPIData.total_hashes || 0).toLocaleString();
                document.getElementById('metricRecordTypes').textContent = Object.keys(metricsAPIData.records_by_type || {}).length;
                document.getElementById('metricTotalFees').textContent = (metricsAPIData.total_fees || 0).toFixed(2);

                // Today's count
                const today = new Date().toLocaleDateString('en-US', { month: 'short', day: '2-digit' });
                const hashesToday = metricsAPIData.hashes_by_day?.[today] || 0;
                document.getElementById('metricToday').textContent = '+' + hashesToday;

                // XRPL Network details
                document.getElementById('metricFeesSummary').textContent = (metricsAPIData.total_fees || 0).toFixed(2) + ' $SLS';
                document.getElementById('metricLastHash').textContent = metricsAPIData.last_hash || '';

                // Record Type Distribution (sorted by count descending)
                renderMetricsTypes(metricsAPIData.records_by_type || {});

                // Live Activity Feed (from real individual_records)
                renderMetricsLiveFeed(metricsAPIData.individual_records || []);

                loading.style.display = 'none';
                content.style.display = 'block';
                statusText.textContent = 'Live';

                // Auto-refresh every 60 seconds
                if (metricsRefreshInterval) clearInterval(metricsRefreshInterval);
                metricsRefreshInterval = setInterval(loadMetricsAPI, 60000);

            } catch (err) {
                loading.style.display = 'none';
                error.style.display = 'block';
                document.getElementById('metricsErrorText').textContent = 'Failed to load metrics: ' + err.message;
                statusText.textContent = 'Offline';
                console.error('Metrics API error:', err);
            }
        }

        function renderMetricsTypes(recordsByType) {
            const list = document.getElementById('metricsTypeList');
            const total = Object.values(recordsByType).reduce((a, b) => a + b, 0);
            const sorted = Object.entries(recordsByType).sort((a, b) => b[1] - a[1]);

            list.innerHTML = sorted.map(([type, count]) => {
                const pct = total > 0 ? ((count / total) * 100).toFixed(1) : 0;
                const color = typeColors[type] || '#636e72';
                return `
                    <div class="metrics-type-item">
                        <div class="metrics-type-label">
                            <span class="metrics-type-dot" style="background: ${color};"></span>
                            <span>${type}</span>
                        </div>
                        <div class="metrics-type-bar-container">
                            <div class="metrics-type-bar" style="width: ${pct}%; background: ${color};"></div>
                        </div>
                        <span class="metrics-type-pct">${count}</span>
                    </div>
                `;
            }).join('');
        }

        function renderMetricsLiveFeed(records) {
            const feed = document.getElementById('metricsLiveFeed');
            // Show the most recent records
            const recent = records.slice(-15).reverse();

            feed.innerHTML = recent.map((r, i) => {
                const color = typeColors[r.record_type] || '#636e72';
                const icon = getRecordTypeIcon(r.record_type);
                return `
                    <div class="metrics-live-item" style="animation-delay: ${i * 0.05}s;">
                        <div class="metrics-live-dot" style="background: ${color};"></div>
                        <i class="fas fa-${icon}" style="color: ${color}; font-size: 0.9rem;"></i>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-size: 0.85rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${r.record_type} anchored</div>
                            <div style="font-size: 0.7rem; color: var(--text-muted); font-family: monospace;">${r.hash || ''}</div>
                        </div>
                        <span class="metrics-live-time">${r.timestamp_display || ''}</span>
                    </div>
                `;
            }).join('');
        }

        function getRecordTypeIcon(type) {
            const icons = {
                'Vitals': 'heartbeat', 'Lab Results': 'vial', 'Imaging': 'x-ray',
                'Surgery': 'user-md', 'Prescription': 'pills', 'Immunization': 'syringe',
                'Clinical Notes': 'file-medical', 'Discharge': 'door-open', 'Emergency': 'ambulance',
                'Mental Health': 'brain', 'Referral': 'share', 'Care Plan': 'clipboard-list',
                'Consent': 'file-signature', 'EHR Integration': 'hospital', 'Telemedicine': 'video',
                'Pediatric': 'baby', 'Post-Op': 'band-aid', 'Chronic Care': 'stethoscope',
                'Preventive': 'shield-halved', 'Patient Message': 'comment-medical',
                'Allergies': 'allergies', 'Administrative': 'file-invoice', 'Other': 'file'
            };
            return icons[type] || 'file';
        }

        // ===== CONTACT FORM =====
        function sendAppContact() {
            const name = document.getElementById('appContactName').value;
            const email = document.getElementById('appContactEmail').value;
            const subject = document.getElementById('appContactSubject').value;
            const message = document.getElementById('appContactMessage').value;
            if (!name || !email || !message) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            const body = 'Name: ' + name + '%0D%0AEmail: ' + email + '%0D%0A%0D%0A' + encodeURIComponent(message);
            window.location.href = 'mailto:support@solusprotocol.com?subject=' + encodeURIComponent((subject || 'General') + ' - Solus Protocol App') + '&body=' + body;
            showToast('Opening email client...', 'success');
        }

        // ===== PARTICLES.JS INIT =====
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof particlesJS !== 'undefined') {
                particlesJS('app-particles', {
                    particles: {
                        number: { value: 50, density: { enable: true, value_area: 1000 } },
                        color: { value: ['#14F195', '#9945FF', '#ffffff'] },
                        shape: { type: 'circle' },
                        opacity: { value: 0.3, random: true, anim: { enable: true, speed: 0.5, opacity_min: 0.1, sync: false } },
                        size: { value: 3, random: true, anim: { enable: true, speed: 2, size_min: 0.5, sync: false } },
                        line_linked: { enable: true, distance: 150, color: '#14F195', opacity: 0.1, width: 1 },
                        move: { enable: true, speed: 1, direction: 'none', random: true, straight: false, out_mode: 'out', bounce: false }
                    },
                    interactivity: {
                        detect_on: 'canvas',
                        events: { onhover: { enable: true, mode: 'grab' }, onclick: { enable: false }, resize: true },
                        modes: { grab: { distance: 140, line_linked: { opacity: 0.3 } } }
                    },
                    retina_detect: true
                });
            }

            // ===== SPLASH SCREEN =====
            setTimeout(() => {
                const splash = document.getElementById('splashScreen');
                if (splash) {
                    splash.classList.add('fade-out');
                    setTimeout(() => splash.remove(), 500);
                }
            }, 1500);
        });

        // ===== ANIMATED STAT COUNTERS =====
        function animateCounter(element, target, duration) {
            if (!element) return;
            const isString = typeof target === 'string';
            const numericTarget = isString ? parseFloat(target.replace(/[^0-9.]/g, '')) : target;
            const suffix = isString ? target.replace(/[0-9.]/g, '') : '';
            const start = 0;
            const startTime = performance.now();

            function step(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                // Ease out cubic
                const eased = 1 - Math.pow(1 - progress, 3);
                const current = Math.round(start + (numericTarget - start) * eased);

                if (suffix === 'M') {
                    element.textContent = (current / 10).toFixed(1) + suffix;
                } else {
                    element.textContent = current + suffix;
                }

                if (progress < 1) requestAnimationFrame(step);
            }
            requestAnimationFrame(step);
        }

        function animateHomeStats() {
            if (currentRole === 'patient') {
                animateCounter(document.getElementById('statRecords'), 12, 800);
                animateCounter(document.getElementById('statShared'), 3, 600);
                animateCounter(document.getElementById('statVerified'), 12, 800);
            }
        }

        // ===== OFFLINE DETECTION =====
        let wasOffline = false;
        function updateOnlineStatus() {
            const banner = document.getElementById('offlineBanner');
            const icon = document.getElementById('offlineIcon');
            const text = document.getElementById('offlineText');

            if (!navigator.onLine) {
                icon.className = 'fas fa-wifi';
                text.textContent = "You're offline";
                banner.className = 'offline-banner show';
                wasOffline = true;
            } else if (wasOffline) {
                icon.className = 'fas fa-wifi';
                text.textContent = 'Back online';
                banner.className = 'offline-banner show online';
                setTimeout(() => { banner.classList.remove('show'); wasOffline = false; }, 2500);
            }
        }
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        // ===== SESSION TIMEOUT =====
        let sessionTimer = null;
        let countdownTimer = null;
        let countdownVal = 30;
        const SESSION_TIMEOUT = 5 * 60 * 1000; // 5 minutes

        function resetSessionTimer() {
            if (currentScreen === 'login') return;
            clearTimeout(sessionTimer);
            clearInterval(countdownTimer);
            document.getElementById('timeoutOverlay').classList.remove('active');
            sessionTimer = setTimeout(showTimeoutWarning, SESSION_TIMEOUT);
        }

        function showTimeoutWarning() {
            if (currentScreen === 'login') return;
            countdownVal = 30;
            document.getElementById('timeoutCountdown').textContent = countdownVal;
            document.getElementById('timeoutOverlay').classList.add('active');
            countdownTimer = setInterval(() => {
                countdownVal--;
                document.getElementById('timeoutCountdown').textContent = countdownVal;
                if (countdownVal <= 0) {
                    clearInterval(countdownTimer);
                    sessionLogout();
                }
            }, 1000);
        }

        function extendSession() {
            clearInterval(countdownTimer);
            document.getElementById('timeoutOverlay').classList.remove('active');
            resetSessionTimer();
            showToast('Session extended', 'success');
        }

        function sessionLogout() {
            clearTimeout(sessionTimer);
            clearInterval(countdownTimer);
            document.getElementById('timeoutOverlay').classList.remove('active');
            logout();
        }

        // Listen for user activity to reset timer
        ['click', 'touchstart', 'keypress', 'scroll'].forEach(evt => {
            document.addEventListener(evt, () => {
                if (currentScreen !== 'login') resetSessionTimer();
            }, { passive: true });
        });

        // ===== SMOOTH PAGE TRANSITIONS =====
        const screenOrder = ['home', 'records', 'trade', 'activity', 'more'];
        let previousScreenIndex = 0;

        const originalNavigateTo = navigateTo;
        navigateTo = function(screen, el) {
            const newIndex = screenOrder.indexOf(screen);
            const direction = newIndex > previousScreenIndex ? 'slide-right' : 'slide-left';
            previousScreenIndex = newIndex;

            // Call original navigation
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            if (el) el.classList.add('active');

            const screenMap = {
                'home': 'homeScreen',
                'records': 'recordsScreen',
                'trade': 'tradeScreen',
                'activity': 'activityScreen',
                'more': 'moreScreen'
            };

            document.querySelectorAll('.screen').forEach(s => {
                s.classList.remove('active', 'slide-right', 'slide-left');
            });
            const targetScreen = document.getElementById(screenMap[screen]);
            targetScreen.classList.add('active', direction);
            currentScreen = screen;

            if (screen === 'activity') {
                document.getElementById('activityBadge').style.display = 'none';
                notificationCount = 0;
            }
            if (screen === 'trade') { updateTradeBalance(); }
            if (screen === 'home') { animateHomeStats(); }
        };

        // ===== HAPTIC FEEDBACK =====
        function haptic(pattern) {
            if ('vibrate' in navigator) {
                navigator.vibrate(pattern || 10);
            }
        }

        // ===== RIPPLE TAP EFFECT =====
        document.addEventListener('click', function(e) {
            const target = e.target.closest('.action-card, .record-card, .btn, .nav-item, .role-card, .patient-card, .exchange-card, .settings-item, .faq-item');
            if (!target) return;
            haptic();
            const rect = target.getBoundingClientRect();
            const ripple = document.createElement('span');
            ripple.className = 'ripple-effect';
            const size = Math.max(rect.width, rect.height);
            ripple.style.width = ripple.style.height = size + 'px';
            ripple.style.left = (e.clientX - rect.left - size / 2) + 'px';
            ripple.style.top = (e.clientY - rect.top - size / 2) + 'px';
            target.style.position = target.style.position || 'relative';
            target.style.overflow = 'hidden';
            target.appendChild(ripple);
            ripple.addEventListener('animationend', () => ripple.remove());
        });

        // ===== BLOCKCHAIN ANCHORING ANIMATION =====
        function showAnchorAnimation() {
            const overlay = document.getElementById('anchorOverlay');
            const hashDisplay = document.getElementById('anchorHashDisplay');
            overlay.classList.add('active');
            hashDisplay.style.display = 'none';

            // Reset all steps
            for (let i = 1; i <= 4; i++) {
                const step = document.getElementById('anchorStep' + i);
                step.classList.remove('active', 'done');
            }

            const fakeHash = 'a7f8b9c2d3e4f5' + Math.random().toString(16).substring(2, 10) + '1k2l3m4n5o6p7q8r';

            // Step 1: Preparing
            setTimeout(() => {
                document.getElementById('anchorStep1').classList.add('active');
                haptic();
            }, 300);

            // Step 2: Hash
            setTimeout(() => {
                document.getElementById('anchorStep1').classList.remove('active');
                document.getElementById('anchorStep1').classList.add('done');
                document.getElementById('anchorStep2').classList.add('active');
                hashDisplay.style.display = 'block';
                hashDisplay.textContent = '';
                haptic();
                // Typewriter hash
                let idx = 0;
                const hashInterval = setInterval(() => {
                    if (idx < fakeHash.length) {
                        hashDisplay.textContent += fakeHash[idx];
                        idx++;
                    } else {
                        clearInterval(hashInterval);
                    }
                }, 40);
            }, 1200);

            // Step 3: Submitting
            setTimeout(() => {
                document.getElementById('anchorStep2').classList.remove('active');
                document.getElementById('anchorStep2').classList.add('done');
                document.getElementById('anchorStep3').classList.add('active');
                haptic();
            }, 2800);

            // Step 4: Confirmed
            setTimeout(() => {
                document.getElementById('anchorStep3').classList.remove('active');
                document.getElementById('anchorStep3').classList.add('done');
                document.getElementById('anchorStep4').classList.add('active');
                haptic([10, 50, 10]);
            }, 4200);

            // Done  close and celebrate
            setTimeout(() => {
                document.getElementById('anchorStep4').classList.remove('active');
                document.getElementById('anchorStep4').classList.add('done');
                setTimeout(() => {
                    overlay.classList.remove('active');
                    showToast('Record anchored to XRPL', 'success');
                    document.getElementById('statRecords').textContent = '13';
                    document.getElementById('statVerified').textContent = '13';
                    launchConfetti();
                }, 600);
            }, 5000);
        }

        // ===== CONFETTI CELEBRATION =====
        function launchConfetti() {
            const container = document.getElementById('confettiContainer');
            const colors = ['#14F195', '#9945FF', '#00C2FF', '#ffd700', '#ff6b6b', '#ffffff'];
            const shapes = ['square', 'circle'];

            for (let i = 0; i < 60; i++) {
                const piece = document.createElement('div');
                piece.className = 'confetti-piece';
                const color = colors[Math.floor(Math.random() * colors.length)];
                const shape = shapes[Math.floor(Math.random() * shapes.length)];
                piece.style.left = Math.random() * 100 + '%';
                piece.style.background = color;
                piece.style.animationDuration = (2 + Math.random() * 2) + 's';
                piece.style.animationDelay = Math.random() * 0.5 + 's';
                if (shape === 'circle') piece.style.borderRadius = '50%';
                piece.style.width = (6 + Math.random() * 8) + 'px';
                piece.style.height = (6 + Math.random() * 8) + 'px';
                container.appendChild(piece);
            }
            haptic([10, 30, 10, 30, 10]);
            setTimeout(() => { container.innerHTML = ''; }, 4000);
        }

        // ===== GYROSCOPE PARALLAX ON GRADIENT ORBS =====
        (function() {
            const orb1 = document.getElementById('orb1');
            const orb2 = document.getElementById('orb2');
            const orb3 = document.getElementById('orb3');
            if (!orb1) return;

            // Device tilt (mobile)
            if (window.DeviceOrientationEvent) {
                window.addEventListener('deviceorientation', function(e) {
                    const beta = (e.beta || 0) * 0.4;
                    const gamma = (e.gamma || 0) * 0.4;
                    orb1.style.transform = 'translate(' + gamma + 'px, ' + beta + 'px)';
                    orb2.style.transform = 'translate(' + (-gamma * 0.7) + 'px, ' + (-beta * 0.7) + 'px)';
                    orb3.style.transform = 'translate(calc(-50% + ' + (gamma * 0.5) + 'px), calc(-50% + ' + (beta * 0.5) + 'px))';
                }, { passive: true });
            }

            // Mouse parallax fallback (desktop)
            document.addEventListener('mousemove', function(e) {
                const cx = window.innerWidth / 2;
                const cy = window.innerHeight / 2;
                const dx = (e.clientX - cx) * 0.025;
                const dy = (e.clientY - cy) * 0.025;
                orb1.style.transform = 'translate(' + dx + 'px, ' + dy + 'px)';
                orb2.style.transform = 'translate(' + (-dx * 0.7) + 'px, ' + (-dy * 0.7) + 'px)';
                orb3.style.transform = 'translate(calc(-50% + ' + (dx * 0.5) + 'px), calc(-50% + ' + (dy * 0.5) + 'px))';
            }, { passive: true });
        })();

        // ===== FAB VISIBILITY =====
        (function() {
            const fab = document.getElementById('fab');
            function updateFab() {
                if (currentScreen === 'home' && currentRole === 'patient') {
                    fab.classList.add('visible');
                } else {
                    fab.classList.remove('visible');
                }
            }
            const _nav = navigateTo;
            window.navigateTo = function(s, el) { _nav(s, el); setTimeout(updateFab, 50); };
            const _login = login;
            window.login = function() { _login(); setTimeout(updateFab, 100); };
            const _sessionLogout = sessionLogout;
            window.sessionLogout = function() { _sessionLogout(); fab.classList.remove('visible'); };
        })();

        // ===== PULL TO REFRESH =====
        (function() {
            let startY = 0;
            let pulling = false;
            const homeScreen = document.getElementById('homeScreen');
            const indicator = document.getElementById('pullIndicator');
            if (!homeScreen || !indicator) return;

            homeScreen.addEventListener('touchstart', function(e) {
                if (homeScreen.scrollTop === 0 && currentScreen === 'home') {
                    startY = e.touches[0].clientY;
                    pulling = true;
                }
            }, { passive: true });

            homeScreen.addEventListener('touchmove', function(e) {
                if (!pulling) return;
                const diff = e.touches[0].clientY - startY;
                if (diff > 0 && diff < 120) {
                    indicator.style.height = Math.min(diff * 0.5, 50) + 'px';
                }
            }, { passive: true });

            homeScreen.addEventListener('touchend', function() {
                if (!pulling) return;
                pulling = false;
                const h = parseInt(indicator.style.height) || 0;
                if (h > 30) {
                    indicator.innerHTML = '<div class="spinner"></div>';
                    indicator.style.height = '50px';
                    haptic();
                    setTimeout(() => {
                        updateGreeting();
                        renderRecords();
                        renderActivity();
                        animateHomeStats();
                        indicator.innerHTML = '<i class="fas fa-check" style="color: var(--accent);"></i>';
                        setTimeout(() => {
                            indicator.style.height = '0';
                            indicator.innerHTML = '<i class="fas fa-arrow-down"></i>';
                        }, 800);
                        showToast('Dashboard refreshed', 'success');
                    }, 1000);
                } else {
                    indicator.style.height = '0';
                }
            }, { passive: true });
        })();

        // ===== LIVE CLOCK =====
        (function() {
            const clockEl = document.getElementById('headerClock');
            if (!clockEl) return;
            function tick() {
                const now = new Date();
                const h = now.getHours();
                const m = now.getMinutes().toString().padStart(2, '0');
                const ampm = h >= 12 ? 'PM' : 'AM';
                const h12 = h % 12 || 12;
                clockEl.textContent = h12 + ':' + m + ' ' + ampm;
            }
            tick();
            setInterval(tick, 15000);
        })();

        // ===== SCROLL TO TOP =====
        (function() {
            const btn = document.getElementById('scrollTopBtn');
            if (!btn) return;
            window.addEventListener('scroll', function() {
                btn.classList.toggle('visible', window.scrollY > 300);
            }, { passive: true });
        })();

        // ===== LONG PRESS CONTEXT MENU =====
        let contextRecordId = null;
        let longPressTimer = null;
        document.addEventListener('touchstart', function(e) {
            const card = e.target.closest('.record-card');
            if (!card) return;
            longPressTimer = setTimeout(function() {
                haptic([10, 30, 10]);
                contextRecordId = card.getAttribute('onclick')?.match(/\d+/)?.[0];
                const menu = document.getElementById('contextMenu');
                const rect = card.getBoundingClientRect();
                menu.style.top = Math.min(rect.bottom, window.innerHeight - 250) + 'px';
                menu.style.left = Math.min(rect.left + 20, window.innerWidth - 200) + 'px';
                menu.classList.add('active');
            }, 500);
        }, { passive: true });
        document.addEventListener('touchend', function() { clearTimeout(longPressTimer); }, { passive: true });
        document.addEventListener('touchmove', function() { clearTimeout(longPressTimer); }, { passive: true });
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.context-menu')) document.getElementById('contextMenu').classList.remove('active');
        });
        function contextAction(action) {
            document.getElementById('contextMenu').classList.remove('active');
            switch(action) {
                case 'verify': openModal('verifyModal'); break;
                case 'share': openModal('shareModal'); break;
                case 'copy':
                    const fakeHash = '0x7f8a9b2c3d4e5f6a' + (contextRecordId || '0001');
                    navigator.clipboard.writeText(fakeHash).then(() => showToast('Hash copied!', 'success'));
                    break;
                case 'explorer':
                    window.open('https://testnet.xrpl.org/accounts/rJPqcx8wUBM58ajPUoz1dReKkTT6hqrqJA', '_blank');
                    break;
                case 'revoke':
                    showToast('Access revoked for this record', 'success');
                    break;
            }
        }

        // ===== LIVE ROLE SWITCHING (mid-session) =====
        function switchRoleLive(role) {
            if (currentRole === role) return;
            haptic([10, 50, 10]);
            currentRole = role;

            // Animate switch
            const homeScreen = document.getElementById('homeScreen');
            homeScreen.classList.add('role-switch-anim');
            setTimeout(() => homeScreen.classList.remove('role-switch-anim'), 500);

            updateUIForRole();
            animateHomeStats();

            const roleNames = { patient: 'Patient', provider: 'Provider', ehr: 'EHR Administrator' };
            showToast('Switched to ' + roleNames[role], 'success');

            // Navigate back to home if on profile
            if (currentScreen === 'more' || currentScreen === 'profile') {
                navigateTo('home', document.querySelector('.nav-item'));
            }
        }

        // ===== TOOLTIP SYSTEM =====
        const tooltipDefinitions = {
            zeroKnowledge: {
                title: 'Zero-Knowledge Privacy',
                text: 'A method where the blockchain verifies your data is authentic without ever seeing the actual data. Only a cryptographic "fingerprint" (hash) is stored on-chain  your medical records remain completely private.'
            },
            blockchain: {
                title: 'Blockchain Synced',
                text: 'Your wallet is connected to the XRP Ledger (XRPL) in real time. All record hashes are verified against on-chain data to ensure nothing has been tampered with since anchoring.'
            },
            hipaa: {
                title: 'HIPAA Secured',
                text: 'HIPAA (Health Insurance Portability and Accountability Act) is the U.S. federal law protecting sensitive patient health information. Solus Protocol complies by never storing actual health data on-chain  only irreversible SHA-256 hashes.'
            },
            sha256: {
                title: 'SHA-256 Hash',
                text: 'A one-way cryptographic function that converts any data into a unique 64-character string. Even changing a single letter in the original data produces a completely different hash  making tampering instantly detectable.'
            },
            healthScore: {
                title: 'Data Health Score',
                text: 'A composite score measuring the integrity and completeness of your health data portfolio. Factors include: percentage of records anchored on-chain, verification freshness, encryption status, and access control configuration.'
            },
            xrpl: {
                title: 'XRP Ledger (XRPL)',
                text: 'A decentralized, open-source blockchain designed for fast, low-cost transactions. Solus Protocol uses XRPL to permanently anchor medical record hashes, providing an immutable audit trail without storing sensitive data.'
            },
            anchoring: {
                title: 'Data Anchoring',
                text: 'The process of recording a cryptographic hash of your medical record onto the blockchain. Once anchored, the hash is permanent and can be used to prove the record hasn\'t been altered since that moment.'
            },
            providerHealthScore: {
                title: 'Practice Health Score',
                text: 'A composite score measuring data integrity across your entire patient panel. Factors include: percentage of records verified, follow-up compliance rate, documentation completeness, and average anchoring latency.'
            },
            ehrHealthScore: {
                title: 'System Health Score',
                text: 'An enterprise-wide infrastructure health metric. Measures uptime, anchoring success rate, HIPAA compliance status, API key freshness, and the percentage of records passing integrity verification.'
            }
        };

        function showTermTooltip(event, termKey) {
            event.stopPropagation();
            // Remove any existing tooltip
            dismissTooltip();

            const def = tooltipDefinitions[termKey];
            if (!def) return;

            // Create backdrop
            const backdrop = document.createElement('div');
            backdrop.className = 'tooltip-backdrop';
            backdrop.onclick = dismissTooltip;

            // Create tooltip
            const bubble = document.createElement('div');
            bubble.className = 'tooltip-bubble';
            bubble.innerHTML = '<h4><i class="fas fa-lightbulb" style="margin-right: 4px;"></i> ' + def.title + '</h4><p>' + def.text + '</p>';

            document.body.appendChild(backdrop);
            document.body.appendChild(bubble);

            // Position near the clicked element
            const rect = event.target.getBoundingClientRect();
            const bw = 280;
            let left = Math.max(10, Math.min(rect.left, window.innerWidth - bw - 10));
            let top = rect.top - bubble.offsetHeight - 12;

            if (top < 10) {
                top = rect.bottom + 12;
                bubble.classList.add('above');
            }

            bubble.style.left = left + 'px';
            bubble.style.top = top + 'px';
        }

        function dismissTooltip() {
            document.querySelectorAll('.tooltip-bubble, .tooltip-backdrop').forEach(el => el.remove());
        }

        // ===== AI HEALTH SCAN ENGINE =====
        function runAIScan() {
            haptic();
            const content = document.getElementById('aiInsightsContent');
            content.innerHTML = `
                <div class="ai-scan-animation">
                    <div class="ai-spinner"></div>
                    <span>Solus Protocol AI Engine analyzing 12 patient records...</span>
                </div>
                <div class="ai-scan-progress">
                    <div class="ai-scan-progress-bar" id="aiProgressBar"></div>
                </div>
            `;

            // Animate progress bar
            let progress = 0;
            const progressBar = document.getElementById('aiProgressBar');
            const progressInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 95) progress = 95;
                progressBar.style.width = progress + '%';
            }, 200);

            // Simulate AI analysis
            setTimeout(() => {
                clearInterval(progressInterval);
                progressBar.style.width = '100%';

                setTimeout(() => {
                    haptic([10, 30, 10, 30, 10]);
                    content.innerHTML = `
                        <div class="ai-finding">
                            <div class="ai-finding-icon warning"><i class="fas fa-exclamation-triangle"></i></div>
                            <div class="ai-finding-text">
                                <h4>Potential Drug Interaction</h4>
                                <p>Lisinopril 10mg + Metformin 500mg  monitor renal function. Studies indicate increased risk of lactic acidosis in patients with reduced kidney function.</p>
                                <span class="ai-tag medium">Medium Priority</span>
                            </div>
                        </div>
                        <div class="ai-finding">
                            <div class="ai-finding-icon alert"><i class="fas fa-heart-pulse"></i></div>
                            <div class="ai-finding-text">
                                <h4>Blood Pressure Trend Anomaly</h4>
                                <p>Systolic BP readings show an upward trend over the past 3 months (118  128  136 mmHg). Consider discussing medication adjustment with Dr. Smith.</p>
                                <span class="ai-tag high">High Priority</span>
                            </div>
                        </div>
                        <div class="ai-finding">
                            <div class="ai-finding-icon info"><i class="fas fa-flask"></i></div>
                            <div class="ai-finding-text">
                                <h4>A1C Improvement Detected</h4>
                                <p>Your A1C dropped from 7.2% to 6.8% between OctNov 2025. Current Metformin regimen appears effective. Keep up the progress!</p>
                                <span class="ai-tag low">Positive Trend</span>
                            </div>
                        </div>
                        <div class="ai-finding">
                            <div class="ai-finding-icon ok"><i class="fas fa-clock"></i></div>
                            <div class="ai-finding-text">
                                <h4>Overdue: Lipid Panel Follow-up</h4>
                                <p>Last lipid panel was Dec 20, 2025 (49 days ago). Recommended follow-up interval for your profile is 90 days. Next due: Mar 20, 2026.</p>
                                <span class="ai-tag low">Reminder</span>
                            </div>
                        </div>
                    `;
                    showToast('Solus Protocol AI Engine  4 insights found', 'success');
                }, 400);
            }, 2500);
        }

        // ===== AI RECORD SUMMARIZATION (in record detail) =====
        function generateAISummary(recordId) {
            const record = mockRecords.find(r => r.id === recordId);
            if (!record) return;

            const summaryBtn = document.getElementById('aiSummaryBtn');
            if (summaryBtn) summaryBtn.disabled = true;

            const container = document.getElementById('aiSummaryContainer');
            container.innerHTML = `
                <div class="ai-scan-animation" style="justify-content: center;">
                    <div class="ai-spinner"></div>
                    <span>Solus Protocol AI Engine summarizing...</span>
                </div>
            `;

            const summaries = {
                visit: {
                    summary: 'Comprehensive physical examination completed. Patient presents in good general health with controlled diabetes (Type 2) and stage 1 hypertension.',
                    keyPoints: ['BMI: 26.4 (slightly overweight)', 'Blood glucose: within target range', 'Heart and lung auscultation: normal', 'Recommended: increase physical activity to 150min/week']
                },
                lab: {
                    summary: 'Blood work results within normal parameters with minor elevations in cholesterol markers. Kidney function stable  important for current medication regimen.',
                    keyPoints: ['WBC, RBC, Platelets: all normal ranges', 'LDL cholesterol: 142 mg/dL (borderline high)', 'eGFR: 78 mL/min (adequate for Metformin)', 'Fasting glucose: 112 mg/dL']
                },
                imaging: {
                    summary: 'Diagnostic imaging reviewed with no acute findings. Chronic degenerative changes noted consistent with age and medical history.',
                    keyPoints: ['No acute pathology identified', 'Mild degenerative disc changes at L4-L5', 'Heart silhouette: normal size', 'Lungs: clear bilaterally']
                },
                rx: {
                    summary: 'Prescription medication for ongoing management of chronic condition. Dosage is within standard therapeutic range.',
                    keyPoints: ['Standard dosage for indication', 'Monitor for GI side effects', 'Take with meals to reduce nausea', 'Renal function monitoring recommended quarterly']
                },
                vitals: {
                    summary: 'Vital signs captured during routine monitoring. Blood pressure trending slightly above target  warrants continued monitoring.',
                    keyPoints: ['BP: 136/84 mmHg (slightly elevated)', 'Heart rate: 72 bpm (normal)', 'SpO2: 98% (normal)', 'Temperature: 98.4F (normal)']
                }
            };

            setTimeout(() => {
                haptic();
                const data = summaries[record.type] || summaries.visit;
                container.innerHTML = `
                    <div class="ai-summary-box">
                        <div class="ai-badge" style="margin-bottom: 8px;"><i class="fas fa-brain"></i> Solus Protocol AI Summary</div>
                        <p>${data.summary}</p>
                        <h4 style="margin-top: 12px; font-size: 0.82rem; color: var(--text);">Key Findings</h4>
                        <ul>
                            ${data.keyPoints.map(p => '<li><i class="fas fa-chevron-right"></i> ' + p + '</li>').join('')}
                        </ul>
                        <p style="font-size: 0.7rem; color: var(--text-muted); margin-top: 12px; font-style: italic;">
                            <i class="fas fa-info-circle"></i> Solus Protocol AI Engine  generated summary for informational purposes only. Always consult your healthcare provider for medical decisions.
                        </p>
                    </div>
                `;
                if (summaryBtn) summaryBtn.disabled = false;
            }, 1800);
        }

        // ===== PROVIDER AI SCAN =====
        function runProviderAIScan() {
            haptic();
            const content = document.getElementById('providerAIContent');
            content.innerHTML = `
                <div class="ai-scan-animation">
                    <div class="ai-spinner"></div>
                    <span>Solus Protocol AI Engine analyzing patient cohort...</span>
                </div>
                <div class="ai-scan-progress">
                    <div class="ai-scan-progress-bar" id="providerAIProgress"></div>
                </div>
            `;

            let progress = 0;
            const bar = document.getElementById('providerAIProgress');
            const interval = setInterval(() => {
                progress += Math.random() * 18;
                if (progress > 95) progress = 95;
                bar.style.width = progress + '%';
            }, 200);

            setTimeout(() => {
                clearInterval(interval);
                bar.style.width = '100%';
                setTimeout(() => {
                    haptic([10, 30, 10, 30, 10]);
                    content.innerHTML = `
                        <div class="ai-finding">
                            <div class="ai-finding-icon alert"><i class="fas fa-pills"></i></div>
                            <div class="ai-finding-text">
                                <h4>Cross-Patient Drug Alert</h4>
                                <p>3 patients in your panel are on both ACE inhibitors and potassium-sparing diuretics. Risk of hyperkalemia  recommend serum potassium monitoring within 7 days.</p>
                                <span class="ai-tag high">High Priority</span>
                            </div>
                        </div>
                        <div class="ai-finding">
                            <div class="ai-finding-icon warning"><i class="fas fa-calendar-xmark"></i></div>
                            <div class="ai-finding-text">
                                <h4>Missed Follow-Up Detection</h4>
                                <p>Sarah Johnson's post-surgical follow-up was scheduled for Jan 30 (8 days overdue). Michael Roberts' A1C recheck is due Feb 10. Recommend automated patient outreach.</p>
                                <span class="ai-tag medium">Medium Priority</span>
                            </div>
                        </div>
                        <div class="ai-finding">
                            <div class="ai-finding-icon info"><i class="fas fa-chart-line"></i></div>
                            <div class="ai-finding-text">
                                <h4>Cohort Vitals Trend</h4>
                                <p>Average systolic BP across your 8 active patients is trending upward by 4.2% compared to 90 days ago. 2 patients now exceed Stage 1 hypertension threshold.</p>
                                <span class="ai-tag medium">Clinical Trend</span>
                            </div>
                        </div>
                        <div class="ai-finding">
                            <div class="ai-finding-icon ok"><i class="fas fa-clipboard-check"></i></div>
                            <div class="ai-finding-text">
                                <h4>Documentation Compliance</h4>
                                <p>24/24 records from today are properly anchored and hash-verified on XRPL. All clinical notes have matching blockchain timestamps. No documentation gaps detected.</p>
                                <span class="ai-tag low">All Clear</span>
                            </div>
                        </div>
                    `;
                    showToast('Solus Protocol AI Engine  4 provider insights found', 'success');
                }, 400);
            }, 2800);
        }

        // ===== EHR AI SCAN =====
        function runEHRAIScan() {
            haptic();
            const content = document.getElementById('ehrAIContent');
            content.innerHTML = `
                <div class="ai-scan-animation">
                    <div class="ai-spinner"></div>
                    <span>Solus Protocol AI Engine running system audit...</span>
                </div>
                <div class="ai-scan-progress">
                    <div class="ai-scan-progress-bar" id="ehrAIProgress"></div>
                </div>
            `;

            let progress = 0;
            const bar = document.getElementById('ehrAIProgress');
            const interval = setInterval(() => {
                progress += Math.random() * 12;
                if (progress > 95) progress = 95;
                bar.style.width = progress + '%';
            }, 250);

            setTimeout(() => {
                clearInterval(interval);
                bar.style.width = '100%';
                setTimeout(() => {
                    haptic([10, 30, 10, 30, 10]);
                    content.innerHTML = `
                        <div class="ai-finding">
                            <div class="ai-finding-icon ok"><i class="fas fa-shield-halved"></i></div>
                            <div class="ai-finding-text">
                                <h4>HIPAA Compliance Status</h4>
                                <p>All 2.4M anchored records passed integrity verification. Zero unauthorized access events in the last 30 days. PHI de-identification is 100% compliant with Safe Harbor method.</p>
                                <span class="ai-tag low">Compliant</span>
                            </div>
                        </div>
                        <div class="ai-finding">
                            <div class="ai-finding-icon warning"><i class="fas fa-server"></i></div>
                            <div class="ai-finding-text">
                                <h4>Anchoring Latency Spike</h4>
                                <p>Average hash anchoring time increased from 2.1s to 3.8s between 2:003:00 PM today. Correlated with XRPL Testnet validator rotation. Recommend monitoring for persistence.</p>
                                <span class="ai-tag medium">Performance</span>
                            </div>
                        </div>
                        <div class="ai-finding">
                            <div class="ai-finding-icon alert"><i class="fas fa-key"></i></div>
                            <div class="ai-finding-text">
                                <h4>API Key Rotation Overdue</h4>
                                <p>Production API key <code>solus_live_...3f7a</code> has not been rotated in 87 days. Security best practice recommends 90-day rotation. Schedule rotation before Feb 14.</p>
                                <span class="ai-tag high">Security</span>
                            </div>
                        </div>
                        <div class="ai-finding">
                            <div class="ai-finding-icon info"><i class="fas fa-chart-pie"></i></div>
                            <div class="ai-finding-text">
                                <h4>Record Distribution Analysis</h4>
                                <p>Top 3 record types: Vitals (34%), Lab Results (22%), Imaging (15%). Immunization records are 12% below expected volume for Q1  may indicate missed flu season anchoring.</p>
                                <span class="ai-tag low">Analytics</span>
                            </div>
                        </div>
                    `;
                    showToast('Solus Protocol AI Engine  4 system insights found', 'success');
                }, 400);
            }, 3200);
        }

        // ===== v2.8.0  EMERGENCY ICE CARD =====
        function shareICECard() {
            haptic();
            if (navigator.share) {
                navigator.share({
                    title: 'Emergency ICE Card  Alex Johnson',
                    text: 'Blood Type: O+ | Allergies: Penicillin, Sulfa | Meds: Lisinopril 10mg, Metformin 500mg | Emergency Contact: Maria Johnson (555) 867-5309',
                    url: window.location.href
                }).catch(() => {});
            } else {
                navigator.clipboard.writeText('ICE Card  Alex Johnson\nBlood Type: O+\nAllergies: Penicillin, Sulfa\nMedications: Lisinopril 10mg, Metformin 500mg\nEmergency Contact: Maria Johnson (555) 867-5309');
                showToast('ICE Card copied to clipboard', 'success');
            }
        }

        function showICEQR() {
            haptic();
            showToast('ICE QR code generated  show to first responders', 'success');
        }

        // ===== CONSENT & ACCESS MANAGER =====
        function revokeAccess(btn, name) {
            haptic([10, 30, 10]);
            btn.textContent = 'Revoked';
            btn.classList.add('revoked');
            btn.disabled = true;
            showToast('Access revoked for ' + name, 'success');
        }

        // ===== RECORD FAVORITES =====
        let favoriteRecords = JSON.parse(localStorage.getItem('solus_favorites') || '[]');

        function toggleFavorite(recordId, event) {
            event.stopPropagation();
            haptic();
            const idx = favoriteRecords.indexOf(recordId);
            if (idx > -1) {
                favoriteRecords.splice(idx, 1);
                showToast('Removed from favorites', 'success');
            } else {
                favoriteRecords.push(recordId);
                showToast('Added to favorites', 'success');
            }
            localStorage.setItem('solus_favorites', JSON.stringify(favoriteRecords));
            renderRecords();
        }

        // ===== ANCHORING ACTIVITY HEATMAP =====
        function renderHeatmap() {
            const grid = document.getElementById('heatmapGrid');
            if (!grid) return;
            // Generate 28 cells (4 weeks  7 days) with simulated data
            const levels = [0, 0, 1, 0, 2, 1, 0, 3, 1, 0, 0, 2, 4, 1, 0, 1, 3, 2, 0, 0, 1, 2, 0, 3, 1, 4, 2, 1];
            grid.innerHTML = levels.map((lvl, i) => {
                const date = new Date();
                date.setDate(date.getDate() - (27 - i));
                const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                const count = lvl === 0 ? 0 : lvl === 1 ? 1 : lvl === 2 ? 3 : lvl === 3 ? 5 : 8;
                return '<div class="heatmap-cell level-' + lvl + '" title="' + dateStr + ': ' + count + ' records anchored"></div>';
            }).join('');
        }

        // ===== SDK PLAYGROUND =====
        const pgTemplates = {
            patient: [
                { name: 'Vitals Check', icon: 'fas fa-heartbeat', type: 'vitals',
                  content: `Patient: Sarah Chen | DOB: 1985-03-15\nDate: ${new Date().toISOString().split('T')[0]}\nHeart Rate: 72 bpm | BP: 118/76 mmHg\nSpO2: 98% | Temp: 98.4F\nRespiratory Rate: 16 breaths/min\nWeight: 145 lbs | Height: 5'6"\nNotes: Routine check  all vitals within normal range.` },
                { name: 'Lab Results', icon: 'fas fa-flask', type: 'lab_result',
                  content: `Lab Report  Complete Blood Count (CBC)\nPatient: Sarah Chen | Ordered by: Dr. Patel\nDate: ${new Date().toISOString().split('T')[0]}\nWBC: 6.2 K/uL (Normal: 4.5-11.0)\nRBC: 4.8 M/uL (Normal: 4.0-5.5)\nHemoglobin: 14.2 g/dL (Normal: 12.0-16.0)\nHematocrit: 42% (Normal: 36-46%)\nPlatelets: 250 K/uL (Normal: 150-400)\nStatus: All values within normal limits` },
                { name: 'Prescription', icon: 'fas fa-pills', type: 'prescription',
                  content: `Prescription Record\nPatient: Sarah Chen | Provider: Dr. Lisa Patel\nDate: ${new Date().toISOString().split('T')[0]}\nMedication: Lisinopril 10mg\nDirections: Take one tablet by mouth daily\nQuantity: 30 tablets | Refills: 3\nPharmacy: CVS Health #4521\nDiagnosis: Essential hypertension (I10)\nNotes: Monitor blood pressure weekly` },
                { name: 'Allergy Update', icon: 'fas fa-allergies', type: 'allergy_update',
                  content: `Allergy Record Update\nPatient: Sarah Chen\nDate: ${new Date().toISOString().split('T')[0]}\nNew Allergy: Amoxicillin\nReaction: Skin rash, mild hives\nSeverity: Moderate\nOnset: Within 2 hours of administration\nVerified by: Dr. Lisa Patel\nAction: Added to EHR allergy list, patient notified` }
            ],
            provider: [
                { name: 'Clinical Note', icon: 'fas fa-stethoscope', type: 'clinical_note',
                  content: `Clinical Note  Office Visit\nProvider: Dr. James Wilson, MD | NPI: 1234567890\nPatient: Michael Torres | MRN: PT-20056\nDate: ${new Date().toISOString().split('T')[0]}\nCC: Follow-up for Type 2 Diabetes\nAssessment: A1C improved from 8.2% to 7.1%\nPlan: Continue Metformin 1000mg BID\n      Add CGM monitoring\n      Follow-up in 3 months\nCPT: 99214 | ICD-10: E11.65` },
                { name: 'Surgery Report', icon: 'fas fa-procedures', type: 'surgery_report',
                  content: `Operative Report\nSurgeon: Dr. James Wilson, MD\nPatient: Robert Kim | MRN: PT-30042\nDate: ${new Date().toISOString().split('T')[0]}\nProcedure: Laparoscopic Cholecystectomy\nDuration: 47 minutes | Anesthesia: General\nFindings: Chronic cholecystitis with cholelithiasis\nComplications: None\nEBL: <50mL\nDisposition: Recovery, discharge expected next day` },
                { name: 'Referral', icon: 'fas fa-share', type: 'referral',
                  content: `Patient Referral\nReferring: Dr. James Wilson (Internal Medicine)\nReferred to: Dr. Sarah Kim (Cardiology)\nPatient: Maria Santos | DOB: 1968-07-22\nDate: ${new Date().toISOString().split('T')[0]}\nReason: Persistent atrial fibrillation\nPriority: Urgent\nClinical Summary: New-onset AFib, HR 110-130 bpm\n  Started on rate control, needs cardiology eval\nAttachments: ECG, Echo results, CBC` },
                { name: 'Discharge Summary', icon: 'fas fa-file-medical-alt', type: 'discharge',
                  content: `Discharge Summary\nProvider: Dr. James Wilson, MD\nPatient: Alex Johnson | MRN: PT-10089\nDate: ${new Date().toISOString().split('T')[0]}\nAdmission: Post-appendectomy care\nLength of Stay: 2 days\nDiagnosis: Acute appendicitis (K35.80)\nProcedures: Laparoscopic appendectomy\nDischarge Meds: Acetaminophen 500mg PRN\n  Ciprofloxacin 500mg BID x7 days\nFollow-up: Surgeon in 2 weeks` }
            ],
            ehr: [
                { name: 'Integration Log', icon: 'fas fa-plug', type: 'integration_log',
                  content: `EHR Integration Log  FHIR R4 Sync\nSystem: HealthBridge EHR v4.2\nDate: ${new Date().toISOString().split('T')[0]}\nEndpoint: api.healthbridge.io/fhir/r4\nResources Synced: 847\n  Patient: 156 | Observation: 312\n  MedicationRequest: 89 | Encounter: 290\nErrors: 3 (0.35% error rate)\nAvg Response Time: 142ms\nStatus: Sync Complete` },
                { name: 'Audit Entry', icon: 'fas fa-shield-alt', type: 'audit_entry',
                  content: `Security Audit Log\nSystem: HealthBridge EHR v4.2\nDate: ${new Date().toISOString().split('T')[0]}\nAudit Period: Last 24 Hours\nTotal Access Events: 2,847\nAuthorized: 2,841 (99.79%)\nDenied: 6 (0.21%)\nBreak-Glass Events: 0\nPHI Access by Role:\n  Physician: 1,204 | Nurse: 1,122\n  Admin: 287 | Billing: 228\nHIPAA Compliance: Passed` },
                { name: 'Compliance Report', icon: 'fas fa-clipboard-check', type: 'compliance_report',
                  content: `Compliance Verification Report\nOrganization: Metro Health Network\nDate: ${new Date().toISOString().split('T')[0]}\nFramework: HIPAA Security Rule\nOverall Score: 94/100\nAccess Controls: 96/100\nAudit Controls: 92/100\nIntegrity Controls: 95/100\nTransmission Security: 93/100\nFindings:\n  Password rotation: 85% compliance\n  Encryption at rest: 100% verified\nNext Review: 30 days` },
                { name: 'Bulk Anchor Test', icon: 'fas fa-layer-group', type: 'bulk_anchor',
                  content: `Bulk Anchor Batch Record\nSystem: HealthBridge EHR v4.2\nDate: ${new Date().toISOString().split('T')[0]}\nBatch ID: BATCH-${Date.now().toString(36).toUpperCase()}\nRecords in Batch: 25\nRecord Types:\n  Clinical Notes: 8 | Lab Results: 6\n  Prescriptions: 5 | Vitals: 4 | Imaging: 2\nAnchor Method: SHA-256  XRPL Memo\nEstimated Fees: 0.000300 XRP\nCompliance: HIPAA-aligned, PHI never on-chain` }
            ]
        };

        let pgSessionHistory = [];
        let pgSelectedTemplate = null;
        let pgCurrentHash = '';
        let pgIsAnchoring = false;
        let pgLastTxHash = '';

        function initPlaygroundTemplates() {
            const grid = document.getElementById('pgTemplateGrid');
            if (!grid) return;
            const role = currentRole || 'patient';
            const templates = pgTemplates[role] || pgTemplates.patient;
            grid.innerHTML = templates.map((t, i) => `
                <div class="template-card ${pgSelectedTemplate === i ? 'selected' : ''}" onclick="selectPgTemplate(${i})">
                    <i class="${t.icon}" style="font-size: 1.3rem; margin-bottom: 6px;"></i>
                    <span style="font-size: 0.78rem; font-weight: 600;">${t.name}</span>
                </div>
            `).join('');
            renderPgHistory();
            updatePgSessionCounter();
            // Show tutorial on first visit
            if (!localStorage.getItem('pgTutorialSeen')) {
                setTimeout(showPlaygroundTutorial, 600);
            }
        }

        function selectPgTemplate(index) {
            const role = currentRole || 'patient';
            const templates = pgTemplates[role] || pgTemplates.patient;
            pgSelectedTemplate = index;
            const template = templates[index];
            document.querySelectorAll('.template-card').forEach((c, i) => c.classList.toggle('selected', i === index));
            document.getElementById('pgRecordType').textContent = template.type.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            const editor = document.getElementById('pgEditor');
            editor.value = template.content;
            activatePgStep(2);
            updatePgHashPreview();
        }

        async function updatePgHashPreview() {
            const editor = document.getElementById('pgEditor');
            const content = editor.value.trim();
            const hashEl = document.getElementById('pgHashValue');
            const anchorBtn = document.getElementById('pgAnchorBtn');
            if (!content) {
                hashEl.textContent = 'Enter or select a record to see its hash...';
                hashEl.style.opacity = '0.4';
                if (anchorBtn) anchorBtn.disabled = true;
                pgCurrentHash = '';
                return;
            }
            try {
                const buffer = new TextEncoder().encode(content);
                const hashBuffer = await crypto.subtle.digest('SHA-256', buffer);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                pgCurrentHash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                hashEl.textContent = pgCurrentHash;
                hashEl.style.opacity = '1';
                if (anchorBtn) anchorBtn.disabled = false;
                activatePgStep(3);
            } catch(e) {
                hashEl.textContent = 'Hash computation error';
                hashEl.style.opacity = '0.4';
            }
        }

        function activatePgStep(upTo) {
            for (let i = 1; i <= 4; i++) {
                const step = document.getElementById('pgStep' + i);
                if (step) step.classList.toggle('active', i <= upTo);
            }
        }

        function strToHex(str) {
            return Array.from(new TextEncoder().encode(str)).map(b => b.toString(16).padStart(2, '0')).join('');
        }

        async function anchorFromPlayground() {
            if (pgIsAnchoring || !pgCurrentHash) return;
            pgIsAnchoring = true;
            const anchorBtn = document.getElementById('pgAnchorBtn');
            const resultCard = document.getElementById('pgResultCard');
            const role = currentRole || 'patient';
            const templates = pgTemplates[role] || pgTemplates.patient;
            const recordType = pgSelectedTemplate !== null ? templates[pgSelectedTemplate].type : 'custom_record';
            anchorBtn.disabled = true;
            anchorBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Connecting to XRPL Testnet...';
            resultCard.style.display = 'none';
            activatePgStep(4);

            try {
                const client = new xrpl.Client("wss://s.altnet.rippletest.net:51233");
                await client.connect();

                anchorBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Preparing transaction...';
                const wallet = xrpl.Wallet.fromSeed("sEd75GpyfXbSLGUShjwvViXoo6xaGuZ");

                const memoData = 'solus:' + recordType + ':' + pgCurrentHash;
                const tx = {
                    TransactionType: "AccountSet",
                    Account: wallet.classicAddress,
                    Memos: [{
                        Memo: {
                            MemoType: strToHex("solus/anchor"),
                            MemoData: strToHex(memoData)
                        }
                    }]
                };

                anchorBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting to ledger...';
                const result = await client.submitAndWait(tx, { wallet });
                await client.disconnect();

                const txHash = result.result.hash;
                pgLastTxHash = txHash;
                const explorerUrl = 'https://testnet.xrpl.org/transactions/' + txHash;

                document.getElementById('pgResultHash').textContent = pgCurrentHash;
                document.getElementById('pgResultTx').textContent = txHash.substring(0, 20) + '...' + txHash.substring(txHash.length - 8);
                document.getElementById('pgResultTx').title = txHash;
                document.getElementById('pgResultTime').textContent = new Date().toLocaleTimeString();
                document.getElementById('pgResultExplorer').href = explorerUrl;
                resultCard.style.display = 'block';

                pgSessionHistory.unshift({
                    timestamp: new Date().toLocaleTimeString(),
                    recordType: recordType,
                    hash: pgCurrentHash.substring(0, 16) + '...',
                    fullHash: pgCurrentHash,
                    txHash: txHash,
                    explorerUrl: explorerUrl
                });
                renderPgHistory();
                updatePgSessionCounter();

                anchorBtn.innerHTML = '<i class="fas fa-check-circle"></i> Anchored Successfully!';
                anchorBtn.style.background = 'linear-gradient(135deg, #00c853, #00e676)';
                showNotification('Record anchored to XRPL! TX: ' + txHash.substring(0, 12) + '...', 'success');

                setTimeout(() => {
                    anchorBtn.innerHTML = '<i class="fas fa-anchor"></i> Anchor to XRPL Testnet';
                    anchorBtn.style.background = '';
                    anchorBtn.disabled = false;
                }, 3000);

            } catch(err) {
                console.error('Playground anchor error:', err);
                anchorBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error  Tap to Retry';
                anchorBtn.style.background = 'linear-gradient(135deg, #ff1744, #ff5252)';
                showNotification('Anchor failed: ' + (err.message || 'Connection error'), 'error');
                setTimeout(() => {
                    anchorBtn.innerHTML = '<i class="fas fa-anchor"></i> Anchor to XRPL Testnet';
                    anchorBtn.style.background = '';
                    anchorBtn.disabled = false;
                }, 3000);
            }
            pgIsAnchoring = false;
        }

        function updatePgSessionCounter() {
            const counter = document.getElementById('pgSessionCount');
            if (counter) counter.textContent = pgSessionHistory.length;
        }

        function renderPgHistory() {
            const container = document.getElementById('pgHistoryList');
            if (!container) return;
            if (pgSessionHistory.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted); font-size: 0.8rem;">No records anchored yet this session</div>';
                return;
            }
            container.innerHTML = pgSessionHistory.map(h => `
                <div class="pg-history-item" onclick="window.open('${h.explorerUrl}', '_blank')">
                    <div class="pg-history-dot"></div>
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-size: 0.82rem; font-weight: 600; margin-bottom: 2px;">${h.recordType.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</div>
                        <div style="font-size: 0.72rem; color: var(--text-muted); font-family: 'SF Mono', monospace;">${h.hash}</div>
                    </div>
                    <div style="text-align: right; flex-shrink: 0;">
                        <div style="font-size: 0.72rem; color: var(--accent);"><i class="fas fa-check-circle"></i></div>
                        <div style="font-size: 0.68rem; color: var(--text-muted);">${h.timestamp}</div>
                    </div>
                </div>
            `).join('');
        }

        function copyPgHash() {
            const hash = pgCurrentHash || (document.getElementById('pgResultHash') ? document.getElementById('pgResultHash').textContent : '');
            if (hash && hash.length === 64) {
                navigator.clipboard.writeText(hash).then(() => showNotification('Hash copied to clipboard!', 'success'));
            }
        }

        function openPgExplorer() {
            if (pgLastTxHash) window.open('https://testnet.xrpl.org/transactions/' + pgLastTxHash, '_blank');
        }

        function showPlaygroundTutorial() {
            const overlay = document.getElementById('pgTutorialOverlay');
            if (overlay) { overlay.classList.add('active'); localStorage.setItem('pgTutorialSeen', 'true'); }
        }

        function closePgTutorial() {
            const overlay = document.getElementById('pgTutorialOverlay');
            if (overlay) overlay.classList.remove('active');
        }

        // ===== KEYBOARD SHORTCUTS =====
        document.addEventListener('keydown', function(e) {
            // Don't fire if user is typing in an input
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') return;
            if (currentScreen === 'login') return;

            const key = e.key.toLowerCase();
            if (key === '?') {
                e.preventDefault();
                document.getElementById('shortcutsOverlay').classList.toggle('active');
            } else if (key === 'h') { navigateTo('home', document.querySelector('.nav-item')); }
            else if (key === 'r') { navigateTo('records', document.querySelectorAll('.nav-item')[1]); }
            else if (key === 't') { navigateTo('trade', document.querySelectorAll('.nav-item')[2]); }
            else if (key === 'a') { navigateTo('activity', document.querySelectorAll('.nav-item')[3]); }
            else if (key === 'm') { navigateToScreen('metricsScreen'); }
            else if (key === 'p') { navigateToScreen('sdkPlaygroundScreen'); initPlaygroundTemplates(); }
            else if (key === 'n') { openModal('addRecordModal'); }
            else if (key === 'd') { toggleTheme(); }
            else if (key === '/') { e.preventDefault(); navigateTo('records'); setTimeout(() => document.getElementById('recordSearchInput')?.focus(), 100); }
            else if (key === 'escape') {
                const shortcuts = document.getElementById('shortcutsOverlay');
                if (shortcuts.classList.contains('active')) { shortcuts.classList.remove('active'); }
                else if (document.getElementById('pgTutorialOverlay')?.classList.contains('active')) { closePgTutorial(); }
                else { logout(); }
            }
        });

        // Initialize heatmap on load
        setTimeout(renderHeatmap, 100);
    </script>
</body>
</html>
